/**
 * 
 * @source: https://github.com/wwwouaiebe/leaflet.TravelNotes
 * 
 * @licstart  The following is the entire license notice for the
 * JavaScript code in this page.
 * 
 * leaflet.travelnotes - version 2.2.0
 * Build 00721 - 2021-02-10T21:38:05+0100 
 * Copyright 2017 2021 wwwouaiebe 
 * Contact: https://www.ouaie.be/
 * License: GPL-3.0
 * 
 * The JavaScript code in this page is free software: you can
 * redistribute it and/or modify it under the terms of the GNU
 * General Public License (GNU GPL) as published by the Free Software
 * Foundation, either version 3 of the License, or (at your option)
 * any later version.  The code is distributed WITHOUT ANY WARRANTY;
 * without even the implied warranty of MERCHANTABILITY or FITNESS
 * FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.
 * 
 * As additional permission under GNU GPL version 3 section 7, you
 * may distribute non-source (e.g., minimized or compacted) forms of
 * that code without the copy of the GNU GPL normally required by
 * section 4, provided you include this license notice and a URL
 * through which recipients can access the Corresponding Source.
 * 
 * @licend  The above is the entire license notice
 * for the JavaScript code in this page.
 * 
 */


!function(){"use strict";
/**
	@------------------------------------------------------------------------------------------------------------------------------

	@file Constants.js
	@copyright Copyright - 2017 2021 - wwwouaiebe - Contact: https://www.ouaie.be/
	@license GNU General Public License
	@private

	@------------------------------------------------------------------------------------------------------------------------------
	*/Object.freeze({notSaved:"ðŸ”´",modified:"ðŸŸ¡",saved:"ðŸŸ¢"}),Object.freeze({fixed:2,invalid:-1,defaultValue:0,metersInKm:1e3}),Object.freeze({refusedByUser:-1,disabled:0,inactive:1,active:2}),Object.freeze({invalidPane:"43a6a53e-008a-4910-80a6-7a87d301ea15",itineraryPane:"8fbf0da7-4e6f-4bc7-8e20-1388461ccde7",travelNotesPane:"dffe782b-07df-4b81-a318-f287c0cf5ec6",searchPane:"228f00d7-43a8-4c13-897d-70400cb6dd58"}),Object.freeze({fixed:2,defaultValue:0}),Object.freeze({defaultValue:0,fixed:6,maxLat:90,minLat:-90,maxLng:180,minLng:-180}),Object.freeze({notEdited:0,editedNoChange:1,editedChanged:2}),Object.freeze({margin:100,height:500,width:1e3,yDeltaText:30,xDeltaText:10,vScales:[1,2,5,10,20,50,100,200,500,1e3,2e3,5e3],hScales:[1,2,5,10,20,50,100,200,500,1e3,2e3,5e3,1e4,2e4,5e4,1e5]}),Object.freeze({width:40,height:40,svgViewboxDim:200}),Object.freeze({d0:0,d90:90,d180:180,d270:270,d360:360,d540:540,toRadians:Math.PI/180,fromRadians:180/Math.PI});const e=window.location.protocol,t=new DOMParser;let r=new Map;function o(e){return e.replaceAll(/</g,"&lt;").replaceAll(/>/g,"&gt;").replaceAll(/"/g,"&quot;").replaceAll(/\u0027/g,"&apos;").replaceAll(/\u0a00/g,"&nbsp;")}function n(r,o="href"){let n=t.parseFromString("<div>"+r+"</div>","text/html");if(!n||"#document"!==n.nodeName)return{url:"",errorsString:"Parsing error"};let l=n.querySelector("body").firstChild,a="";for(let e=0;e<l.childNodes.length;e++){if("#text"!==l.childNodes[e].nodeName)return{url:"",errorsString:"Invalid characters found in the url"};a+=l.childNodes[e].nodeValue}if(a=a.replaceAll(/</g,"").replaceAll(/>/g,"").replaceAll(/"/g,"").replaceAll(/\u0027/g,"").replaceAll(/&lt;/g,"").replaceAll(/&gt;/g,"").replaceAll(/&quot;/g,"").replaceAll(/&apos;/g,"").replaceAll(/%3C/g,"").replaceAll(/%3c/g,"").replaceAll(/%3E/g,"").replaceAll(/%3e/g,"").replaceAll(/%22/g,"").replaceAll(/%27/g,""),a!==r)return{url:"",errorsString:"Invalid characters found in the url"};let s=["https:"];if("http:"!==e&&"href"!==o||s.push("http:"),"href"===o){s.push("mailto:"),s.push("sms:"),s.push("tel:");let e=a.match(/^#\w*/);if(e&&a===e[0])return{url:a,errorsString:""}}"src"===o&&s.push("data:");let i=null;try{i=new URL(a)}catch(e){return{url:"",errorsString:"Invalid url string"}}if(-1===s.indexOf(i.protocol))return{url:"",errorsString:"Invalid protocol "+i.protocol};if(-1!==["sms:","tel:"].indexOf(i.protocol)&&i.pathname.match(/^\+[0-9,*,#]*$/))return{url:a,errorsString:""};try{encodeURIComponent(i.href)}catch(e){return{url:"",errorsString:"Invalid character in url"}}return{url:a,errorsString:""}}r.set("a",["href","target"]),r.set("div",[]),r.set("del",[]),r.set("em",[]),r.set("figcaption",[]),r.set("figure",[]),r.set("h1",[]),r.set("h2",[]),r.set("h3",[]),r.set("h4",[]),r.set("h5",[]),r.set("h6",[]),r.set("hr",[]),r.set("img",["src","alt","width","height"]),r.set("ins",[]),r.set("li",[]),r.set("mark",[]),r.set("ol",[]),r.set("p",[]),r.set("s",[]),r.set("small",[]),r.set("strong",[]),r.set("span",[]),r.set("sub",[]),r.set("sup",[]),r.set("ul",[]),r.set("svg",["xmlns","viewBox","class"]),r.set("text",["x","y","text-anchor"]),r.set("polyline",["points","class","transform"]);const l=Object.freeze(new class{sanitizeToColor(e){let t=e.match(/^#[0-9,A-F,a-f]{6}$/);return t?t[0]:null}sanitizeToUrl(e,t){return n(e,t)}sanitizeToJsString(e){return function(e){let r=t.parseFromString("<div>"+e+"</div>","text/html");if(!r||"#document"!==r.nodeName)return"";let o=r.querySelector("body").firstChild,n="";for(let e=0;e<o.childNodes.length;e++){if("#text"!==o.childNodes[e].nodeName)return"";n+=o.childNodes[e].nodeValue}return n=n.replaceAll(/</g,"â‰º").replaceAll(/>/g,"â‰»").replaceAll(/"/g,"â€³").replaceAll(/\u0027/g,"â€²"),n}(e)}sanitizeToHtmlElement(e,o){!function(e,o){let l=t.parseFromString("<div>"+e+"</div>","text/html");l&&"#document"===l.nodeName?function e(t,o){let l=t.childNodes;for(let a=0;a<l.length;a++){let l=t.childNodes[a],s=l.nodeName.toLowerCase(),i=r.get(s);if(i){i=i.concat(["id","class","dir","title","tanwidth","tanheight"]);let t="svg"===s||"text"===s||"polyline"===s,r=t?document.createElementNS("http://www.w3.org/2000/svg",s):document.createElement(s);if(i.forEach(e=>{if(t)l.hasAttributeNS(null,e)&&(r.setAttributeNS(null,e,l.getAttribute(e)),l.removeAttributeNS(null,e));else if(l.hasAttribute(e))if("href"===e||"src"===e){let t=n(l.getAttribute(e),e).url;""!==t&&r.setAttribute(e,t)}else r.setAttribute(e,l.getAttribute(e))}),l.hasAttribute("style")){l.getAttribute("style").split(";").forEach(e=>{let t=e.split(":");2!==t.length||"width"!==t[0].trim()&&"height"!==t[0].trim()||(r.style[t[0].trim()]=t[1].trim())})}o.appendChild(r),e(l,r)}else"#text"===s&&o.appendChild(document.createTextNode(l.nodeValue))}}(l.querySelector("body").firstChild,o):o.textContent=""}(e,o)}sanitizeToHtmlString(e){return function(e){let l="",a="",s=t.parseFromString("<div>"+e.replace("&nbsp;","à¨€")+"</div>","text/html");return s&&"#document"===s.nodeName?(function e(t){let s=t.childNodes;for(let i=0;i<s.length;i++){let s=t.childNodes[i],d=s.nodeName.toLowerCase(),c=r.get(d);if(c){c=c.concat(["id","class","dir","title","tanwidth","tanheight"]);let t="svg"===d||"text"===d||"polyline"===d;l+="<"+d,c.forEach(e=>{if(t)s.hasAttributeNS(null,e)&&(l+=" "+e+'="'+o(s.getAttribute(e))+'"',s.removeAttribute(e));else if(s.hasAttribute(e))if("href"===e||"src"===e){let t=n(s.getAttribute(e),e).url;""===t?a+="\nAn invalid url ("+s.getAttribute(e)+") was removed from a "+e+" attribute":l+=" "+e+'="'+t+'"',s.removeAttribute(e)}else l+=" "+e+'="'+o(s.getAttribute(e))+'"',s.removeAttribute(e)}),l+=">",e(s),l+="</"+d+">"}else"#text"===d?l+=o(s.nodeValue):a+="\nAn invalid tag "+d+" was removed";if(s.hasAttributes)for(let e=0;e<s.attributes.length;e++)a+="\nAn unsecure attribute "+s.attributes[e].name+'="'+s.attributes[e].value+'" was removed.'}}(s.querySelector("body").firstChild),{htmlString:l,errorsString:a}):{htmlString:"",errorsString:"Parsing error"}}(e)}});let a=new Map;const s=new class{constructor(){Object.freeze(this)}setTranslations(e){e.forEach(e=>a.set(e.msgid,l.sanitizeToJsString(e.msgstr)))}getText(e,t){let r=a.get(e);return t&&r&&Object.getOwnPropertyNames(t).forEach(e=>r=r.replace("{"+e+"}",t[e])),r||e}};
/**
	@------------------------------------------------------------------------------------------------------------------------------

	@file IndexedDb.js
	@copyright Copyright - 2017 2021 - wwwouaiebe - Contact: https://www.ouaie.be/
	@license GNU General Public License
	@private

	@------------------------------------------------------------------------------------------------------------------------------
	*/let i=null;const d=new class{constructor(){Object.freeze(this)}getOpenPromise(){return new Promise((function(e,t){if(i)return void e();let r=window.indexedDB.open("TravelNotesDb",1);r.onerror=function(){i=null,t(new Error("Not possible to open the db"))},r.onsuccess=function(t){i=t.target.result,e()},r.onupgradeneeded=function(e){i=e.target.result,i.createObjectStore("Travels",{keyPath:"UUID"})}}))}getReadPromise(e){return new Promise((function(t,r){if(!i)return void r(new Error("Database not opened"));let o=i.transaction(["Travels"],"readonly");o.onerror=function(){r(new Error("Transaction error"))},o.objectStore("Travels").get(e).onsuccess=function(e){t(e.target.result?e.target.result.data:null)}}))}getWritePromise(e,t){return new Promise((function(r,o){if(!i)return void o(new Error("Database not opened"));let n=null;try{n=i.transaction(["Travels"],"readwrite")}catch(e){return void o(e)}n.onerror=function(){o(new Error("Transaction error"))},n.objectStore("Travels").put({UUID:e,data:t}).onsuccess=function(){r()}}))}closeDb(e){if(!i)return;if(!e)return i.close(),void(i=null);let t=i.transaction(["Travels"],"readwrite");t.onerror=function(){};let r=t.objectStore("Travels").delete(e);r.onerror=function(){i.close(),i=null},r.onsuccess=function(){i.close(),i=null}}};let c=new URLSearchParams(document.location.search.substring(1)),u=c.get("lng"),h=c.get("page");function m(){let e=document.getElementById("TravelNotes-Travel-ShowNotes").checked,t=document.getElementsByClassName("TravelNotes-Roadbook-Travel-Notes-Row");for(let r=0;r<t.length;r++)e?t[r].classList.remove("TravelNotes-Hidden"):t[r].classList.add("TravelNotes-Hidden")}function g(){let e=document.getElementById("TravelNotes-Routes-ShowNotes").checked,t=document.getElementsByClassName("TravelNotes-Roadbook-Route-Notes-Row");for(let r=0;r<t.length;r++)e?t[r].classList.remove("TravelNotes-Hidden"):t[r].classList.add("TravelNotes-Hidden")}function f(){let e=document.getElementById("TravelNotes-Routes-ShowManeuvers").checked,t=document.getElementsByClassName("TravelNotes-Roadbook-Route-Maneuvers-Row");for(let r=0;r<t.length;r++)e?t[r].classList.remove("TravelNotes-Hidden"):t[r].classList.add("TravelNotes-Hidden")}function v(){document.querySelectorAll(".TravelNotes-Roadbook-Route-ManeuversAndNotes-IconCell, .TravelNotes-Roadbook-Travel-Notes-IconCell").forEach(e=>{let t=e.getAttribute("tanwidth");t&&(e.style.width=t);let r=e.getAttribute("tanheight");r&&(e.style.height=r)})}function b(e){document.getElementById("TravelNotes").textContent="",l.sanitizeToHtmlElement(e,document.getElementById("TravelNotes"));let t=document.querySelector(".TravelNotes-Roadbook-Travel-Header-Name");t&&(document.title=""===t.textContent?"roadbook":t.textContent+" - roadbook"),v(),m(),g(),f()}document.getElementById("TravelNotes-Travel-ShowNotes").addEventListener("change",m),document.getElementById("TravelNotes-Routes-ShowNotes").addEventListener("change",g),document.getElementById("TravelNotes-Routes-ShowManeuvers").addEventListener("change",f),h?(u&&fetch(window.location.href.substr(0,window.location.href.lastIndexOf("/")+1)+"TravelNotes"+u.toUpperCase()+".json").then(e=>{200===e.status&&e.ok&&e.json().then(e=>{s.setTranslations(e),document.getElementById("TravelNotes-Travel-ShowNotesLabel").textContent=s.getText("Roadbook - show travel notes"),document.getElementById("TravelNotes-Routes-ShowManeuversLabel").textContent=s.getText("Roadbook - show maneuver"),document.getElementById("TravelNotes-Routes-ShowNotesLabel").textContent=s.getText("Roadbook - show routes notes"),document.getElementById("TravelNotes-SaveButton").textContent=s.getText("Roadbook - Save")}).catch(e=>{e instanceof Error&&console.error(e)})}),function(){let e=document.createElement("button");e.id="TravelNotes-SaveButton",document.getElementById("TravelNotes-Roadbook-Menu").appendChild(e),e.addEventListener("click",(function(){try{let e=document.querySelector(".TravelNotes-Roadbook-Travel-Header-Name").textContent+"-Roadbook.html",t=document.getElementById("TravelNotes-Roadbook-Menu").removeChild(document.getElementById("TravelNotes-SaveButton")),r=window.URL.createObjectURL(new File(["<!DOCTYPE html>",document.documentElement.outerHTML],e,{type:"text/plain"})),o=document.createElement("a");o.setAttribute("href",r),o.setAttribute("download",e),o.style.display="none",document.body.appendChild(o),o.click(),document.body.removeChild(o),window.URL.revokeObjectURL(r),document.getElementById("TravelNotes-Roadbook-Menu").appendChild(t)}catch(e){e instanceof Error&&console.error(e)}}))}(),h?(d.getOpenPromise().then(()=>d.getReadPromise(h)).then(b).catch(e=>{e instanceof Error&&console.error(e)}),window.addEventListener("storage",()=>{d.getReadPromise(h).then(e=>{e?b(e):document.getElementById("TravelNotes").textContent=""}).catch(e=>{e instanceof Error&&console.error(e)})}),window.addEventListener("unload",()=>{d.closeDb()})):document.getElementById("TravelNotes-Roadbook-Menu").removeChild(document.getElementById("TravelNotes-ButtonContainer"))):v(),m(),g(),f()}();
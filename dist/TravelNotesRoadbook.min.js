/**
 * 
 * @source: https://github.com/wwwouaiebe/leaflet.TravelNotes
 * 
 * @licstart  The following is the entire license notice for the
 * JavaScript code in this page.
 * 
 * leaflet.travelnotes - version 2.1.0
 * Build 00425 - 2021-01-19T22:44:04+0100 
 * Copyright 2017 2021 wwwouaiebe 
 * Contact: https://www.ouaie.be/
 * License: GPL-3.0
 * 
 * The JavaScript code in this page is free software: you can
 * redistribute it and/or modify it under the terms of the GNU
 * General Public License (GNU GPL) as published by the Free Software
 * Foundation, either version 3 of the License, or (at your option)
 * any later version.  The code is distributed WITHOUT ANY WARRANTY;
 * without even the implied warranty of MERCHANTABILITY or FITNESS
 * FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.
 * 
 * As additional permission under GNU GPL version 3 section 7, you
 * may distribute non-source (e.g., minimized or compacted) forms of
 * that code without the copy of the GNU GPL normally required by
 * section 4, provided you include this license notice and a URL
 * through which recipients can access the Corresponding Source.
 * 
 * @licend  The above is the entire license notice
 * for the JavaScript code in this page.
 * 
 */


!function(){"use strict";
/**
	@------------------------------------------------------------------------------------------------------------------------------

	@file Constants.js
	@copyright Copyright - 2017 2021 - wwwouaiebe - Contact: https://www.ouaie.be/
	@license GNU General Public License
	@private

	@------------------------------------------------------------------------------------------------------------------------------
	*/Object.freeze({fixed:2,invalid:-1,defaultValue:0}),Object.freeze({refusedByUser:-1,disabled:0,inactive:1,active:2}),Object.freeze({invalidPane:"43a6a53e-008a-4910-80a6-7a87d301ea15",itineraryPane:"8fbf0da7-4e6f-4bc7-8e20-1388461ccde7",travelNotesPane:"dffe782b-07df-4b81-a318-f287c0cf5ec6",searchPane:"228f00d7-43a8-4c13-897d-70400cb6dd58"}),Object.freeze({fixed:2,defaultValue:0}),Object.freeze({defaultValue:0,fixed:6}),Object.freeze({notEdited:0,editedNoChange:1,editedChanged:2}),Object.freeze({margin:100,height:500,width:1e3,yDeltaText:30,xDeltaText:10,vScales:[1,2,5,10,20,50,100,200,500,1e3,2e3,5e3],hScales:[1,2,5,10,20,50,100,200,500,1e3,2e3,5e3,1e4,2e4,5e4,1e5]}),Object.freeze({width:40,height:40,svgViewboxDim:200});let e=new Map;e.set("a",["href","target"]),e.set("div",[]),e.set("del",[]),e.set("em",[]),e.set("figcaption",[]),e.set("figure",[]),e.set("h1",[]),e.set("h2",[]),e.set("h3",[]),e.set("h4",[]),e.set("h5",[]),e.set("h6",[]),e.set("hr",[]),e.set("img",["src","alt","width","height"]),e.set("ins",[]),e.set("li",[]),e.set("mark",[]),e.set("ol",[]),e.set("p",[]),e.set("s",[]),e.set("small",[]),e.set("strong",[]),e.set("span",[]),e.set("sub",[]),e.set("sup",[]),e.set("ul",[]),e.set("svg",["xmlns","viewBox","class"]),e.set("text",["x","y","text-anchor"]),e.set("polyline",["points","class","transform"]);const t=window.location.protocol,r=new DOMParser;function o(e){return e.replaceAll(/</g,"&lt;").replaceAll(/>/g,"&gt;").replaceAll(/"/g,"&quot;").replaceAll(/\u0027/g,"&apos;").replaceAll(/\u0a00/g,"&nbsp;")}function n(e,o="href"){let n=r.parseFromString("<div>"+e+"</div>","text/html");if(!n||"#document"!==n.nodeName)return{url:"",errorsString:"Parsing error"};let l=n.querySelector("body").firstChild,s="";for(let e=0;e<l.childNodes.length;e++){if("#text"!==l.childNodes[e].nodeName)return{url:"",errorsString:"Invalid characters found in the url"};s+=l.childNodes[e].nodeValue}if(s=s.replaceAll(/</g,"").replaceAll(/>/g,"").replaceAll(/"/g,"").replaceAll(/\u0027/g,"").replaceAll(/&lt;/g,"").replaceAll(/&gt;/g,"").replaceAll(/&quot;/g,"").replaceAll(/&apos;/g,"").replaceAll(/%3C/g,"").replaceAll(/%3c/g,"").replaceAll(/%3E/g,"").replaceAll(/%3e/g,"").replaceAll(/%22/g,"").replaceAll(/%27/g,""),s!==e)return{url:"",errorsString:"Invalid characters found in the url"};let a=["https:"];if("http:"!==t&&"href"!==o||a.push("http:"),"href"===o){a.push("mailto:"),a.push("sms:"),a.push("tel:");let e=s.match(/^#\w*/);if(e&&s===e[0])return{url:s,errorsString:""}}"src"===o&&a.push("data:");let i=null;try{i=new URL(s)}catch(e){return{url:"",errorsString:"Invalid url string"}}if(-1===a.indexOf(i.protocol))return{url:"",errorsString:"Invalid protocol "+i.protocol};if(-1!==["sms:","tel:"].indexOf(i.protocol)&&i.pathname.match(/^\+[0-9,*,#]*$/))return{url:s,errorsString:""};try{encodeURIComponent(i.href)}catch(e){return{url:"",errorsString:"Invalid character in url"}}return{url:s,errorsString:""}}const l=Object.freeze(new class{sanitizeToColor(e){let t=e.match(/^#[0-9,A-F,a-f]{6}$/);return t?t[0]:null}sanitizeToUrl(e,t){return n(e,t)}sanitizeToJsString(e){return function(e){let t=r.parseFromString("<div>"+e+"</div>","text/html");if(!t||"#document"!==t.nodeName)return"";let o=t.querySelector("body").firstChild,n="";for(let e=0;e<o.childNodes.length;e++){if("#text"!==o.childNodes[e].nodeName)return"";n+=o.childNodes[e].nodeValue}return n=n.replaceAll(/</g,"≺").replaceAll(/>/g,"≻").replaceAll(/"/g,"″").replaceAll(/\u0027/g,"′"),n}(e)}sanitizeToHtmlElement(t,o){!function(t,o){let l=r.parseFromString("<div>"+t+"</div>","text/html");l&&"#document"===l.nodeName?function t(r,o){let l=r.childNodes;for(let s=0;s<l.length;s++){let l=r.childNodes[s],a=l.nodeName.toLowerCase(),i=e.get(a);if(i){i=i.concat(["id","class","dir","title"]);let e="svg"===a||"text"===a||"polyline"===a,r=e?document.createElementNS("http://www.w3.org/2000/svg",a):document.createElement(a);if(i.forEach(t=>{if(e)l.hasAttributeNS(null,t)&&(r.setAttributeNS(null,t,l.getAttribute(t)),l.removeAttributeNS(null,t));else if(l.hasAttribute(t))if("href"===t||"src"===t){let e=n(l.getAttribute(t),t).url;""!==e&&r.setAttribute(t,e)}else r.setAttribute(t,l.getAttribute(t))}),l.hasAttribute("style")){l.getAttribute("style").split(";").forEach(e=>{let t=e.split(":");2!==t.length||"width"!==t[0].trim()&&"height"!==t[0].trim()||(r.style[t[0].trim()]=t[1].trim())})}o.appendChild(r),t(l,r)}else"#text"===a&&o.appendChild(document.createTextNode(l.nodeValue))}}(l.querySelector("body").firstChild,o):o.textContent=""}(t,o)}sanitizeToHtmlString(t){return function(t){let l="",s="",a=r.parseFromString("<div>"+t.replace("&nbsp;","਀")+"</div>","text/html");return a&&"#document"===a.nodeName?(function t(r){let a=r.childNodes;for(let i=0;i<a.length;i++){let a=r.childNodes[i],c=a.nodeName.toLowerCase(),u=e.get(c);if(u){u=u.concat(["id","class","dir","title"]);let e="svg"===c||"text"===c||"polyline"===c;l+="<"+c,u.forEach(t=>{if(e)a.hasAttributeNS(null,t)&&(l+=" "+t+'="'+o(a.getAttribute(t))+'"',a.removeAttribute(t));else if(a.hasAttribute(t))if("href"===t||"src"===t){let e=n(a.getAttribute(t),t).url;""===e?s+="\nAn invalid url ("+a.getAttribute(t)+") was removed from a "+t+" attribute":l+=" "+t+'="'+e+'"',a.removeAttribute(t)}else l+=" "+t+'="'+o(a.getAttribute(t))+'"',a.removeAttribute(t)}),l+=">",t(a),l+="</"+c+">"}else"#text"===c?l+=o(a.nodeValue):s+="\nAn invalid tag "+c+" was removed";if(a.hasAttributes)for(let e=0;e<a.attributes.length;e++)s+="\nAn unsecure attribute "+a.attributes[e].name+'="'+a.attributes[e].value+'" was removed.'}}(a.querySelector("body").firstChild),{htmlString:l,errorsString:s}):{htmlString:"",errorsString:"Parsing error"}}(t)}});let s=new Map;const a=Object.freeze(new class{setTranslations(e){e.forEach(e=>s.set(e.msgid,l.sanitizeToJsString(e.msgstr)))}getText(e,t){let r=s.get(e);return t&&r&&Object.getOwnPropertyNames(t).forEach(e=>r=r.replace("{"+e+"}",t[e])),r||e}});const i=Object.freeze(new
/**
	@------------------------------------------------------------------------------------------------------------------------------

	@file HttpRequestBuilder.js
	@copyright Copyright - 2017 2021 - wwwouaiebe - Contact: https://www.ouaie.be/
	@license GNU General Public License
	@private

	@------------------------------------------------------------------------------------------------------------------------------
	*/
class{getTextPromise(e,t){return new Promise((function(r,o){let n=new XMLHttpRequest;n.timeout=4e4,n.ontimeout=function(){o("XMLHttpRequest TimeOut. File : "+n.responseURL)},n.onreadystatechange=function(){4===n.readyState&&(200===n.status?r(n.responseText):o("Error XMLHttpRequest - File : "+n.responseURL))},n.open("GET",e,!0),t&&t.forEach(e=>n.setRequestHeader(e.headerName,e.headerValue)),n.overrideMimeType("text/plain"),n.send(null)}))}getJsonPromise(e,t){return new Promise((function(r,o){let n=new XMLHttpRequest;n.timeout=4e4,n.ontimeout=function(){o("XMLHttpRequest TimeOut. File : "+n.responseURL)},n.onreadystatechange=function(){if(4===n.readyState)if(200===n.status){let e=null;try{e=JSON.parse(n.responseText)}catch(e){o(e.message+" File: "+n.responseURL)}r(e)}else o("Error XMLHttpRequest - File : "+n.responseURL)},n.open("GET",e,!0),t&&t.forEach(e=>n.setRequestHeader(e.headerName,e.headerValue)),n.overrideMimeType("application/json"),n.send(null)}))}getBinaryPromise(e,t){return new Promise((function(r,o){let n=new XMLHttpRequest;n.timeout=4e4,n.ontimeout=function(){o("XMLHttpRequest TimeOut. File : "+n.responseURL)},n.onload=function(){if(200===n.status){let e=n.response;e?r(e):o("Error XMLHttpRequest - File : "+n.responseURL)}else o("Error XMLHttpRequest - File : "+n.responseURL)},n.open("GET",e,!0),t&&t.forEach(e=>n.setRequestHeader(e.headerName,e.headerValue)),n.responseType="arraybuffer",n.send(null)}))}});
/**
	@------------------------------------------------------------------------------------------------------------------------------

	@file IndexedDb.js
	@copyright Copyright - 2017 2021 - wwwouaiebe - Contact: https://www.ouaie.be/
	@license GNU General Public License
	@private

	@------------------------------------------------------------------------------------------------------------------------------
	*/let c=null;const u=Object.freeze(new class{getOpenPromise(){return new Promise((function(e,t){if(c)return void e();let r=window.indexedDB.open("TravelNotesDb",1);r.onerror=function(){c=null,t(new Error("Not possible to open the db"))},r.onsuccess=function(t){c=t.target.result,e()},r.onupgradeneeded=function(e){c=e.target.result,c.createObjectStore("Travels",{keyPath:"UUID"})}}))}getReadPromise(e){return new Promise((function(t,r){if(!c)return void r(new Error("Database not opened"));let o=c.transaction(["Travels"],"readonly");o.onerror=function(){r(new Error("Transaction error"))},o.objectStore("Travels").get(e).onsuccess=function(e){t(e.target.result?e.target.result.data:null)}}))}getWritePromise(e,t){return new Promise((function(r,o){if(!c)return void o(new Error("Database not opened"));let n=null;try{n=c.transaction(["Travels"],"readwrite")}catch(e){return void o(e)}n.onerror=function(){o(new Error("Transaction error"))},n.objectStore("Travels").put({UUID:e,data:t}).onsuccess=function(){r()}}))}closeDb(e){if(!c)return;if(!e)return c.close(),void(c=null);let t=c.transaction(["Travels"],"readwrite");t.onerror=function(){};let r=t.objectStore("Travels").delete(e);r.onerror=function(){c.close(),c=null},r.onsuccess=function(){c.close(),c=null}}});function d(){let e=document.getElementById("TravelNotes-Travel-ShowNotes").checked,t=document.getElementsByClassName("TravelNotes-Roadbook-Travel-Notes-Row");for(let r=0;r<t.length;r++)e?t[r].classList.remove("TravelNotes-Roadbook-Hidden-Row"):t[r].classList.add("TravelNotes-Roadbook-Hidden-Row")}function g(){let e=document.getElementById("TravelNotes-Routes-ShowNotes").checked,t=document.getElementsByClassName("TravelNotes-Roadbook-Route-Notes-Row");for(let r=0;r<t.length;r++)e?t[r].classList.remove("TravelNotes-Roadbook-Hidden-Row"):t[r].classList.add("TravelNotes-Roadbook-Hidden-Row")}function h(){let e=document.getElementById("TravelNotes-Routes-ShowManeuvers").checked,t=document.getElementsByClassName("TravelNotes-Roadbook-Route-Maneuvers-Row");for(let r=0;r<t.length;r++)e?t[r].classList.remove("TravelNotes-Roadbook-Hidden-Row"):t[r].classList.add("TravelNotes-Roadbook-Hidden-Row")}function m(e){document.getElementById("TravelNotes").textContent="",l.sanitizeToHtmlElement(e,document.getElementById("TravelNotes"));let t=document.querySelector(".TravelNotes-Roadbook-Travel-Header-Name");t&&(document.title=""===t.textContent?"roadbook":t.textContent+" - roadbook"),d(),g(),h()}document.getElementById("TravelNotes-Travel-ShowNotes").addEventListener("change",d),document.getElementById("TravelNotes-Routes-ShowNotes").addEventListener("change",g),document.getElementById("TravelNotes-Routes-ShowManeuvers").addEventListener("change",h);let f=new URLSearchParams(document.location.search.substring(1)),p=f.get("lng"),v=f.get("page");v?(u.getOpenPromise().then(()=>u.getReadPromise(v)).then(e=>{m(e)}).catch(e=>console.log(e||"An error occurs when loading the content")),window.addEventListener("storage",()=>{u.getReadPromise(v).then(e=>{e?m(e):document.getElementById("TravelNotes").textContent=""}).catch(e=>console.log(e||"An error occurs when loading the content"))}),window.addEventListener("unload",()=>{u.closeDb()})):document.getElementById("TravelNotes-Menu").removeChild(document.getElementById("TravelNotes-ButtonContainer")),p&&i.getJsonPromise(window.location.href.substr(0,window.location.href.lastIndexOf("/")+1)+"TravelNotes"+p.toUpperCase()+".json").then(e=>{a.setTranslations(e),document.getElementById("TravelNotes-Travel-ShowNotesLabel").textContent=a.getText("Roadbook - show travel notes"),document.getElementById("TravelNotes-Routes-ShowManeuversLabel").textContent=a.getText("Roadbook - show maneuver"),document.getElementById("TravelNotes-Routes-ShowNotesLabel").textContent=a.getText("Roadbook - show routes notes")}).catch(e=>console.log(e||"An error occurs when loading translation")),d(),g(),h()}();
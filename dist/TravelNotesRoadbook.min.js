/**
 * 
 * @source: https://github.com/wwwouaiebe/leaflet.TravelNotes
 * 
 * @licstart  The following is the entire license notice for the
 * JavaScript code in this page.
 * 
 * leaflet.travelnotes - version 2.0.0
 * Build 00313 - 2020-12-30T21:06:31+0100 
 * Copyright 2017 2020 wwwouaiebe 
 * Contact: https://www.ouaie.be/
 * License: GPL-3.0
 * 
 * The JavaScript code in this page is free software: you can
 * redistribute it and/or modify it under the terms of the GNU
 * General Public License (GNU GPL) as published by the Free Software
 * Foundation, either version 3 of the License, or (at your option)
 * any later version.  The code is distributed WITHOUT ANY WARRANTY;
 * without even the implied warranty of MERCHANTABILITY or FITNESS
 * FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.
 * 
 * As additional permission under GNU GPL version 3 section 7, you
 * may distribute non-source (e.g., minimized or compacted) forms of
 * that code without the copy of the GNU GPL normally required by
 * section 4, provided you include this license notice and a URL
 * through which recipients can access the Corresponding Source.
 * 
 * @licend  The above is the entire license notice
 * for the JavaScript code in this page.
 * 
 */


!function(){"use strict";
/**
	@------------------------------------------------------------------------------------------------------------------------------

	@file Translator.js
	@copyright Copyright - 2017 2021 - wwwouaiebe - Contact: https://www.ouaie.be/
	@license GNU General Public License
	@private

	@------------------------------------------------------------------------------------------------------------------------------
	*/let e=new Map;const t=Object.freeze(new class{setTranslations(t){t.forEach(t=>e.set(t.msgid,t.msgstr.replace(/>|&gt;/gi,"â‰»").replace(/<|&lt;/gi,"â‰º").replace(/'|&apos;/gi,"â€²").replace(/"|&quot;/gi,"â€³")))}getText(t,o){let r=e.get(t);return o&&r&&Object.getOwnPropertyNames(o).forEach(e=>r=r.replace("{"+e+"}",o[e])),r||t}});const o=Object.freeze(new
/**
	@------------------------------------------------------------------------------------------------------------------------------

	@file HttpRequestBuilder.js
	@copyright Copyright - 2017 2021 - wwwouaiebe - Contact: https://www.ouaie.be/
	@license GNU General Public License
	@private

	@------------------------------------------------------------------------------------------------------------------------------
	*/
class{getTextPromise(e,t){return new Promise((function(o,r){let n=new XMLHttpRequest;n.timeout=4e4,n.ontimeout=function(){r("XMLHttpRequest TimeOut. File : "+n.responseURL)},n.onreadystatechange=function(){4===n.readyState&&(200===n.status?o(n.responseText):r("Error XMLHttpRequest - File : "+n.responseURL))},n.open("GET",e,!0),t&&t.forEach(e=>n.setRequestHeader(e.headerName,e.headerValue)),n.overrideMimeType("text/plain"),n.send(null)}))}getJsonPromise(e,t){return new Promise((function(o,r){let n=new XMLHttpRequest;n.timeout=4e4,n.ontimeout=function(){r("XMLHttpRequest TimeOut. File : "+n.responseURL)},n.onreadystatechange=function(){if(4===n.readyState)if(200===n.status){let e=null;try{e=JSON.parse(n.responseText)}catch(e){r(e.message+" File: "+n.responseURL)}o(e)}else r("Error XMLHttpRequest - File : "+n.responseURL)},n.open("GET",e,!0),t&&t.forEach(e=>n.setRequestHeader(e.headerName,e.headerValue)),n.overrideMimeType("application/json"),n.send(null)}))}getBinaryPromise(e,t){return new Promise((function(o,r){let n=new XMLHttpRequest;n.timeout=4e4,n.ontimeout=function(){r("XMLHttpRequest TimeOut. File : "+n.responseURL)},n.onload=function(){if(200===n.status){let e=n.response;e?o(e):r("Error XMLHttpRequest - File : "+n.responseURL)}else r("Error XMLHttpRequest - File : "+n.responseURL)},n.open("GET",e,!0),t&&t.forEach(e=>n.setRequestHeader(e.headerName,e.headerValue)),n.responseType="arraybuffer",n.send(null)}))}});
/**
	@------------------------------------------------------------------------------------------------------------------------------

	@file Constants.js
	@copyright Copyright - 2017 2021 - wwwouaiebe - Contact: https://www.ouaie.be/
	@license GNU General Public License
	@private

	@------------------------------------------------------------------------------------------------------------------------------
	*/Object.freeze({fixed:2,invalid:-1,defaultValue:0}),Object.freeze({refusedByUser:-1,disabled:0,inactive:1,active:2}),Object.freeze({invalidPane:"43a6a53e-008a-4910-80a6-7a87d301ea15",itineraryPane:"8fbf0da7-4e6f-4bc7-8e20-1388461ccde7",travelNotesPane:"dffe782b-07df-4b81-a318-f287c0cf5ec6",searchPane:"228f00d7-43a8-4c13-897d-70400cb6dd58"}),Object.freeze({fixed:2,defaultValue:0}),Object.freeze({defaultValue:0,fixed:6}),Object.freeze({notEdited:0,editedNoChange:1,editedChanged:2}),Object.freeze({margin:100,height:500,width:1e3,yDeltaText:30,xDeltaText:10,vScales:[1,2,5,10,20,50,100,200,500,1e3,2e3,5e3],hScales:[1,2,5,10,20,50,100,200,500,1e3,2e3,5e3,1e4,2e4,5e4,1e5]}),Object.freeze({width:40,height:40});let r=new Map;r.set("a",["href","target"]),r.set("br",[]),r.set("div",[]),r.set("del",[]),r.set("em",[]),r.set("figcaption",[]),r.set("figure",[]),r.set("h1",[]),r.set("h2",[]),r.set("h3",[]),r.set("h4",[]),r.set("h5",[]),r.set("h6",[]),r.set("hr",[]),r.set("img",["src","alt"]),r.set("ins",[]),r.set("li",[]),r.set("mark",[]),r.set("ol",[]),r.set("p",[]),r.set("s",[]),r.set("small",[]),r.set("strong",[]),r.set("span",[]),r.set("sub",[]),r.set("sup",[]),r.set("ul",[]),r.set("svg",["xmlns","viewBox","class"]),r.set("text",["x","y","text-anchor"]),r.set("polyline",["points","class","transform"]);const n=window.location.protocol;function s(e,t){let o=null;try{o=new URL(e)}catch(e){return""}let r=["https:"];return"http:"===n&&r.push("http:"),"href"===t&&r.push("mailto:"),-1!==r.indexOf(o.protocol)?o.href:""}function a(e){return e.replaceAll(/</g,"&lt;").replaceAll(/>/g,"&gt;").replaceAll(/"/g,"&quot;").replaceAll(/\u0027/g,"&apos;").replaceAll(/\u0a00/g,"&nbsp;")}const l=Object.freeze(new class{validateUrl(e){return s(e)}parse(e,t){!function e(t,o){let n=t.childNodes;for(let a=0;a<n.length;a++){let n=t.childNodes[a],l=n.nodeName.toLowerCase(),i=r.get(l);if(i){i=i.concat(["id","class","dir","title"]);let t="svg"===l||"text"===l||"polyline"===l,r=t?document.createElementNS("http://www.w3.org/2000/svg",l):document.createElement(l);i.forEach(e=>{if(t)n.hasAttributeNS(null,e)&&(r.setAttributeNS(null,e,n.getAttribute(e)),n.removeAttributeNS(null,e));else if(n.hasAttribute(e)){if("href"===e||"src"===e){let t=s(n.getAttribute(e),e);if(""===t){let t="An invalid url ("+n.getAttribute(e)+")was removed from a "+e+" attribute";console.log(t)}else r.setAttribute(e,t)}else r.setAttribute(e,n.getAttribute(e));n.removeAttribute(e)}}),o.appendChild(r),e(n,r)}else"#text"===l?o.appendChild(document.createTextNode(n.nodeValue)):console.log("An invalid tag <"+l+"> was removed");if(n.hasAttributes)for(let e=0;e<n.attributes.length;e++)console.log("An unsecure attribute "+n.attributes[e].name+" ðŸ¢‚ "+n.attributes[e].value+" was removed.")}}((new DOMParser).parseFromString("<div>"+e+"</div>","text/html").querySelector("body").firstChild,t)}verify(e){let t="",o="";return function e(n){let l=n.childNodes;for(let i=0;i<l.length;i++){let l=n.childNodes[i],u=l.nodeName.toLowerCase(),c=r.get(u);if(c){c=c.concat(["id","class","dir","title"]);let r="svg"===u||"text"===u||"polyline"===u;t+="<"+u,c.forEach(e=>{if(r)l.hasAttributeNS(null,e)&&(t+=" "+e+'="'+a(l.getAttribute(e))+'"',l.removeAttribute(e));else if(l.hasAttribute(e))if("href"===e||"src"===e){let r=s(l.getAttribute(e),e);if(""===r){let t="An invalid url ("+l.getAttribute(e)+")was removed from a "+e+" attribute";console.log(t),o+="<p>"+t+"</p>"}else t+=" "+e+'="'+r+'"';l.removeAttribute(e)}else t+=" "+e+'="'+a(l.getAttribute(e))+'"',l.removeAttribute(e)}),t+=">",e(l),t+="</"+u+">"}else if("#text"===u)t+=a(l.nodeValue);else{let e="An invalid tag "+u+" was removed";console.log(e),o+="<p>"+e+"</p>"}if(l.hasAttributes)for(let e=0;e<l.attributes.length;e++){let t="An unsecure attribute "+l.attributes[e].name+'="'+l.attributes[e].value+'" was removed.';console.log(t),o+="<p>"+t+"</p>"}}}((new DOMParser).parseFromString("<div>"+e.replace("&nbsp;","à¨€")+"</div>","text/html").querySelector("body").firstChild),{htmlString:t,errorsString:o}}});
/**
	@------------------------------------------------------------------------------------------------------------------------------

	@file IndexedDb.js
	@copyright Copyright - 2017 2021 - wwwouaiebe - Contact: https://www.ouaie.be/
	@license GNU General Public License
	@private

	@------------------------------------------------------------------------------------------------------------------------------
	*/let i=null;const u=Object.freeze(new class{getOpenPromise(){return new Promise((function(e,t){if(i)return void e();let o=window.indexedDB.open("TravelNotesDb",1);o.onerror=function(){i=null,t(new Error("Not possible to open the db"))},o.onsuccess=function(t){i=t.target.result,e()},o.onupgradeneeded=function(e){i=e.target.result,i.createObjectStore("Travels",{keyPath:"UUID"})}}))}getReadPromise(e){return new Promise((function(t,o){if(!i)return void o(new Error("Database not opened"));let r=i.transaction(["Travels"],"readonly");r.onerror=function(){o(new Error("Transaction error"))},r.objectStore("Travels").get(e).onsuccess=function(e){t(e.target.result?e.target.result.data:null)}}))}getWritePromise(e,t){return new Promise((function(o,r){if(!i)return void r(new Error("Database not opened"));let n=null;try{n=i.transaction(["Travels"],"readwrite")}catch(e){return void r(e)}n.onerror=function(){r(new Error("Transaction error"))},n.objectStore("Travels").put({UUID:e,data:t}).onsuccess=function(){o()}}))}closeDb(e){if(!i)return;if(!e)return i.close(),void(i=null);let t=i.transaction(["Travels"],"readwrite");t.onerror=function(){};let o=t.objectStore("Travels").delete(e);o.onerror=function(){i.close(),i=null},o.onsuccess=function(){i.close(),i=null}}});function c(){let e=document.getElementById("TravelNotes-Travel-ShowNotes").checked,t=document.getElementsByClassName("TravelNotes-Roadbook-Travel-Notes-Row");for(let o=0;o<t.length;o++)e?t[o].classList.remove("TravelNotes-Roadbook-Hidden-Row"):t[o].classList.add("TravelNotes-Roadbook-Hidden-Row")}function d(){let e=document.getElementById("TravelNotes-Routes-ShowNotes").checked,t=document.getElementsByClassName("TravelNotes-Roadbook-Route-Notes-Row");for(let o=0;o<t.length;o++)e?t[o].classList.remove("TravelNotes-Roadbook-Hidden-Row"):t[o].classList.add("TravelNotes-Roadbook-Hidden-Row")}function g(){let e=document.getElementById("TravelNotes-Routes-ShowManeuvers").checked,t=document.getElementsByClassName("TravelNotes-Roadbook-Route-Maneuvers-Row");for(let o=0;o<t.length;o++)e?t[o].classList.remove("TravelNotes-Roadbook-Hidden-Row"):t[o].classList.add("TravelNotes-Roadbook-Hidden-Row")}document.getElementById("TravelNotes-Travel-ShowNotes").addEventListener("change",c),document.getElementById("TravelNotes-Routes-ShowNotes").addEventListener("change",d),document.getElementById("TravelNotes-Routes-ShowManeuvers").addEventListener("change",g);let m=new URLSearchParams(document.location.search.substring(1)),f=m.get("lng"),h=m.get("page");h?(u.getOpenPromise().then(()=>u.getReadPromise(h)).then(e=>{document.getElementById("TravelNotes").textContent="",l.parse(e,document.getElementById("TravelNotes")),c(),d(),g()}).catch(e=>console.log(e||"An error occurs when loading the content")),window.addEventListener("storage",()=>{u.getReadPromise(h).then(e=>{e?(l.parse(e,document.getElementById("TravelNotes")),c(),d(),g()):document.getElementById("TravelNotes").textContent=""}).catch(e=>console.log(e||"An error occurs when loading the content"))}),window.addEventListener("unload",()=>{u.closeDb()})):document.getElementById("TravelNotes-Menu").removeChild(document.getElementById("TravelNotes-ButtonContainer")),f&&o.getJsonPromise(window.location.href.substr(0,window.location.href.lastIndexOf("/")+1)+"TravelNotes"+f.toUpperCase()+".json").then(e=>{t.setTranslations(e),document.getElementById("TravelNotes-Travel-ShowNotesLabel").textContent=t.getText("Roadbook - show travel notes"),document.getElementById("TravelNotes-Routes-ShowManeuversLabel").textContent=t.getText("Roadbook - show maneuver"),document.getElementById("TravelNotes-Routes-ShowNotesLabel").textContent=t.getText("Roadbook - show routes notes")}).catch(e=>console.log(e||"An error occurs when loading translation")),c(),d(),g()}();
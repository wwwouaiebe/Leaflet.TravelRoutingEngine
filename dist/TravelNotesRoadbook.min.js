/**
 * 
 * @source: https://github.com/wwwouaiebe/leaflet.TravelNotes
 * 
 * @licstart  The following is the entire license notice for the
 * JavaScript code in this page.
 * 
 * leaflet.travelnotes - version 2.0.0
 * Build 00579 - 2021-01-04T21:06:49+0100 
 * Copyright 2017 2021 wwwouaiebe 
 * Contact: https://www.ouaie.be/
 * License: GPL-3.0
 * 
 * The JavaScript code in this page is free software: you can
 * redistribute it and/or modify it under the terms of the GNU
 * General Public License (GNU GPL) as published by the Free Software
 * Foundation, either version 3 of the License, or (at your option)
 * any later version.  The code is distributed WITHOUT ANY WARRANTY;
 * without even the implied warranty of MERCHANTABILITY or FITNESS
 * FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.
 * 
 * As additional permission under GNU GPL version 3 section 7, you
 * may distribute non-source (e.g., minimized or compacted) forms of
 * that code without the copy of the GNU GPL normally required by
 * section 4, provided you include this license notice and a URL
 * through which recipients can access the Corresponding Source.
 * 
 * @licend  The above is the entire license notice
 * for the JavaScript code in this page.
 * 
 */


!function(){"use strict";
/**
	@------------------------------------------------------------------------------------------------------------------------------

	@file Constants.js
	@copyright Copyright - 2017 2021 - wwwouaiebe - Contact: https://www.ouaie.be/
	@license GNU General Public License
	@private

	@------------------------------------------------------------------------------------------------------------------------------
	*/Object.freeze({fixed:2,invalid:-1,defaultValue:0}),Object.freeze({refusedByUser:-1,disabled:0,inactive:1,active:2}),Object.freeze({invalidPane:"43a6a53e-008a-4910-80a6-7a87d301ea15",itineraryPane:"8fbf0da7-4e6f-4bc7-8e20-1388461ccde7",travelNotesPane:"dffe782b-07df-4b81-a318-f287c0cf5ec6",searchPane:"228f00d7-43a8-4c13-897d-70400cb6dd58"}),Object.freeze({fixed:2,defaultValue:0}),Object.freeze({defaultValue:0,fixed:6}),Object.freeze({notEdited:0,editedNoChange:1,editedChanged:2}),Object.freeze({margin:100,height:500,width:1e3,yDeltaText:30,xDeltaText:10,vScales:[1,2,5,10,20,50,100,200,500,1e3,2e3,5e3],hScales:[1,2,5,10,20,50,100,200,500,1e3,2e3,5e3,1e4,2e4,5e4,1e5]}),Object.freeze({width:40,height:40});let e=new Map;e.set("a",["href","target"]),e.set("br",[]),e.set("div",[]),e.set("del",[]),e.set("em",[]),e.set("figcaption",[]),e.set("figure",[]),e.set("h1",[]),e.set("h2",[]),e.set("h3",[]),e.set("h4",[]),e.set("h5",[]),e.set("h6",[]),e.set("hr",[]),e.set("img",["src","alt"]),e.set("ins",[]),e.set("li",[]),e.set("mark",[]),e.set("ol",[]),e.set("p",[]),e.set("s",[]),e.set("small",[]),e.set("strong",[]),e.set("span",[]),e.set("sub",[]),e.set("sup",[]),e.set("ul",[]),e.set("svg",["xmlns","viewBox","class"]),e.set("text",["x","y","text-anchor"]),e.set("polyline",["points","class","transform"]);const t=window.location.protocol,r=new DOMParser;function o(e){return e.replaceAll(/</g,"&lt;").replaceAll(/>/g,"&gt;").replaceAll(/"/g,"&quot;").replaceAll(/\u0027/g,"&apos;").replaceAll(/\u0a00/g,"&nbsp;")}function n(e){return e.replaceAll(/&lt;/g,"<").replaceAll(/&gt;/g,">").replaceAll(/&amp;/g,"&").replaceAll(/&quot;/g,'"').replaceAll(/&apos;/g,"'").replaceAll(/&nbsp;/g,"਀")}function s(e,o="href"){let s=r.parseFromString("<div>"+n(e)+"</div>","text/html").querySelector("body").firstChild,l="";for(let e=0;e<s.childNodes.length;e++)"#text"===s.childNodes[e].nodeName&&(l+=s.childNodes[e].nodeValue);if(l!==e)return{url:"",errorsString:"tags found in the url"};let a=["https:"];if("http:"!==t&&"href"!==o||a.push("http:"),"href"===o){a.push("mailto:");let e=l.match(/^#\w*/);if(e&&l===e[0])return{url:l,errorsString:""}}let i=null;try{i=new URL(l)}catch(e){return{url:"",errorsString:"Invalid url string"}}if(-1===a.indexOf(i.protocol))return{url:"",errorsString:"Invalid protocol "+i.protocol};try{encodeURIComponent(i.href)}catch(e){return{url:"",errorsString:"Invalid character in url"}}return-1!==i.href.search(/[()\u0027*]/g)?{url:"",errorsString:"Invalid character in url"}:{url:i.href,errorsString:""}}const l=Object.freeze(new class{sanitizeToColor(e){let t=e.match(/^#[0-9,A-F,a-f]{6}$/);return t?t[0]:null}sanitizeToUrl(e){return s(e)}sanitizeToJsString(e){return function(e){let t=r.parseFromString("<div>"+n(e)+"</div>","text/html").querySelector("body").firstChild,o="";for(let e=0;e<t.childNodes.length;e++)"#text"===t.childNodes[e].nodeName&&(o+=t.childNodes[e].nodeValue);return o=o.replaceAll(/</g,"≺").replaceAll(/>/g,"≻").replaceAll(/"/g,"″").replaceAll(/\u0027/g,"′").replaceAll(/&lt;/g,"≺").replaceAll(/&gt;/g,"≻").replaceAll(/&quot;/g,"″").replaceAll(/&apos;/g,"′"),o}(e)}sanitizeToHtmlElement(t,o){!function(t,o){!function t(r,o){let n=r.childNodes;for(let l=0;l<n.length;l++){let n=r.childNodes[l],a=n.nodeName.toLowerCase(),i=e.get(a);if(i){i=i.concat(["id","class","dir","title"]);let e="svg"===a||"text"===a||"polyline"===a,r=e?document.createElementNS("http://www.w3.org/2000/svg",a):document.createElement(a);i.forEach(t=>{if(e)n.hasAttributeNS(null,t)&&(r.setAttributeNS(null,t,n.getAttribute(t)),n.removeAttributeNS(null,t));else if(n.hasAttribute(t)){if("href"===t||"src"===t){let e=s(n.getAttribute(t),t).url;""!==e&&r.setAttribute(t,e)}else r.setAttribute(t,n.getAttribute(t));n.removeAttribute(t)}}),o.appendChild(r),t(n,r)}else"#text"===a&&o.appendChild(document.createTextNode(n.nodeValue))}}(r.parseFromString("<div>"+t+"</div>","text/html").querySelector("body").firstChild,o)}(t,o)}sanitizeToHtmlString(t){return function(t){let n="",l="";return function t(r){let a=r.childNodes;for(let i=0;i<a.length;i++){let a=r.childNodes[i],c=a.nodeName.toLowerCase(),u=e.get(c);if(u){u=u.concat(["id","class","dir","title"]);let e="svg"===c||"text"===c||"polyline"===c;n+="<"+c,u.forEach(t=>{if(e)a.hasAttributeNS(null,t)&&(n+=" "+t+'="'+o(a.getAttribute(t))+'"',a.removeAttribute(t));else if(a.hasAttribute(t))if("href"===t||"src"===t){let e=s(a.getAttribute(t),t).url;""===e?l+="\nAn invalid url ("+a.getAttribute(t)+") was removed from a "+t+" attribute":n+=" "+t+'="'+e+'"',a.removeAttribute(t)}else n+=" "+t+'="'+o(a.getAttribute(t))+'"',a.removeAttribute(t)}),n+=">",t(a),n+="</"+c+">"}else"#text"===c?n+=o(a.nodeValue):l+="\nAn invalid tag "+c+" was removed";if(a.hasAttributes)for(let e=0;e<a.attributes.length;e++)l+="\nAn unsecure attribute "+a.attributes[e].name+'="'+a.attributes[e].value+'" was removed.'}}(r.parseFromString("<div>"+t.replace("&nbsp;","਀")+"</div>","text/html").querySelector("body").firstChild),{htmlString:n,errorsString:l}}(t)}});let a=new Map;const i=Object.freeze(new class{setTranslations(e){e.forEach(e=>a.set(e.msgid,l.sanitizeToJsString(e.msgstr)))}getText(e,t){let r=a.get(e);return t&&r&&Object.getOwnPropertyNames(t).forEach(e=>r=r.replace("{"+e+"}",t[e])),r||e}});const c=Object.freeze(new
/**
	@------------------------------------------------------------------------------------------------------------------------------

	@file HttpRequestBuilder.js
	@copyright Copyright - 2017 2021 - wwwouaiebe - Contact: https://www.ouaie.be/
	@license GNU General Public License
	@private

	@------------------------------------------------------------------------------------------------------------------------------
	*/
class{getTextPromise(e,t){return new Promise((function(r,o){let n=new XMLHttpRequest;n.timeout=4e4,n.ontimeout=function(){o("XMLHttpRequest TimeOut. File : "+n.responseURL)},n.onreadystatechange=function(){4===n.readyState&&(200===n.status?r(n.responseText):o("Error XMLHttpRequest - File : "+n.responseURL))},n.open("GET",e,!0),t&&t.forEach(e=>n.setRequestHeader(e.headerName,e.headerValue)),n.overrideMimeType("text/plain"),n.send(null)}))}getJsonPromise(e,t){return new Promise((function(r,o){let n=new XMLHttpRequest;n.timeout=4e4,n.ontimeout=function(){o("XMLHttpRequest TimeOut. File : "+n.responseURL)},n.onreadystatechange=function(){if(4===n.readyState)if(200===n.status){let e=null;try{e=JSON.parse(n.responseText)}catch(e){o(e.message+" File: "+n.responseURL)}r(e)}else o("Error XMLHttpRequest - File : "+n.responseURL)},n.open("GET",e,!0),t&&t.forEach(e=>n.setRequestHeader(e.headerName,e.headerValue)),n.overrideMimeType("application/json"),n.send(null)}))}getBinaryPromise(e,t){return new Promise((function(r,o){let n=new XMLHttpRequest;n.timeout=4e4,n.ontimeout=function(){o("XMLHttpRequest TimeOut. File : "+n.responseURL)},n.onload=function(){if(200===n.status){let e=n.response;e?r(e):o("Error XMLHttpRequest - File : "+n.responseURL)}else o("Error XMLHttpRequest - File : "+n.responseURL)},n.open("GET",e,!0),t&&t.forEach(e=>n.setRequestHeader(e.headerName,e.headerValue)),n.responseType="arraybuffer",n.send(null)}))}});
/**
	@------------------------------------------------------------------------------------------------------------------------------

	@file IndexedDb.js
	@copyright Copyright - 2017 2021 - wwwouaiebe - Contact: https://www.ouaie.be/
	@license GNU General Public License
	@private

	@------------------------------------------------------------------------------------------------------------------------------
	*/let u=null;const d=Object.freeze(new class{getOpenPromise(){return new Promise((function(e,t){if(u)return void e();let r=window.indexedDB.open("TravelNotesDb",1);r.onerror=function(){u=null,t(new Error("Not possible to open the db"))},r.onsuccess=function(t){u=t.target.result,e()},r.onupgradeneeded=function(e){u=e.target.result,u.createObjectStore("Travels",{keyPath:"UUID"})}}))}getReadPromise(e){return new Promise((function(t,r){if(!u)return void r(new Error("Database not opened"));let o=u.transaction(["Travels"],"readonly");o.onerror=function(){r(new Error("Transaction error"))},o.objectStore("Travels").get(e).onsuccess=function(e){t(e.target.result?e.target.result.data:null)}}))}getWritePromise(e,t){return new Promise((function(r,o){if(!u)return void o(new Error("Database not opened"));let n=null;try{n=u.transaction(["Travels"],"readwrite")}catch(e){return void o(e)}n.onerror=function(){o(new Error("Transaction error"))},n.objectStore("Travels").put({UUID:e,data:t}).onsuccess=function(){r()}}))}closeDb(e){if(!u)return;if(!e)return u.close(),void(u=null);let t=u.transaction(["Travels"],"readwrite");t.onerror=function(){};let r=t.objectStore("Travels").delete(e);r.onerror=function(){u.close(),u=null},r.onsuccess=function(){u.close(),u=null}}});function g(){let e=document.getElementById("TravelNotes-Travel-ShowNotes").checked,t=document.getElementsByClassName("TravelNotes-Roadbook-Travel-Notes-Row");for(let r=0;r<t.length;r++)e?t[r].classList.remove("TravelNotes-Roadbook-Hidden-Row"):t[r].classList.add("TravelNotes-Roadbook-Hidden-Row")}function h(){let e=document.getElementById("TravelNotes-Routes-ShowNotes").checked,t=document.getElementsByClassName("TravelNotes-Roadbook-Route-Notes-Row");for(let r=0;r<t.length;r++)e?t[r].classList.remove("TravelNotes-Roadbook-Hidden-Row"):t[r].classList.add("TravelNotes-Roadbook-Hidden-Row")}function m(){let e=document.getElementById("TravelNotes-Routes-ShowManeuvers").checked,t=document.getElementsByClassName("TravelNotes-Roadbook-Route-Maneuvers-Row");for(let r=0;r<t.length;r++)e?t[r].classList.remove("TravelNotes-Roadbook-Hidden-Row"):t[r].classList.add("TravelNotes-Roadbook-Hidden-Row")}document.getElementById("TravelNotes-Travel-ShowNotes").addEventListener("change",g),document.getElementById("TravelNotes-Routes-ShowNotes").addEventListener("change",h),document.getElementById("TravelNotes-Routes-ShowManeuvers").addEventListener("change",m);let f=new URLSearchParams(document.location.search.substring(1)),p=f.get("lng"),v=f.get("page");v?(d.getOpenPromise().then(()=>d.getReadPromise(v)).then(e=>{document.getElementById("TravelNotes").textContent="",l.sanitizeToHtmlElement(e,document.getElementById("TravelNotes")),g(),h(),m()}).catch(e=>console.log(e||"An error occurs when loading the content")),window.addEventListener("storage",()=>{d.getReadPromise(v).then(e=>{e?(l.sanitizeToHtmlElement(e,document.getElementById("TravelNotes")),g(),h(),m()):document.getElementById("TravelNotes").textContent=""}).catch(e=>console.log(e||"An error occurs when loading the content"))}),window.addEventListener("unload",()=>{d.closeDb()})):document.getElementById("TravelNotes-Menu").removeChild(document.getElementById("TravelNotes-ButtonContainer")),p&&c.getJsonPromise(window.location.href.substr(0,window.location.href.lastIndexOf("/")+1)+"TravelNotes"+p.toUpperCase()+".json").then(e=>{i.setTranslations(e),document.getElementById("TravelNotes-Travel-ShowNotesLabel").textContent=i.getText("Roadbook - show travel notes"),document.getElementById("TravelNotes-Routes-ShowManeuversLabel").textContent=i.getText("Roadbook - show maneuver"),document.getElementById("TravelNotes-Routes-ShowNotesLabel").textContent=i.getText("Roadbook - show routes notes")}).catch(e=>console.log(e||"An error occurs when loading translation")),g(),h(),m()}();
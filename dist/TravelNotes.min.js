/**
 * 
 * @source: https://github.com/wwwouaiebe/leaflet.TravelNotes
 * 
 * @licstart  The following is the entire license notice for the
 * JavaScript code in this page.
 * 
 * leaflet.travelnotes - version 2.1.0
 * Build 00002 - 2021-01-13T15:53:37+0100 
 * Copyright 2017 2021 wwwouaiebe 
 * Contact: https://www.ouaie.be/
 * License: GPL-3.0
 * 
 * The JavaScript code in this page is free software: you can
 * redistribute it and/or modify it under the terms of the GNU
 * General Public License (GNU GPL) as published by the Free Software
 * Foundation, either version 3 of the License, or (at your option)
 * any later version.  The code is distributed WITHOUT ANY WARRANTY;
 * without even the implied warranty of MERCHANTABILITY or FITNESS
 * FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.
 * 
 * As additional permission under GNU GPL version 3 section 7, you
 * may distribute non-source (e.g., minimized or compacted) forms of
 * that code without the copy of the GNU GPL normally required by
 * section 4, provided you include this license notice and a URL
 * through which recipients can access the Corresponding Source.
 * 
 * @licend  The above is the entire license notice
 * for the JavaScript code in this page.
 * 
 */


!function(){"use strict";
/**
	@------------------------------------------------------------------------------------------------------------------------------

	@file Constants.js
	@copyright Copyright - 2017 2021 - wwwouaiebe - Contact: https://www.ouaie.be/
	@license GNU General Public License
	@private

	@------------------------------------------------------------------------------------------------------------------------------
	*/const e=Object.freeze({fixed:2,invalid:-1,defaultValue:0}),t=Object.freeze({refusedByUser:-1,disabled:0,inactive:1,active:2}),o=Object.freeze({invalidPane:"43a6a53e-008a-4910-80a6-7a87d301ea15",itineraryPane:"8fbf0da7-4e6f-4bc7-8e20-1388461ccde7",travelNotesPane:"dffe782b-07df-4b81-a318-f287c0cf5ec6",searchPane:"228f00d7-43a8-4c13-897d-70400cb6dd58"}),a=Object.freeze({fixed:2,defaultValue:0}),n=Object.freeze({defaultValue:0,fixed:6}),r=Object.freeze({notEdited:0,editedNoChange:1,editedChanged:2}),i=Object.freeze({margin:100,height:500,width:1e3,yDeltaText:30,xDeltaText:10,vScales:[1,2,5,10,20,50,100,200,500,1e3,2e3,5e3],hScales:[1,2,5,10,20,50,100,200,500,1e3,2e3,5e3,1e4,2e4,5e4,1e5]}),l=Object.freeze({width:40,height:40,svgViewboxDim:200}),s=[.3,10,1],d="http://www.w3.org/2000/svg";let c=new Map;c.set("a",["href","target"]),c.set("br",[]),c.set("div",[]),c.set("del",[]),c.set("em",[]),c.set("figcaption",[]),c.set("figure",[]),c.set("h1",[]),c.set("h2",[]),c.set("h3",[]),c.set("h4",[]),c.set("h5",[]),c.set("h6",[]),c.set("hr",[]),c.set("img",["src","alt","width","height"]),c.set("ins",[]),c.set("li",[]),c.set("mark",[]),c.set("ol",[]),c.set("p",[]),c.set("s",[]),c.set("small",[]),c.set("strong",[]),c.set("span",[]),c.set("sub",[]),c.set("sup",[]),c.set("ul",[]),c.set("svg",["xmlns","viewBox","class"]),c.set("text",["x","y","text-anchor"]),c.set("polyline",["points","class","transform"]);const u=window.location.protocol,g=new DOMParser;function v(e){return e.replaceAll(/</g,"&lt;").replaceAll(/>/g,"&gt;").replaceAll(/"/g,"&quot;").replaceAll(/\u0027/g,"&apos;").replaceAll(/\u0a00/g,"&nbsp;")}function h(e,t="href"){let o=g.parseFromString("<div>"+e+"</div>","text/html");if(!o||"#document"!==o.nodeName)return{url:"",errorsString:"Parsing error"};let a=o.querySelector("body").firstChild,n="";for(let e=0;e<a.childNodes.length;e++){if("#text"!==a.childNodes[e].nodeName)return{url:"",errorsString:"Invalid characters found in the url"};n+=a.childNodes[e].nodeValue}if(n=n.replaceAll(/</g,"").replaceAll(/>/g,"").replaceAll(/"/g,"").replaceAll(/\u0027/g,"").replaceAll(/&lt;/g,"").replaceAll(/&gt;/g,"").replaceAll(/&quot;/g,"").replaceAll(/&apos;/g,"").replaceAll(/%3C/g,"").replaceAll(/%3c/g,"").replaceAll(/%3E/g,"").replaceAll(/%3e/g,"").replaceAll(/%22/g,"").replaceAll(/%27/g,""),n!==e)return{url:"",errorsString:"Invalid characters found in the url"};let r=["https:"];if("http:"!==u&&"href"!==t||r.push("http:"),"href"===t){r.push("mailto:"),r.push("sms:"),r.push("tel:");let e=n.match(/^#\w*/);if(e&&n===e[0])return{url:n,errorsString:""}}"src"===t&&r.push("data:");let i=null;try{i=new URL(n)}catch(e){return{url:"",errorsString:"Invalid url string"}}if(-1===r.indexOf(i.protocol))return{url:"",errorsString:"Invalid protocol "+i.protocol};if(-1!==["sms:","tel:"].indexOf(i.protocol)&&i.pathname.match(/^\+[0-9,*,#]*$/))return{url:n,errorsString:""};try{encodeURIComponent(i.href)}catch(e){return{url:"",errorsString:"Invalid character in url"}}return{url:n,errorsString:""}}const p=Object.freeze(new class{sanitizeToColor(e){let t=e.match(/^#[0-9,A-F,a-f]{6}$/);return t?t[0]:null}sanitizeToUrl(e,t){return h(e,t)}sanitizeToJsString(e){return function(e){let t=g.parseFromString("<div>"+e+"</div>","text/html");if(!t||"#document"!==t.nodeName)return"";let o=t.querySelector("body").firstChild,a="";for(let e=0;e<o.childNodes.length;e++){if("#text"!==o.childNodes[e].nodeName)return"";a+=o.childNodes[e].nodeValue}return a=a.replaceAll(/</g,"≺").replaceAll(/>/g,"≻").replaceAll(/"/g,"″").replaceAll(/\u0027/g,"′"),a}(e)}sanitizeToHtmlElement(e,t){!function(e,t){let o=g.parseFromString("<div>"+e+"</div>","text/html");o&&"#document"===o.nodeName?function e(t,o){let a=t.childNodes;for(let n=0;n<a.length;n++){let a=t.childNodes[n],r=a.nodeName.toLowerCase(),i=c.get(r);if(i){i=i.concat(["id","class","dir","title"]);let t="svg"===r||"text"===r||"polyline"===r,n=t?document.createElementNS(d,r):document.createElement(r);if(i.forEach(e=>{if(t)a.hasAttributeNS(null,e)&&(n.setAttributeNS(null,e,a.getAttribute(e)),a.removeAttributeNS(null,e));else if(a.hasAttribute(e))if("href"===e||"src"===e){let t=h(a.getAttribute(e),e).url;""!==t&&n.setAttribute(e,t)}else n.setAttribute(e,a.getAttribute(e))}),a.hasAttribute("style")){a.getAttribute("style").split(";").forEach(e=>{let t=e.split(":");2!==t.length||"width"!==t[0].trim()&&"height"!==t[0].trim()||(n.style[t[0].trim()]=t[1].trim())})}o.appendChild(n),e(a,n)}else"#text"===r&&o.appendChild(document.createTextNode(a.nodeValue))}}(o.querySelector("body").firstChild,t):t.textContent=""}(e,t)}sanitizeToHtmlString(e){return function(e){let t="",o="",a=g.parseFromString("<div>"+e.replace("&nbsp;","਀")+"</div>","text/html");return a&&"#document"===a.nodeName?(function e(a){let n=a.childNodes;for(let r=0;r<n.length;r++){let n=a.childNodes[r],i=n.nodeName.toLowerCase(),l=c.get(i);if(l){l=l.concat(["id","class","dir","title"]);let a="svg"===i||"text"===i||"polyline"===i;t+="<"+i,l.forEach(e=>{if(a)n.hasAttributeNS(null,e)&&(t+=" "+e+'="'+v(n.getAttribute(e))+'"',n.removeAttribute(e));else if(n.hasAttribute(e))if("href"===e||"src"===e){let a=h(n.getAttribute(e),e).url;""===a?o+="\nAn invalid url ("+n.getAttribute(e)+") was removed from a "+e+" attribute":t+=" "+e+'="'+a+'"',n.removeAttribute(e)}else t+=" "+e+'="'+v(n.getAttribute(e))+'"',n.removeAttribute(e)}),t+=">",e(n),t+="</"+i+">"}else"#text"===i?t+=v(n.nodeValue):o+="\nAn invalid tag "+i+" was removed";if(n.hasAttributes)for(let e=0;e<n.attributes.length;e++)o+="\nAn unsecure attribute "+n.attributes[e].name+'="'+n.attributes[e].value+'" was removed.'}}(a.querySelector("body").firstChild),{htmlString:t,errorsString:o}):{htmlString:"",errorsString:"Parsing error"}}(e)}});let m={autoLoad:!1,map:{center:{lat:50.50923,lng:5.49542},zoom:12},travelNotesToolbarUI:{contactMail:{url:"https://github.com/wwwouaiebe/leaflet.TravelNotes/issues"}},layersToolbarUI:{haveLayersToolbarUI:!0,toolbarTimeOut:1500,theDevil:{addButton:!1}},mouseUI:{haveMouseUI:!0},errorUI:{timeOut:1e4,helpTimeOut:3e4,showError:!0,showWarning:!0,showInfo:!0,showHelp:!0},geoLocation:{color:"#ff0000",radius:11,zoomToPosition:!0,zoomFactor:17,options:{enableHighAccuracy:!1,maximumAge:0,timeout:1/0}},APIKeys:{showDialogButton:!0,saveToSessionStorage:!0,showAPIKeysInDialog:!0,dialogHaveUnsecureButtons:!0},contextMenu:{timeout:1500},routing:{auto:!0},language:"fr",itineraryPointMarker:{color:"#ff0000",weight:2,radius:7,fill:!1},searchPointMarker:{color:"#006400",weight:4,radius:20,fill:!1},searchPointPolyline:{color:"#006400",weight:4,radius:20,fill:!1},previousSearchLimit:{color:"#006400",fill:!1,weight:1},nextSearchLimit:{color:"#ff0000",fill:!1,weight:1},wayPoint:{reverseGeocoding:!1},route:{color:"#ff0000",width:3,dashArray:0,dashChoices:[{text:"——————",iDashArray:null},{text:"— — — — —",iDashArray:[4,2]},{text:"—‧—‧—‧—‧—",iDashArray:[4,2,0,2]},{text:"················",iDashArray:[0,2]}],elev:{smooth:!0,smoothCoefficient:.25,smoothPoints:3},showDragTooltip:3},note:{osmSearchNoteDialog:!1,reverseGeocoding:!1,grip:{size:10,opacity:0,moveOpacity:1},polyline:{color:"#808080",weight:1},haveBackground:!1,svgRoadbookDimCoef:2,svgAnleMaxDirection:{right:35,slightRight:80,continue:100,slightLeft:145,left:200,sharpLeft:270,sharpRight:340},svgZoom:17,svgAngleDistance:10,svgHamletDistance:200,svgVillageDistance:400,svgCityDistance:1200,svgTownDistance:1500,svgTimeOut:40,maxManeuversNotes:100},noteDialog:{toggleIconDimension:!0,toggleIconTextArea:!1,toggleTooltip:!1,togglePopupContent:!1,toggleAddress:!1,toggleLink:!1,togglePhone:!0,iconAreaHeight:2,popupAreaHeigth:8},itineraryPointZoom:17,routeEditor:{displayEditionInHTMLPage:!0},travelEditor:{clearAfterSave:!0,startMinimized:!0,timeout:1e3,startupRouteEdition:!0},haveBeforeUnloadWarning:!0,overpassApi:{url:"https://lz4.overpass-api.de/api/interpreter"},nominatim:{url:"https://nominatim.openstreetmap.org/",language:"*"},printRouteMap:{isEnabled:!0,maxTiles:240,paperWidth:287,paperHeight:200,pageBreak:!1,printNotes:!0,borderWidth:30,zoomFactor:15,entryPointMarker:{color:"#00ff00",weight:4,radius:10,fill:!0,fillOpacity:1},exitPointMarker:{color:"#ff0000",weight:4,radius:10,fill:!0,fillOpacity:1}},haveCrypto:!1,itineraryPane:{showNotes:!0,showManeuvers:!1},colorDialog:{haveSlider:!0,initialRed:0}};let f=new class{get autoLoad(){return m.autoLoad}get map(){return m.map}get travelNotesToolbarUI(){return m.travelNotesToolbarUI}get layersToolbarUI(){return m.layersToolbarUI}get mouseUI(){return m.mouseUI}get errorUI(){return m.errorUI}get APIKeys(){return m.APIKeys}get contextMenu(){return m.contextMenu}get routing(){return m.routing}get language(){return m.language}get itineraryPointMarker(){return m.itineraryPointMarker}get searchPointMarker(){return m.searchPointMarker}get searchPointPolyline(){return m.searchPointPolyline}get previousSearchLimit(){return m.previousSearchLimit}get nextSearchLimit(){return m.nextSearchLimit}get wayPoint(){return m.wayPoint}get route(){return m.route}get note(){return m.note}get noteDialog(){return m.noteDialog}get itineraryPointZoom(){return m.itineraryPointZoom}get routeEditor(){return m.routeEditor}get travelEditor(){return m.travelEditor}get haveBeforeUnloadWarning(){return m.haveBeforeUnloadWarning}get overpassApi(){return m.overpassApi}get nominatim(){return m.nominatim}get geoLocation(){return m.geoLocation}get printRouteMap(){return m.printRouteMap}get haveCrypto(){return m.haveCrypto}get itineraryPane(){return m.itineraryPane}get colorDialog(){return m.colorDialog}overload(e){!function e(t,o){if("object"==typeof t&&"object"==typeof o)try{for(let a in o)"object"==typeof o[a]?e(t[a],o[a]):typeof t[a]==typeof o[a]&&("string"==typeof o[a]?o[a]="color"===a?p.sanitizeToColor(t[a])||o[a]:"url"===a?p.sanitizeToUrl(t[a]).url:p.sanitizeToJsString(t[a]):o[a]=t[a]||o[a]);for(let a in t)"object"==typeof t[a]?("[object Array]"===Object.prototype.toString.call(t[a])?o[a]=o[a]||[]:o[a]=o[a]||{},e(t[a],o[a])):"string"==typeof o.property?o[a]=p.sanitizeToHtmlString(t[a],[]).htmlString:o[a]=t[a]}catch(e){console.log(e||"Not possible to overload Config")}}(e,m),m=function e(t){for(let o in t)"object"==typeof t[o]&&(t[o]=e(t[o]));return Object.freeze(t)}(m)}};
/**
	@------------------------------------------------------------------------------------------------------------------------------

	@file HTMLElementsFactory.js
	@copyright Copyright - 2017 2021 - wwwouaiebe - Contact: https://www.ouaie.be/
	@license GNU General Public License
	@private

	@------------------------------------------------------------------------------------------------------------------------------
	*/const b=Object.freeze(new class{create(e,t,o){let a=null;return"text"===e.toLowerCase()?a=document.createTextNode(t.value||""):(a=document.createElement(e),t&&function(e,t){for(let o in t)try{e[o]=t[o]}catch(e){console.log("Invalid property : "+o)}}(a,t)),o&&o.appendChild(a),a}});const y=Object.freeze(new
/**
	@------------------------------------------------------------------------------------------------------------------------------

	@file HttpRequestBuilder.js
	@copyright Copyright - 2017 2021 - wwwouaiebe - Contact: https://www.ouaie.be/
	@license GNU General Public License
	@private

	@------------------------------------------------------------------------------------------------------------------------------
	*/
class{getTextPromise(e,t){return new Promise((function(o,a){let n=new XMLHttpRequest;n.timeout=4e4,n.ontimeout=function(){a("XMLHttpRequest TimeOut. File : "+n.responseURL)},n.onreadystatechange=function(){4===n.readyState&&(200===n.status?o(n.responseText):a("Error XMLHttpRequest - File : "+n.responseURL))},n.open("GET",e,!0),t&&t.forEach(e=>n.setRequestHeader(e.headerName,e.headerValue)),n.overrideMimeType("text/plain"),n.send(null)}))}getJsonPromise(e,t){return new Promise((function(o,a){let n=new XMLHttpRequest;n.timeout=4e4,n.ontimeout=function(){a("XMLHttpRequest TimeOut. File : "+n.responseURL)},n.onreadystatechange=function(){if(4===n.readyState)if(200===n.status){let e=null;try{e=JSON.parse(n.responseText)}catch(e){a(e.message+" File: "+n.responseURL)}o(e)}else a("Error XMLHttpRequest - File : "+n.responseURL)},n.open("GET",e,!0),t&&t.forEach(e=>n.setRequestHeader(e.headerName,e.headerValue)),n.overrideMimeType("application/json"),n.send(null)}))}getBinaryPromise(e,t){return new Promise((function(o,a){let n=new XMLHttpRequest;n.timeout=4e4,n.ontimeout=function(){a("XMLHttpRequest TimeOut. File : "+n.responseURL)},n.onload=function(){if(200===n.status){let e=n.response;e?o(e):a("Error XMLHttpRequest - File : "+n.responseURL)}else a("Error XMLHttpRequest - File : "+n.responseURL)},n.open("GET",e,!0),t&&t.forEach(e=>n.setRequestHeader(e.headerName,e.headerValue)),n.responseType="arraybuffer",n.send(null)}))}});let N=0;function T(){return++N,N}
/**
	@------------------------------------------------------------------------------------------------------------------------------

	@file Version.js
	@copyright Copyright - 2017 2021 - wwwouaiebe - Contact: https://www.ouaie.be/
	@license GNU General Public License
	@private

	@------------------------------------------------------------------------------------------------------------------------------
	*/function w(e){const t=e;return Object.seal(new class{get name(){return t}get version(){return"2.1.0"}get jsonObject(){return{name:t,version:"2.1.0"}}validate(e){if(!Object.getOwnPropertyNames(e).includes("name"))throw new Error("No name for "+t);if(t!==e.name)throw new Error("Invalid name for "+t);if(!Object.getOwnPropertyNames(e).includes("version"))throw new Error("No version for "+t)}})}function x(e){const t=e;let o=[];const a=function(){let e=t();if(!e.objType||!e.objType.name)throw new Error("invalid object name for collection");return e.objType.name}();function n(e){if(!e.objType||!e.objType.name||e.objType.name!==a)throw new Error("invalid object name for add function");o.push(e)}function r(){let e=-1;return Object.seal({get value(){return e<o.length?o[e]:null},get previous(){return 0>=e?null:o[e-1]},get next(){return e<o.length-1?o[e+1]:null},get done(){return++e>=o.length},get first(){return 0===e},get last(){return e>=o.length-1},get index(){return e}})}function i(e){return o.findIndex(t=>t.objId===e)}function l(e,t,a){let n=i(e);if(-1===n)throw new Error("invalid objId for next or previous function");if(1!==a&&-1!==a)throw new Error("invalid direction");let r=t;for(r||(r=()=>!0),n+=a;-1<n&&n<o.length&&!r(o[n]);)n+=a;return-1===n||o.length===n?null:o[n]}return Object.seal(new class{add(e){n(e)}forEach(e){let t=null,o=r();for(;!o.done;)t=e(o.value,t);return t}getAt(e){let t=i(e);return-1===t?null:o[t]}moveTo(e,t,a){let n=i(e),r=i(t);if(-1===n||-1===r)throw new Error("invalid objId for function  myMoveTo");a||r++,o.splice(r,0,o[n]),r<n&&n++,o.splice(n,1)}next(e,t){return l(e,t,1)}previous(e,t){return l(e,t,-1)}remove(e){if(-1===i(e))throw new Error("invalid objId for remove function");o.splice(i(e),1)}removeAll(e){e?o.splice(1,o.length-2):o.length=0}replace(e,t){let n=i(e);if(-1===n)throw new Error("invalid objId for replace function");if(!t.objType||!t.objType.name||t.objType.name!==a)throw new Error("invalid object name for replace function");o[n]=t}reverse(){o.reverse()}sort(e){o.sort(e)}swap(e,t){let a=i(e);if(-1===a||0===a&&t||o.length-1===a&&!t)throw new Error("invalid objId for swap function");let n=o[a];o[a]=o[a+(t?-1:1)],o[a+(t?-1:1)]=n}get first(){return o[0]}get iterator(){return r()}get last(){return o[o.length-1]}get length(){return o.length}get jsonObject(){let e=[],t=r();for(;!t.done;)e.push(t.value.jsonObject);return e}set jsonObject(e){o.length=0;let a=null;e.forEach(e=>{a=t(),a.jsonObject=e,n(a)})}})}let I=new Map;const A=Object.freeze(new class{setTranslations(e){e.forEach(e=>I.set(e.msgid,p.sanitizeToJsString(e.msgstr)))}getText(e,t){let o=I.get(e);return t&&o&&Object.getOwnPropertyNames(t).forEach(e=>o=o.replace("{"+e+"}",t[e])),o||e}});const E=Object.freeze(new class{get UUID(){let e=new Uint16Array(8);const t=["","-","-","-","-","","",""];window.crypto.getRandomValues(e);let o="";for(let a=0;a<8;a++)o+=e[a].toString(16).padStart(4,"0")+t[a];return o}storageAvailable(e){try{let t=window[e],o="__storage_test__";return t.setItem(o,o),t.removeItem(o),!0}catch(e){return!1}}saveFile(e,t,o){try{let a=window.URL.createObjectURL(new File([t],e,{type:o||"text/plain"})),n=document.createElement("a");n.setAttribute("href",a),n.setAttribute("download",e),n.click(),window.URL.revokeObjectURL(a)}catch(e){console.log(e||"An error occurs when saving file")}}formatTime(e){let t=Math.floor(e);if(0===t)return"";let o=Math.floor(t/86400),a=Math.floor(t%86400/3600),n=Math.floor(t%3600/60),r=Math.floor(t%60);return 0<o?o+" "+A.getText("Utilities - Day")+" "+a+" "+A.getText("Utilities - Hour"):0<a?a+" "+A.getText("Utilities - Hour")+" "+n+" "+A.getText("Utilities - Minute"):0<n?n+" "+A.getText("Utilities - Minute"):r+" "+A.getText("Utilities - Second")}formatDistance(e){let t=Math.floor(e);return 0>=t?"0 km":Math.floor(t/1e3)+","+Math.floor(t%1e3/10).toFixed(0).padStart(2,"0").padEnd(3,"0")+" km"}formatLat(e){return e>0?e.toFixed(n.fixed)+" N":(-e).toFixed(n.fixed)+" S"}formatLng(e){return e>0?e.toFixed(n.fixed)+" E":(-e).toFixed(n.fixed)+" W"}formatLatLng(e){return 0===e[0]&&0===e[1]?"":this.formatLat(e[0])+" - "+this.formatLng(e[1])}}),j=w("WayPoint"),P=new WeakMap;class D{constructor(){this.name="",this.address="",this.lat=n.defaultValue,this.lng=n.defaultValue,P.set(this,T())}get fullName(){let e=""===this.name?this.address:this.name+", "+this.address;return""===e&&(e=E.formatLatLng([this.lat,this.lng])),e}get latLng(){return[this.lat,this.lng]}set latLng(e){this.lat=e[0],this.lng=e[1]}get objId(){return P.get(this)}get objType(){return j}get jsonObject(){return{name:this.name,address:this.address,lat:parseFloat(this.lat.toFixed(n.fixed)),lng:parseFloat(this.lng.toFixed(n.fixed)),objId:P.get(this),objType:j.jsonObject}}set jsonObject(e){let t=function(e){if(!Object.getOwnPropertyNames(e).includes("objType"))throw new Error("No objType for "+j.name);if(j.validate(e.objType),j.version!==e.objType.version)switch(e.objType.version){case"1.0.0":case"1.1.0":case"1.2.0":case"1.3.0":case"1.4.0":case"1.5.0":case"1.6.0":case"1.7.0":case"1.7.1":case"1.8.0":case"1.9.0":case"1.10.0":case"1.11.0":e.address=e.name,e.name="";case"1.12.0":case"1.13.0":case"2.0.0":e.objType.version="2.1.0";break;default:throw new Error("invalid version for "+j.name)}let t=Object.getOwnPropertyNames(e);return["address","name","lat","lng","objId"].forEach(e=>{if(!t.includes(e))throw new Error("No "+e+" for "+j.name)}),e}(e);this.address=t.address||"",this.name=t.name||"",this.lat=t.lat||n.defaultValue,this.lng=t.lng||n.defaultValue,P.set(this,T()),this.validateData()}validateData(){"string"==typeof this.address?this.address=p.sanitizeToJsString(this.address):this.address="","string"==typeof this.name?this.name=p.sanitizeToJsString(this.name):this.name="","number"!=typeof this.lat&&(this.lat=n.defaultValue),"number"!=typeof this.lng&&(this.lng=n.defaultValue)}}function C(){return Object.seal(new D)}const R=w("ItineraryPoint"),M=new WeakMap;class S{constructor(){this.lat=n.defaultValue,this.lng=n.defaultValue,this.distance=e.defaultValue,this.elev=a.defaultValue,M.set(this,T())}get latLng(){return[this.lat,this.lng]}set latLng(e){this.lat=e[0],this.lng=e[1]}get objType(){return R}get objId(){return M.get(this)}get jsonObject(){return{lat:parseFloat(this.lat.toFixed(n.fixed)),lng:parseFloat(this.lng.toFixed(n.fixed)),distance:parseFloat(this.distance.toFixed(e.fixed)),elev:parseFloat(this.elev.toFixed(a.fixed)),objId:M.get(this),objType:R.jsonObject}}set jsonObject(t){let o=function(e){if(!Object.getOwnPropertyNames(e).includes("objType"))throw new Error("No objType for "+R.name);if(R.validate(e.objType),R.version!==e.objType.version)switch(e.objType.version){case"1.0.0":case"1.1.0":case"1.2.0":case"1.3.0":case"1.4.0":case"1.5.0":case"1.6.0":e.elev=a.defaultValue;case"1.7.0":case"1.7.1":case"1.8.0":case"1.9.0":case"1.10.0":case"1.11.0":case"1.12.0":case"1.13.0":case"2.0.0":e.objType.version="2.1.0";break;default:throw new Error("invalid version for "+R.name)}let t=Object.getOwnPropertyNames(e);return["lat","lng","distance","elev","objId"].forEach(e=>{if(!t.includes(e))throw new Error("No "+e+" for "+R.name)}),e}(t);this.lat=o.lat||n.defaultValue,this.lng=o.lng||n.defaultValue,this.distance=o.distance||e.defaultValue,this.elev=o.elev||a.defaultValue,M.set(this,T()),this.validateData()}validateData(){"number"!=typeof this.lat&&(this.lat=n.defaultValue),"number"!=typeof this.lng&&(this.lng=n.defaultValue),"number"!=typeof this.distance&&(this.distance=e.defaultValue),"number"!=typeof this.elev&&(this.elev=a.defaultValue)}}function O(){return Object.seal(new S)}const U=w("Maneuver"),k=new WeakMap;class B{constructor(){this.iconName="",this.instruction="",this.itineraryPointObjId=-1,this.distance=e.defaultValue,this.duration=e.defaultValue,k.set(this,T())}get objType(){return U}get objId(){return k.get(this)}get jsonObject(){return{iconName:this.iconName,instruction:this.instruction,distance:parseFloat(this.distance.toFixed(e.fixed)),duration:this.duration,itineraryPointObjId:this.itineraryPointObjId,objId:k.get(this),objType:U.jsonObject}}set jsonObject(t){let o=function(t){if(!Object.getOwnPropertyNames(t).includes("objType"))throw new Error("No objType for "+U.name);if(U.validate(t.objType),U.version!==t.objType.version)switch(t.objType.version){case"1.0.0":case"1.1.0":case"1.2.0":case"1.3.0":case"1.4.0":case"1.5.0":case"1.6.0":case"1.7.0":case"1.7.1":case"1.8.0":case"1.9.0":case"1.10.0":case"1.11.0":"kArriveDefault"===t.iconName&&(t.distance=e.defaultValue);case"1.12.0":case"1.13.0":case"2.0.0":t.objType.version="2.1.0";break;default:throw new Error("invalid version for "+U.name)}let o=Object.getOwnPropertyNames(t);return["iconName","instruction","distance","duration","itineraryPointObjId","objId"].forEach(e=>{if(!o.includes(e))throw new Error("No "+e+" for "+U.name)}),t}(t);this.iconName=o.iconName||"",this.instruction=o.instruction||"",this.distance=o.distance||e.defaultValue,this.duration=o.duration||e.defaultValue,this.itineraryPointObjId=o.itineraryPointObjId||-1,k.set(this,T()),this.validateData()}validateData(){"string"==typeof this.iconName?this.iconName=p.sanitizeToJsString(this.iconName):this.iconName="","string"==typeof this.instruction?this.instruction=p.sanitizeToJsString(this.instruction):this.instruction="","number"!=typeof this.distance&&(this.distance=e.defaultValue),"number"!=typeof this.duration&&(this.duration=e.defaultValue),"number"!=typeof this.itineraryPointObjId&&(this.itineraryPointObjId=-1)}}function H(){return Object.seal(new B)}const z=w("Itinerary"),V=new WeakMap;class F{constructor(){this.hasProfile=!1,this.ascent=0,this.descent=0,this.provider="",this.transitMode="",this.itineraryPoints=x(O),this.maneuvers=x(H),V.set(this,T())}get objType(){return z}get objId(){return V.get(this)}get jsonObject(){return{hasProfile:this.hasProfile,ascent:this.ascent,descent:this.descent,itineraryPoints:this.itineraryPoints.jsonObject,maneuvers:this.maneuvers.jsonObject,provider:this.provider,transitMode:this.transitMode,objId:V.get(this),objType:z.jsonObject}}set jsonObject(e){let t=function(e){if(!Object.getOwnPropertyNames(e).includes("objType"))throw new Error("No objType for "+z.name);if(z.validate(e.objType),z.version!==e.objType.version)switch(e.objType.version){case"1.0.0":case"1.1.0":case"1.2.0":case"1.3.0":case"1.4.0":case"1.5.0":case"1.6.0":e.hasProfile=!1,e.ascent=0,e.descent=0;case"1.7.0":case"1.7.1":case"1.8.0":case"1.9.0":case"1.10.0":case"1.11.0":case"1.12.0":case"1.13.0":case"2.0.0":e.objType.version="2.1.0";break;default:throw new Error("invalid version for "+z.name)}let t=Object.getOwnPropertyNames(e);return["hasProfile","ascent","descent","itineraryPoints","maneuvers","provider","transitMode","objId"].forEach(e=>{if(!t.includes(e))throw new Error("No "+e+" for "+z.name)}),e}(e);this.hasProfile=t.hasProfile||!1,this.ascent=t.ascent||0,this.descent=t.descent||0,this.itineraryPoints.jsonObject=t.itineraryPoints||[],this.maneuvers.jsonObject=t.maneuvers||[],this.provider=t.provider||"",this.transitMode=t.transitMode||"",V.set(this,T());let o=new Map,a=0,n=this.itineraryPoints.iterator;for(;!n.done;)o.set(t.itineraryPoints[a].objId,n.value.objId),a++;let r=this.maneuvers.iterator;for(;!r.done;)r.value.itineraryPointObjId=o.get(r.value.itineraryPointObjId);this.validateData()}validateData(){"boolean"!=typeof this.hasProfile&&(this.hasProfile=!1),"number"!=typeof this.ascent&&(this.ascent=0),"number"!=typeof this.descent&&(this.descent=0),"string"==typeof this.provider?this.provider=p.sanitizeToJsString(this.provider):this.provider="","string"==typeof this.transitMode?this.transitMode=p.sanitizeToJsString(this.transitMode):this.transitMode=""}}function W(){return Object.seal(new F)}const K=w("Note"),J=new WeakMap;function Z(e){return e.replaceAll(/style='color:white;background-color:red'/g,"class='TravelNotes-Note-WhiteRed'").replaceAll(/style='color:white;background-color:green'/g,"class='TravelNotes-Note-WhiteGreen'").replaceAll(/style='color:white;background-color:blue'/g,"class='TravelNotes-Note-WhiteBlue'").replaceAll(/style='color:white;background-color:brown'/g,"class='TravelNotes-Note-WhiteBrown'").replaceAll(/style='color:white;background-color:black'/g,"class='TravelNotes-Note-WhiteBlack'").replaceAll(/style='border:solid 0.1em'/g,"class='TravelNotes-Note-BlackWhite'").replaceAll(/style='background-color:white;'/g,"class='TravelNotes-Note-Knooppunt'").replaceAll(/style='fill:green;font:bold 120px sans-serif;'/g,"").replaceAll(/style='fill:none;stroke:green;stroke-width:10;'/g,"")}class X{constructor(){this.iconHeight=0,this.iconWidth=0,this.iconContent="",this.popupContent="",this.tooltipContent="",this.phone="",this.url="",this.address="",this.iconLat=n.defaultValue,this.iconLng=n.defaultValue,this.lat=n.defaultValue,this.lng=n.defaultValue,this.distance=e.invalid,this.chainedDistance=e.defaultValue,J.set(this,T())}get isRouteNote(){return this.distance!==e.invalid}get iconLatLng(){return[this.iconLat,this.iconLng]}set iconLatLng(e){this.iconLat=e[0],this.iconLng=e[1]}get latLng(){return[this.lat,this.lng]}set latLng(e){this.lat=e[0],this.lng=e[1]}get objType(){return K}get objId(){return J.get(this)}get jsonObject(){return{iconHeight:this.iconHeight,iconWidth:this.iconWidth,iconContent:this.iconContent,popupContent:this.popupContent,tooltipContent:this.tooltipContent,phone:this.phone,url:this.url,address:this.address,iconLat:parseFloat(this.iconLat.toFixed(n.fixed)),iconLng:parseFloat(this.iconLng.toFixed(n.fixed)),lat:parseFloat(this.lat.toFixed(n.fixed)),lng:parseFloat(this.lng.toFixed(n.fixed)),distance:parseFloat(this.distance.toFixed(e.fixed)),chainedDistance:parseFloat(this.chainedDistance.toFixed(e.fixed)),objId:J.get(this),objType:K.jsonObject}}set jsonObject(t){let o=function(e){if(!Object.getOwnPropertyNames(e).includes("objType"))throw new Error("No objType for "+K.name);if(K.validate(e.objType),K.version!==e.objType.version)switch(e.objType.version){case"1.0.0":case"1.1.0":case"1.2.0":case"1.3.0":case"1.4.0":case"1.5.0":case"1.6.0":case"1.7.0":case"1.7.1":case"1.8.0":case"1.9.0":case"1.10.0":case"1.11.0":case"1.12.0":case"1.13.0":"string"==typeof e.iconHeight&&(e.iconHeight=Number.parseInt(e.iconHeight)),"string"==typeof e.iconWidth&&(e.iconWidth=Number.parseInt(e.iconWidth)),e.iconContent=Z(e.iconContent),e.popupContent=Z(e.popupContent),e.tooltipContent=Z(e.tooltipContent),e.phone=Z(e.phone),e.address=Z(e.address);case"2.0.0":e.objType.version="2.1.0";break;default:throw new Error("invalid version for "+K.name)}let t=Object.getOwnPropertyNames(e);return["iconHeight","iconWidth","iconContent","popupContent","tooltipContent","phone","url","address","iconLat","iconLng","lat","lng","distance","chainedDistance","objId"].forEach(e=>{if(!t.includes(e))throw new Error("No "+e+" for "+K.name)}),e}(t);this.iconHeight=o.iconHeight||0,this.iconWidth=o.iconWidth||0,this.iconContent=o.iconContent||"",this.popupContent=o.popupContent||"",this.tooltipContent=o.tooltipContent||"",this.phone=o.phone||"",this.url=o.url||"",this.address=o.address||"",this.iconLat=o.iconLat||n.defaultValue,this.iconLng=o.iconLng||n.defaultValue,this.lat=o.lat||n.defaultValue,this.lng=o.lng||n.defaultValue,this.distance=o.distance||e.invalid,this.chainedDistance=o.chainedDistance||e.defaultValue,J.set(this,T()),this.validateData(!0)}validateData(t){if("number"!=typeof this.iconHeight&&(this.iconHeight=0),"number"!=typeof this.iconWidth&&(this.iconWidth=0),"string"==typeof this.iconContent){let e=p.sanitizeToHtmlString(this.iconContent);t&&""!==e.errorsString&&console.log(e.errorsString+" ("+this.iconContent+")"),this.iconContent=e.htmlString}else this.iconContent="";if("string"==typeof this.popupContent){let e=p.sanitizeToHtmlString(this.popupContent);t&&""!==e.errorsString&&console.log(e.errorsString+" ("+this.popupContent+")"),this.popupContent=e.htmlString}else this.popupContent="";if("string"==typeof this.tooltipContent){let e=p.sanitizeToHtmlString(this.tooltipContent);t&&""!==e.errorsString&&console.log(e.errorsString+" ("+this.tooltipContent+")"),this.tooltipContent=e.htmlString}else this.tooltipContent="";if("string"==typeof this.phone){let e=p.sanitizeToHtmlString(this.phone);t&&""!==e.errorsString&&console.log(e.errorsString+" ("+this.phone+")"),this.phone=e.htmlString}else this.phone="";if("string"==typeof this.url&&""!==this.url){let e=p.sanitizeToUrl(this.url);t&&""!==e.errorsString&&console.log(e.errorsString+" ("+this.url+")"),this.url=encodeURI(e.url)}else this.url="";"string"==typeof this.address?this.address=p.sanitizeToHtmlString(this.address).htmlString:this.address="","number"!=typeof this.iconLat&&(this.iconLat=n.defaultValue),"number"!=typeof this.iconLng&&(this.iconLng=n.defaultValue),"number"!=typeof this.lat&&(this.lat=n.defaultValue),"number"!=typeof this.lng&&(this.lng=n.defaultValue),"number"!=typeof this.distance&&(this.distance=e.invalid),"number"!=typeof this.chainedDistance&&(this.chainedDistance=e.defaultValue)}}function G(){return Object.seal(new X)}const q=w("Route"),Y=new WeakMap;class Q{constructor(){this.name="",this.wayPoints=x(C),this.wayPoints.add(C()),this.wayPoints.add(C()),this.notes=x(G),this.itinerary=W(),this.width=f.route.width,this.color=f.route.color,this.dashArray=f.route.dashArray,this.chain=!1,this.chainedDistance=e.defaultValue,this.distance=e.defaultValue,this.duration=e.defaultValue,this.editionStatus=r.notEdited,this.hidden=!1,Y.set(this,T())}get computedName(){let e=this.name;return""===e&&(e=(""===this.wayPoints.first.fullName?"???":this.wayPoints.first.fullName)+" ⮞ "+(""===this.wayPoints.last.fullName?"???":this.wayPoints.last.fullName)),e}get objId(){return Y.get(this)}get objType(){return q}get jsonObject(){return{name:this.name,wayPoints:this.wayPoints.jsonObject,notes:this.notes.jsonObject,itinerary:this.itinerary.jsonObject,width:this.width,color:this.color,dashArray:this.dashArray,chain:this.chain,distance:parseFloat(this.distance.toFixed(e.fixed)),duration:this.duration,editionStatus:this.editionStatus,hidden:this.hidden,chainedDistance:parseFloat(this.chainedDistance.toFixed(e.fixed)),objId:Y.get(this),objType:q.jsonObject}}set jsonObject(e){let t=function(e){if(!Object.getOwnPropertyNames(e).includes("objType"))throw new Error("No objType for "+q.name);if(q.validate(e.objType),q.version!==e.objType.version)switch(e.objType.version){case"1.0.0":e.dashArray=0,e.hidden=!1;case"1.1.0":case"1.2.0":case"1.3.0":case"1.4.0":e.edited=r.notEdited;case"1.5.0":case"1.6.0":case"1.7.0":case"1.7.1":case"1.8.0":case"1.9.0":case"1.10.0":case"1.11.0":e.editionStatus=e.edited;case"1.12.0":case"1.13.0":case"2.0.0":e.objType.version="2.1.0";break;default:throw new Error("invalid version for "+q.name)}let t=Object.getOwnPropertyNames(e);return["name","wayPoints","notes","itinerary","width","color","dashArray","chain","distance","duration","editionStatus","hidden","chainedDistance","objId"].forEach(e=>{if(!t.includes(e))throw new Error("No "+e+" for "+q.name)}),e}(e);this.name=t.name||"",this.wayPoints.jsonObject=t.wayPoints||[],this.notes.jsonObject=t.notes||[],this.itinerary.jsonObject=t.itinerary||W().jsonObject,this.width=t.width||f.route.width,this.color=t.color||"#000000",this.dashArray=t.dashArray||0,this.chain=t.chain||!1,this.distance=t.distance,this.duration=t.duration,this.editionStatus=t.editionStatus||r.notEdited,this.hidden=t.hidden||!1,this.chainedDistance=t.chainedDistance,Y.set(this,T()),this.validateData()}validateData(){"string"==typeof this.name?this.name=p.sanitizeToJsString(this.name):this.name="","number"!=typeof this.width&&(this.width=f.route.width),"string"==typeof this.color?this.color=p.sanitizeToColor(this.color)||f.route.color:this.color=f.route.color,"number"!=typeof this.dashArray&&(this.dashArray=0),this.dashArray>=f.route.dashChoices.length&&(this.dashArray=0),"boolean"!=typeof this.chain&&(this.chain=!1),"number"!=typeof this.distance&&(this.distance=e.defaultValue),"number"!=typeof this.duration&&(this.duration=e.defaultValue),"number"!=typeof this.editionStatus&&(this.editionStatus=r.notEdited),"boolean"!=typeof this.hidden&&(this.hidden=!1),"number"!=typeof this.chainedDistance&&(this.chainedDistance=e.defaultValue)}}function _(){return Object.seal(new Q)}const $=w("Travel"),ee=new WeakMap;class te{constructor(){this.editedRoute=_(),this.routes=x(_),this.notes=x(G),this.layerName="OSM - Color",this.name="",this.readOnly=!1,ee.set(this,T())}get objId(){return ee.get(this)}get objType(){return $}get jsonObject(){return{editedRoute:this.editedRoute.jsonObject,layerName:this.layerName,name:this.name,routes:this.routes.jsonObject,notes:this.notes.jsonObject,readOnly:this.readOnly,objId:ee.get(this),objType:$.jsonObject}}set jsonObject(e){let t=function(e){if(!Object.getOwnPropertyNames(e).includes("objType"))throw new Error("No objType for "+$.name);if($.validate(e.objType),$.version!==e.objType.version)switch(e.objType.version){case"1.0.0":case"1.1.0":case"1.2.0":case"1.3.0":case"1.4.0":e.editedRoute=_();case"1.5.0":if(e.userData.layerId){let t=[{layerId:"0",layerName:"OSM - Color"},{layerId:"1",layerName:"OSM - Black and White"},{layerId:"2",layerName:"Thunderforest - Transport"},{layerId:"3",layerName:"Thunderforest - OpenCycleMap"},{layerId:"4",layerName:"Thunderforest - Outdoors"},{layerId:"5",layerName:"Esri - Aerial view"},{layerId:"6",layerName:"Kartverket - Norway"},{layerId:"7",layerName:"IGN-NGI - Belgium now"},{layerId:"12",layerName:"Thunderforest - Landscape"},{layerId:"24",layerName:"Lantmäteriet - Sweden"},{layerId:"25",layerName:"Maanmittauslaitos - Finland"}].find(t=>t.layerId===e.userData.layerId);e.layerName=t?t.layerName:"OSM - Color"}else e.layerName="OSM - Color";case"1.6.0":case"1.7.0":case"1.7.1":case"1.8.0":case"1.9.0":case"1.10.0":case"1.11.0":case"1.12.0":case"1.13.0":case"2.0.0":e.objType.version="2.1.0";break;default:throw new Error("invalid version for "+$.name)}let t=Object.getOwnPropertyNames(e);return["name","editedRoute","routes","objId"].forEach(e=>{if(!t.includes(e))throw new Error("No "+e+" for "+$.name)}),e}(e);this.editedRoute.jsonObject=t.editedRoute,this.layerName=e.layerName||"OSM - Color",this.name=t.name||"",this.readOnly=t.readOnly||!1,this.routes.jsonObject=t.routes||[],this.notes.jsonObject=t.notes||[],ee.set(this,T()),this.validateData()}validateData(){"string"==typeof this.layerName?this.layerName=p.sanitizeToJsString(this.layerName):this.layerName="OSM - Color","string"==typeof this.name?this.name=p.sanitizeToJsString(this.name):this.name="TravelNotes","boolean"!=typeof this.readOnly&&(this.readOnly=!0)}}function oe(){return Object.seal(new te)}let ae=new Map,ne=new Map,re=Object.seal({provider:"",transitMode:""}),ie=E.UUID;const le=Object.seal(new class{constructor(){this.map=null,this.travel=oe(),this.editedRouteObjId=-1,this.searchData=[]}get providers(){return ae}get mapObjects(){return ne}get routing(){return re}get UUID(){return ie}});function se(){let e=0,t=0,o=0,a=0,n=0,r=0,i=null,l=null,s=null,d=null,c=null,u=null,g=null,v=null,h=null,m=null,f=null,y=null,N=null,T=!0,w=null,x=null,I=null;function L(e){T&&("Escape"===e.key||"Esc"===e.key?y.click():"Enter"===e.key&&f.click())}function E(i){o+=i.screenX-e,a+=i.screenY-t,o=Math.min(Math.max(o,20),n-s.clientWidth-20),a=Math.max(a,20);let l=r-Math.max(a,0)-20;s.style.top=String(a)+"px",s.style.left=String(o)+"px",s.style["max-height"]=String(l)+"px"}function j(o){try{o.dataTransfer.setData("Text","1")}catch(e){console.log(e)}e=o.screenX,t=o.screenY}function P(){document.removeEventListener("keydown",L,!0),document.querySelector("body").removeChild(i)}function D(){P(),I("Canceled by user")}function C(){let e=null;N&&(e=N(),!e)||(f.removeEventListener("click",C,!1),P(),x(e))}function R(e,t){x=e,I=t,document.querySelector("body").appendChild(i),document.addEventListener("keydown",L,!0),n=i.clientWidth,r=i.clientHeight,function(){o=(n-s.clientWidth)/2,a=(r-s.clientHeight)/2,o=Math.min(Math.max(o,20),n-s.clientWidth-20),a=Math.max(a,20);let e=r-Math.max(a,0)-20;s.style.top=String(a)+"px",s.style.left=String(o)+"px",s.style["max-height"]=String(e)+"px"}(),w&&w()}i=b.create("div",{className:"TravelNotes-Background"}),i.addEventListener("dragover",()=>null,!1),i.addEventListener("drop",()=>null,!1),s=b.create("div",{className:"TravelNotes-BaseDialog-Container"},i),l=b.create("div",{className:"TravelNotes-BaseDialog-TopBar",draggable:!0},s),l.addEventListener("dragstart",j,!1),l.addEventListener("dragend",E,!1),y=b.create("div",{textContent:"❌",className:"TravelNotes-BaseDialog-CancelButton",title:A.getText("BaseDialog - Cancel")},l),y.addEventListener("click",D,!1),d=b.create("div",{className:"TravelNotes-BaseDialog-HeaderDiv"},s),c=b.create("div",{className:"TravelNotes-BaseDialog-ContentDiv"},s),u=b.create("div",{className:"TravelNotes-BaseDialog-ErrorDiv TravelNotes-BaseDialog-Hidden"},s),g=b.create("div",{className:"TravelNotes-BaseDialog-WaitDiv"},s),m=b.create("div",{className:"TravelNotes-WaitAnimationBullet TravelNotes-BaseDialog-Hidden"},h=b.create("div",{className:"TravelNotes-WaitAnimation TravelNotes-BaseDialog-Hidden"},g)),v=b.create("div",{className:"TravelNotes-BaseDialog-FooterDiv"},s),f=b.create("div",{textContent:"🆗",className:"TravelNotes-BaseDialog-Button"},v),f.addEventListener("click",C,!1);return Object.seal(new class{set okButtonListener(e){N=e}set keyboardEventListenerEnabled(e){T=e}set onShow(e){w=e}set title(e){d.textContent=e}get content(){return c}get footer(){return v}get okButton(){return f}get cancelButton(){return y}showError(e){u.textContent="",p.sanitizeToHtmlElement(e,u),u.classList.remove("TravelNotes-BaseDialog-Hidden")}hideError(){u.textContent="",u.classList.add("TravelNotes-BaseDialog-Hidden")}showWait(){m.classList.remove("TravelNotes-BaseDialog-Hidden"),h.classList.remove("TravelNotes-BaseDialog-Hidden"),f.classList.add("TravelNotes-BaseDialog-Hidden")}hideWait(){m.classList.add("TravelNotes-BaseDialog-Hidden"),h.classList.add("TravelNotes-BaseDialog-Hidden"),f.classList.remove("TravelNotes-BaseDialog-Hidden")}show(){return new Promise(R)}})}function de(e){let t=null,o=null,a=null;function n(){return t.hideError(),!e||!(a.value.length<12)&&a.value.match(RegExp("[0-9]+"))&&a.value.match(RegExp("[a-z]+"))&&a.value.match(RegExp("[A-Z]+"))&&a.value.match(RegExp("[^0-9a-zA-Z]"))?(new window.TextEncoder).encode(a.value):(t.showError("<p>"+A.getText("PasswordDialog - Password rules1")+"</p><ul><li>"+A.getText("PasswordDialog - Password rules2")+"</li><li>"+A.getText("PasswordDialog - Password rules3")+"</li><li>"+A.getText("PasswordDialog - Password rules4")+"</li><li>"+A.getText("PasswordDialog - Password rules5")+"</li><li>"+A.getText("PasswordDialog - Password rules6")+"</li></ul>"),void a.focus())}return t=se(),t.title=A.getText("PasswordDialog - password"),t.okButtonListener=n,o=b.create("div",null,t.content),a=b.create("input",{type:"password"},o),t.onShow=function(){a.focus()},t}
/**
	@------------------------------------------------------------------------------------------------------------------------------

	@file DataEncryptor.js
	@copyright Copyright - 2017 2021 - wwwouaiebe - Contact: https://www.ouaie.be/
	@license GNU General Public License
	@private

	@------------------------------------------------------------------------------------------------------------------------------
	*/function ce(){function e(e){return window.crypto.subtle.importKey("raw",e,{name:"PBKDF2"},!1,["deriveKey"])}function t(e){return window.crypto.subtle.deriveKey({name:"PBKDF2",salt:(new window.TextEncoder).encode("Tire la chevillette la bobinette cherra. Le Petit Chaperon rouge tira la chevillette."),iterations:1e6,hash:"SHA-256"},e,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"])}return Object.freeze(new class{encryptData(o,a,n,r){!function(o,a,n,r){let i=window.crypto.getRandomValues(new Uint8Array(16));r.then(e).then(t).then((function(e){return window.crypto.subtle.encrypt({name:"AES-GCM",iv:i},e,o)})).then((function(e){a(new Blob([i,new Uint8Array(e)],{type:"application/octet-stream"}))})).catch(n)}(o,a,n,r)}decryptData(o,a,n,r){!function(o,a,n,r){r.then(e).then(t).then((function(e){return window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(o.slice(0,16))},e,new Uint8Array(o.slice(16)))})).then(a).catch(n)}(o,a,n,r)}})}let ue=null,ge=null,ve=null,he=null,pe=f.errorUI.showHelp;function me(){pe=!ve.checked}function fe(){ge&&(clearTimeout(ge),ge=null),ue.classList.remove("TravelNotes-ErrorsUI-Error"),ue.classList.remove("TravelNotes-ErrorsUI-Warning"),ue.classList.remove("TravelNotes-ErrorsUI-Info"),ue.classList.remove("TravelNotes-ErrorsUI-Help"),ue.classList.add("TravelNotes-ErrorsUI-Hidden"),ve&&(ve.removeEventListener("change",me,!1),ve=null,he=null),ue.textContent=""}function be(e,t){if("Error"===t&&!f.errorUI.showError||"Warning"===t&&!f.errorUI.showWarning||"Info"===t&&!f.errorUI.showInfo||"Help"===t&&!f.errorUI.showHelp||"Help"===t&&!pe)return;ge&&fe();let o=b.create("div",{id:"TravelNotes-ErrorsUI-Header"},ue);b.create("span",{id:"TravelNotes-ErrorsUI-CancelButton",textContent:"❌"},o).addEventListener("click",fe,!1),p.sanitizeToHtmlElement(e,b.create("div",{id:"TravelNotes-ErrorsUI-Message"},ue)),ue.classList.add("TravelNotes-ErrorsUI-"+t);let a=f.errorUI.timeOut;"Help"===t&&(he=b.create("div",{id:"TravelNotes-ErrorsUI-HelpInputDiv"},ue),ve=b.create("input",{id:"TravelNotes-ErrorsUI-HelpInput",type:"checkbox"},he),ve.addEventListener("change",me,!1),b.create("label",{id:"TravelNotes-ErrorsUI-HelpInputLabel",for:"TravelNotes-ErrorsUI-HelpInput",textContent:A.getText("ErrorUI - Dont show again")},he),a=f.errorUI.helpTimeOut),ue.classList.remove("TravelNotes-ErrorsUI-Hidden"),ge=setTimeout(fe,a)}const ye=Object.freeze(new class{createUI(){ue||(ue=b.create("div",{id:"TravelNotes-ErrorsUI",className:"TravelNotes-ErrorsUI-Hidden"},document.querySelector("body")))}showError(e){be(e,"Error")}showWarning(e){be(e,"Warning")}showInfo(e){be(e,"Info")}showHelp(e){be(e,"Help")}});function Ne(e){let t=null,o=null,a=null,n=null,r=null,i=null,l=null,s=null,d=null,c=null,u=null;function g(){let e=[],t=a.childNodes;for(let o=0;o<t.length;o++)e.push({providerName:t[o].childNodes[0].value,providerKey:t[o].childNodes[1].value});return e}function v(){let e=!0;t.hideError();let o=a.childNodes;for(let t=0;t<o.length;t++)e=e&&""!==o[t].childNodes[0].value,e=e&&""!==o[t].childNodes[1].value;return e||t.showError(A.getText("APIKeysDialog - empty API key name or value")),e}function h(e){e.stopPropagation(),e.target.parentNode.parentNode.removeChild(e.target.parentNode)}function p(e){let t=b.create("div",{className:"TravelNotes-APIKeysDialog-ApiKeyRow"},a);b.create("input",{className:"TravelNotes-APIKeysDialog-ApiKeyName TravelNotes-APIKeysDialog-Input",value:e.providerName,placeholder:A.getText("APIKeysDialog - provider name")},t),b.create("input",{className:"TravelNotes-APIKeysDialog-ApiKeyValue TravelNotes-APIKeysDialog-Input",value:e.providerKey,placeholder:A.getText("APIKeysDialog - API key"),type:f.APIKeys.showAPIKeysInDialog?"text":"password"},t),b.create("div",{className:"TravelNotes-BaseDialog-Button TravelNotes-APIKeysDialog-AtRightButton TravelNotes-APIKeysDialog-DeleteRowButton",title:A.getText("APIKeysDialog - delete API key"),textContent:"❌"},t).addEventListener("click",h,!1)}function m(e){t.hideWait(),t.keyboardEventListenerEnabled=!0,e&&"Canceled by user"!==e&&t.showError(A.getText("APIKeysDialog - An error occurs when reading the file"))}function N(e){let o=null;try{o=JSON.parse((new TextDecoder).decode(e))}catch(e){return void m(e)}for(;a.firstChild;)a.removeChild(a.firstChild);o.forEach(e=>p(e)),t.hideWait(),t.hideError(),t.keyboardEventListenerEnabled=!0}function T(e){e.stopPropagation(),t.showWait(),t.keyboardEventListenerEnabled=!1,y.getBinaryPromise(window.location.href.substr(0,window.location.href.lastIndexOf("/")+1)+"APIKeys").then(e=>{ce().decryptData(e,N,m,de(!1).show())}).catch(()=>{t.showError(A.getText("APIKeysDialog - An error occurs when loading the APIKeys file")),t.hideWait(),t.keyboardEventListenerEnabled=!0})}function w(){t.showError(A.getText("APIKeysDialog - An error occurs when saving the keys")),t.hideWait(),t.keyboardEventListenerEnabled=!0}function x(e){t.hideError(),t.hideWait();let o=URL.createObjectURL(e),a=document.createElement("a");a.setAttribute("href",o),a.setAttribute("download","APIKeys"),a.style.display="none",document.body.appendChild(a),a.click(),document.body.removeChild(a),window.URL.revokeObjectURL(o),t.keyboardEventListenerEnabled=!0}function I(e){e.stopPropagation(),t.hideError(),v()&&(t.showWait(),t.keyboardEventListenerEnabled=!1,ce().encryptData((new window.TextEncoder).encode(JSON.stringify(g())),x,w,de(!0).show()))}function L(e){t.hideError(),t.showWait(),t.keyboardEventListenerEnabled=!1,e.stopPropagation();let o=new FileReader;o.onload=function(){ce().decryptData(o.result,N,m,de(!1).show())},o.readAsArrayBuffer(e.target.files[0])}function j(){n.click()}function P(e){e.stopPropagation(),p({providerName:"",providerKey:""})}function D(e){e.stopPropagation(),t.hideError(),v()&&E.saveFile("APIKeys.json",JSON.stringify(g()))}function C(e){e.stopPropagation(),t.hideError();let o=new FileReader;o.onload=function(){try{let e=JSON.parse(o.result);for(;a.firstChild;)a.removeChild(a.firstChild);e.forEach(e=>p(e))}catch(e){t.showError(e.message),console.log(e||"An error occurs when reading the file")}},o.readAsText(e.target.files[0])}function R(){r.click()}function M(){if(t.hideError(),v())return g()}return t=se(),t.title=A.getText("APIKeysDialog - API keys"),t.okButtonListener=M,o=b.create("div",{className:"TravelNotes-APIKeysDialog-ToolbarDiv"},t.content),f.haveCrypto&&(i=b.create("div",{className:"TravelNotes-BaseDialog-Button",title:A.getText("APIKeysDialog - Reload from server"),textContent:"🔄"},o),i.addEventListener("click",T,!1),l=b.create("div",{className:"TravelNotes-BaseDialog-Button",title:A.getText("APIKeysDialog - Save to file"),textContent:"💾"},o),l.addEventListener("click",I,!1),n=b.create("input",{className:"TravelNotes-BaseDialog-OpenFileInput",type:"file"},o),n.addEventListener("change",L,!1),s=b.create("div",{className:"TravelNotes-BaseDialog-Button",title:A.getText("APIKeysDialog - Open file"),textContent:"📂"},o),s.addEventListener("click",j,!1)),d=b.create("div",{className:"TravelNotes-BaseDialog-Button",title:A.getText("APIKeysDialog - new API key"),textContent:"+"},o),d.addEventListener("click",P,!1),f.APIKeys.dialogHaveUnsecureButtons&&(c=b.create("div",{className:"TravelNotes-BaseDialog-Button TravelNotes-APIKeysDialog-AtRightButton",title:A.getText("APIKeysDialog - Save to json file"),textContent:"💾"},o),c.addEventListener("click",D,!1),r=b.create("input",{className:"TravelNotes-BaseDialog-OpenFileInput",type:"file"},o),r.addEventListener("change",C,!1),u=b.create("div",{className:"TravelNotes-BaseDialog-Button",title:A.getText("APIKeysDialog - Open json file"),textContent:"📂"},o),u.addEventListener("click",R,!1)),a=b.create("div",{id:"TravelNotes-APIKeysDialog-DataDiv"},t.content),e.forEach(e=>p(e)),ye.showHelp("<p>"+A.getText("Help - Complete the APIKeys1")+"</p><p>"+A.getText("Help - Complete the APIKeys2")+"</p><p>"+A.getText("Help - Complete the APIKeys3")+"</p>"),t}const Te=Object.freeze(new class{dispatch(e,t){let o=function(e){return-1<["showitinerary","updateitinerary","showtravelnotes","updatetravelnotes","showsearch","updatesearch","setrouteslist","setprovider","providersadded","travelnameupdated","settransitmode"].indexOf(e)?document.getElementById("TravelNotes-UI-MainDiv"):-1<["removeobject","removeallobjects","zoomto","additinerarypointmarker","addsearchpointmarker","addrectangle","addwaypoint","layerchange","geolocationstatuschanged","geolocationpositionchanged","routeupdated","routepropertiesupdated","noteupdated","roadbookupdate","profileclosed"].indexOf(e)?document:null}(e);if(o){let a=new Event(e);t&&(a.data=t),o.dispatchEvent(a)}}});let we=new Map;function xe(e){return we.get(e.toLowerCase())}function Ie(e,t){we.set(e.toLowerCase(),t)}function Le(e){sessionStorage.clear(),we.clear();let t=E.storageAvailable("sessionStorage")&&f.APIKeys.saveToSessionStorage;e.forEach(e=>{t&&sessionStorage.setItem(e.providerName.toLowerCase()+"ProviderKey",btoa(e.providerKey)),Ie(e.providerName,e.providerKey)}),le.providers.forEach(e=>{e.providerKey=xe(e.name)||""}),Te.dispatch("providersadded")}function Ae(e){Le(JSON.parse((new TextDecoder).decode(e)))}function Ee(e){console.log(e||"An error occurs when reading the APIKeys file"),e&&"Canceled by user"!==e&&ye.showError(A.getText("APIKeysManager - An error occurs when reading the APIKeys file"))}function je(e){ce().decryptData(e,Ae,Ee,de(!1).show())}const Pe=Object.seal(new class{getKey(e){return xe(e)}setKeysFromServerFile(){0===function(){let e=0;for(let t=0;t<sessionStorage.length;t++){let o=sessionStorage.key(t);"ProviderKey"===o.substr(o.length-"ProviderKey".length)&&(Ie(o.substr(0,o.length-"ProviderKey".length),atob(sessionStorage.getItem(o))),e++)}return le.providers.forEach(e=>{e.providerKey=xe(e.name)||""}),e}()?f.haveCrypto&&y.getBinaryPromise(window.location.href.substr(0,window.location.href.lastIndexOf("/")+1)+"APIKeys").then(je).catch(e=>console.log(e||"APIKeys not found on server")):Te.dispatch("providersadded")}setKeysFromDialog(){let e=[];we.forEach((t,o)=>e.push({providerName:o,providerKey:t})),e.sort((e,t)=>e.providerName.localeCompare(t.providerName)),Ne(e).show().then(e=>Le(e)).catch(e=>console.log(e||"canceled by user"))}addProvider(e){let t=e.name.toLowerCase(),o=xe(t);e.providerKeyNeeded&&!o&&E.storageAvailable("sessionStorage")&&(o=sessionStorage.getItem(t),o&&(o=atob(o))),e.providerKeyNeeded&&o&&(e.providerKey=o),le.providers.set(e.name.toLowerCase(),e)}});const De=Object.seal(new class{getRoute(e){let t=null;return t=le.travel.routes.getAt(e),t||e===le.travel.editedRoute.objId&&(t=le.travel.editedRoute),t}getNoteAndRoute(e){let t=null,o=null;if(t=le.travel.notes.getAt(e),!t){let a=le.travel.routes.iterator;for(;!a.done&&!t;)t=a.value.notes.getAt(e),t&&(o=a.value);t||(t=le.travel.editedRoute.notes.getAt(e),t&&(o=le.travel.editedRoute))}return Object.freeze({note:t,route:o})}getWayPoint(e){let t=le.travel.editedRoute.wayPoints.getAt(e);if(!t){let o=le.travel.routes.iterator;for(;!o.done&&!t;)t=o.value.wayPoints.getAt(e)}return t}});function Ce(){let e="",t="",o=null;function a(a){o=De.getRoute(a),o&&(t='time="'+(new Date).toISOString()+'" ',e='<?xml version="1.0"?>\n',e+='<gpx xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xsi:schemaLocation="http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd" version="1.1" creator="leaflet.TravelNotes">',function(){let a=o.wayPoints.iterator;for(;!a.done;)e+='\n\t<wpt lat="'+a.value.lat+'" lon="'+a.value.lng+'" '+t+"/>"}(),function(){e+="\n\t<rte>";let a=o.itinerary.maneuvers.iterator;for(;!a.done;){let n=o.itinerary.itineraryPoints.getAt(a.value.itineraryPointObjId),r=a.value.instruction.replace("&","&amp;").replace('"',"&apos;").replace('"',"&quote;").replace(">","&gt;").replace("<","&lt;");e+='\n\t\t<rtept lat="'+n.lat+'" lon="'+n.lng+'" '+t+'desc="'+r+'" />'}e+="\n\t</rte>"}(),function(){e+="\n\t<trk>",e+="\n\t\t<trkseg>";let a=o.itinerary.itineraryPoints.iterator;for(;!a.done;)e+='\n\t\t\t<trkpt lat="'+a.value.lat+'" lon="'+a.value.lng+'" '+t+" />";e+="\n\t\t</trkseg>",e+="\n\t</trk>"}(),e+="\n</gpx>",function(){let t=(""===le.travel.name?"":le.travel.name+" - ")+o.computedName;""===t&&(t="TravelNote"),t+=".gpx",E.saveFile(t,e)}())}return Object.seal(new class{routeToGpx(e){a(e)}})}class Re{constructor(e,t,o){this.red=("number"==typeof e?e:255)%256,this.green=("number"==typeof t?t:255)%256,this.blue=("number"==typeof o?o:255)%256}get cssColor(){return"#"+this.red.toString(16).padStart(2,"0")+this.green.toString(16).padStart(2,"0")+this.blue.toString(16).padStart(2,"0")}set cssColor(e){this.red=parseInt(e.substr(1,2),16),this.green=parseInt(e.substr(3,2),16),this.blue=parseInt(e.substr(5,2),16)}clone(){return new Re(this.red,this.green,this.blue)}copyTo(e){e.red=this.red,e.green=this.green,e.blue=this.blue}}function Me(e){let t=null,o=null,a=null,n=null,r=null,i=null;function l(){return e.color=document.getElementById("TravelNotes-ColorDialog-ColorSampleDiv").color.cssColor,e.computedName!==a.value&&(e.name=a.value),e.width=parseInt(n.value),e.chain=r.checked,e.dashArray=i.selectedIndex,e.validateData(),e}return t=function(e){let t=null,o=new Re;o.cssColor=e;let a=null,n=[],r=null,i=null,l=null,s=null;function d(e){o=e.target.color.clone(),r.value=o.red,i.value=o.green,l.value=o.blue,s.style["background-color"]=o.cssColor,s.color=o}function c(e){for(let t=0;t<6;++t)for(let o=0;o<6;++o){let a=n[6*t+o];a.color.red=e,a.style["background-color"]=a.color.cssColor}}function u(e){c(Math.ceil(2.55*e.target.valueAsNumber))}function g(e){c(255-e.target.color.blue)}function v(){o.red=parseInt(r.value),o.green=parseInt(i.value),o.blue=parseInt(l.value),s.style["background-color"]=o.cssColor,s.color=o}return t=se(),t.title=A.getText("ColorDialog - Colors"),a=b.create("div",{id:"TravelNotes-ColorDialog-ColorDiv"},t.content),function(){let e=b.create("div",null,a),t=new Re(f.colorDialog.initialRed,0,0);for(let o=0;o<6;++o){let o=b.create("div",{className:"TravelNotes-ColorDialog-RowColorDiv"},e);t.green=0;for(let e=0;e<6;++e){let e=b.create("div",{className:"TravelNotes-ColorDialog-CellColorDiv"},o);e.color=t.clone(),e.style["background-color"]=t.cssColor,e.addEventListener("click",d,!1),t.green+=51,n.push(e)}t.blue+=51}}(),f.colorDialog.haveSlider?function(){let e=b.create("div",null,a),t=Math.ceil(f.colorDialog.initialRed*(100/255)),o=b.create("input",{type:"range",className:"TravelNotes-ColorDialog-SliderInput",value:t,min:0,max:100,step:20},e);o.addEventListener("input",u,!1),o.focus()}():function(){let e=b.create("div",null,a),t=new Re(255,0,0),o=b.create("div",{className:"TravelNotes-ColorDialog-RowColorDiv",id:"TravelNotes-ColorDialog-RedButtonsRowDiv"},e);for(let e=0;e<6;++e){let e=b.create("div",{className:"TravelNotes-ColorDialog-CellColorDiv"},o);e.color=t.clone(),e.style["background-color"]=e.color.cssColor,e.addEventListener("click",g,!1),t.green+=51,t.blue+=51}}(),function(){let e=b.create("div",null,a);b.create("text",{value:A.getText("ColorDialog - Red")},e),r=b.create("input",{type:"number",className:"TravelNotes-ColorDialog-NumberInput",value:o.red,min:0,max:255},e),r.addEventListener("input",v,!1),b.create("text",{value:A.getText("ColorDialog - Green")},e),i=b.create("input",{type:"number",className:"TravelNotes-ColorDialog-NumberInput",value:o.green,min:0,max:255},e),i.addEventListener("input",v,!1),b.create("text",{value:A.getText("ColorDialog - Blue")},e),l=b.create("input",{type:"number",className:"TravelNotes-ColorDialog-NumberInput",value:o.blue,min:0,max:255},e),l.addEventListener("input",v,!1)}(),s=b.create("div",{id:"TravelNotes-ColorDialog-ColorSampleDiv"},a),s.style["background-color"]=o.cssColor,s.color=o,t}(e.color),t.title=A.getText("RoutePropertiesDialog - Route properties"),t.okButtonListener=l,o=b.create("div",{id:"TravelNotes-RoutePropertiesDialog-MainDataDiv"}),t.content.insertBefore(o,t.content.firstChild),function(){let t=b.create("div",null,o);b.create("div",{textContent:A.getText("RoutePropertiesDialog - Name")},t);let n=b.create("div",{className:"TravelNotes-RoutePropertiesDialog-DataDiv",id:"TravelNotes-RoutePropertiesDialog-NameInputDiv"},t);a=b.create("input",{type:"text",id:"TravelNotes-RoutePropertiesDialog-NameInput",value:e.computedName},n)}(),function(){let t=b.create("div",{className:"TravelNotes-RoutePropertiesDialog-DataDiv"},o);b.create("text",{value:A.getText("RoutePropertiesDialog - Width")},b.create("span",null,t)),n=b.create("input",{type:"number",id:"TravelNotes-RoutePropertiesDialog-WidthInput",value:e.width,min:1,max:40},t)}(),function(){let t=b.create("div",{className:"TravelNotes-RoutePropertiesDialog-DataDiv"},o);b.create("text",{value:A.getText("RoutePropertiesDialog - Linetype")},b.create("span",null,t)),i=b.create("select",null,t);let a=f.route.dashChoices;for(let e=0;e<a.length;e++)i.add(b.create("option",{text:a[e].text}));i.selectedIndex=e.dashArray<a.length?e.dashArray:0}(),function(){let t=b.create("div",{className:"TravelNotes-RoutePropertiesDialog-DataDiv",id:"TravelNotes-RoutePropertiesDialog-ChainDiv"},o);b.create("text",{value:A.getText("RoutePropertiesDialog - Chained route")},b.create("span",null,t)),r=b.create("input",{type:"checkbox",checked:e.chain},t)}(),b.create("div",{textContent:A.getText("RoutePropertiesDialog - Color"),id:"TravelNotes-RoutePropertiesDialog-ColorHeaderDiv"},o),t}const Se=Math.PI/180;function Oe(e){return(e+540)%360-180}const Ue=Object.freeze(new class{getLatLngElevAtDist(e,t){if(e.distance<=t||0>=t)return null;let o=0,a=e.itinerary.itineraryPoints.iterator;for(;o<t&&!a.done;)o+=a.value.distance;let n=a.value;a.done;let r=(n.distance-o+t)/n.distance;return Object.freeze({latLng:[n.lat+(a.value.lat-n.lat)*r,n.lng+(a.value.lng-n.lng)*r],elev:n.elev+(a.value.elev-n.elev)*r,ascent:100*(a.value.elev-n.elev)/n.distance,routeDistance:t})}getClosestLatLngDistance(t,o){if(0===t.itinerary.itineraryPoints.length)return null;let a=t.itinerary.itineraryPoints.iterator;a.done;let n=Number.MAX_VALUE,r=L.Projection.SphericalMercator.project(L.latLng(o[0],o[1])),i=L.Projection.SphericalMercator.project(L.latLng(a.value.lat,a.value.lng)),l=null,s=e.defaultValue,d=a.value.distance;for(;!a.done;){let e=L.Projection.SphericalMercator.project(L.latLng(a.value.lat,a.value.lng)),t=L.LineUtil.pointToSegmentDistance(r,i,e);t<n&&(n=t,l=L.Projection.SphericalMercator.unproject(L.LineUtil.closestPointOnSegment(r,i,e)),s=d-l.distanceTo(L.latLng(a.value.lat,a.value.lng))),d+=a.value.distance,i=e}return Object.freeze({latLng:[l.lat,l.lng],distance:s})}getLatLngBounds(e){let t=L.latLng([90,180]),o=L.latLng([-90,-180]);return e.forEach(e=>{t.lat=Math.min(t.lat,e[0]),t.lng=Math.min(t.lng,e[1]),o.lat=Math.max(o.lat,e[0]),o.lng=Math.max(o.lng,e[1])}),L.latLngBounds(t,o)}pointsDistance(e,t){if(e[0]===t[0]&&e[1]===t[1])return 0;let o=e[0]*Se,a=t[0]*Se,n=(Oe(t[1])-Oe(e[1]))*Se;return 6371e3*Math.acos(Math.sin(o)*Math.sin(a)+Math.cos(o)*Math.cos(a)*Math.cos(n))}getSquareBoundingBox(e,t){let o=t/6371e3/Se,a=e[0]*Se,n=Math.acos((Math.cos(t/6371e3)-Math.sin(a)**2)/Math.cos(a)**2)/Se;return L.latLngBounds(L.latLng([e[0]-o,e[1]-n]),L.latLng([e[0]+o,e[1]+n]))}project(e,t){let o=le.map.project(L.latLng(e),t);return[o.x,o.y]}screenCoordToLatLng(e,t){let o=le.map.containerPointToLatLng(L.point(e,t));return[o.lat,o.lng]}addPoints(e,t){return[e[0]+t[0],e[1]+t[1]]}subtrackPoints(e,t){return[e[0]-t[0],e[1]-t[1]]}});function ke(){let e=[];function t(t){e.push(t.latLng),e.push(t.iconLatLng)}function o(o){o.itinerary.itineraryPoints.forEach(t=>e.push(t.latLng)),o.notes.forEach(e=>t(e))}return Object.seal(new class{zoomToLatLng(e){Te.dispatch("zoomto",{latLng:e})}zoomToManeuver(e){let t=le.travel.editedRoute.itinerary.maneuvers.getAt(e).itineraryPointObjId,o=le.travel.editedRoute.itinerary.itineraryPoints.getAt(t).latLng;Te.dispatch("zoomto",{latLng:o})}zoomToNote(o){e=[],t(De.getNoteAndRoute(o).note),Te.dispatch("zoomto",{geometry:[e]})}zoomToRoute(t){e=[],o(De.getRoute(t)),Te.dispatch("zoomto",{geometry:[e]})}zoomToTravel(){e=[],le.travel.routes.forEach(e=>o(e)),-1!==le.travel.editedRouteObjId&&o(le.travel.editedRoute),le.travel.notes.forEach(e=>t(e)),Te.dispatch("zoomto",{geometry:[e]})}zoomToPoi(e){Te.dispatch("zoomto",e)}})}
/**
	@------------------------------------------------------------------------------------------------------------------------------

	@file FloatWindow.js
	@copyright Copyright - 2017 2021 - wwwouaiebe - Contact: https://www.ouaie.be/
	@license GNU General Public License
	@private

	@------------------------------------------------------------------------------------------------------------------------------
	*/function Be(){let e=null,t=null,o=null,a=0,n=0,r=0,i=0,l=0,s=0,d=null;function c(e){try{e.dataTransfer.setData("Text","1")}catch(e){console.log(e)}a=e.screenX,n=e.screenY}function u(t){r+=t.screenX-a,i+=t.screenY-n,r=Math.min(Math.max(r,20),l-e.clientWidth-20),i=Math.max(i,20);let o=s-Math.max(i,0)-20;e.style.top=String(i)+"px",e.style.left=String(r)+"px",e.style["max-height"]=String(o)+"px"}function g(){d&&d(),document.querySelector("body").removeChild(e)}return new class{createWindow(){l=le.map.getContainer().clientWidth,s=le.map.getContainer().clientHeight,e=b.create("div",{className:"TravelNotes-FloatWindow-Container"},document.querySelector("body")),function(){let t=b.create("div",{className:"TravelNotes-FloatWindow-TopBar",draggable:!0},e);t.addEventListener("dragstart",c,!1),t.addEventListener("dragend",u,!1),b.create("div",{textContent:"❌",className:"TravelNotes-FloatWindow-CancelButton",title:A.getText("FloatWindow - Close")},t).addEventListener("click",g,!1)}(),t=b.create("div",{className:"TravelNotes-FloatWindow-HeaderDiv"},e),o=b.create("div",{className:"TravelNotes-FloatWindow-ContentDiv"},e)}close(){g()}set onClose(e){d=e}get header(){return t}get content(){return o}}}let He=null,ze=n.defaultValue,Ve=n.defaultValue,Fe=null,We=null,Ke=-1,Je=-1,Ze=-1,Xe=[],Ge=null,qe=null;function Ye(e){-1!==Ze&&Fe.childNodes[Ze+1].firstChild.classList.remove("TravelNotes-ContextMenu-ItemSelected"),e?(Fe.childNodes[Ke+1].firstChild.classList.add("TravelNotes-ContextMenu-ItemSelected"),Ze=Ke):(Fe.childNodes[Je+1].firstChild.classList.add("TravelNotes-ContextMenu-ItemSelected"),Ze=Je,Ke=Je)}function Qe(e){Fe&&("Escape"===e.key||"Esc"===e.key?(e.stopPropagation(),Ge.click()):"ArrowDown"===e.key||"ArrowRight"===e.key||"Tab"===e.key?(e.stopPropagation(),Ke=-1===Ke||Xe.length-1===Ke?0:++Ke,Ye(!0)):"ArrowUp"===e.key||"ArrowLeft"===e.key?(e.stopPropagation(),Ke=-1===Ke||0===Ke?Xe.length-1:--Ke,Ye(!0)):"Home"===e.key?(e.stopPropagation(),Ke=0,Ye(!0)):"End"===e.key?(e.stopPropagation(),Ke=Xe.length-1,Ye(!0)):"Enter"===e.key&&Ke>=0&&Xe[Ke].action&&(e.stopPropagation(),Ye(!0),Fe.childNodes[Ze+1].firstChild.click()))}function _e(e){e.stopPropagation();let t=Xe[e.target.menuItem];Ge.click(),t.param?t.action.call(t.context,t.param):t.action.call(t.context)}function $e(e){Je=e.target.objId,Ye(!1)}function et(){We&&(clearTimeout(We),We=null),document.removeEventListener("keydown",Qe,!0),qe.removeChild(Fe),He=null,ze=n.defaultValue,Ve=n.defaultValue,Fe=null,Ke=-1,Je=-1,Ze=-1,Xe=[],Ge=null,qe=null}function tt(e,t,o){function a(){if(He=e,He.fromUI||He.latlng.lat!==ze||He.latlng.lng!==Ve){if(ze=He.latlng.lat,Ve=He.latlng.lng,Fe)return We&&(clearTimeout(We),We=null),void et();Fe=null,Ke=-1,Je=-1,Ze=-1,Ge=null,qe=o||document.querySelector("body"),Xe=t,Fe=b.create("div",{id:"TravelNotes-ContextMenu-Container",className:"TravelNotes-ContextMenu-Container"},qe),0<f.contextMenu.timeout&&(Fe.addEventListener("mouseenter",()=>{We&&(clearTimeout(We),We=null)},!1),Fe.addEventListener("mouseleave",()=>{We=setTimeout(et,f.contextMenu.timeout)},!1)),Ge=b.create("div",{textContent:"❌",className:"TravelNotes-ContextMenu-CloseButton",title:A.getText("ContextMenu - Close")},Fe),Ge.addEventListener("click",et,!1),function(){let e=0;Xe.forEach(t=>{let o=b.create("div",{className:"TravelNotes-ContextMenu-ItemContainer"},Fe),a=b.create("div",{textContent:t.name,id:"TravelNotes-ContextMenu-Item"+e,objId:e,className:t.action?"TravelNotes-ContextMenu-Item":"TravelNotes-ContextMenu-Item TravelNotes-ContextMenu-ItemDisabled"},o);a.addEventListener("mouseenter",$e,!1),t.action&&a.addEventListener("click",_e,!1),a.menuItem=e,++e})}(),function(){let e=document.querySelector("body"),t=b.create("div",{className:"TravelNotes-ContextMenu-Panel"},e),a=t.clientWidth,n=t.clientHeight;e.removeChild(t);let r=Math.min(He.originalEvent.clientY,n-Fe.clientHeight-20),i=Math.min(He.originalEvent.clientX,a-Fe.clientWidth-20);o?(Fe.style.top=String(r)+"px",Fe.style.right=String(20)+"px"):(Fe.style.top=String(r)+"px",Fe.style.left=String(i)+"px")}(),document.addEventListener("keydown",Qe,!0)}}return new class{show(){a()}}}let ot=!1;function at(){let t=Object.seal({latLng:[n.defaultValue,n.defaultValue],distance:e.defaultValue}),o=null,a=null,r={},i=new Map,s=new Map,c=[],u=null,g="",v=null,h=0,p=[0,0],m=0,b=null,N=f.note.svgZoom,T=f.note.svgAngleDistance,w=" ",x="",I="",L="";function E(e){let t=!1;return a.wayPoints.forEach(o=>{Math.abs(e.lat-o.lat)<1e-5&&Math.abs(e.lng-o.lng)<1e-5&&(t=!0)}),!t&&(o.lat!==e.lat||o.lng!==e.lng)}function j(j,P){ot?P("A request is already running"):(ot=!0,r={},v=null,g="",w=" ",x="",I="",function(){let n=Number.MAX_VALUE,r=e.defaultValue;a.itinerary.itineraryPoints.forEach(e=>{let a=Ue.pointsDistance(t.latLng,e.latLng);n>a&&(n=a,o=e,t.distance=r),r+=e.distance}),t.latLng=o.latLng}(),y.getJsonPromise(function(){let e=t.latLng[0].toFixed(n.fixed)+","+t.latLng[1].toFixed(n.fixed);return f.overpassApi.url+"?data=[out:json][timeout:"+f.note.svgTimeOut+"];way[highway](around:"+(1.5*l.svgViewboxDim).toFixed(0)+","+e+")->.a;(.a >;.a;)->.a;.a out;is_in("+e+')->.e;area.e[admin_level="2"][name="United Kingdom"]->.f;area.e[admin_level="8"]->.g;area.e[admin_level="10"]->.h;if(f.count(deriveds)==0){.g->.i;}else{if(h.count(deriveds)==0){.g->.i;}else{.h->.i;}}.i out;(node(area.i)[place="village"];node(area.i)[place="hamlet"];node(area.i)[place="city"];node(area.i)[place="town"];)->.k;( node(around:'+f.note.svgHamletDistance+","+e+')[place="hamlet"];node(around:'+f.note.svgVillageDistance+","+e+')[place="village"];node(around:'+f.note.svgCityDistance+","+e+')[place="city"];node(around:'+f.note.svgTownDistance+","+e+')[place="town"];)->.l;node.k.l->.m;.m out;'}()).then((function(n){r=n,i.clear(),s.clear(),r.elements.forEach(e=>{switch(e.type){case"area":e.tags&&e.tags.boundary&&e.tags.name&&(g=e.tags.name);break;case"way":e.nodesIds=e.nodes,delete e.nodes,i.set(e.id,e);break;case"node":s.set(e.id,e),e.tags&&e.tags.place&&["town","city","village","hamlet"].includes(e.tags.place)&&c.push(e)}}),v=document.createElementNS(d,"svg"),v.setAttributeNS(null,"viewBox",String(l.svgViewboxDim/4)+" "+l.svgViewboxDim/4+" "+l.svgViewboxDim/2+" "+l.svgViewboxDim/2),v.setAttributeNS(null,"class","TravelNotes-SvgIcon"),function(){let e=Number.MAX_VALUE;c.forEach(t=>{let a=Ue.pointsDistance(o.latLng,[t.lat,t.lon]);e>a&&(e=a,u=t.tags.name)})}(),p=Ue.subtrackPoints([l.svgViewboxDim/2,l.svgViewboxDim/2],Ue.project(t.latLng,N)),function(){let n=e.defaultValue,r=a.itinerary.itineraryPoints.first,i=a.itinerary.itineraryPoints.last,l=!1;a.itinerary.itineraryPoints.forEach(e=>{t.distance-n>T&&(r=e),n-t.distance>T&&!l&&(i=e,l=!0),n+=e.distance});let s=Ue.addPoints(Ue.project(t.latLng,N),p);if(o.objId!==a.itinerary.itineraryPoints.first.objId){let e=Ue.addPoints(Ue.project(r.latLng,N),p);m=180*Math.atan((s[1]-e[1])/(e[0]-s[0]))/Math.PI,0>m&&(m+=360),m-=270,0>e[0]-s[0]&&(m+=180)}if(o.objId!==a.itinerary.itineraryPoints.last.objId){let e=Ue.addPoints(Ue.project(i.latLng,N),p);for(b=180*Math.atan((s[1]-e[1])/(e[0]-s[0]))/Math.PI,0>e[0]-s[0]&&(b+=180),b-=m;0>b;)b+=360;for(;360<b;)b-=360}o.objId===a.itinerary.itineraryPoints.first.objId&&(m=-b-90,b=null,h=-1),t.latLng[0]===a.itinerary.itineraryPoints.last.lat&&t.latLng[1]===a.itinerary.itineraryPoints.last.lng&&(b=null,h=1)}(),null!==b&&(b<f.note.svgAnleMaxDirection.right?(x=A.getText("SvgIconFromOsmFactory - Turn right"),w="🢂"):b<f.note.svgAnleMaxDirection.slightRight?(x=A.getText("SvgIconFromOsmFactory - Turn slight right"),w="🢅"):b<f.note.svgAnleMaxDirection.continue?(x=A.getText("SvgIconFromOsmFactory - Continue"),w="🢁"):b<f.note.svgAnleMaxDirection.slightLeft?(x=A.getText("SvgIconFromOsmFactory - Turn slight left"),w="🢄"):b<f.note.svgAnleMaxDirection.left?(x=A.getText("SvgIconFromOsmFactory - Turn left"),w="🢀"):b<f.note.svgAnleMaxDirection.sharpLeft?(x=A.getText("SvgIconFromOsmFactory - Turn sharp left"),w="🢇"):b<f.note.svgAnleMaxDirection.sharpRight?(x=A.getText("SvgIconFromOsmFactory - Turn sharp right"),w="🢆"):(x=A.getText("SvgIconFromOsmFactory - Turn right"),w="🢂")),-1===h?x=A.getText("SvgIconFromOsmFactory - Start"):1===h&&(x=A.getText("SvgIconFromOsmFactory - Stop")),function(){let t=a.itinerary.itineraryPoints.previous(o.objId,E),n=a.itinerary.itineraryPoints.next(o.objId,E),r=-1,l=-1,d=-1,c=Number.MAX_VALUE,u=Number.MAX_VALUE,g=Number.MAX_VALUE,v=e.defaultValue;s.forEach(e=>{o&&(v=Ue.pointsDistance([e.lat,e.lon],o.latLng),v<c&&(r=e.id,c=v)),t&&(v=Ue.pointsDistance([e.lat,e.lon],t.latLng),v<u&&(l=e.id,u=v)),n&&(v=Ue.pointsDistance([e.lat,e.lon],n.latLng),v<g&&(d=e.id,g=v))});let p=s.get(r),m=p&&p.tags&&p.tags.highway&&"mini_roundabout"===p.tags.highway;p&&p.tags&&p.tags.rcn_ref&&p.tags["network:type"]&&"node_network"===p.tags["network:type"]&&"bike"===a.itinerary.transitMode&&(L=p.tags.rcn_ref);let f="",b="",y=!1,N=!1;i.forEach(e=>{if(!e.nodesIds.includes(r))return;let t=function(e){return(e.tags.name?e.tags.name:"")+(e.tags.name&&e.tags.ref?" ":"")+(e.tags.ref?"["+e.tags.ref+"]":"")}(e),o=""!==t,a=e.nodesIds.includes(l),n=e.nodesIds.includes(d),i=2*e.nodesIds.filter(e=>e===r).length;if(e.nodesIds[0]===r&&i--,e.nodesIds[e.nodesIds.length-1]===r&&i--,a&&(f=o?t:"???",i--,e.tags.junction&&"roundabout"===e.tags.junction&&(N=!0)),0!==i&&(n&&(b=o?t:"???",i--,e.tags.junction&&"roundabout"===e.tags.junction&&(y=!0)),0!==i&&o))for(;0!==i;)I=""===I?t:I+" ⪥  "+t,i--}),I=-1===h?"🟢 "+b:1===h?f+" 🔴 ":f+(""===I?"":" ⪥  "+I)+" "+w+" "+b,y&&!N?x+=A.getText("SvgIconFromOsmFactory - entry roundabout"):!y&&N?x+=A.getText("SvgIconFromOsmFactory - exit roundabout"):y&&N&&(x+=A.getText("SvgIconFromOsmFactory - continue roundabout")),m&&(x+=A.getText("SvgIconFromOsmFactory - at the small roundabout on the ground"))}(),function(){let e=-1,t=-1,o=-1,n=[];if(a.itinerary.itineraryPoints.forEach(a=>{e++;let r=Ue.addPoints(Ue.project(a.latLng,N),p);n.push(r),r[0]>=0&&r[1]>=0&&r[0]<=l.svgViewboxDim&&r[1]<=l.svgViewboxDim&&(-1===t&&(t=e),o=e)}),-1!==t&&-1!==o){0<t&&t--,a.itinerary.itineraryPoints.length-1>o&&o++;let r="";for(e=t;e<=o;e++)r+=n[e][0].toFixed(0)+","+n[e][1].toFixed(0)+" ";let i=document.createElementNS(d,"polyline");i.setAttributeNS(null,"points",r),i.setAttributeNS(null,"class","TravelNotes-OSM-Itinerary"),i.setAttributeNS(null,"transform","rotate("+m+","+l.svgViewboxDim/2+","+l.svgViewboxDim/2+")"),v.appendChild(i)}}(),i.forEach(e=>{let t=-1,o=-1,a=-1,n=[];if(e.nodesIds.forEach(e=>{a++;let r=s.get(e),i=Ue.addPoints(Ue.project([r.lat,r.lon],N),p);n.push(i),i[0]>=0&&i[1]>=0&&i[0]<=l.svgViewboxDim&&i[1]<=l.svgViewboxDim&&(-1===t&&(t=a),o=a)}),-1!==t&&-1!==o){0<t&&t--,e.nodesIds.length-1>o&&o++;let r="";for(a=t;a<=o;a++)r+=n[a][0].toFixed(0)+","+n[a][1].toFixed(0)+" ";let i=document.createElementNS(d,"polyline");i.setAttributeNS(null,"points",r),i.setAttributeNS(null,"class","TravelNotes-OSM-Highway TravelNotes-OSM-Highway-"+e.tags.highway),i.setAttributeNS(null,"transform","rotate("+m+","+l.svgViewboxDim/2+","+l.svgViewboxDim/2+")"),v.appendChild(i)}}),function(){if(""===L)return;let e=document.createElementNS(d,"text");e.textContent=L,e.setAttributeNS(null,"x",String(l.svgViewboxDim/2)),e.setAttributeNS(null,"y",String(.6*l.svgViewboxDim)),e.setAttributeNS(null,"class","TravelNotes-OSM-RcnRef"),v.appendChild(e)}(),ot=!1,j(Object.freeze({svg:v,tooltip:x,city:g,place:u,streets:I,latLng:o.latLng}))})).catch(e=>{ot=!1,P(e)}))}return Object.seal(new class{getPromiseIconAndAdress(e,o){return t.latLng=e,a=De.getRoute(o),new Promise(j)}})}const nt=Math.max(f.note.svgHamletDistance,f.note.svgVillageDistance,f.note.svgCityDistance,f.note.svgTownDistance);function rt(){let e=null;return Object.seal(new class{parseResponse(t){let o=function(t){const o=f.nominatim.language;let a=[],n={hamlet:{name:null,distance:Number.MAX_VALUE,maxDistance:f.note.svgHamletDistance},village:{name:null,distance:Number.MAX_VALUE,maxDistance:f.note.svgVillageDistance},city:{name:null,distance:Number.MAX_VALUE,maxDistance:f.note.svgCityDistance},town:{name:null,distance:Number.MAX_VALUE,maxDistance:f.note.svgTownDistance}};t.elements.forEach(t=>{if("area"===t.type){let e=t.tags.name;o&&"*"!==o&&t.tags["name:"+o]&&(e=t.tags["name:"+o]),a[Number.parseInt(t.tags.admin_level)]=e}if("node"===t.type&&t.tags&&t.tags.place&&n[t.tags.place]&&t.tags.name){let o=Ue.pointsDistance(e,[t.lat,t.lon]),a=n[t.tags.place];a.maxDistance>o&&a.distance>o&&(a.distance=o,a.name=t.tags.name)}});let r=null,i=null;for(let e=2;e<a.length;e++)void 0!==a[e]&&("8">=e?r=a[e]:i=a[e]);let l=null,s=Number.MAX_VALUE;return Object.values(n).forEach(e=>{e.distance<s&&(s=e.distance,l=e.name)}),l=i||l,l===r&&(l=null),{city:r,place:l,country:a[2]}}(t[1].value),a=function(e){let t="";return e.error?{street:null,nameDetails:null,country:null}:(e.address.house_number&&(t+=e.address.house_number+" "),e.address.road?t+=e.address.road+" ":e.address.pedestrian&&(t+=e.address.pedestrian+" "),{street:t,nameDetails:e.namedetails.name,country:e.address.country})}(t[0].value),n=o.city;o.place&&(n+=" ("+o.place+")");let r=a.street;r||n||(n=a.country||o.country||""),r=r||"";let i=a.nameDetails||"";return(r.includes(i)||n.includes(i))&&(i=""),Object.seal({name:p.sanitizeToJsString(i),street:p.sanitizeToJsString(r),city:p.sanitizeToJsString(n)})}getPromiseAddress(t){e=t;let o=f.nominatim.url+"reverse?format=json&lat="+t[0]+"&lon="+t[1]+"&zoom=18&addressdetails=1&namedetails=1",a=f.nominatim.language;a&&"*"!==a&&(o+="&accept-language="+a);let n=null;a&&"*"===a&&(n=[{headerName:"accept-language",headerValue:""}]);let r=f.overpassApi.url+"?data=[out:json][timeout:"+f.note.svgTimeOut+"];is_in("+t[0]+","+t[1]+')->.e;area.e[admin_level][boundary="administrative"]->.f;node(around:'+nt+","+t[0]+","+t[1]+")[place]->.g;(.f;.g;)->.h;.h out;";return Promise.allSettled([y.getJsonPromise(o,n),y.getJsonPromise(r)])}})}let it=[],lt=[],st=null,dt=null,ct=null,ut=null;function gt(){lt.forEach(e=>dt.add(b.create("option",{text:p.sanitizeToJsString(e.name)}))),dt.selectedIndex=-1}function vt(){it.forEach(e=>{let t=b.create("button",{type:"button",htmlBefore:e.htmlBefore||"",htmlAfter:e.htmlAfter||"",className:"TravelNotes-NoteDialog-EditorButton"},st);p.sanitizeToHtmlElement(e.title||"?",t),t.addEventListener("click",ut.onButtonClickEventListener,!1)})}function ht(e){let t=new FileReader;t.onload=function(){try{let e=JSON.parse(t.result);it=it.concat(e.editionButtons),lt=lt.concat(e.preDefinedIconsList),lt.sort((e,t)=>e.name.localeCompare(t.name)),document.querySelectorAll(".TravelNotes-NoteDialog-EditorButton").forEach(e=>{e.removeEventListener("click",ut.onButtonClickEventListener,!1),st.removeChild(e)}),vt();for(let e=dt.length-1;e>=0;e--)dt.remove(e);gt(),ut.hideError()}catch(e){console.log(e?e.message:"An error occurs when opening the file"),ut.showError(A.getText("NoteDialogToolbar - An error was found in the json file",{error:e.message}))}},t.readAsText(e.target.files[0])}function pt(){ct.click()}function mt(e){ut.toggleContents(),e.target.textContent="▼"===e.target.textContent?"▶":"▼"}const ft=Object.seal(new class{set selectOptions(e){lt=lt.concat(e),lt.sort((e,t)=>e.name.localeCompare(t.name))}set buttons(e){it=it.concat(e)}getIconData(e){return lt[e]}getIconDataFromName(e){let t=lt.find(t=>t.name===e);return t?t.icon:null}createToolbar(e){return ut=e,st=b.create("div",{className:"TravelNotes-NoteDialog-ToolbarDiv",id:"TravelNotes-NoteDialog-ToolbarDiv"}),dt=b.create("select",{className:"TravelNotes-NoteDialog-Select",id:"TravelNotes-NoteDialog-IconSelect"},st),dt.addEventListener("change",ut.onSelectEventListener,!1),gt(),ct=b.create("input",{className:"TravelNotes-BaseDialog-OpenFileInput",type:"file"},st),ct.addEventListener("change",ht,!1),b.create("div",{className:"TravelNotes-BaseDialog-Button",title:A.getText("NoteDialog - show hidden contents"),textContent:"▼"},st).addEventListener("click",mt,!1),b.create("div",{className:"TravelNotes-BaseDialog-Button",title:A.getText("NoteDialog - Open a configuration file"),textContent:"📂"},st).addEventListener("click",pt,!1),vt(),st}});function bt(){let e=null,t=1,o=1,a=Number.MAX_VALUE,n=0,r=0,l=null,s=0,c=f.route.elev.smoothCoefficient,u=f.route.elev.smoothPoints;function g(){let e=function(){let e=0,t=0,o=[],a=l.itinerary.itineraryPoints.iterator,n=0,r=a.done;for(o.push({distance:e,elev:a.value.elev}),n+=a.value.distance,r=a.done;!r;){for(e+=s;e>=n&&!r;)n+=a.value.distance,r=a.done;if(!r){let r=(a.value.elev-a.previous.elev)/a.previous.distance;t=a.value.elev-(n-e)*r,o.push({distance:e,elev:t})}}return o.push({distance:n,elev:l.itinerary.itineraryPoints.last.elev}),o}(),t=new Map,o=(e[u].elev-e[0].elev)/u,a=0;for(a=0;a<u;a++)t.set(a*s,{distance:a*s,elev:e[0].elev+o*a});for(a=u;a<e.length-u;a++){let o=0;for(let t=a-u;a+u>=t;t++)o+=e[t].elev;t.set(e[a].distance,{distance:e[a].distance,elev:o/(2*u+1)})}return a--,o=s*(e[e.length-1].elev-e[e.length-1-u].elev)/(e[e.length-1].distance-e[e.length-1-u].distance),t.set(e[a].distance+s,{distance:e[a].distance+s,elev:e[a].elev+o}),t.set(e[a].distance+2*s,{distance:e[a].distance+2*s,elev:e[a].elev+2*o}),t}function v(s){return l=s,a=Number.MAX_VALUE,n=0,l.itinerary.itineraryPoints.forEach(e=>{n=Math.max(n,e.elev),a=Math.min(a,e.elev)}),r=n-a,t=i.height/r,o=i.width/l.distance,e=document.createElementNS(d,"svg"),e.setAttributeNS(null,"viewBox","0 0 "+(i.width+2*i.margin)+" "+(i.height+2*i.margin)),e.setAttributeNS(null,"class","TravelNotes-SvgProfile"),function(){let a="",r=0,s=0,c=0;l.itinerary.itineraryPoints.forEach(e=>{s=(i.margin+o*r).toFixed(0),c=(i.margin+t*(n-e.elev)).toFixed(0),a+=s+","+c+" ",r+=e.distance});let u=document.createElementNS(d,"polyline");u.setAttributeNS(null,"points",a),u.setAttributeNS(null,"class","TravelNotes-SvgProfile-profilePolyline"),e.appendChild(u)}(),function(){const t=i.margin.toFixed(0),o=(i.margin+i.height).toFixed(0),a=(i.margin+i.width).toFixed(0),n=i.margin.toFixed(0);let r=t+","+n+" "+t+","+o+" "+a+","+o+" "+a+","+n,l=document.createElementNS(d,"polyline");l.setAttributeNS(null,"points",r),l.setAttributeNS(null,"class","TravelNotes-SvgProfile-framePolyline"),e.appendChild(l)}(),function(){let o=Number.MAX_VALUE,l=0;i.vScales.forEach(e=>{let t=Math.abs(r/4-e);t<o&&(o=t,l=e)});let s=Math.ceil(a/l)*l;const c=(i.margin+i.width+i.xDeltaText).toFixed(0),u=(i.margin-i.xDeltaText).toFixed(0);for(;s<n;){let o=i.margin+(n-s)*t,a=document.createElementNS(d,"text");a.appendChild(document.createTextNode(s.toFixed(0))),a.setAttributeNS(null,"class","TravelNotes-SvgProfile-elevLegend"),a.setAttributeNS(null,"x",c),a.setAttributeNS(null,"y",o),a.setAttributeNS(null,"text-anchor","start"),e.appendChild(a);let r=document.createElementNS(d,"text");r.appendChild(document.createTextNode(s.toFixed(0))),r.setAttributeNS(null,"class","TravelNotes-SvgProfile-elevLegend"),r.setAttributeNS(null,"x",u),r.setAttributeNS(null,"y",o),r.setAttributeNS(null,"text-anchor","end"),e.appendChild(r),s+=l}}(),function(){const t=i.margin+i.height+i.margin/2;let a=Number.MAX_VALUE,n=0;i.hScales.forEach(e=>{let t=Math.abs(l.distance/8-e);t<a&&(a=t,n=e)});let r=Math.ceil(l.chainedDistance/n)*n;for(;r<l.distance+l.chainedDistance;){let a=document.createElementNS(d,"text");a.appendChild(document.createTextNode(1e3<n||0<l.chainedDistance?r/1e3+" km":r+" m ")),a.setAttributeNS(null,"class","TravelNotes-SvgProfile-distLegend"),a.setAttributeNS(null,"x",i.margin+(r-l.chainedDistance)*o),a.setAttributeNS(null,"y",t),a.setAttributeNS(null,"text-anchor","start"),e.appendChild(a),r+=n}}(),e}return Object.seal(new class{smooth(e){!function(e){l=e;let t=l.itinerary.itineraryPoints.iterator,o=0,a=0;for(;!t.done;)o+=t.value.distance,a+=t.next?Math.abs(t.value.elev-t.next.elev):0;if(s=10*Math.floor(c/(a/o)),o<=2*u*s)return;let n=g();t=l.itinerary.itineraryPoints.iterator,t.done;let r=t.value.distance;for(;!t.done;){let e=n.get(Math.floor(r/s)*s),o=n.get(Math.ceil(r/s)*s);if(e&&o){let a=r-e.distance,n=(o.elev-e.elev)/(o.distance-e.distance);t.value.elev=e.elev+a*n}r+=t.value.distance}}(e)}createSvg(e){return v(e)}})}function yt(e,t){let o=t.note,a=b.create("div");if(0!==o.tooltipContent.length&&p.sanitizeToHtmlElement(o.tooltipContent,b.create("div",{className:e+"NoteHtml-TooltipContent"},a)),0!==o.popupContent.length&&p.sanitizeToHtmlElement(o.popupContent,b.create("div",{className:e+"NoteHtml-PopupContent"},a)),0!==o.address.length&&p.sanitizeToHtmlElement("<span>"+A.getText("HTMLViewsFactory - Address")+"</span> : "+o.address,b.create("div",{className:e+"NoteHtml-Address"},a)),0!==o.url.length&&p.sanitizeToHtmlElement(A.getText("HTMLViewsFactory - Link")+"<a href="+o.url+' target="_blank" >'+o.url.substr(0,40)+"...</a>",b.create("div",{className:e+"NoteHtml-Url"},a)),0!==o.phone.length){let t=o.phone;if(o.phone.match(/^\+[0-9, ,*,#]*$/)){let e=o.phone.replaceAll(/\u0020/g,""),a=o.phone.replaceAll(/\u0020/g," ");t=A.getText("HTMLViewsFactory - Phone")+" : "+A.getText("HTMLViewsFactory - call")+'<a target="_blank" href="tel:'+e+'" >'+a+"</a>"+A.getText("HTMLViewsFactory - Send a sms to")+'<a target="_blank" href="sms:'+e+'" >'+a+"</a>"}else t=A.getText("HTMLViewsFactory - Phone")+" : "+o.phone;p.sanitizeToHtmlElement(t,b.create("div",{className:e+"NoteHtml-Phone"},a))}if(p.sanitizeToHtmlElement(E.formatLatLng(o.latLng),b.create("div",{className:e+"NoteHtml-LatLng"},a)),t.route){t.route.chain&&p.sanitizeToHtmlElement("<span>"+A.getText("HTMLViewsFactory - Distance from start of travel")+"</span> : "+E.formatDistance(o.chainedDistance+o.distance),b.create("div",{className:e+"NoteHtml-Distance"},a)),p.sanitizeToHtmlElement("<span>"+A.getText("HTMLViewsFactory - Distance from start of route")+"</span> : "+E.formatDistance(o.distance),b.create("div",{className:e+"NoteHtml-Distance"},a));let n=t.route.notes.next(o.objId);if(n){let t=n.distance-o.distance;9<t&&p.sanitizeToHtmlElement("<span>"+A.getText("HTMLViewsFactory - Next note after")+"</span> : "+E.formatDistance(t),b.create("div",{className:e+"NoteHtml-NextDistance"},a))}}return a}function Nt(e,t){let o=b.create("div"),a=b.create("div",{className:e+"Travel-Notes-IconCell"},o);p.sanitizeToHtmlElement(t.note.iconContent,a),a.style.width=String(t.note.iconWidth)+"px",a.style.height=String(t.note.iconHeight)+"px","TravelNotes-Roadbook-"===e&&a.firstChild&&("svg"===a.firstChild.tagName?(a.firstChild.setAttributeNS(null,"viewBox","0 0 "+l.svgViewboxDim+" "+l.svgViewboxDim),a.style.width=String(t.note.iconWidth*f.note.svgRoadbookDimCoef)+"px",a.style.height=String(t.note.iconWidth*f.note.svgRoadbookDimCoef)+"px"):a.firstChild.classList.contains("TravelNotes-MapNoteCategory-0073")&&(a.style.width=String(t.note.iconWidth*f.note.svgRoadbookDimCoef)+"px",a.style.height=String(t.note.iconWidth*f.note.svgRoadbookDimCoef)+"px"));let n=yt(e,t);return n.className=e+"Travel-Notes-Cell",o.appendChild(n),o.noteObjId=t.note.objId,o}function Tt(e){let t=b.create("div",{className:e+"Travel-Notes"}),o=le.travel.notes.iterator;for(;!o.done;){let a=Nt(e,{note:o.value,route:null});a.className=e+"Travel-Notes-Row",t.appendChild(a)}return t}function wt(e,t){let o=b.create("div",{className:e+"Route-Header",id:"route"+t.objId});return p.sanitizeToHtmlElement(t.computedName,b.create("div",{className:e+"Route-Header-Name"},o)),0!==t.distance&&p.sanitizeToHtmlElement(A.getText("HTMLViewsFactory - Route distance",{distance:E.formatDistance(t.distance)}),b.create("div",{className:e+"Route-Header-Distance"},o)),le.travel.readOnly||"bike"===t.itinerary.transitMode||p.sanitizeToHtmlElement(A.getText("HTMLViewsFactory - Duration",{duration:E.formatTime(t.duration)}),b.create("div",{className:e+"Route-Header-Duration"},o)),t.itinerary.hasProfile&&(p.sanitizeToHtmlElement(A.getText("HTMLViewsFactory - Ascent",{ascent:t.itinerary.ascent.toFixed(0)}),b.create("div",{className:e+"Route-Header-Ascent"},o)),p.sanitizeToHtmlElement(A.getText("HTMLViewsFactory - Descent",{descent:t.itinerary.descent.toFixed(0)}),b.create("div",{className:e+"Route-Header-Descent"},o))),o}function xt(t,o){let a=b.create("div");b.create("div",{className:t+"Route-ManeuversAndNotes-IconCell TravelNotes-ManeuverNote-"+o.maneuver.iconName},a);let n=b.create("div",{className:t+"Route-ManeuversAndNotes-Cell"},a);return p.sanitizeToHtmlElement(o.maneuver.instruction,b.create("div",null,n)),o.route.chain&&p.sanitizeToHtmlElement("<span>"+A.getText("HTMLViewsFactory - Distance from start of travel")+"</span> : "+E.formatDistance(o.route.chainedDistance+o.maneuverDistance),b.create("div",null,n)),p.sanitizeToHtmlElement("<span>"+A.getText("HTMLViewsFactory - Distance from start of route")+"</span> : "+E.formatDistance(o.maneuverDistance),b.create("div",null,n)),e.defaultValue<o.maneuver.distance&&p.sanitizeToHtmlElement("<span>"+A.getText("HTMLViewsFactory - Next maneuver after")+"</span> : "+E.formatDistance(o.maneuver.distance),b.create("div",null,n)),a}function It(e,t){let o=[],a=t.notes.iterator;for(;!a.done;){let n=Nt(e,{note:a.value,route:t});n.className=e+"Route-Notes-Row",n.objId=T(),n.latLng=a.value.latLng,n.noteObjId=a.value.objId,n.distance=a.value.distance,o.push(n)}let n=t.itinerary.maneuvers.iterator,r=0;for(;!n.done;){let a=xt(e,{route:t,maneuver:n.value,maneuverDistance:r});a.className=e+"Route-Maneuvers-Row",a.objId=T(),a.latLng=t.itinerary.itineraryPoints.getAt(n.value.itineraryPointObjId).latLng,a.maneuverObjId=n.value.objId,a.distance=r,o.push(a),r+=n.value.distance}o.sort((e,t)=>e.distance-t.distance);let i=b.create("div",{className:e+"Route-ManeuversAndNotes"});return o.forEach(e=>i.appendChild(e)),i}function Lt(e,t){let o="";""!==t.itinerary.provider&&""!==t.itinerary.transitMode&&(o=A.getText("HTMLViewsFactory - Itinerary computed by {provider} and optimized for {transitMode}",{provider:t.itinerary.provider,transitMode:A.getText("HTMLViewsFactory - TransitMode "+t.itinerary.transitMode)}));let a=b.create("div",{className:e+"RouteFooter"});return p.sanitizeToHtmlElement(o,a),a}function At(e,t){let o=b.create("div",{className:e+"RouteProfile"});return p.sanitizeToHtmlElement(A.getText("HTMLViewsFactory - Profile"),o),o.appendChild(bt().createSvg(t)),o}function Et(t){let o=b.create("div",{className:t+"Travel"});o.appendChild(function(t){let o=b.create("div",{className:t+"Travel-Header"});p.sanitizeToHtmlElement(le.travel.name,b.create("div",{className:t+"Travel-Header-Name"},o));let a=e.defaultValue,n=0,r=0,i=le.travel.routes.iterator;for(;!i.done;){let e=i.value.objId===le.editedRouteObjId&&f.routeEditor.displayEditionInHTMLPage?le.travel.editedRoute:i.value;p.sanitizeToHtmlElement('<a href="#route'+e.objId+'" >'+e.computedName+"</a> : "+E.formatDistance(e.distance)+".",b.create("div",{className:t+"Travel-Header-RouteName"},o)),e.chain&&(a+=e.distance,n+=e.itinerary.ascent,r+=e.itinerary.descent)}return p.sanitizeToHtmlElement(A.getText("HTMLViewsFactory - Travel distance",{distance:E.formatDistance(a)}),b.create("div",{className:t+"Travel-Header-TravelDistance"},o)),0!==n&&p.sanitizeToHtmlElement(A.getText("HTMLViewsFactory - Travel ascent",{ascent:n.toFixed(0)}),b.create("div",{className:t+"Travel-Header-TravelAscent"},o)),0!==r&&p.sanitizeToHtmlElement(A.getText("HTMLViewsFactory - Travel descent",{descent:r.toFixed(0)}),b.create("div",{className:t+"Travel-Header-TravelDescent"},o)),o}(t)),o.appendChild(Tt(t));let a=le.travel.routes.iterator;for(;!a.done;){let e=f.routeEditor.displayEditionInHTMLPage&&a.value.objId===le.editedRouteObjId?le.travel.editedRoute:a.value;o.appendChild(wt(t,e)),e.itinerary.hasProfile&&o.appendChild(At(t,e)),o.appendChild(It(t,e)),o.appendChild(Lt(t,e))}return o.appendChild(function(e){let t=A.getText("HTMLViewsFactory - Travel footer")+'<a href="https://github.com/wwwouaiebe/leaflet.TravelNotes" target="_blank" title="https://github.com/wwwouaiebe/leaflet.TravelNotes" >Travel & Notes</a>, © <a href="https://www.ouaie.be/" target="_blank" title="https://www.ouaie.be/" >wwwouaiebe 2017 2021</a> © <a href="https://www.openstreetmap.org/copyright" target="_blank" title="https://www.openstreetmap.org/copyright">'+A.getText("HTMLViewsFactory - OpenStreetMap contributors")+"</a>",o=b.create("div",{className:e+"TravelFooter"});return p.sanitizeToHtmlElement(t,o),o}(t)),o}const jt=Object.freeze(new class{getTravelHTML(e){return Et(e)}getNoteTextAndIconHTML(e,t){return Nt(e,t)}getNoteTextHTML(e,t){return yt(e,t)}getEditedRouteManeuversAndNotesHTML(e){return It(e,le.travel.editedRoute)}getTravelNotesHTML(e){return Tt(e)}getRouteHeaderHTML(e,t){return wt(e,t)}});function Pt(e,t,o){let a=null,r=rt(),i=e.latLng,s="",d="",c=null,u=null,g=null,v=null,h=null,m=null,y=null,N=null,T=null,w=null,x=null,I=null,L=null,E=null,j=null,P=null,D=null,C=null,R=null,M=null,S=null,O=null;function U(){if(""!==E.value){if(""===M.value||""!==p.sanitizeToUrl(M.value).url)return e.iconWidth=Number.parseInt(j.value),e.iconHeight=Number.parseInt(P.value),e.iconContent=E.value,e.popupContent=D.value,e.tooltipContent=C.value,e.address=R.value,e.url=M.value,e.phone=S.value,e.latLng=i,e.validateData(),e;I.showError(A.getText("Notedialog - invalidUrl"))}else I.showError(A.getText("Notedialog - The icon content cannot be empty"))}function k(){""===E.value?c.iconContent="?????":c.iconContent=E.value,c.popupContent=D.value,c.tooltipContent=C.value,c.address=R.value,c.url=M.value,c.phone=S.value,c.iconWidth=j.value,c.iconHeight=P.value,O.textContent="",O.appendChild(jt.getNoteTextAndIconHTML("TravelNotes-NoteDialog-",{note:c,route:null}))}function B(t){let a=r.parseResponse(t);s=a.street,""!==a.city&&(s+=' <span class="TravelNotes-NoteHtml-Address-City">'+a.city+"</span>"),d=a.city,f.note.reverseGeocoding&&""===e.address&&o&&(R.value=s),k()}function H(e){I.showError(A.getText("Notedialog - an error occurs when searching the adress")),console.log(e||"an error occurs when searching the adress."),k()}function z(e){E.value=e.svg.outerHTML,C.value=e.tooltip;let t=e.streets,o=""===e.city?d:e.city;""!==o&&(t+=' <span class="TravelNotes-NoteHtml-Address-City">'+o+"</span>"),e.place&&e.place!==o&&(t+=" ("+e.place+")"),R.value=t,i=e.latLng,I.hideWait(),k()}function V(e){I.hideWait(),I.showError(A.getText("Notedialog - an error occurs when creating the SVG icon")),console.log(e||"an error occurs when creating the SVG icon."),k()}function F(o){let a=ft.getIconData(o.target.selectedIndex);"SvgIcon"===a.icon?-1===t?I.showError(A.getText("Notedialog - not possible to create a SVG icon for a travel note")):(I.showWait(),at().getPromiseIconAndAdress(e.latLng,t).then(z).catch(V)):(I.hideError(),j.value=a.width,P.value=a.height,E.value=a.icon,C.value=a.tooltip,k())}function W(e){if(!a)return;let t=e.target;for(;!t.htmlBefore;)t=t.parentNode;let o=a.selectionStart,n=a.selectionEnd;a.value=a.value.slice(0,o)+t.htmlBefore+(0===t.htmlAfter.length?"":a.value.slice(o,n))+t.htmlAfter+a.value.slice(n),o===n||0===t.htmlAfter.length?(o+=t.htmlBefore.length,n=o):n+=t.htmlBefore.length+t.htmlAfter.length,a.setSelectionRange(o,n),a.focus(),k()}function K(){R.value=s,k()}function J(e){a=e.target}function Z(e){if(""===e.target.value)return;let t=p.sanitizeToUrl(e.target.value);""===t.errorsString?I.hideError():I.showError(t.errorsString)}function X(){f.noteDialog.toggleIconDimension&&u.classList.toggle("TravelNotes-NoteDialog-HiddenItem"),f.noteDialog.toggleIconTextArea&&g.classList.toggle("TravelNotes-NoteDialog-HiddenItem"),f.noteDialog.togglePopupContent&&v.classList.toggle("TravelNotes-NoteDialog-HiddenItem"),f.noteDialog.toggleTooltip&&h.classList.toggle("TravelNotes-NoteDialog-HiddenItem"),f.noteDialog.toggleAddress&&(m.classList.toggle("TravelNotes-NoteDialog-HiddenItem"),y.classList.toggle("TravelNotes-NoteDialog-HiddenItem")),f.noteDialog.toggleLink&&(N.classList.toggle("TravelNotes-NoteDialog-HiddenItem"),T.classList.toggle("TravelNotes-NoteDialog-HiddenItem")),f.noteDialog.togglePhone&&(w.classList.toggle("TravelNotes-NoteDialog-HiddenItem"),x.classList.toggle("TravelNotes-NoteDialog-HiddenItem"))}return c=G(),c.jsonObject=e.jsonObject,""===c.iconContent&&(c.iconContent="?????"),I=se(),I.title=A.getText("NoteDialog - Note"),I.okButtonListener=U,L=b.create("div",{id:"TravelNotes-NoteDialog-MainDataDiv"},I.content),L.appendChild(ft.createToolbar({onButtonClickEventListener:W,onSelectEventListener:F,hideError:I.hideError,showError:I.showError,toggleContents:X})),u=b.create("div",{className:"TravelNotes-NoteDialog-DataDiv"},L),b.create("text",{value:A.getText("NoteDialog - Icon width")},u),j=b.create("input",{type:"number",className:"TravelNotes-NoteDialog-NumberInput",value:0===e.iconWidth?l.width:e.iconWidth},u),j.addEventListener("input",k,!1),b.create("text",{value:A.getText("NoteDialog - Icon height")},u),P=b.create("input",{type:"number",className:"TravelNotes-NoteDialog-NumberInput",value:0===e.iconHeight?l.height:e.iconHeight},u),P.addEventListener("input",k,!1),g=b.create("div",{className:"TravelNotes-NoteDialog-DataDiv",textContent:A.getText("NoteDialog - Icon content")},L),E=b.create("textarea",{className:"TravelNotes-NoteDialog-TextArea",value:e.iconContent,placeholder:"?????",rows:f.noteDialog.iconAreaHeight},g),E.addEventListener("focus",J,!1),E.addEventListener("input",k,!1),h=b.create("div",{className:"TravelNotes-NoteDialog-DataDiv",textContent:A.getText("NoteDialog - Tooltip content")},L),C=b.create("input",{type:"text",className:"TravelNotes-NoteDialog-InputText",value:e.tooltipContent},h),C.addEventListener("focus",J,!1),C.addEventListener("input",k,!1),v=b.create("div",{className:"TravelNotes-NoteDialog-DataDiv",textContent:A.getText("NoteDialog - Text")},L),D=b.create("textarea",{className:"TravelNotes-NoteDialog-TextArea",value:e.popupContent,rows:f.noteDialog.popupAreaHeigth},v),D.addEventListener("focus",J,!1),D.addEventListener("input",k,!1),m=b.create("div",{className:"TravelNotes-NoteDialog-DataDiv"},L),b.create("div",{className:"TravelNotes-BaseDialog-Button",title:A.getText("NoteDialog - Reset address"),textContent:"🔄"},m).addEventListener("click",K,!1),b.create("text",{value:A.getText("NoteDialog - Address")},m),y=b.create("div",{className:"TravelNotes-NoteDialog-DataDiv"},L),R=b.create("input",{type:"text",value:e.address,className:"TravelNotes-NoteDialog-InputText"},y),R.addEventListener("focus",J,!1),R.addEventListener("input",k,!1),N=b.create("div",{className:"TravelNotes-NoteDialog-DataDiv"},L),f.note.theDevil.addButton&&b.create("text",{value:"👿"},b.create("a",{href:"https://www.google.com/maps/@"+e.lat.toFixed(n.fixed)+","+e.lng.toFixed(n.fixed)+","+f.note.theDevil.noteZoom+"z",target:"_blank",title:"Reminder! The devil will know everything about you"},b.create("div",{className:"TravelNotes-BaseDialog-Button",title:"Reminder! The devil will know everything about you"},N))),b.create("text",{value:A.getText("NoteDialog - Link")},N),T=b.create("div",{className:"TravelNotes-NoteDialog-DataDiv"},L),M=b.create("input",{type:"text",className:"TravelNotes-NoteDialog-InputText",value:e.url},T),M.addEventListener("focus",()=>{a=null},!1),M.addEventListener("blur",Z,!1),M.addEventListener("input",k,!1),w=b.create("div",{className:"TravelNotes-NoteDialog-DataDiv"},L),b.create("text",{value:" "+A.getText("NoteDialog - Phone")},w),x=b.create("div",{className:"TravelNotes-NoteDialog-DataDiv"},L),S=b.create("input",{type:"text",className:"TravelNotes-NoteDialog-InputText",value:e.phone},x),S.addEventListener("focus",J,!1),S.addEventListener("input",k,!1),O=b.create("div",{className:"TravelNotes-NoteDialog-PreviewDiv"},I.footer),O.appendChild(jt.getNoteTextAndIconHTML("TravelNotes-NoteDialog-",{note:c,route:null})),r.getPromiseAddress(e.latLng).then(B).catch(H),X(),I}function Dt(){let e=null,t=null;return Object.freeze(new class{createUI(){if(document.getElementById("TravelNotes-WaitUI"))return;e=b.create("div",{className:"TravelNotes-Background"},document.querySelector("body"));let o=b.create("div",{id:"TravelNotes-WaitUI"},e);t=b.create("div",{id:"TravelNotes-WaitUI-MessageDiv"},o),b.create("div",{className:"TravelNotes-WaitAnimationBullet"},b.create("div",{className:"TravelNotes-WaitAnimation"},o))}showInfo(e){t.textContent=e}close(){document.querySelector("body").removeChild(e),e=null}})}let Ct=null,Rt=0,Mt=0,St=f.note.osmSearchNoteDialog;function Ot(e,t){let o=G();o.iconContent=e.svg.outerHTML,o.popupContent="",o.iconWidth=l.width,o.iconHeight=l.height,o.tooltipContent=e.tooltip,o.address=e.streets,""!==e.city&&(o.address+=' <span class="TravelNotes-NoteHtml-Address-City">'+e.city+"</span>"),e.place&&e.place!==e.city&&(o.address+=" ("+e.place+")"),o.latLng=e.latLng,o.iconLatLng=e.latLng,o.distance=Ue.getClosestLatLngDistance(t,o.latLng).distance,o.chainedDistance=t.chainedDistance,t.notes.add(o),Te.dispatch("noteupdated",{removedNoteObjId:-1,addedNoteObjId:o.objId}),Te.dispatch("roadbookupdate")}function Ut(e,t,o){if(o)if(-1===t)le.travel.notes.add(e),Te.dispatch("showtravelnotes");else{let o=De.getRoute(t);o.notes.add(e),e.chainedDistance=o.chainedDistance,o.notes.sort((e,t)=>e.distance-t.distance),Te.dispatch("showitinerary")}else-1===t?Te.dispatch("updatetravelnotes"):Te.dispatch("updateitinerary");Te.dispatch("noteupdated",{removedNoteObjId:e.objId,addedNoteObjId:e.objId}),Te.dispatch("roadbookupdate")}function kt(e,t,o){Pt(e,t,o).show().then(()=>{Ut(e,t,o)}).catch(e=>console.log(e||"An error occurs in the note dialog"))}function Bt(e){let t=G();return t.latLng=e,t.iconLatLng=e,t}const Ht=Object.seal(new class{get osmSearchNoteDialog(){return St}changeOsmSearchNoteDialog(){St=!St}addAllManeuverNotes(e){let t=De.getRoute(e),o=t.itinerary.maneuvers.iterator;for(Mt=0;!o.done;)"kDepartDefault"===o.value.iconName&&!o.first||"kArriveDefault"===o.value.iconName&&!o.last||Mt++;f.note.maxManeuversNotes<Mt?ye.showError(A.getText("NoteEditor - max maneuvers notes reached {maneuversLength}{maxManeuversNotes}",{maneuversLength:Mt,maxManeuversNotes:f.note.maxManeuversNotes})):function(e){let t=null;return function(){if(t=se(),t.footer.classList.add("TravelNotes-TwoButtonsDialog-FooterDiv"),t.title=e.title||"",t.okButton.classList.add("TravelNotes-TwoButtonsDialog-Button"),e.okButtonContent&&(t.okButton.textContent=e.okButtonContent),e.secondButtonContent){b.create("div",{textContent:e.secondButtonContent,className:"TravelNotes-BaseDialog-Button TravelNotes-TwoButtonsDialog-Button"},t.footer).addEventListener("click",()=>t.cancelButton.click(),!0)}e.textContent&&b.create("div",{id:"TravelNotes-TwoButtonsDialog-MessageDiv",textContent:e.textContent},t.content)}(),t}({title:A.getText("NoteEditor - Add a note for each maneuver"),textContent:A.getText("NoteEditor - Add a note for each maneuver. Are you sure?",{noteLength:Mt}),secondButtonContent:"❌"}).show().then(()=>{o=t.itinerary.maneuvers.iterator,o.done||(Ct=Dt(),Ct.createUI(),Rt=1,function e(t,o){function a(){t.done?(o.notes.sort((e,t)=>e.distance-t.distance),Te.dispatch("updateitinerary"),Te.dispatch("roadbookupdate"),Ct.close(),Ct=null):e(t,o)}if(Ct.showInfo(A.getText("NoteEditor - Creating note",{noteNumber:Rt,notesLength:Mt})),"kDepartDefault"===t.value.iconName&&!t.first||"kArriveDefault"===t.value.iconName&&!t.last)a();else{Rt++;let e=o.itinerary.itineraryPoints.getAt(t.value.itineraryPointObjId).latLng;at().getPromiseIconAndAdress(e,o.objId).then(e=>{Ot(e,o),a()}).catch(e=>{console.log(e||"an error occurs when creating the SVG icon."),a()})}}(o,t))}).catch(e=>console.log(e||"An error occurs in the note dialog"))}newRouteNote(e){let t=De.getRoute(e.routeObjId),o=Ue.getClosestLatLngDistance(t,[e.lat,e.lng]),a=Bt(o.latLng);a.distance=o.distance,kt(a,t.objId,!0)}newSearchNote(e){let t=[e.osmElement.lat,e.osmElement.lon],o=[e.osmElement.lat,e.osmElement.lon],a=-1,n=Number.MAX_VALUE;function r(e){if(e.objId!==le.editedRouteObjId){let r=Ue.getClosestLatLngDistance(e,t);if(r){let i=Ue.pointsDistance(t,r.latLng);i<n&&(a=e.objId,n=i,o=r.latLng)}}}e.isTravelNote||(le.travel.routes.forEach(r),-1!==le.editedRouteObjId&&r(le.travel.editedRoute));let i=G();i.latLng=o,i.iconLatLng=t,i.iconHeight=l.height,i.iconWidth=l.width,e.osmElement.tags.rcn_ref?i.iconContent="<div class='TravelNotes-MapNote TravelNotes-MapNoteCategory-0073'><svg viewBox='0 0 20 20'><text x='10' y='14'>"+e.osmElement.tags.rcn_ref+"</text></svg></div>":i.iconContent=ft.getIconDataFromName(e.osmElement.description)||"",i.address=(e.osmElement.tags["addr:housenumber"]?e.osmElement.tags["addr:housenumber"]+" ":"")+(e.osmElement.tags["addr:street"]?e.osmElement.tags["addr:street"]+" ":"")+(e.osmElement.tags["addr:postcode"]?e.osmElement.tags["addr:postcode"]+" ":"")+(e.osmElement.tags["addr:city"]?e.osmElement.tags["addr:city"]+" ":""),i.url=e.osmElement.tags.website||"",i.phone=e.osmElement.tags.phone||"",i.tooltipContent=e.osmElement.description||"",i.popupContent=e.osmElement.tags.name||"",e.isTravelNote||-1!==a?St||""===i.iconContent?kt(i,a,!0):Ut(i,a,!0):ye.showError(A.getText("NoteEditor - No route was found"))}newManeuverNote(e){Ct=Dt(),Ct.createUI();let t=le.travel.editedRoute,o=t.itinerary.maneuvers.getAt(e),a=t.itinerary.itineraryPoints.getAt(o.itineraryPointObjId).latLng;at().getPromiseIconAndAdress(a,t.objId).then(o=>{Ot(o,t),t.notes.sort((e,t)=>e.distance-t.distance),t.itinerary.maneuvers.remove(e),Te.dispatch("showitinerary"),Te.dispatch("roadbookupdate"),Ct.close(),Ct=null}).catch(e=>{console.log(e||"an error occurs when creating the SVG icon."),Ct.close(),Ct=null})}newTravelNote(e){kt(Bt(e),-1,!0)}editNote(e){let t=De.getNoteAndRoute(e),o=null===t.route?-1:t.route.objId;kt(t.note,o,!1)}removeNote(e){let t=De.getNoteAndRoute(e);t.route?(t.route.notes.remove(e),Te.dispatch("updateitinerary")):(le.travel.notes.remove(e),Te.dispatch("updatetravelnotes")),Te.dispatch("noteupdated",{removedNoteObjId:e,addedNoteObjId:-1}),Te.dispatch("roadbookupdate")}hideNotes(){let e=le.travel.notes.iterator;for(;!e.done;)Te.dispatch("removeobject",{objId:e.value.objId});let t=le.travel.routes.iterator;for(;!t.done;)for(e=t.value.notes.iterator;!e.done;)Te.dispatch("removeobject",{objId:e.value.objId});if(-1!==le.editedRouteObjId)for(e=le.travel.editedRoute.notes.iterator;!e.done;)Te.dispatch("removeobject",{objId:e.value.objId})}showNotes(){this.hideNotes();let e=le.travel.notes.iterator;for(;!e.done;)Te.dispatch("noteupdated",{removedNoteObjId:-1,addedNoteObjId:e.value.objId});let t=le.travel.routes.iterator;for(;!t.done;)t.value.hidden||Te.dispatch("routeupdated",{removedRouteObjId:t.value.objId,addedRouteObjId:t.value.objId})}attachNoteToRoute(e){let t=De.getNoteAndRoute(e),o=Number.MAX_VALUE,a=null,n=null,r=null;le.travel.routes.forEach(e=>{let i=Ue.getClosestLatLngDistance(e,t.note.latLng);if(i){let l=Ue.pointsDistance(t.note.latLng,i.latLng);l<o&&(o=l,a=e,n=i.latLng,r=i.distance)}}),a&&(le.travel.notes.remove(e),t.note.distance=r,t.note.latLng=n,t.note.chainedDistance=a.chainedDistance,a.notes.add(t.note),a.notes.sort((e,t)=>e.distance-t.distance),Te.dispatch("noteupdated",{removedNoteObjId:e,addedNoteObjId:e}),Te.dispatch("updateitinerary"),Te.dispatch("updatetravelnotes"),Te.dispatch("roadbookupdate"))}detachNoteFromRoute(t){let o=De.getNoteAndRoute(t);o.route.notes.remove(t),o.note.distance=e.invalid,o.note.chainedDistance=e.defaultValue,le.travel.notes.add(o.note),Te.dispatch("updateitinerary"),Te.dispatch("updatetravelnotes"),Te.dispatch("roadbookupdate")}travelNoteDropped(e,t,o){le.travel.notes.moveTo(e,t,o),Te.dispatch("updatetravelnotes"),Te.dispatch("roadbookupdate")}});
/**
	@------------------------------------------------------------------------------------------------------------------------------

	@file ProfileWindow.js
	@copyright Copyright - 2017 2021 - wwwouaiebe - Contact: https://www.ouaie.be/
	@license GNU General Public License
	@private

	@------------------------------------------------------------------------------------------------------------------------------
	*/
function zt(){let e=T(),t=null,o=null,a=null,n=null,r=null,l=null,s=null,c=null;function u(e){let o=t.getBoundingClientRect(),a=(e.clientX-o.x-i.margin/(2*i.margin+i.width)*o.width)/(i.width/(2*i.margin+i.width)*o.width)*c.distance;return Ue.getLatLngElevAtDist(c,a)}function g(e){e.preventDefault(),e.stopPropagation();let t=u(e);t&&(e.routeObjId=c.objId,e.latlng={lat:t.latLng[0],lng:t.latLng[1]},e.originalEvent={clientX:e.clientX,clientY:e.clientY},function(e){let t=ke(),o=tt(e,[{context:Ht,name:A.getText("ProfileContextMenu - Add a note to the route at this point"),action:Ht.newRouteNote,param:{routeObjId:e.routeObjId,lat:e.latlng.lat,lng:e.latlng.lng}},{context:t,name:A.getText("ProfileContextMenu - Zoom to this point"),action:t.zoomToLatLng,param:[e.latlng.lat,e.latlng.lng]}]);return Object.seal(o)}(e).show())}function v(){Te.dispatch("removeobject",{objId:e})}function h(l){let s=t.getBoundingClientRect(),g=u(l);if(g){const u=3;Te.dispatch("removeobject",{objId:e}),Te.dispatch("additinerarypointmarker",{objId:e,latLng:g.latLng}),o&&(t.removeChild(o),t.removeChild(r),t.removeChild(a),t.removeChild(n));let v=(2*i.margin+i.width)*(l.clientX-s.x)/s.width,h=i.margin+i.height;o=document.createElementNS(d,"polyline"),o.setAttributeNS(null,"points",String(v)+","+i.margin+" "+v+","+h),o.setAttributeNS(null,"class","TravelNotes-SvgProfile-markerPolyline"),t.appendChild(o);let p=g.routeDistance>c.distance/2?"end":"start",m=g.routeDistance>c.distance/2?-i.xDeltaText:i.xDeltaText;r=document.createElementNS(d,"text"),r.appendChild(document.createTextNode(E.formatDistance(g.routeDistance))),r.setAttributeNS(null,"class","TravelNotes-SvgProfile-elevText"),r.setAttributeNS(null,"x",v+m),r.setAttributeNS(null,"y",i.margin+i.yDeltaText),r.setAttributeNS(null,"text-anchor",p),t.appendChild(r),a=document.createElementNS(d,"text"),a.appendChild(document.createTextNode("Alt. "+g.elev.toFixed(0)+" m.")),a.setAttributeNS(null,"class","TravelNotes-SvgProfile-elevText"),a.setAttributeNS(null,"x",v+m),a.setAttributeNS(null,"y",i.margin+2*i.yDeltaText),a.setAttributeNS(null,"text-anchor",p),t.appendChild(a),n=document.createElementNS(d,"text"),n.appendChild(document.createTextNode("Pente "+g.ascent.toFixed(0)+" % ")),n.setAttributeNS(null,"class","TravelNotes-SvgProfile-elevText"),n.setAttributeNS(null,"x",v+m),n.setAttributeNS(null,"y",i.margin+i.yDeltaText*u),n.setAttributeNS(null,"text-anchor",p),t.appendChild(n)}}function p(){t&&(t.removeEventListener("contextmenu",g,!1),t.removeEventListener("mousemove",h,!1),t.removeEventListener("mouseleave",v,!1),Te.dispatch("removeobject",{objId:e}),l.content.removeChild(s),l.content.removeChild(t)),t=null,o=null,n=null,r=null,a=null,s=null}return l=Be(),l.createWindow(),l.onClose=function(){p(),Te.dispatch("profileclosed",{objId:c.objId})},l.update=function(e){p(),c=e,t=bt().createSvg(e),l.header.textContent=A.getText("ProfileWindow - Profile {name}",c),l.content.appendChild(t),t.addEventListener("contextmenu",g,!1),t.addEventListener("mousemove",h,!1),t.addEventListener("mouseleave",v,!1),s=b.create("div",{className:"TravelNotes-ProfileWindow-Ascent",textContent:A.getText("ProfileWindow - Ascent: {ascent} m. - Descent: {descent} m. - Distance: {distance}",{ascent:c.itinerary.ascent.toFixed(0),descent:c.itinerary.descent.toFixed(0),distance:E.formatDistance(c.distance)})}),l.content.appendChild(s)},Object.seal(l)}let Vt=new Map,Ft=bt();const Wt=Object.seal(new class{createProfile(e){let t=Vt.get(e.objId);if(e.itinerary.hasProfile){f.route.elev.smooth&&Ft.smooth(e),e.itinerary.ascent=0,e.itinerary.descent=0;let o=e.itinerary.itineraryPoints.first.elev;e.itinerary.itineraryPoints.forEach(t=>{let a=t.elev-o;0>a?e.itinerary.descent-=a:e.itinerary.ascent+=a,o=t.elev}),t&&t.update(e)}else t&&t.close()}updateProfile(e,t){let o=Vt.get(e);o&&(Vt.delete(e),t&&t.itinerary.hasProfile?(o.update(t),Vt.set(t.objId,o)):o.close())}deleteProfile(e){let t=Vt.get(e);t&&t.close()}deleteAllProfiles(){Vt.forEach(e=>e.close())}showProfile(e){let t=Vt.get(e);t||(t=zt());let o=De.getRoute(e);t.update(o),Vt.set(e,t)}onProfileClosed(e){Vt.delete(e)}});const Kt=Object.seal(new class{createUI(){b.create("div",{id:"TravelNotes-AttributionsUI"},document.querySelector("body")),this.attributions=""}set attributions(e){let t='© <a href="https://leafletjs.com/" target="_blank" title="Leaflet">Leaflet</a> | © <a href="https://www.openstreetmap.org/copyright" target="_blank" title="OpenStreetMap contributors">OpenStreetMap contributors</a> '+e+'| © <a href="https://github.com/wwwouaiebe" target="_blank" title="https://github.com/wwwouaiebe">Travel & Notes</a>',o=document.getElementById("TravelNotes-AttributionsUI");for(;o.firstChild;)o.removeChild(o.firstChild);p.sanitizeToHtmlElement(t,o)}});class Jt{constructor(e){if(!e.name||"string"!=typeof e.name)throw new Error("invalid name for layer");if(this.name=p.sanitizeToJsString(e.name),!e.service||"wms"!==e.service&&"wmts"!==e.service)throw new Error("invalid service for layer "+this.name);if(this.service=e.service,!e.url||"string"!=typeof e.url)throw new Error("invalid url for layer "+this.name);if(this.url=e.url,"wms"===this.service){if(!(e.wmsOptions&&e.wmsOptions.layers&&"string"==typeof e.wmsOptions.layers&&e.wmsOptions.format&&"string"==typeof e.wmsOptions.format&&e.wmsOptions.transparent&&"boolean"==typeof e.wmsOptions.transparent))throw new Error("invalid wmsOptions for layer "+this.name);this.wmsOptions=e.wmsOptions,this.wmsOptions.layers=p.sanitizeToJsString(this.wmsOptions.layers),this.wmsOptions.format=p.sanitizeToJsString(this.wmsOptions.format)}try{e.bounds&&"number"==typeof e.bounds[0][0]&&"number"==typeof e.bounds[0][1]&&"number"==typeof e.bounds[1][0]&&"number"==typeof e.bounds[1][1]&&(this.bounds=e.bounds)}catch(e){throw new Error("invalid bounds for layer "+this.name)}if(e.minZoom&&"number"==typeof e.minZoom&&(this.minZoom=e.minZoom),e.maxZoom&&"number"==typeof e.maxZoom&&(this.maxZoom=e.maxZoom),!(e.toolbar&&e.toolbar.text&&"string"==typeof e.toolbar.text&&e.toolbar.color&&"string"==typeof e.toolbar.color&&e.toolbar.backgroundColor&&"string"==typeof e.toolbar.backgroundColor))throw new Error("invalid toolbar for layer "+this.name);if(this.toolbar=e.toolbar,this.toolbar.text=p.sanitizeToJsString(this.toolbar.text),this.toolbar.color=p.sanitizeToColor(this.toolbar.color)||"#000000",this.toolbar.backgroundColor=p.sanitizeToColor(this.toolbar.backgroundColor)||"#ffffff",!e.providerName||"string"!=typeof e.providerName)throw new Error("invalid providerName for layer "+this.name);if(this.providerName=p.sanitizeToJsString(e.providerName),"boolean"!=typeof e.providerKeyNeeded)throw new Error("invalid providerKeyNeeded for layer "+this.name);if(this.providerKeyNeeded=e.providerKeyNeeded,""===e.attribution)this.attribution="";else{if(!e.attribution||"string"!=typeof e.attribution)throw new Error("invalid attribution for layer "+this.name);this.attribution=p.sanitizeToHtmlString(e.attribution).htmlString}if(e.getCapabilitiesUrl&&"string"==typeof e.getCapabilitiesUrl&&(this.getCapabilitiesUrl=p.sanitizeToUrl(e.getCapabilitiesUrl).url,""===this.getCapabilitiesUrl))throw new Error("invalid getCapabilitiesUrl for layer "+this.name)}}function Zt(e){return Object.freeze(new Jt(e))}let Xt=[Zt({service:"wmts",url:"https://{s}.tile.osm.org/{z}/{x}/{y}.png",name:"OSM - Color",toolbar:{text:"OSM",color:"#ff0000",backgroundColor:"#ffffff"},providerName:"OSM",providerKeyNeeded:!1,attribution:""})],Gt=null,qt=null,Yt=null,Qt=0,_t=0,$t=0,eo=0;function to(e){e.target.style.color=e.target.layer.toolbar.backgroundColor,e.target.style["background-color"]=e.target.layer.toolbar.color}function oo(e){e.target.style.color=e.target.layer.toolbar.color,e.target.style["background-color"]=e.target.layer.toolbar.backgroundColor}function ao(e){e.target.classList.add("TravelNotes-LayersToolbarUI-LinkButton-Enter"),e.target.classList.remove("TravelNotes-LayersToolbarUI-LinkButton-Leave")}function no(e){Te.dispatch("layerchange",{layer:e.target.layer}),Kt.attributions=e.target.layer.attribution,le.travel.layerName=e.target.layer.name}function ro(e){e.target.classList.add("TravelNotes-LayersToolbarUI-LinkButton-Leave"),e.target.classList.remove("TravelNotes-LayersToolbarUI-LinkButton-Enter")}function io(e){e.deltaY&&(Qt-=e.deltaY*s[e.deltaMode],Qt=Qt>eo?eo:Qt,Qt=Qt<eo-$t+3*_t?eo-$t+3*_t:Qt,Yt.style.marginTop=String(Qt)+"px"),e.stopPropagation()}function lo(){let e=Yt.childNodes;for(let t=0;t<e.length;t++)"layer"===e[t].type?(e[t].removeEventListener("mouseenter",to,!1),e[t].removeEventListener("mouseleave",oo,!1),e[t].removeEventListener("click",no,!1)):(e[t].removeEventListener("mouseenter",ao,!1),e[t].removeEventListener("mouseleave",ao,!1));Yt.removeEventListener("wheel",io,!1),qt.removeChild(Yt),Gt=null}function so(){Gt=setTimeout(lo,f.layersToolbarUI.toolbarTimeOut)}function co(){if(Gt)return clearTimeout(Gt),void(Gt=null);Yt=b.create("div",{id:"TravelNotes-LayersToolbarUI-Buttons"},qt),eo=qt.clientHeight,$t=0,Xt.forEach(e=>function(e){if(e.providerKeyNeeded&&!Pe.getKey(e.providerName.toLowerCase()))return;let t=b.create("div",{type:"layer",className:"TravelNotes-LayersToolbarUI-Button",title:e.name,layer:e,textContent:e.toolbar.text,style:"color:"+e.toolbar.color+";background-color:"+e.toolbar.backgroundColor},Yt);t.addEventListener("mouseenter",to,!1),t.addEventListener("mouseleave",oo,!1),t.addEventListener("click",no,!1),_t=t.clientHeight,$t+=_t}(e)),f.layersToolbarUI.theDevil&&f.layersToolbarUI.theDevil.addButton&&function(e,t,o){let a=b.create("div",{type:"link",className:"TravelNotes-LayersToolbarUI-Button TravelNotes-LayersToolbarUI-LinkButton-Leave"},Yt);b.create("a",{href:e,title:t,textContent:o,target:"_blank"},a),a.addEventListener("mouseenter",ao,!1),a.addEventListener("mouseleave",ro,!1),$t+=a.clientHeight}("https://www.google.com/maps/@"+le.map.getCenter().lat+","+le.map.getCenter().lng+","+le.map.getZoom()+"z","Reminder! The devil will know everything about you","👿"),eo+=_t,Qt=eo,Yt.style.marginTop=String(Qt)+"px",Yt.addEventListener("wheel",io,!1)}const uo=Object.freeze(new class{createUI(){qt=b.create("div",{id:"TravelNotes-LayersToolbarUI"},document.querySelector("body")),b.create("div",{id:"TravelNotes-LayersToolbarUI-Header",textContent:A.getText("LayersToolbarUI - Layers")},qt),qt.addEventListener("mouseenter",co,!1),qt.addEventListener("mouseleave",so,!1),Te.dispatch("layerchange",{layer:Xt[0]}),Kt.attributions=Xt[0].attribution}getLayer(e){let t=Xt.find(t=>t.name===e)||Xt[0];if(t.providerKeyNeeded){Pe.getKey(t.providerName.toLowerCase())||(t=Xt[0])}return t}setLayer(e){let t=Xt.find(t=>t.name===e)||Xt[0];if(t.providerKeyNeeded){Pe.getKey(t.providerName.toLowerCase())||(t=Xt[0])}Te.dispatch("layerchange",{layer:t}),Kt.attributions=t.attribution,le.travel.layerName=t.name}addLayers(e){e.forEach(e=>{Xt.push(Zt(e))})}});function go(){let e=null,t=null,o=null,a=[],n=0,r=null,i=document.querySelector("body"),l=0;function s(){for(;0<document.getElementsByClassName("TravelNotes-routeViewDiv").length;)i.removeChild(document.getElementsByClassName("TravelNotes-routeViewDiv")[0]);document.getElementById("TravelNotes-PrintToolbar-PrintButton").removeEventListener("click",()=>window.print(),!1),document.getElementById("TravelNotes-PrintToolbar-CancelButton").removeEventListener("click",s,!1),i.removeChild(document.getElementById("TravelNotes-PrintToolbar"));let e=i.children;for(let t=0;t<e.length;t++)e.item(t).classList.remove("TravelNotes-PrintViews-Hidden");le.map.invalidateSize(!1),window.removeEventListener("afterprint",s,!0),document.title="Travel & Notes"+(""===le.travel.name?"":" - "+le.travel.name)}function d(e,t,a){let n=function(e,t,a){if(e.bottomLeft.lat===e.upperRight.lat&&e.bottomLeft.lng===e.upperRight.lng){let e=Math.min(Math.abs(o[0]/(a.lat-t.lat)),Math.abs(o[1]/(a.lng-t.lng)));return{lat:t.lat+e*(a.lat-t.lat),lng:t.lng+e*(a.lng-t.lng)}}return null}(e,t,a);if(n)return n;if(n=function(e,t){return t.lat-e.bottomLeft.lat<1e-6||e.upperRight.lat-t.lat<1e-6||t.lng-e.bottomLeft.lng<1e-6||e.upperRight.lng-t.lng<1e-6?{lat:t.lat,lng:t.lng}:null}(e,t),n)return n;if(n=function(e,t,o){return t.lng===o.lng?{lat:t.lat>o.lat?e.bottomLeft.lat:e.upperRight.lat,lng:t.lng}:t.lat===o.lat?{lat:t.lat,lng:t.lng<o.lng?e.upperRight.lng:e.bottomLeft.lng}:null}(e,t,a),n)return n;let r=(t.lat-a.lat)/(t.lng-a.lng),i=t.lat-r*t.lng;if(n={lat:r*e.upperRight.lng+i,lng:e.upperRight.lng},n.lat<=e.upperRight.lat&&n.lat>=e.bottomLeft.lat&&n.lng<a.lng)return n;if(n={lat:e.upperRight.lat,lng:(e.upperRight.lat-i)/r},n.lng>=e.bottomLeft.lng&&n.lng<=e.upperRight.lng&&n.lat<a.lat)return n;if(n={lat:r*e.bottomLeft.lng+i,lng:e.bottomLeft.lng},n.lat<=e.upperRight.lat&&n.lat>=e.bottomLeft.lat&&n.lng>a.lng)return n;if(n={lat:e.bottomLeft.lat,lng:(e.bottomLeft.lat-i)/r},n.lng>=e.bottomLeft.lng&&n.lng<=e.upperRight.lng&&n.lat>a.lat)return n;throw new Error("intermediate point not found")}function c(o){n++;let a="TravelNotes-RouteViewDiv"+n,l=b.create("div",{className:"TravelNotes-routeViewDiv",id:a},i);e.pageBreak&&l.classList.add("TravelNotes-PrintPageBreak"),l.style.width=String(e.paperWidth)+"mm",l.style.height=String(e.paperHeight)+"mm";let s=e.printNotes?function(){let e=[];return t.notes.forEach(t=>{let o=L.divIcon({iconSize:[t.iconWidth,t.iconHeight],iconAnchor:[t.iconWidth/2,t.iconHeight/2],popupAnchor:[0,-t.iconHeight/2],html:t.iconContent,className:"TravelNotes-AllNotes "});let a=L.marker(t.iconLatLng,{zIndexOffset:100,icon:o,draggable:!0});e.push(a)}),e}():[];s.push(function(){let e=uo.getLayer(le.travel.layerName),t=e.url;if(e.providerKeyNeeded){let o=Pe.getKey(e.providerName.toLowerCase());t=t.replace("{providerKey}",o)}let o=null;return o="wmts"===e.service.toLowerCase()?L.tileLayer(t):L.tileLayer.wms(t,e.wmsOptions),o.options.attribution=' © <a href="https://www.openstreetmap.org/copyright" target="_blank" title="OpenStreetMap contributors">OpenStreetMap contributors</a> '+e.attribution+'| © <a href="https://github.com/wwwouaiebe" target="_blank" title="https://github.com/wwwouaiebe">Travel & Notes</a> ',o}()),s.push(L.circleMarker([o.entryPoint.lat,o.entryPoint.lng],f.printRouteMap.entryPointMarker)),s.push(L.circleMarker([o.exitPoint.lat,o.exitPoint.lng],f.printRouteMap.exitPointMarker)),s.push(r),L.map(a,{attributionControl:!0,zoomControl:!1,center:[(o.bottomLeft.lat+o.upperRight.lat)/2,(o.bottomLeft.lng+o.upperRight.lng)/2],zoom:e.zoomFactor,minZoom:e.zoomFactor,maxZoom:e.zoomFactor,layers:s})}function u(){let e=i.children;for(let t=0;t<e.length;t++)e.item(t).classList.add("TravelNotes-PrintViews-Hidden");document.title=""===le.travel.name?"maps":le.travel.name+" - "+t.computedName+" - maps",function(){let e=b.create("div",{id:"TravelNotes-PrintToolbar"},i);b.create("div",{id:"TravelNotes-PrintToolbar-PrintButton",className:"TravelNotes-UI-Button",title:A.getText("PrintFactory - Print"),textContent:"🖨️"},e).addEventListener("click",()=>window.print(),!1),b.create("div",{id:"TravelNotes-PrintToolbar-CancelButton",className:"TravelNotes-UI-Button",title:A.getText("PrintFactory - Cancel print"),textContent:"❌"},e).addEventListener("click",s,!1)}(),window.addEventListener("afterprint",s,!0);let o=[],l=t.itinerary.itineraryPoints.iterator;for(;!l.done;)o.push(l.value.latLng);r=L.polyline(o,{color:t.color,weight:t.width}),n=0,a.forEach(c)}return Object.freeze(new class{print(n,r){t=De.getRoute(r),t&&(e=n,function(){let t=document.querySelector("body"),a=b.create("div",{},t);a.style.position="absolute",a.style.top="0",a.style.left="0",a.style.width=String(e.paperWidth-2*e.borderWidth)+"mm",a.style.height=String(e.paperHeight-2*e.borderWidth)+"mm",l=Math.ceil(a.clientWidth/256)*Math.ceil(a.clientHeight/256);let n=Ue.screenCoordToLatLng(0,0),r=Ue.screenCoordToLatLng(a.clientWidth,a.clientHeight);t.removeChild(a);let i=le.map.getZoomScale(le.map.getZoom(),e.zoomFactor);o=[Math.abs(n[0]-r[0])*i,Math.abs(n[1]-r[1])*i]}(),function(){a=[];let e=t.itinerary.itineraryPoints.iterator,n=e.done,r={bottomLeft:{lat:e.value.lat,lng:e.value.lng},upperRight:{lat:e.value.lat,lng:e.value.lng}},i={lat:e.value.lat,lng:e.value.lng},s=e.value;n=e.done;let c=e.value;for(;!n;){let t={bottomLeft:{lat:Math.min(r.bottomLeft.lat,c.lat),lng:Math.min(r.bottomLeft.lng,c.lng)},upperRight:{lat:Math.max(r.upperRight.lat,c.lat),lng:Math.max(r.upperRight.lng,c.lng)}},u=[t.upperRight.lat-t.bottomLeft.lat,t.upperRight.lng-t.bottomLeft.lng];o[0]>u[0]&&o[1]>u[1]?(r=t,s=e.value,n=e.done,c=e.value,n&&(r.entryPoint=i,r.exitPoint=s,a.push(r))):(s=d(r,s,c),r.bottomLeft={lat:Math.min(r.bottomLeft.lat,s.lat),lng:Math.min(r.bottomLeft.lng,s.lng)},r.upperRight={lat:Math.max(r.upperRight.lat,s.lat),lng:Math.max(r.upperRight.lng,s.lng)},r.entryPoint=i,r.exitPoint=s,a.push(r),r={bottomLeft:{lat:s.lat,lng:s.lng},upperRight:{lat:s.lat,lng:s.lng}},i={lat:s.lat,lng:s.lng}),f.printRouteMap.maxTiles<a.length*l&&(n=!0)}}(),f.printRouteMap.maxTiles<a.length*l?ye.showError(A.getText("PrintFactory - The maximum of allowed pages is reached.")):u())}})}let vo=!1,ho=!1;function po(){let t=le.travel.routes.iterator,o=e.defaultValue;for(;!t.done;){t.value.chain?(t.value.chainedDistance=o,o+=t.value.distance):t.value.chainedDistance=e.defaultValue;let a=t.value.notes.iterator;for(;!a.done;)a.value.chainedDistance=t.value.chainedDistance}}function mo(e){let t=!0;return e.wayPoints.forEach(e=>{t=t&&n.defaultValue!==e.lat&&n.defaultValue!==e.lng}),t}function fo(e){ho=!1,ye.showError(e),console.log(e||"An error occurs when asking the route to the provider")}function bo(){ho=!1,le.travel.editedRoute.itinerary.validateData();let t=le.travel.editedRoute.itinerary.maneuvers.iterator;for(;!t.done;)t.value.validateData();let o=le.travel.editedRoute.itinerary.itineraryPoints.iterator;for(;!o.done;)o.value.validateData();if(function(t){let o=t.itinerary.itineraryPoints.iterator,a=t.itinerary.maneuvers.iterator;for(o.done,a.done,a.value.distance=e.defaultValue,a.done,t.distance=e.defaultValue,t.duration=e.defaultValue;!o.done;)o.previous.distance=Ue.pointsDistance(o.previous.latLng,o.value.latLng),t.distance+=o.previous.distance,a.previous.distance+=o.previous.distance,a.value.itineraryPointObjId===o.value.objId&&(t.duration+=a.previous.duration,a.value.distance=e.defaultValue,a.next&&a.value.itineraryPointObjId===a.next.itineraryPointObjId&&(a.done,a.value.distance=e.defaultValue),a.done)}(le.travel.editedRoute),"circle"!==le.travel.editedRoute.itinerary.transitMode){let e=le.travel.editedRoute.wayPoints.iterator;for(;!e.done;)e.first?e.value.latLng=le.travel.editedRoute.itinerary.itineraryPoints.first.latLng:e.last?e.value.latLng=le.travel.editedRoute.itinerary.itineraryPoints.last.latLng:e.value.latLng=Ue.getClosestLatLngDistance(le.travel.editedRoute,e.value.latLng).latLng}let a=le.travel.editedRoute.notes.iterator;for(;!a.done;){let e=Ue.getClosestLatLngDistance(le.travel.editedRoute,a.value.latLng);a.value.latLng=e.latLng,a.value.distance=e.distance}po(),le.travel.editedRoute.notes.sort((e,t)=>e.distance-t.distance),vo&&ke().zoomToRoute(le.travel.editedRoute.objId),Wt.createProfile(le.travel.editedRoute),Te.dispatch("routeupdated",{removedRouteObjId:le.travel.editedRoute.objId,addedRouteObjId:le.travel.editedRoute.objId}),Te.dispatch("roadbookupdate"),Te.dispatch("showitinerary")}const yo=Object.seal(new class{addRoute(){let e=_();le.travel.routes.add(e),r.editedChanged===le.travel.editedRoute.editionStatus?(po(),Te.dispatch("setrouteslist"),Te.dispatch("roadbookupdate")):this.editRoute(e.objId)}editRoute(e){if(r.editedChanged===le.travel.editedRoute.editionStatus)return void ye.showError(A.getText("RouteEditor - Not possible to edit a route without a save or cancel"));let t=De.getRoute(e),o=t.itinerary.provider,a=le.providers.get(o.toLowerCase());if(o&&""!==o&&(!a||a.providerKeyNeeded&&!Pe.getKey(o)))return void ye.showError(A.getText("RouteEditor - Not possible to edit a route created with this provider",{provider:o}));-1!==le.editedRouteObjId&&this.cancelEdition(),o&&""!==o&&Te.dispatch("setprovider",{provider:o});let n=t.itinerary.transitMode;n&&""!==n&&Te.dispatch("settransitmode",{transitMode:n}),le.travel.editedRoute=_(),t.editionStatus=r.editedNoChange,le.travel.editedRoute.jsonObject=t.jsonObject,le.editedRouteObjId=t.objId,le.travel.editedRoute.hidden=!1,t.hidden=!1,Wt.updateProfile(le.editedRouteObjId,le.travel.editedRoute),po(),Te.dispatch("routeupdated",{removedRouteObjId:t.objId,addedRouteObjId:le.travel.editedRoute.objId}),Te.dispatch("roadbookupdate"),Te.dispatch("showitinerary"),Te.dispatch("setrouteslist")}removeRoute(e){let t=e;if(t===le.editedRouteObjId||t===le.travel.editedRoute.objId){if(r.editedChanged===le.travel.editedRoute.editionStatus)return void ye.showError(A.getText("TravelEditor - Cannot remove an edited route"));t=le.editedRouteObjId,this.cancelEdition()}Te.dispatch("routeupdated",{removedRouteObjId:t,addedRouteObjId:-1}),le.travel.routes.remove(t),Wt.deleteProfile(t),po(),Te.dispatch("roadbookupdate"),Te.dispatch("setrouteslist")}removeManeuver(t){(le.travel.editedRoute.itinerary.maneuvers.previous(t,t=>e.defaultValue<t.distance)||le.travel.editedRoute.itinerary.maneuvers.first).distance+=le.travel.editedRoute.itinerary.maneuvers.getAt(t).distance,le.travel.editedRoute.itinerary.maneuvers.remove(t),Te.dispatch("showitinerary"),Te.dispatch("roadbookupdate")}saveGpx(e){Ce().routeToGpx(e)}chainRoutes(){po()}startRouting(){if(f.routing.auto&&!ho&&mo(le.travel.editedRoute)){vo=0===le.travel.editedRoute.itinerary.itineraryPoints.length,ho=!0;let e=le.providers.get(le.routing.provider.toLowerCase());le.travel.editedRoute.itinerary.provider=e.name,le.travel.editedRoute.itinerary.transitMode=le.routing.transitMode,e.getPromiseRoute(le.travel.editedRoute,null).then(bo).catch(fo)}}saveEdition(){let e=_();e.jsonObject=le.travel.editedRoute.jsonObject,le.travel.routes.replace(le.editedRouteObjId,e),le.editedRouteObjId=e.objId,this.cancelEdition()}cancelEdition(){let e=De.getRoute(le.editedRouteObjId);e.editionStatus=r.notEdited,Wt.updateProfile(le.travel.editedRoute.objId,e),Te.dispatch("routeupdated",{removedRouteObjId:le.travel.editedRoute.objId,addedRouteObjId:le.editedRouteObjId}),le.editedRouteObjId=-1,le.travel.editedRoute=_(),po(),Te.dispatch("roadbookupdate"),Te.dispatch("setrouteslist"),Te.dispatch("showitinerary")}routeProperties(e){let t=De.getRoute(e);Me(t).show().then(()=>{po(),mo(t)&&Te.dispatch("routepropertiesupdated",{routeObjId:t.objId}),Te.dispatch("roadbookupdate"),Te.dispatch("setrouteslist"),Te.dispatch("updateitinerary")}).catch(e=>console.log(e||"An error occurs in the route properties dialog"))}printRouteMap(e){(function(){let e=null,t=null,o=null,a=null,n=null,r=null,i=null,l=null;function s(){return Object.seal({paperWidth:parseInt(o.value),paperHeight:parseInt(a.value),borderWidth:parseInt(n.value),zoomFactor:parseInt(l.value),pageBreak:r.checked,printNotes:i.checked})}return e=se(),e.title=A.getText("PrintRouteMapDialog - Print"),e.okButtonListener=s,t=b.create("div",{id:"TravelNotes-PrintRouteMapDialog-MainDataDiv"},e.content),function(){let e=b.create("div",{className:"TravelNotes-PrintRouteMapDialog-DataDiv"},t);b.create("text",{value:A.getText("PrintRouteMapDialog - Paper width")},e),o=b.create("input",{type:"number",className:"TravelNotes-PrintRouteMapDialog-NumberInput"},e),o.value=f.printRouteMap.paperWidth,b.create("text",{value:A.getText("PrintRouteMapDialog - Paper width units")},e)}(),function(){let e=b.create("div",{className:"TravelNotes-PrintRouteMapDialog-DataDiv"},t);b.create("text",{value:A.getText("PrintRouteMapDialog - Paper height")},e),a=b.create("input",{type:"number",className:"TravelNotes-PrintRouteMapDialog-NumberInput",value:f.printRouteMap.paperHeight},e),b.create("text",{value:A.getText("PrintRouteMapDialog - Paper height units")},e)}(),function(){let e=b.create("div",{className:"TravelNotes-PrintRouteMapDialog-DataDiv"},t);b.create("text",{value:A.getText("PrintRouteMapDialog - Border width")},e),n=b.create("input",{type:"number",className:"TravelNotes-PrintRouteMapDialog-NumberInput",id:"TravelNotes-PrintRouteMapDialog-BorderWidthNumberInput",value:f.printRouteMap.borderWidth},e),b.create("text",{value:A.getText("PrintRouteMapDialog - Border width units")},e)}(),function(){let e=b.create("div",{className:"TravelNotes-PrintRouteMapDialog-DataDiv",id:"TravelNotes-PrintRouteMapDialog-ZoomFactorDataDiv"},t);b.create("text",{value:A.getText("PrintRouteMapDialog - Zoom factor")},e),l=b.create("input",{type:"number",className:"TravelNotes-PrintRouteMapDialog-NumberInput",value:Math.min(f.printRouteMap.zoomFactor,15),min:le.map.getMinZoom(),max:Math.min(le.map.getMaxZoom(),15)},e)}(),function(){let e=b.create("div",{className:"TravelNotes-PrintRouteMapDialog-DataDiv",id:"TravelNotes-PrintRouteMapDialog-PageBreakDataDiv"},t);r=b.create("input",{type:"checkbox",id:"TravelNotes-PrintRouteMapDialog-PageBreakInput",checked:f.printRouteMap.pageBreak},e),b.create("text",{value:A.getText("PrintRouteMapDialog - Page break")},e)}(),function(){let e=b.create("div",{className:"TravelNotes-PrintRouteMapDialog-DataDiv",id:"TravelNotes-PrintRouteMapDialog-PrintNotesDataDiv"},t);i=b.create("input",{type:"checkbox",id:"TravelNotes-PrintRouteMapDialog-PrintNotesInput",checked:f.printRouteMap.printNotes},e),b.create("text",{value:A.getText("PrintRouteMapDialog - Print notes")},e)}(),e})().show().then(t=>go().print(t,e)).catch(e=>console.log(e||"An error occurs in the route properties dialog"))}showRoute(e){De.getRoute(e).hidden=!1,Te.dispatch("routeupdated",{removedRouteObjId:-1,addedRouteObjId:e}),Te.dispatch("setrouteslist")}hideRoute(e){De.getRoute(e).hidden=!0,Te.dispatch("routeupdated",{removedRouteObjId:e,addedRouteObjId:-1}),Te.dispatch("setrouteslist")}showRoutes(){let e=le.travel.routes.iterator;for(;!e.done;)e.value.hidden&&(e.value.hidden=!1,Te.dispatch("routeupdated",{removedRouteObjId:-1,addedRouteObjId:e.value.objId}));Te.dispatch("setrouteslist")}hideRoutes(){let e=le.travel.routes.iterator;for(;!e.done;)e.value.hidden||e.value.objId===le.editedRouteObjId||(e.value.hidden=!0,Te.dispatch("routeupdated",{removedRouteObjId:e.value.objId,addedRouteObjId:-1}));Te.dispatch("setrouteslist")}});function No(e,t){if(!f.wayPoint.reverseGeocoding)return;let o=rt();o.getPromiseAddress(e).then(e=>{let a=o.parseResponse(e),n=a.street;""!==a.city&&(n+=" "+a.city),function(e,t){le.travel.editedRoute.editionStatus=r.editedChanged;let o=le.travel.editedRoute.wayPoints.getAt(t);o.name=e.name,o.address=e.address,Te.dispatch("setrouteslist"),Te.dispatch("showitinerary"),Te.dispatch("roadbookupdate")}(Object.seal({name:a.name,address:n}),t)}).catch(e=>console.log(e||"An error occurs in the geoCoder"))}const To=Object.seal(new class{addWayPoint(e){le.travel.editedRoute.editionStatus=r.editedChanged;let t=C();t.latLng=e,No(e,t.objId),le.travel.editedRoute.wayPoints.add(t),Te.dispatch("addwaypoint",{wayPoint:le.travel.editedRoute.wayPoints.last,letter:le.travel.editedRoute.wayPoints.length-2}),le.travel.editedRoute.wayPoints.swap(t.objId,!0),yo.startRouting()}addWayPointOnRoute(e,t){let o=Ue.getClosestLatLngDistance(le.travel.editedRoute,e).distance;le.travel.editedRoute.editionStatus=r.editedChanged;let a=C();a.latLng=t,No(t,a.objId),le.travel.editedRoute.wayPoints.add(a),Te.dispatch("addwaypoint",{wayPoint:le.travel.editedRoute.wayPoints.last,letter:le.travel.editedRoute.wayPoints.length-2});let n=le.travel.editedRoute.wayPoints.iterator;for(;!n.done;){if(o<Ue.getClosestLatLngDistance(le.travel.editedRoute,n.value.latLng).distance){le.travel.editedRoute.wayPoints.moveTo(a.objId,n.value.objId,!0);break}}yo.startRouting()}reverseWayPoints(){le.travel.editedRoute.editionStatus=r.editedChanged;let e=le.travel.editedRoute.wayPoints.iterator;for(;!e.done;)Te.dispatch("removeobject",{objId:e.value.objId});for(le.travel.editedRoute.wayPoints.reverse(),e=le.travel.editedRoute.wayPoints.iterator;!e.done;)Te.dispatch("addwaypoint",{wayPoint:e.value,letter:e.first?"A":e.last?"B":e.index});Te.dispatch("setrouteslist"),Te.dispatch("showitinerary"),Te.dispatch("roadbookupdate"),yo.startRouting()}removeWayPoint(e){le.travel.editedRoute.editionStatus=r.editedChanged,Te.dispatch("removeobject",{objId:e}),le.travel.editedRoute.wayPoints.remove(e),yo.startRouting()}setStartPoint(e){le.travel.editedRoute.editionStatus=r.editedChanged,n.defaultValue!==le.travel.editedRoute.wayPoints.first.lat&&Te.dispatch("removeobject",{objId:le.travel.editedRoute.wayPoints.first.objId}),le.travel.editedRoute.wayPoints.first.latLng=e,f.wayPoint.reverseGeocoding&&No(e,le.travel.editedRoute.wayPoints.first.objId),Te.dispatch("addwaypoint",{wayPoint:le.travel.editedRoute.wayPoints.first,letter:"A"}),yo.startRouting()}setEndPoint(e){le.travel.editedRoute.editionStatus=r.editedChanged,n.defaultValue!==le.travel.editedRoute.wayPoints.last.lat&&Te.dispatch("removeobject",{objId:le.travel.editedRoute.wayPoints.last.objId}),le.travel.editedRoute.wayPoints.last.latLng=e,f.wayPoint.reverseGeocoding&&No(e,le.travel.editedRoute.wayPoints.last.objId),Te.dispatch("addwaypoint",{wayPoint:le.travel.editedRoute.wayPoints.last,letter:"B"}),yo.startRouting()}wayPointDragEnd(e){le.travel.editedRoute.editionStatus=r.editedChanged,f.wayPoint.reverseGeocoding&&No(le.travel.editedRoute.wayPoints.getAt(e).latLng,e),yo.startRouting()}wayPointProperties(e){(function(e){let t=null,o=null,a=null,n=null;function r(){return e.name=a.value,e.address=n.value,e.validateData(),e}function i(t){if(t.stopPropagation(),!f.wayPoint.reverseGeocoding)return;let o=rt();o.getPromiseAddress(e.latLng).then(e=>{let t=o.parseResponse(e),a=t.street;""!==t.city&&(a+=" "+t.city),n.value=a}).catch(e=>console.log(e||"An error occurs in the geoCoder"))}return t=se(),t.title=A.getText("WayPointPropertiesDialog - Waypoint properties"),t.okButtonListener=r,o=b.create("div",{id:"TravelNotes-WayPointPropertiesDialog-DataDiv"},t.content),b.create("div",{textContent:A.getText("WayPointPropertiesDialog - Name")},o),a=b.create("input",{type:"text",value:e.name,className:"TravelNotes-WayPointPropertiesDialog-Input"},b.create("div",null,o)),function(){let t=b.create("div",null,o);b.create("div",{className:"TravelNotes-BaseDialog-Button",title:A.getText("WayPointPropertiesDialog - Reset address"),textContent:"🔄"},t).addEventListener("click",i,!1),b.create("text",{value:A.getText("WayPointPropertiesDialog - Address")},t),n=b.create("input",{type:"text",value:e.address,className:"TravelNotes-WayPointPropertiesDialog-Input"},b.create("div",null,o))}(),t})(le.travel.editedRoute.wayPoints.getAt(e)).show().then(()=>{Te.dispatch("setrouteslist"),Te.dispatch("showitinerary"),Te.dispatch("roadbookupdate")}).catch(e=>console.log(e||"An error occurs in the waypoint properties dialog"))}});function wo(e,t){let o=e.target.objId,a=De.getRoute(o),n=ke();let i=tt(e,function(){let t=[{context:yo,name:A.getText("RouteContextMenu - Edit this route"),action:o===le.travel.editedRoute.objId||r.editedChanged===le.travel.editedRoute.editionStatus?null:yo.editRoute,param:o},{context:yo,name:A.getText("RouteContextMenu - Delete this route"),action:o===le.travel.editedRoute.objId&&r.editedChanged===le.travel.editedRoute.editionStatus?null:yo.removeRoute,param:o},a.hidden?{context:yo,name:A.getText("RouteContextMenu - Show this route"),action:yo.showRoute,param:o}:{context:yo,name:A.getText("RouteContextMenu - Hide this route"),action:le.travel.editedRoute.objId===o?null:yo.hideRoute,param:o},{context:yo,name:A.getText("RouteContextMenu - Properties"),action:a.hidden?null:yo.routeProperties,param:o},{context:n,name:A.getText("RouteContextMenu - Zoom to route"),action:n.zoomToRoute,param:o},{context:Wt,name:A.getText("RouteContextMenu - View the elevation"),action:a.itinerary.hasProfile?Wt.showProfile:null,param:o}];return f.printRouteMap.isEnabled&&t.push({context:yo,name:A.getText("RouteContextMenu - Print route map"),action:yo.printRouteMap,param:o}),t=t.concat([{context:yo,name:A.getText("RouteContextMenu - Save this route in a GPX file"),action:0<a.itinerary.itineraryPoints.length?yo.saveGpx:null,param:o},{context:To,name:A.getText("RouteContextMenu - Invert waypoints"),action:le.travel.editedRoute.objId===o?To.reverseWayPoints:null},{context:Ht,name:A.getText("RouteContextMenu - Add a note on the route"),action:e.fromUI?null:Ht.newRouteNote,param:{routeObjId:o,lat:e.latlng.lat,lng:e.latlng.lng}},{context:Ht,name:A.getText("RouteContextMenu - Create a note for each route maneuver"),action:a.hidden?null:Ht.addAllManeuverNotes,param:o},{context:yo,name:A.getText("RouteContextMenu - Save modifications on this route"),action:le.travel.editedRoute.objId===o?yo.saveEdition:null},{context:yo,name:A.getText("RouteContextMenu - Cancel modifications on this route"),action:le.travel.editedRoute.objId===o?yo.cancelEdition:null}]),t}(),t);return Object.seal(i)}function xo(e,t){let o=e.noteObjId||e.target.objId,a=ke();let n=tt(e,function(){let e=De.getNoteAndRoute(o).route;return[{context:Ht,name:A.getText("NoteContextMenu - Edit this note"),action:Ht.editNote,param:o},{context:Ht,name:A.getText("NoteContextMenu - Delete this note"),action:Ht.removeNote,param:o},{context:a,name:A.getText("NoteContextMenu - Zoom to note"),action:a.zoomToNote,param:o},{context:Ht,name:e?A.getText("NoteContextMenu - Detach note from route"):A.getText("NoteContextMenu - Attach note to route"),action:0!==le.travel.routes.length&&-1===le.editedRouteObjId?e?Ht.detachNoteFromRoute:Ht.attachNoteToRoute:null,param:o}]}(),t);return Object.seal(n)}let Io=null,Lo=null;function Ao(e){let t=De.getRoute(e.target.objId),o=Ue.getClosestLatLngDistance(t,[e.latlng.lat,e.latlng.lng]).distance;o+=t.chainedDistance,o=E.formatDistance(o);let a=le.mapObjects.get(e.target.objId);a.closeTooltip();let n=t.computedName;le.travel.readOnly||(n+=0===n.length?"":" - ",n+=o),a.setTooltipContent(n),a.openTooltip(e.latlng)}function Eo(e,t){t.objId=e,t.addTo(le.map),le.mapObjects.set(e,t)}function jo(e){let t=De.getNoteAndRoute(e).note,o=L.marker(t.latLng,{icon:L.divIcon({iconSize:[f.note.grip.size,f.note.grip.size],iconAnchor:[f.note.grip.size/2,f.note.grip.size/2],html:"<div></div>",className:"TravelNotes-Note-Bullet"}),opacity:f.note.grip.opacity,draggable:!le.travel.readOnly});o.objId=t.objId;let a=L.divIcon({iconSize:[t.iconWidth,t.iconHeight],iconAnchor:[t.iconWidth/2,t.iconHeight/2],popupAnchor:[0,-t.iconHeight/2],html:t.iconContent,className:"TravelNotes-AllNotes "});let n=L.marker(t.iconLatLng,{zIndexOffset:100,icon:a,draggable:!le.travel.readOnly});n.objId=t.objId,n.bindPopup(e=>jt.getNoteTextHTML("TravelNotes-",De.getNoteAndRoute(e.objId))),0!==t.tooltipContent.length&&(n.bindTooltip(e=>De.getNoteAndRoute(e.objId).note.tooltipContent),n.getTooltip().options.offset[0]=t.iconWidth/2);let r=L.polyline([t.latLng,t.iconLatLng],f.note.polyline);r.objId=t.objId;let i=L.layerGroup([n,r,o]);return i.markerId=L.Util.stamp(n),i.polylineId=L.Util.stamp(r),i.bulletId=L.Util.stamp(o),Eo(t.objId,i),f.note.haveBackground&&document.querySelectorAll(".TravelNotes-MapNote,.TravelNotes-SvgIcon").forEach(e=>e.classList.add("TravelNotes-MapNote-Background")),Object.freeze({marker:n,polyline:r,bullet:o})}function Po(e){e.dashArray>=f.route.dashChoices.length&&(e.dashArray=0);let t=f.route.dashChoices[e.dashArray].iDashArray;if(t){let o="",a=0;for(a=0;a<t.length-1;a++)o+=t[a]*e.width+",";return o+=t[a]*e.width,o}return null}const Do=Object.seal(new class{addRoute(e){let t=De.getRoute(e),o=[],a=t.itinerary.itineraryPoints.iterator;for(;!a.done;)o.push(a.value.latLng);let n=L.polyline(o,{color:t.color,weight:t.width,dashArray:Po(t)});Eo(t.objId,n),r.notEdited===t.editionStatus&&(n.bindTooltip(t.computedName,{sticky:!0,direction:"right"}),n.on("mouseover",Ao),n.on("mousemove",Ao)),n.bindPopup(e=>{let t=De.getRoute(e.objId);return jt.getRouteHeaderHTML("TravelNotes-UI-",t)}),L.DomEvent.on(n,"click",e=>e.target.openPopup(e.latlng));let i=t.notes.iterator;for(;!i.done;)jo(i.value.objId);return t}addNote(e){return jo(e)}getDashArray(e){return Po(e)}zoomTo(e,t){if(t){let e=[];t.forEach(t=>e=e.concat(t)),le.map.fitBounds(Ue.getLatLngBounds(e))}else le.map.setView(e,f.itineraryPointZoom)}setLayer(e,t){let o=null;o="wmts"===e.service.toLowerCase()?L.tileLayer(t):L.tileLayer.wms(t,e.wmsOptions),Io&&le.map.removeLayer(Io),le.map.addLayer(o),Io=o,le.travel.readOnly||(le.map.getZoom()<(e.minZoom||0)&&le.map.setZoom(e.minZoom||0),le.map.setMinZoom(e.minZoom||0),le.map.getZoom()>(e.maxZoom||18)&&le.map.setZoom(e.maxZoom||18),le.map.setMaxZoom(e.maxZoom||18),e.bounds?(le.map.getBounds().intersects(e.bounds)&&!le.map.getBounds().contains(e.bounds)||(le.map.setMaxBounds(null),le.map.fitBounds(e.bounds),le.map.setZoom(e.minZoom||0)),le.map.setMaxBounds(e.bounds)):le.map.setMaxBounds(null)),le.map.fire("baselayerchange",o)}onGeolocationStatusChanged(e){t.active!==e&&Lo&&(le.map.removeLayer(Lo),Lo=null)}onGeolocationPositionChanged(e){let t=f.geoLocation.zoomToPosition;Lo&&(le.map.removeLayer(Lo),t=!1),Lo=L.circleMarker(L.latLng(e.coords.latitude,e.coords.longitude),{radius:f.geoLocation.radius,color:f.geoLocation.color}).bindTooltip(E.formatLatLng([e.coords.latitude,e.coords.longitude])).addTo(le.map),t&&le.map.setView(L.latLng(e.coords.latitude,e.coords.longitude),f.geoLocation.zoomFactor)}});let Co=null,Ro=null,Mo=1;function So(){Co&&(L.DomEvent.off(Co),le.map.removeLayer(Co),Co=null)}function Oo(){L.DomEvent.off(Co,"mouseout",So)}function Uo(e){e.latlng.lat=Ro[0],e.latlng.lng=Ro[1],e.target.objId=le.travel.editedRoute.objId,wo(e).show()}function ko(e){To.addWayPointOnRoute(Ro,[e.target.getLatLng().lat,e.target.getLatLng().lng]),Co&&(L.DomEvent.off(Co,"dragstart",Oo),L.DomEvent.off(Co,"dragend",ko),L.DomEvent.off(Co,"contextmenu",Uo),le.map.removeLayer(Co),Co=null)}function Bo(e){let t=De.getNoteAndRoute(e.target.objId),o=t.note,a=t.route,n=le.mapObjects.get(e.target.objId);if(null===a)o.latLng=[e.target.getLatLng().lat,e.target.getLatLng().lng],Te.dispatch("updatetravelnotes");else{let t=Ue.getClosestLatLngDistance(a,[e.target.getLatLng().lat,e.target.getLatLng().lng]);o.latLng=t.latLng,o.distance=t.distance,a.notes.sort((e,t)=>e.distance-t.distance),n.getLayer(n.bulletId).setLatLng(t.latLng),Te.dispatch("updateitinerary")}n.getLayer(n.polylineId).setLatLngs([o.latLng,o.iconLatLng]),Te.dispatch("roadbookupdate")}function Ho(e){let t=De.getNoteAndRoute(e.target.objId).note,o=le.mapObjects.get(e.target.objId);o.getLayer(o.polylineId).setLatLngs([[e.latlng.lat,e.latlng.lng],t.iconLatLng])}function zo(e){e.originalEvent.target.style.opacity=f.note.grip.moveOpacity}function Vo(e){e.originalEvent.target.style.opacity=f.note.grip.opacity}function Fo(e){xo(e).show()}function Wo(e){let t=De.getNoteAndRoute(e.target.objId).note;t.iconLatLng=[e.target.getLatLng().lat,e.target.getLatLng().lng];let o=le.mapObjects.get(e.target.objId);o.getLayer(o.polylineId).setLatLngs([t.latLng,t.iconLatLng])}function Ko(e){let t=De.getNoteAndRoute(e.target.objId).note,o=le.mapObjects.get(e.target.objId);o.getLayer(o.polylineId).setLatLngs([t.latLng,[e.latlng.lat,e.latlng.lng]])}function Jo(e){let t=De.getRoute(e.target.objId);if(r.notEdited!==t.editionStatus)if(Ro=[e.latlng.lat,e.latlng.lng],Co)Co.setLatLng(e.latlng);else{let t='<div class="TravelNotes-WayPoint TravelNotes-WayPointTmp"></div><div class="TravelNotes-WayPointText">?</div>';Co=L.marker(e.latlng,{icon:L.divIcon({iconSize:[40,40],iconAnchor:[20,40],html:t,className:"TravelNotes-WayPointStyle"}),draggable:!0}),(-1===f.route.showDragTooltip||Mo<=f.route.showDragTooltip)&&(Mo++,Co.bindTooltip(A.getText("MapEditor - Drag and drop to add a waypoint")),Co.getTooltip().options.offset=[0,0]),Co.addTo(le.map),L.DomEvent.on(Co,"mouseout",So),L.DomEvent.on(Co,"dragstart",Oo),L.DomEvent.on(Co,"dragend",ko),L.DomEvent.on(Co,"contextmenu",Uo)}}function Zo(e){wo(e).show()}function Xo(e){(function(e){let t=e.target.objId,o=tt(e,function(){let e=le.travel.editedRoute.wayPoints.first.objId!==t&&le.travel.editedRoute.wayPoints.last.objId!==t;return[{context:To,name:A.getText("WayPointContextMenu - Delete this waypoint"),action:e?To.removeWayPoint:null,param:t},{context:To,name:A.getText("WayPointContextMenu - Modify properties"),action:To.wayPointProperties,param:t}]}());return Object.seal(o)})(e).show()}function Go(e){le.travel.editedRoute.wayPoints.getAt(e.target.objId).latLng=[e.target.getLatLng().lat,e.target.getLatLng().lng],To.wayPointDragEnd(e.target.objId)}function qo(e,t){t.objId=e,t.addTo(le.map),le.mapObjects.set(e,t)}function Yo(e){let t=le.mapObjects.get(e);t&&(L.DomEvent.off(t),le.map.removeLayer(t),le.mapObjects.delete(e))}function Qo(e,t){if(n.defaultValue===e.lat&&n.defaultValue===e.lng)return;let o='<div class="TravelNotes-WayPoint TravelNotes-WayPoint'+("A"===t?"Start":"B"===t?"End":"Via")+'"></div><div class="TravelNotes-WayPointText">'+t+"</div>",a=L.marker(e.latLng,{icon:L.divIcon({iconSize:[40,40],iconAnchor:[20,40],html:o,className:"TravelNotes-WayPointStyle"}),draggable:!0});a.bindTooltip(e=>De.getWayPoint(e.objId).fullName),a.getTooltip().options.offset=[20,-20],L.DomEvent.on(a,"contextmenu",Xo),a.objId=e.objId,qo(e.objId,a),L.DomEvent.on(a,"dragend",Go)}const _o=Object.seal(new class{updateRoute(e,t){-1!==e&&function(e){let t=De.getRoute(e);Yo(t.objId);let o=t.notes.iterator;for(;!o.done;)Yo(o.value.objId);let a=t.wayPoints.iterator;for(;!a.done;)Yo(a.value.objId)}(e),-1!==t&&function(e){let t=Do.addRoute(e),o=le.mapObjects.get(e);if(!le.travel.readOnly){L.DomEvent.on(o,"contextmenu",Zo),L.DomEvent.on(o,"mouseover",Jo);let e=t.notes.iterator;for(;!e.done;){let t=le.mapObjects.get(e.value.objId),o=t.getLayer(t.markerId),a=t.getLayer(t.bulletId);L.DomEvent.on(a,"dragend",Bo),L.DomEvent.on(a,"drag",Ho),L.DomEvent.on(a,"mouseenter",zo),L.DomEvent.on(a,"mouseleave",Vo),L.DomEvent.on(o,"contextmenu",Fo),L.DomEvent.on(o,"dragend",Wo),L.DomEvent.on(o,"drag",Ko)}}if(!le.travel.readOnly&&r.notEdited!==t.editionStatus){let e=le.travel.editedRoute.wayPoints.iterator;for(;!e.done;)Qo(e.value,e.first?"A":e.last?"B":e.index)}}(t)}updateRouteProperties(e){let t=le.mapObjects.get(e),o=De.getRoute(e);t.setStyle({color:o.color,weight:o.width,dashArray:Do.getDashArray(o)})}updateNote(e,t){let o=!1;if(-1!==e){let t=le.mapObjects.get(e);t&&(o=t.getLayer(t.markerId).isPopupOpen()),Yo(e)}-1!==t&&function(e,t){let o=Do.addNote(e);t&&o.marker.openPopup(),le.travel.readOnly||(L.DomEvent.on(o.bullet,"dragend",Bo),L.DomEvent.on(o.bullet,"drag",Ho),L.DomEvent.on(o.bullet,"mouseenter",zo),L.DomEvent.on(o.bullet,"mouseleave",Vo),L.DomEvent.on(o.marker,"contextmenu",Fo),L.DomEvent.on(o.marker,"dragend",Wo),L.DomEvent.on(o.marker,"drag",Ko))}(t,o)}removeObject(e){Yo(e)}removeAllObjects(){le.mapObjects.forEach(e=>{L.DomEvent.off(e),le.map.removeLayer(e)}),le.mapObjects.clear()}addWayPoint(e,t){Qo(e,t)}addItineraryPointMarker(e,t){qo(e,L.circleMarker(t,f.itineraryPointMarker))}addSearchPointMarker(e,t,o){let a=!1;if(o){let e=[];o.forEach(t=>{e=e.concat(t)});let t=Ue.getLatLngBounds(e),n=le.map.getBounds();a=(t.getEast()-t.getWest())/(n.getEast()-n.getWest())>.01&&(t.getNorth()-t.getSouth())/(n.getNorth()-n.getSouth())>.01}qo(e,a?L.polyline(o,f.searchPointPolyline):L.circleMarker(t,f.searchPointMarker))}addRectangle(e,t,o){qo(e,L.rectangle(t,o))}setLayer(e){let t=e.url;if(e.providerKeyNeeded){let o=Pe.getKey(e.providerName.toLowerCase());if(!o)return;t=t.replace("{providerKey}",o)}Do.setLayer(e,t)}});var $o={};function ea(e){return Math.floor(Math.abs(e)+.5)*(e>=0?1:-1)}function ta(e,t,o){var a=(e=ea(e*o))-(t=ea(t*o));a<<=1,e-t<0&&(a=~a);for(var n="";a>=32;)n+=String.fromCharCode(63+(32|31&a)),a>>=5;return n+=String.fromCharCode(a+63)}function oa(e){for(var t=[],o=0;o<e.length;o++){var a=e[o].slice();t.push([a[1],a[0]])}return t}function aa(){function e(e){let t={};0!==e.itinerary.itineraryPoints.length&&(t=e.itinerary.itineraryPoints[0].objType);let o={latLngs:[],distances:[],elevs:[],objIds:[],objType:t};e.itinerary.itineraryPoints.forEach(e=>{o.latLngs.push([e.lat,e.lng]),o.distances.push(e.distance),o.elevs.push(e.elev),o.objIds.push(e.objId)}),o.latLngs=$o.encode(o.latLngs,6),e.itinerary.itineraryPoints=o}function t(e){e.itinerary.itineraryPoints.latLngs=$o.decode(e.itinerary.itineraryPoints.latLngs,6);let t=[],o=0;e.itinerary.itineraryPoints.latLngs.forEach(n=>{let r={};r.lat=n[0],r.lng=n[1],r.distance=e.itinerary.itineraryPoints.distances[o],e.itinerary.itineraryPoints.elevs?r.elev=e.itinerary.itineraryPoints.elevs[o]:r.elev=a.defaultValue,r.objId=e.itinerary.itineraryPoints.objIds[o],r.objType=e.itinerary.itineraryPoints.objType,t.push(r),o++}),e.itinerary.itineraryPoints=t}function o(e){e.routes.forEach(t),e.editedRoute&&t(e.editedRoute)}return Object.seal(new class{decompress(e){o(e),le.travel.jsonObject=e,le.editedRouteObjId=-1,le.travel.routes.forEach(e=>{r.notEdited!==e.editionStatus&&(le.editedRouteObjId=e.objId)})}decompressMerge(e){o(e);let t=oe();t.jsonObject=e;let a=t.routes.iterator;for(;!a.done;)le.travel.routes.add(a.value);let n=t.notes.iterator;for(;!n.done;)le.travel.notes.add(n.value)}compress(){let t=le.travel.jsonObject;return t.routes.forEach(e),e(t.editedRoute),t}})}$o.decode=function(e,t){for(var o,a=0,n=0,r=0,i=[],l=0,s=0,d=null,c=Math.pow(10,Number.isInteger(t)?t:5);a<e.length;){d=null,l=0,s=0;do{s|=(31&(d=e.charCodeAt(a++)-63))<<l,l+=5}while(d>=32);o=1&s?~(s>>1):s>>1,l=s=0;do{s|=(31&(d=e.charCodeAt(a++)-63))<<l,l+=5}while(d>=32);n+=o,r+=1&s?~(s>>1):s>>1,i.push([n/c,r/c])}return i},$o.encode=function(e,t){if(!e.length)return"";for(var o=Math.pow(10,Number.isInteger(t)?t:5),a=ta(e[0][0],0,o)+ta(e[0][1],0,o),n=1;n<e.length;n++){var r=e[n],i=e[n-1];a+=ta(r[0],i[0],o),a+=ta(r[1],i[1],o)}return a},$o.fromGeoJSON=function(e,t){if(e&&"Feature"===e.type&&(e=e.geometry),!e||"LineString"!==e.type)throw new Error("Input must be a GeoJSON LineString");return $o.encode(oa(e.coordinates),t)},$o.toGeoJSON=function(e,t){return{type:"LineString",coordinates:oa($o.decode(e,t))}},"object"==typeof module&&module.exports&&(module.exports=$o);const na=Object.seal(new class{routeDropped(e,t,o){le.travel.routes.moveTo(e,t,o),yo.chainRoutes(),Te.dispatch("setrouteslist"),Te.dispatch("roadbookupdate")}saveTravel(){let e=le.travel.routes.iterator;for(;!e.done;)e.value.hidden=!1;let t=aa().compress(le.travel);E.saveFile(t.name+".trv",JSON.stringify(t))}clear(){window.confirm(A.getText("TravelEditor - This page ask to close; data are perhaps not saved."))&&(Wt.deleteAllProfiles(),Te.dispatch("removeallobjects"),le.travel.editedRoute=_(),le.editedRouteObjId=-1,le.travel=oe(),le.travel.routes.add(_()),Te.dispatch("setrouteslist"),Te.dispatch("showitinerary"),Te.dispatch("roadbookupdate"),Te.dispatch("travelnameupdated"),f.travelEditor.startupRouteEdition&&yo.editRoute(le.travel.routes.first.objId))}});function ra(){return Object.seal(new class{openDistantFile(e){aa().decompress(e),le.travel.readOnly=!0,this.display()}display(){document.title="Travel & Notes"+(""===le.travel.name?"":" - "+le.travel.name);let e=le.travel.routes.iterator;for(;!e.done;)r.notEdited===e.value.editionStatus&&Te.dispatch("routeupdated",{removedRouteObjId:-1,addedRouteObjId:e.value.objId});-1!==le.editedRouteObjId&&Te.dispatch("routeupdated",{removedRouteObjId:-1,addedRouteObjId:le.travel.editedRoute.objId});let t=le.travel.notes.iterator;for(;!t.done;)Te.dispatch("noteupdated",{removedNoteObjId:-1,addedNoteObjId:t.value.objId});ke().zoomToTravel()}})}function ia(){function e(e,t){let o=new FileReader;o.onload=function(){let e={};try{e=JSON.parse(o.result)}catch(e){console.log(e||"An error occurs when reading the file")}t?aa().decompressMerge(e):(Wt.deleteAllProfiles(),aa().decompress(e)),function(){if(Te.dispatch("removeallobjects"),ra().display(),uo.setLayer(le.travel.layerName),Te.dispatch("setrouteslist"),-1!==le.editedRouteObjId){let e=le.travel.editedRoute.itinerary.provider;if(e&&""!==e&&!le.providers.get(e.toLowerCase()))ye.showError(A.getText("FileLoader - Not possible to select as provider",{provider:e}));else{let t=le.travel.editedRoute.itinerary.transitMode;Te.dispatch("setprovider",{provider:e}),t&&""!==t&&Te.dispatch("settransitmode",{transitMode:t})}}yo.chainRoutes(),Te.dispatch("travelnameupdated"),Te.dispatch("showitinerary"),Te.dispatch("roadbookupdate")}()},o.readAsText(e.target.files[0])}return Object.seal(new class{openLocalFile(t){e(t,!1)}mergeLocalFile(t){e(t,!0)}})}let la=null,sa=null,da=null,ca=0,ua=null,ga=null,va=null,ha=null;function pa(e){e.deltaY&&(e.target.scrollTop+=e.deltaY*s[e.deltaMode]),e.stopPropagation()}function ma(e){le.travel.name=p.sanitizeToJsString(e.target.value),document.title="Travel & Notes"+(""===le.travel.name?"":" - "+le.travel.name),Te.dispatch("roadbookupdate")}function fa(e){e.stopPropagation(),na.clear(),document.title="Travel & Notes"+(""===le.travel.name?"":" - "+le.travel.name)}function ba(e){e.stopPropagation(),""===le.travel.name?ye.showError(A.getText("TravelUI - Gives a name to the travel")):na.saveTravel()}function ya(e){e.stopPropagation(),ia().openLocalFile(e)}function Na(){window.confirm(A.getText("TravelEditor - This page ask to close; data are perhaps not saved."))&&ga.click()}function Ta(e){e.stopPropagation(),ia().mergeLocalFile(e)}function wa(){-1===le.editedRouteObjId?va.click():ye.showError(A.getText("TravelUI - Not possible to merge a travel when a route is edited"))}function xa(){ua=b.create("div",{className:"TravelNotes-UI-FlexRowDiv"},da),b.create("div",{className:"TravelNotes-UI-Button",title:A.getText("TravelUI - Cancel travel"),textContent:"❌"},ua).addEventListener("click",fa,!1),b.create("div",{className:"TravelNotes-UI-Button",title:A.getText("TravelUI - Save travel"),textContent:"💾"},ua).addEventListener("click",ba,!1),ga=b.create("input",{className:"TravelNotes-TravelUI-OpenFileInput",type:"file",accept:".trv"},ua),ga.addEventListener("change",ya,!1),b.create("div",{className:"TravelNotes-UI-Button",title:A.getText("TravelUI - Open travel"),textContent:"📂"},ua).addEventListener("click",Na,!1),va=b.create("input",{className:"TravelNotes-TravelUI-OpenFileInput",type:"file",accept:".trv,.map"},ua),va.addEventListener("change",Ta,!1),b.create("div",{className:"TravelNotes-UI-Button",title:A.getText("TravelUI - Import travel"),textContent:"🌏"},ua).addEventListener("click",wa,!1),b.create("text",{value:"📋"},b.create("a",{className:"TravelNotes-UI-LinkButton",href:"TravelNotesRoadbook.html?lng="+f.language+"&page="+le.UUID,target:"_blank"},b.create("div",{className:"TravelNotes-UI-Button",title:A.getText("TravelUI - Open travel roadbook")},ua)))}function Ia(e){e.stopPropagation(),la.classList.toggle("TravelNotes-TravelUI-HiddenRouteList");let t=la.classList.contains("TravelNotes-TravelUI-HiddenRouteList");e.target.textContent=t?"▶":"▼",e.target.title=t?A.getText("TravelUI - Show"):A.getText("TravelUI - Hide")}function La(e){e.stopPropagation(),yo.addRoute()}function Aa(){ha=b.create("div",{className:"TravelNotes-UI-FlexRowDiv"},da),b.create("div",{textContent:"▼",className:"TravelNotes-TravelUI-RouteList-ExpandButton"},ha).addEventListener("click",Ia,!1),b.create("span",{textContent:A.getText("TravelUI - Travel routes")},ha),b.create("div",{className:"TravelNotes-UI-Button TravelNotes-UI-FlexRow-RightButton",title:A.getText("TravelUI - Add a route"),textContent:"+"},ha).addEventListener("click",La,!1)}function Ea(e){e.stopPropagation();try{e.dataTransfer.setData("Text",e.target.objId),e.dataTransfer.dropEffect="move",e.dataTransfer.routeObjId=e.target.objId}catch(e){console.log(e)}ca=e.target.objId}function ja(e){e.preventDefault()}function Pa(e){e.preventDefault();let t=e.target;for(;!t.objId;)t=t.parentElement;let o=t.getBoundingClientRect();na.routeDropped(ca,t.objId,e.clientY-o.top<o.bottom-e.clientY)}function Da(e){e.stopPropagation(),e.preventDefault(),e.latlng={lat:n.defaultValue,lng:n.defaultValue},e.fromUI=!0,e.originalEvent={clientX:e.clientX,clientY:e.clientY},wo(e,da).show()}const Ca=Object.freeze(new class{createUI(e){da||(da=e,function(){let e=b.create("div",{className:"TravelNotes-UI-FlexRowDiv"},da);b.create("span",{textContent:A.getText("TravelUI - Travel")},e),sa=b.create("input",{id:"TravelNotes-TravelUI-InputTravelName",type:"text",value:le.travel.name},e),sa.addEventListener("change",ma,!1)}(),xa(),Aa(),la=b.create("div",{className:"TravelNotes-TravelUI-RoutesListDiv"},da),la.addEventListener("drop",Pa,!1),la.addEventListener("dragover",ja,!1),la.addEventListener("wheel",pa,!1))}setRoutesList(){for(;la.firstChild;)la.firstChild.removeEventListener("dragstart",Ea,!1),la.firstChild.removeEventListener("contextmenu",Da,!1),la.removeChild(la.firstChild);let e=le.travel.routes.iterator;for(;!e.done;){let t=e.value.objId===le.editedRouteObjId?le.travel.editedRoute:e.value,o=(e.value.objId===le.editedRouteObjId?"🔴 ":"")+(t.chain?"⛓ ":"")+t.computedName,a=b.create("div",{draggable:!0,className:"TravelNotes-TravelUI-RoutesList-Item TravelNotes-UI-MoveCursor"+(e.value.hidden?" TravelNotes-TravelUI-RoutesList-HiddenItem":""),objId:e.value.objId===le.editedRouteObjId?le.travel.editedRoute.objId:e.value.objId,canDrag:!0,textContent:o},la);a.addEventListener("dragstart",Ea,!1),a.addEventListener("contextmenu",Da,!1)}}setTravelName(){sa.value=le.travel.name}});let Ra=o.invalidPane,Ma=new Map,Sa=null,Oa=null;function Ua(e){o.invalidPane!==Ra&&(Ma.get(Ra).remove(),Sa.textContent=""),Ra=e,Ma.get(Ra).add(),document.querySelectorAll(".TravelNotes-DataPaneUI-PaneButton").forEach(e=>{e.paneId===Ra?e.classList.add("TravelNotes-DataPaneUI-ActivePaneButton"):e.classList.remove("TravelNotes-DataPaneUI-ActivePaneButton")})}function ka(e){Ua(e.target.paneId)}function Ba(e){e.deltaY&&(e.target.scrollTop+=e.deltaY*s[e.deltaMode]),e.stopPropagation()}const Ha=Object.freeze(new class{createUI(e){if(Sa)return;let t=b.create("div",{className:"TravelNotes-UI-FlexRowDiv"},e);Oa=b.create("div",{id:"TravelNotes-PanesManagerUI-PaneControlsDiv"},e),Sa=b.create("div",{id:"TravelNotes-PanesManagerUI-PaneDataDiv"},e),Sa.addEventListener("wheel",Ba,!1),Ma.forEach(e=>{b.create("div",{textContent:e.getButtonText(),className:"TravelNotes-DataPaneUI-PaneButton",paneId:e.getId()},t).addEventListener("click",ka,!1),e.setPaneDivs(Sa,Oa)})}addPane(e){Ma.set(e.getId(),e)}showPane(e){Ua(e)}updatePane(e){e===Ra&&Ua(e)}});let za=null,Va=!1;const Fa=["bike","pedestrian","car","train","line","circle"];let Wa={bike:null,pedestrian:null,car:null,train:null,line:null,circle:null},Ka=null;const Ja={bike:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAIAAAC0Ujn1AAAABmJLR0QAAAAzAJlWvctWAAAACXBIWX\t\tMAAA7EAAAOxAGVKw4bAAAAB3RJTUUH5AEIChYTLGSDtAAAA65JREFUSMftVl1sk1UYfs53vnZft4/R/W+hHaUrbshcQch06VCGWd\t\tBohmNRCRiXKXphZCOacCEYBeOFXHhDlHDjQDEBdKIx9sL4Q8bqtEPqLAOE/YDrGPspa2m7bt/Xr8eLr3WddFuJ88b4Xp285z1P3v\t\tOe533eQ9xud3FxMcdxmMMURWGMUUoJIUjNFEUZHBwkPp8vovBnHVfB7gghACNIsgEQQgjAwBjiAfFIQqqrLBpNhKeU/to9Vr/fic\t\tWzbw6iqrKEQ/Ks/pkxAODwr9n/0HcHLWq5uoqlXMqMTjR+nj2bKWPlcrH9t4komyHRmgLt3pcq0gQNGOr2dSJZMyycteNaSJKjlk\t\tIh0dk9KjnO3QhORtrsV+YmXjzreW576qfxlrrlJUXCrUkWlBgDlmgJI+Tn7pvHfvTOeYzEodncTfP8xoIu93h7XzDR+Vx1vj8kVx\t\toEp2fqrlvGWihsseoFnggCv2JZRql+1pNMK+xL10T5yiyeI6/UFuzbalydq12YIbWW9CMt1u2bDeVm8VCzdZUl+1j7yEPr8wmBlh\t\tJTJg+AEgBI1+L4Gw9OSez8ldsv1JvfbbonKUNi1U6jZNuW0p3vuVRG1K8P6wUc2G4++OlAU03Rh98PV63OKvNNXR8K2oxCqTn747\t\taLgVCkfSBkv+Bvqs5985kV+08OzGTNEoi192lTm71XdTSs1RMl2trhzczUBWXm6vG2PGHcue2+xzeZHNfDWx81vX308tcX/BbTEp\t\tX0rR3jOdnpswqSKPAZomC/FABQadA1PlX+uWsCAM8xAK4Rqb7WvMlmebZhzQ5bXl6u+MC9WS9uzM/R6z7ac796fHJa+XtB/sKOSJ\t\tEqg9DpmXJ6wnWvd8RGRjS273TdqFxnvnh5+BPH2Nqy7N/7/F/5ZABArAiiQNUFpRwATlEUhmnVdeiz/saGWa/xWJkoyxF1vefo1Y\t\twNrR8c7wbQ+kX/q42rEiN3bS76Y+i2uo5GGQCeUhplkuryhJROp+fIbmuXa9h9LfTkw0WimNZ8uGeGrwxDo2EAPV75bOfg4eaK8b\t\tFAKCQtM+i9t8JvneiPQ0cBkEAgcO6XkZrXvksYe3j5kYK8HN2ZrtEz/ZPza1CNRczP0p4+PyEpM3Swv7Nug62UBwBCZ7USw/vfjq\t\tQobz/0BpNoHs8voHzzik9SsUtZVFNH+Y8NMMqRxQWllAdA/H6/RqPr7bvJGBYcgSz28wIhJK49SR7WUlIoy2HidruNRiOldBGzVr\t\t+TfwLXzWMKJ+iQhAAAAABJRU5ErkJggg==",pedestrian:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAIAAAC0Ujn1AAAABmJLR0QAAAAzAJlWvctWAAAACXBIWX\t\tMAAA7EAAAOxAGVKw4bAAAAB3RJTUUH5AEICholT2tZIQAAAyxJREFUSMetll1IFFEUx/93PtZ13cykJNvWNDXEMkgoyYKICCJISK\t\tkIIYjqpU98kB77loogjCzKCvoQkqigh8ioKKS01NS2grDwY7ddLa3dNVt37r1ze5haLXVzV8/TmTN3fufMYeacP3E4HCkpKZIkYX\t\twmhCCEhD/DOXc6ncTr9TKu1D5vgxj7LCEQYvglAYQQnOuSTAiMTAQGgpDlSzNUlSmyLLe0fl1/6BUmzx6exNIl6RLwV7kygUomzB\t\tYA8G+LuQD9kyoxRrqxf9HFvQtIVMmUMPeqDuevWZUNgDJ917n3kaLDfRhZmUmGE2dRo6g6HLr6bmtQY+5u78kr7ycZ3fCmlzGdUj\t\t01yTyZ6MOb0q6dLYyzmObYE29VFp3Ykjk56HXZU0p2rrDE/m6xJda0c1v+yjTLeIgyCYveujHb0+MfCLBQxOsPHi1dNh40F2HRVm\t\tvMz4AW1IbQZyrrF8637S+wT7QhVovKGedMD0U8Xwau3mzYsyM/XpUmhDaZVKHrus5DEVUmu8+/8/T4LpbmGpFjxelvb6zLSjRFhl\t\tZUhTGu86GqzSYJwL6Dz3Lm21ZnWgEkxMfYbdP8QT0ydMWluoorjRrlnAtKdQCKTAC8cAXKymsvn1p752Desry0/h+D+ZnWyNCVtX\t\t3XG7yDQdbU3F52+nEIDaDq1bfj5c/efei1z060JSdUnS86snluxH+jRjkIqMYAmIZNkXNPejpc/dOmxgLo6PpeVLDQqkiRoRnjBM\t\tTbTwEoyl+Dtbgw25i0U+PNJQce5SSbx0SPOpB1ziVJcvdp/xyYZVEW56YaftJ0K+Woc/4cEz3qXqSUg8DVpwEAGXq/HJv53v0Wd7\t\tfvZVNXp/PbjAQ14l4HBhkAt4/+2bS/rabtR/GJlt6+gYZmV3tnb3XT92jQhBBPvyYEMGKJCcBsVijTo1lg92rarHGqLkRQ46NpD/\t\tHZ4/d0+6NBX3jaYzhOt3f4FDSs8XXXg+fuetdgNOiQzdtwe2Rwe7nj/+NJlqJXHqM+KcsKAOLz+VQ19uOnbiEwht4gMGSZGJJp4S\t\t0jfSalAeJwOOx2uyzLYfTjCAU4Ljn5C1w5SWBHSm1MAAAAAElFTkSuQmCC",car:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAIAAAC0Ujn1AAAABmJLR0QAAAAzAJlWvctWAAAACXBIWX\t\tMAAA7EAAAOxAGVKw4bAAAAB3RJTUUH5AEICh4hLGpYPAAAAlZJREFUSMfdlk1oE0EUx/+zszEx3UhD0zZYkn5ksfWjlVgrVk1RQV\t\tR6EMFaK9qjggdBRO1NvSiIB8/iyQ/akxepSKteRPxoETXamkQtJAbbBN0ky0boZne8FIu23exqKuhjDgMz78ef/3u8GRIOh/1+P8\t\tdxKF1ompZIJEgmkylo/KPHMTBL6QQzCXM2hGxpF222Ak8pffkqvff88xKqHrqE9g0BDrAo10wwAOCwaPFvovmFDo6Gak4f3+x0gj\t\tHoOjQNTIfOoOvQ9dn93aF3p268tobu3R9sqC+XJACgdGbxPCgFIbPXHPYWa+gKWtbS7M3nIe669VVTfjm1aRUC53AtwYObHXW1rr\t\tZK90haMuv1mZ4VgsBFYlNzuQBU+kUiybiajMYmeR69e0QLZdwW8gMYGU0ZF+rp6GcArcHlZg3Z5K1avaqKMUwkpGNbawzQ2VxB09\t\tDU6Gl0lUVkpQj6xA7xwtntdjsjBBfPdZhpMnc5fXL7wO5DA8+mFCND1gddDgcA8nFCVtUi0OlpRKKyrsPtphuby015PTYuB7r67w\t\t3HjdH3H8abDva/eStZKGOt33n9ZNu6tZXG6NagZ6AvVF+3zEJfCwI93BMs6nJ1tbN730rTM+R3JyxjxVQfuRztu5IaG+4UBORyWL\t\tNz0AD34k6nx4NCAYHQ4Cc1XQStMEVRlR8SEmrSjOT4fNf++lBNpfR8npNlzThZlmG3Y6H2nx8tdl8zo6uh6+p/94AtMppypLRQSn\t\tkAJJvN2mxL33+YZOynR+9PQgx4VfUbCYfDPp+PUlry7+R3HyvZuSYHFFYAAAAASUVORK5CYII=",train:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAIAAAC0Ujn1AAAABmJLR0QAAAAzAJlWvctWAAAACXBIWX\t\tMAAA7EAAAOxAGVKw4bAAAAB3RJTUUH5AEICiI23EqkBAAABQpJREFUSMetVm1QVFUYfs+55+4u+zEsshK0iuy6iuAHbaSwJhkZNp\t\tWjaWn2oQ2Zk1lmpjMllmNqDYZjM+Y0TdkIg8WYHwU6KjqUIzl8KGhihcgCu8Auu3uBXXfZT+89/cBAYFex8f1173nOfea973ne5z\t\t2oqrouNUWHMYb7CUqBAkWAEAqD8jxvMplRd08vpWzlhRtA74scwe0PRjwgNMegIyRERCypq3cs/qwWHlyc+RIyZ2oxAASCXniwQQ\t\tEAMAB4ff6wG6Yr4YMcVaoi+D/IEUIEAFhCwsL5G6elTEnc8A6RSgnP05vuQOP1juXbrnjpqM4cA4BIxIbFnv/0mnbpyQlLyo6VXU\t\tEIHfn1kiYpLjlmtIkTACAMGwleZZAumK8bo5SFQoGxseyhXxqezkyYYnFVXPPYb5F7UyMU/gfzX43f+P5z5L9yvZWrHoACgUDlhb\t\t9e23LRHkJ3o4Zw6LIZUevW5HCcc++354/+Zp6YIDPoVZN1YxPiY5TRoujo6NSUpIL3uNw9RgExkalHhAwLX3ySTQizeUd5YU0fgL\t\tTJSE8ZHQCOYTvTov1/3pRFpKZ0eCMeLzBoNeofiioKa/p2r4yfnjpeLGb9gWCfx2/nvOZOd7vFIxETsZg0Gb2Tgu4bfkWErKlwxz\t\tt/umD2E3OmHSg+t3Zfc+m2tIULDHc/LquVe2TJ0ZFFx/367n/JfAguFz2TMVOXv+dETb2t6cjCe/ICQEKC6utNqeF1jQADwJsGeW\t\tnh0lDo1surD6VNjdtX8GJS0sOjlPCz8/UaqRAx68na2IMl52+6AysWa2ama1mWHX1bKxTyzbmTwioEAYBCRlSxyrlZ08tOVAGAz+\t\tezO1wWa4+5vcfY2t3U6q66xjl9vEpGdGq5LmmMNIpixDMYE4IZBndYXBHF12J2tpgFrudsZY3l8311tZxoRHJSALB74O/rPFwfrk\t\tI5+BlgeRjUOBlQXnl1t8kVctNeAAAQ3a/VeUCiZjydvHyQemAEbV2rX7QgzcE5u2xOk7nncoOl+LTN5B/SafvXaV56YZYgCEU/VW\t\t840N6/uH6efOVyvcXqXLOjFvjhBaEA8H1Jg9frmZ2p06fp0vV4ySLY+lGoo8PeZHRUXzR9d9xiCTJFx0xPZiXHKOUK2aDt3DD7lU\t\tolBUSGDkrkdrsv1TuyPzw7sDRvAlm1LPFR/WTdRDXDMAN+1GnhzO2cg+tze0L9Zi+RiAiDCRNSKhVJibElR+q2HOoCgDO7MgwZE8\t\tN4SIXplre4dT3GbSabIPCPpSePVcWIxWKtRq3VqCPVus1k3f6z5baaB3U9wvqquujyXc2m9t6sOTNaWjr3Hyj/p7E1GIw4ybju3m\t\t27KgJDp8/d7Pztb9r+qLXtyMuZmqotOXzhqdxTr2SrtBOUcSoFYXiEkVgkkkhoe4fr3b3GPgGPylQHoviS7+Sy0oPb01e9Me/xTN\t\t3HO899dcbZD2XEwabVU+dm6bPnRs3OnFJxrjG/sPlORTF5eXkWq7eo3BiJ3SegHyusgt0cJcGJCezvF7kgMADQ2QeHKx2nTzTIWb\t\tfb7ZPLRbNSotoabbYAWZEzbvy4MQQAGIzu2RE7Szko5QAAYIi31HP09d1NdyxIAIBhCAAgl8vFslHNxi5KASGgdPhkGHmto/T2Fk\t\toppVSgFCggBBhjQMBgPEkXHwr50NWrDYmJ4zFmYMilDwECBEBppBsM9KcSNniebzOZ/gWOPRAUHy2iQwAAAABJRU5ErkJggg==",line:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAIAAAC0Ujn1AAAABmJLR0QAAAAzAJlWvctWAAAACXBIWX\t\tMAAA7EAAAOxAGVKw4bAAAAB3RJTUUH5AEICiINbUFNIAAAAfZJREFUSMdjvHz5spycHBMTEwP1wN+/fx8/fsz44cOHP39ZDh+9zf\t\tCfJO2MDFANGAxGRhtLFVbWPyzMzMwXLr4ObDxFRVfv6mKwNFNmYmAg0bnEgP8MDAwMZAZxoqXgomJd/GrIMdpCkq270SMi1Iz6Rs\t\t9sdxIW4l2x+hSVjV5UrKunI3fpyqO43svUNDrfVSwi1Oztu8/plfsIKmYiKYhrS50ZGBiau/eeeP6LmkbDg3ji7lfEqGeiehCTZj\t\tRJQYzTaMb/bBQGMU6j/zOia57f60ZSEBMbIBsbTTXUpI6dvE18EMMBCx65mgBpT3e9Fy8/FLccxZUcE4OUv//4XTD3DglGW0iyle\t\tY7MTAwVLXsRgtiiIl21srKSuKsLMyPn7wlzej5vW58vJyz5h+ef/w9VhN///l7997LQ0fvzl93l4QAgQdx+tTrAVrcUQFqxoZysr\t\tIiaCbiTzAsuIL40+fvb958ubvaX0lRnIGB4fv3X9dvPD1x+iFBE3EaDQliVhZmVl5OP2/D799/nTl3/+jJ+1hDkzSjixK1+Xg5v3\t\t//dfX6U/JMxGl03/yrl669atnwlPIKEt3oE89/naCGueRXu4PAaGYmRuoayszMwsDAwPjx40dWVs47d1/8/8/ASCUrVJQlfv/+zn\t\tj58mVZWVlmZmaqNycB+D3rTYmxQpEAAAAASUVORK5CYII=",circle:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAIAAAC0Ujn1AAAABmJLR0QAAAAzAJlWvctWAAAACXBIWX\t\tMAAA7EAAAOxAGVKw4bAAAAB3RJTUUH5AEICiEaxb+bJAAAAqNJREFUSMdjvHz5spycHBMTEwP1wN+/fx8/fsz44cOHP39ZDh+9zf\t\tCfJO2MDFANGAxGRhtLFVbWPyzMzMwXLr4ObDxFRVfv6mKwNFNmYmAg0bnEgP8MDAwMTAw0Ayz4pS0k2RKDlO2slUVFeIWFeBkYGN\t\t6++/z6zedDR+/OX3f3xPNfZBo9M1szIsTk48dvBw7fOnvp5cTdrxgYGPJdxYz1xD1dtWIjzBevOJk+9TrJRu/vszUyVJg6+1DVso\t\tfI4hN3v2LY/Yqh93JNgHRpvpOOloR19n6sJjDhMldZSSw+ex2aucigZcNT96iVstJCR6c6Emv0zGxNI0OFvKodG659xR8TJ57/Cs\t\tvcrKMlMzNbk7DRFpJssRHm3RP3ETQXbnr3xH2xEeYWkmwEjE4MUn7z9nPLhqfEJ7KWDU/fvP2cFaVOwGg7a+UDh2+RmoS3775mai\t\txPwGhREd6zl16SavSJcy+kJAUJGC0sxAtJvySB+cff8/FyEpX4qALQjf70+Xu+qxippiRaCn76/J2A0c+evzfWEyfVaAsjiWfP3x\t\tMw+vTZhw62aqQabWetfPrsQwJGT1t2U0SYty1KnnhzawKk5WVFpi27ScDoE89/LV5xMjvVDjN34Sp1S/OdFq84iVnAYkkh6VOvX7\t\tn2ZNV0X4KmW0iyrZrue+XaE6xFK/bEZ529//HTdzuXhdcESOMJh53Lwh8/fYerUMVZXltn75+ZrVlV7JoY/X7PgVsnzr2Yf/w9JJ\t\t1ZGEm4OKhJSgiSWRVAQmb+urtZUep21soRISbzeDkhCf/Z8/dHT9ybtuwm+RUYJFZP9F5mYLhMhdxI5YzOzMRIXUOZmVkYGBgYP3\t\t78yMrKeefui///GRipZIWKssTv398ZL1++LCsry8zMTPXmJADJwQv2CCSQygAAAABJRU5ErkJggg=="};function Za(e){le.routing.transitMode=e;let t=document.querySelector(".TravelNotes-ProvidersToolbarUI-ActiveTransitModeImgButton");t&&t.classList.remove("TravelNotes-ProvidersToolbarUI-ActiveTransitModeImgButton"),document.getElementById("TravelNotes-ProvidersToolbarUI-"+e+"ImgButton").classList.add("TravelNotes-ProvidersToolbarUI-ActiveTransitModeImgButton")}function Xa(e){e.stopPropagation(),Za(e.target.transitMode),yo.startRouting()}function Ga(e){le.routing.provider=e;let t=document.querySelector(".TravelNotes-ProvidersToolbarUI-ActiveProviderImgButton");t&&t.classList.remove("TravelNotes-ProvidersToolbarUI-ActiveProviderImgButton"),document.getElementById("TravelNotes-ProvidersToolbarUI-"+e+"ImgButton").classList.add("TravelNotes-ProvidersToolbarUI-ActiveProviderImgButton");let o=le.providers.get(e.toLowerCase());if(Fa.forEach(e=>{o.transitModes[e]?Wa[e].classList.remove("TravelNotes-ProvidersToolbarUI-InactiveImgButton"):Wa[e].classList.add("TravelNotes-ProvidersToolbarUI-InactiveImgButton")}),!o.transitModes[le.routing.transitMode]){let e=null;Fa.forEach(t=>{o.transitModes[t]&&(e=e||t)}),Za(e)}}function qa(e){e.stopPropagation(),Ga(e.target.provider),yo.startRouting()}function Ya(e){if(0===e.providerKey)return;let t=b.create("img",{src:e.icon,id:"TravelNotes-ProvidersToolbarUI-"+e.name+"ImgButton",className:"TravelNotes-ProvidersToolbarUI-ImgButton",title:e.name,provider:e.name},za);if(t.addEventListener("click",qa,!1),!Va){t.classList.add("TravelNotes-ProvidersToolbarUI-ActiveProviderImgButton"),le.routing.provider=t.provider,Va=!0;let o=null;Fa.forEach(t=>{e.transitModes[t]&&(o=o||t)}),Wa[o].classList.add("TravelNotes-ProvidersToolbarUI-ActiveTransitModeImgButton"),le.routing.transitMode=o,Fa.forEach(t=>{e.transitModes[t]||Wa[t].classList.add("TravelNotes-ProvidersToolbarUI-InactiveImgButton")})}}const Qa=Object.freeze(new class{createUI(e){Ka=e,za=b.create("div",{className:"TravelNotes-UI-FlexRowDiv TravelNotes-ProvidersToolbarUI-ImgButtonsDiv"},e),Fa.forEach(e=>{Wa[e]=b.create("img",{src:Ja[e],id:"TravelNotes-ProvidersToolbarUI-"+e+"ImgButton",className:"TravelNotes-ProvidersToolbarUI-ImgButton",title:A.getText("ProvidersToolbarUI - "+e),transitMode:e},za),Wa[e].addEventListener("click",Xa,!1)}),le.providers&&(Va=!1,le.providers.forEach(Ya))}set provider(e){Ga(e)}set transitMode(e){Za(e)}providersAdded(){Ka.removeChild(za),this.createUI(Ka)}});let _a="geolocation"in navigator?t.inactive:t.disabled,$a=null;function en(e){Te.dispatch("geolocationpositionchanged",{position:e})}function tn(){t.active===_a&&(_a=t.inactive),Te.dispatch("geolocationstatuschanged",{status:_a}),navigator.geolocation.clearWatch($a),$a=null}function on(e){1===e.code&&(_a=t.refusedByUser),tn()}const an=Object.seal(new class{get status(){return _a}switch(){switch(_a){case t.inactive:_a=t.active,Te.dispatch("geolocationstatuschanged",{status:_a}),navigator.geolocation.getCurrentPosition(en,on,f.geoLocation.options),$a=navigator.geolocation.watchPosition(en,on,f.geoLocation.options);break;case t.active:tn()}return _a}});let nn=null,rn=null,ln=null,sn=null,dn=!1;function cn(){rn&&(clearTimeout(rn),rn=null),sn.classList.remove("TravelNotes-UI-MainDiv-Minimize"),sn.classList.add("TravelNotes-UI-MainDiv-Maximize")}function un(){sn.classList.remove("TravelNotes-UI-MainDiv-Maximize"),sn.classList.add("TravelNotes-UI-MainDiv-Minimize")}function gn(){rn=setTimeout(un,f.travelEditor.timeout)}function vn(e){e.stopPropagation(),Pe.setKeysFromDialog()}function hn(e){e.stopPropagation(),an.switch()}function pn(e){dn?(e.target.textContent="📌",sn.addEventListener("mouseenter",cn,!1),sn.addEventListener("mouseleave",gn,!1)):(e.target.textContent="❌",sn.removeEventListener("mouseenter",cn,!1),sn.removeEventListener("mouseleave",gn,!1)),dn=!dn}const mn=Object.freeze(new class{createUI(e){sn=e,ln=b.create("div",{className:"TravelNotes-UI-FlexRowDiv"},e),b.create("text",{value:"🏠"},b.create("a",{className:"TravelNotes-UI-LinkButton",href:window.location.origin,target:"_blank"},b.create("div",{className:"TravelNotes-UI-Button",title:"Home"},ln))),b.create("text",{value:"?"},b.create("a",{className:"TravelNotes-UI-LinkButton",href:"https://github.com/wwwouaiebe/leaflet.TravelNotes/tree/gh-pages/TravelNotesGuides",target:"_blank"},b.create("div",{className:"TravelNotes-UI-Button",title:"Help"},ln))),b.create("text",{value:"@"},b.create("a",{className:"TravelNotes-UI-LinkButton",href:f.travelNotesToolbarUI.contactMail.url||window.location.origin,target:"_blank"},b.create("div",{className:"TravelNotes-UI-Button",title:"Contact"},ln))),f.APIKeys.showDialogButton&&b.create("div",{className:"TravelNotes-UI-Button",title:A.getText("TravelNotesToolbarUI - API keys"),textContent:"🔑"},ln).addEventListener("click",vn,!1),t.disabled<an.status&&(nn=b.create("div",{className:"TravelNotes-UI-Button",title:A.getText("TravelNotesToolbarUI - Geo location"),textContent:"🌐"},ln),nn.addEventListener("click",hn,!1)),function(){let e=b.create("div",{textContent:"❌",className:"TravelNotes-UI-Button TravelNotes-UI-FlexRow-RightButton"},ln);e.addEventListener("click",pn,!1),f.travelEditor.startMinimized?(e.textContent="📌",sn.addEventListener("mouseenter",cn,!1),sn.addEventListener("mouseleave",gn,!1),sn.classList.add("TravelNotes-UI-MainDiv-Minimize")):(sn.classList.add("TravelNotes-UI-MainDiv-Maximize"),dn=!0)}()}geoLocationStatusChanged(e){switch(e){case t.inactive:nn.classList.remove("TravelNotes-TravelNotesToolbarUI-GeoLocationButton-Striked");break;case t.active:nn.classList.add("TravelNotes-TravelNotesToolbarUI-GeoLocationButton-Striked");break;default:nn&&(nn.parentNode.removeChild(nn),nn=null)}}});function fn(){let e=f.itineraryPane.showNotes,t=f.itineraryPane.showManeuvers,a=null,r=null,i=null,l=null,s=null,d=null;function c(e){e.stopPropagation(),e.preventDefault();let t=e.target;for(;!t.latLng;)t=t.parentNode;e.latlng={lat:n.defaultValue,lng:n.defaultValue},e.fromUI=!0,e.originalEvent={clientX:e.clientX,clientY:e.clientY,latLng:t.latLng},t.maneuverObjId?(e.maneuverObjId=t.maneuverObjId,function(e,t){let o=e.maneuverObjId,a=ke(),n=tt(e,[{context:a,name:A.getText("ManeuverContextMenu - Zoom to this maneuver"),action:a.zoomToManeuver,param:o}],t);return Object.seal(n)}(e,a.parentNode).show()):t.noteObjId&&(e.noteObjId=t.noteObjId,xo(e,a.parentNode).show())}function u(e){e.stopPropagation(),Te.dispatch("additinerarypointmarker",{objId:e.target.objId,latLng:e.target.latLng})}function g(e){e.stopPropagation(),Te.dispatch("removeobject",{objId:e.target.objId})}function v(t){e=t.target.checked,document.querySelectorAll(".TravelNotes-UI-Route-Notes-Row").forEach(e=>{e.classList.toggle("TravelNotes-UI-Route-Notes-Row-Hidden")})}function h(e){t=e.target.checked,document.querySelectorAll(".TravelNotes-UI-Route-Maneuvers-Row").forEach(e=>{e.classList.toggle("TravelNotes-UI-Route-Maneuvers-Row-Hidden")})}return Object.freeze(new class{remove(){!function(){document.querySelectorAll(".TravelNotes-UI-Route-Notes-Row, .TravelNotes-UI-Route-Maneuvers-Row").forEach(e=>{e.removeEventListener("contextmenu",c,!1),e.removeEventListener("mouseenter",u,!1),e.removeEventListener("mouseleave",g,!1)});let e=document.querySelector(".TravelNotes-UI-Route-ManeuversAndNotes");e&&a.removeChild(e)}(),i&&(d&&(d.removeEventListener("click",h,!1),i.removeChild(d),d=null),s&&(s.removeEventListener("click",v,!1),i.removeChild(s),s=null),r.removeChild(i),i=null),l&&(r.removeChild(l),l=null)}add(){-1!==le.editedRouteObjId&&(i=b.create("div",null,r),b.create("text",{value:A.getText("ItineraryPaneUI - Show notes")},i),s=b.create("input",{type:"checkbox",id:"TravelNotes-ItineraryPane-ShowNotesInput",checked:e},i),s.addEventListener("click",v,!1),b.create("text",{value:A.getText("ItineraryPaneUI - Show maneuvers")},i),d=b.create("input",{type:"checkbox",id:"TravelNotes-ItineraryPane-ShowManeuversInput",checked:t},i),d.addEventListener("click",h,!1),l=jt.getRouteHeaderHTML("TravelNotes-UI-",le.travel.editedRoute),r.appendChild(l),a.appendChild(jt.getEditedRouteManeuversAndNotesHTML("TravelNotes-UI-")),document.querySelectorAll(".TravelNotes-UI-Route-Notes-Row, .TravelNotes-UI-Route-Maneuvers-Row").forEach(e=>{e.addEventListener("contextmenu",c,!1),e.addEventListener("mouseenter",u,!1),e.addEventListener("mouseleave",g,!1)}),e||document.querySelectorAll(".TravelNotes-UI-Route-Notes-Row").forEach(e=>{e.classList.toggle("TravelNotes-UI-Route-Notes-Row-Hidden")}),t||document.querySelectorAll(".TravelNotes-UI-Route-Maneuvers-Row").forEach(e=>{e.classList.toggle("TravelNotes-UI-Route-Maneuvers-Row-Hidden")}))}getId(){return o.itineraryPane}getButtonText(){return A.getText("PanesManagerUI - Itinerary")}setPaneDivs(e,t){a=e,r=t}})}let bn=-1,yn=-1,Nn=!1;let Tn=null,wn=null,xn=null,In=[];class Ln{constructor(e,t){this.name=p.sanitizeToJsString(e),this.items=[],this.filterTagsArray=[],this.elementTypes=["node","way","relation"],this.isSelected=!1,this.isExpanded=!1,this.isRoot=!1,t&&(this.isExpanded=!0,this.isRoot=!0)}}function An(){-1===yn?yn=T():Te.dispatch("removeobject",{objId:yn});let e=le.map.getCenter();wn=le.map.getBounds();let t=Ue.getSquareBoundingBox([e.lat,e.lng],5e3);wn.getSouthWest().lat=Math.max(wn.getSouthWest().lat,t.getSouthWest().lat),wn.getSouthWest().lng=Math.max(wn.getSouthWest().lng,t.getSouthWest().lng),wn.getNorthEast().lat=Math.min(wn.getNorthEast().lat,t.getNorthEast().lat),wn.getNorthEast().lng=Math.min(wn.getNorthEast().lng,t.getNorthEast().lng),Te.dispatch("addrectangle",{objId:yn,bounds:wn,properties:f.nextSearchLimit})}function En(e){e.isSelected&&0<e.filterTagsArray.length&&(In=In.concat(e)),e.items.forEach(En)}function jn(e,t){In.forEach(o=>{o.filterTagsArray.forEach(a=>{(function(e,t){let o=!0;for(const[a,n]of Object.entries(t))o=o&&e.tags[a]&&(e.tags[a]===n||"*"===n);return o})(e,a)&&(e.description=o.name,t.set(e.id,e))})})}function Pn(e){let t=new Map,o=new Map,a=new Map,r=new Map;function i(e){e.geometry=[[]],e.lat=n.defaultValue,e.lon=n.defaultValue;let t=0;e.nodes.forEach(a=>{let n=o.get(a);e.geometry[0].push([n.lat,n.lon]),e.lat+=n.lat,e.lon+=n.lon,t++}),0!==t&&(e.lat/=t,e.lon/=t)}e.forEach(e=>{switch(e.type){case"node":o.set(e.id,e);break;case"way":a.set(e.id,e);break;case"relation":r.set(e.id,e)}e.tags&&jn(e,t)}),t.forEach(e=>{switch(e.type){case"way":i(e);break;case"relation":!function(e){e.geometry=[[]],e.lat=n.defaultValue,e.lon=n.defaultValue;let t=0;e.members.forEach(o=>{if("way"===o.type){let n=a.get(o.ref);i(n),e.geometry.push(n.geometry[0]),e.lat+=n.lat,e.lon+=n.lon,t++}}),0!==t&&(e.lat/=t,e.lon/=t)}(e)}}),le.searchData=Array.from(t.values()).sort((e,t)=>e.description>t.description?1:e.description<t.description?-1:0),Nn=!1,Te.dispatch("showsearch")}function Dn(e){let t=[];e.forEach(e=>{"fulfilled"===e.status?t=t.concat(e.value.elements):console.log(e.reason)}),Pn(t)}const Cn=Object.seal(new class{get dictionary(){return xn}search(){Nn||(Nn=!0,In=[],En(xn),Promise.allSettled(function(){let e=[];Tn=wn;let t={node:new Map,way:new Map,relation:new Map};In.forEach(e=>{e.elementTypes.forEach(o=>{e.filterTagsArray.forEach(e=>{t[o].set(e,e)})})});let o={node:"",way:"",relation:""},a="("+wn.getSouthWest().lat.toFixed(n.fixed)+","+wn.getSouthWest().lng.toFixed(n.fixed)+","+wn.getNorthEast().lat.toFixed(n.fixed)+","+wn.getNorthEast().lng.toFixed(n.fixed)+")";for(const[e,n]of Object.entries(t))n.forEach(t=>{let[n,r]=Object.entries(t)[0];o[e]+=e+"["+n+("*"===r?"":"="+r)+"]"+a+";"});for(const[t,a]of Object.entries(o))if(""!==a){let o=f.overpassApi.url+"?data=[out:json][timeout:40];("+a+");"+("node"===t?"":"(._;>;);")+"out;";e.push(y.getJsonPromise(o))}return e}()).then(Dn))}show(){le.map.on("zoom",An),le.map.on("move",An),An(),Tn&&(-1===bn?bn=T():Te.dispatch("removeobject",{objId:bn}),Te.dispatch("addrectangle",{objId:bn,bounds:[[Tn.getSouthWest().lat,Tn.getSouthWest().lng],[Tn.getNorthEast().lat,Tn.getNorthEast().lng]],properties:f.previousSearchLimit}))}hide(){let e=Te;le.map.off("zoom",An),le.map.off("move",An),-1!==yn&&(e.dispatch("removeobject",{objId:yn}),yn=-1),-1!==bn&&(e.dispatch("removeobject",{objId:bn}),bn=-1)}parseDictionary(e){xn=new Ln("All",!0);let t=[xn.items],o=null,a=null;e.split(/\r\n|\r|\n/).forEach(e=>{""!==e&&function(e){let n=e.split(";");for(;""===n[n.length-1];)n.pop();let r=0,i=null;n.forEach(e=>{if(""!==e)if(-1===e.indexOf("="))a=new Ln(e),t[r].push(a),t[r+1]=a.items,o=a.filterTagsArray;else{let t=e.split("=");"element"===t[0]?a.elementTypes=[t[1]]:(i=i||{},i[t[0]]=t[1])}r++}),i&&o.push(i)}(e)})}});function Rn(){let e=null,t=null,a=null,r=null,i=null,l=-1,d=0;function c(t){t.stopPropagation(),t.preventDefault();let o=t.target;for(;!o.osmElement;)o=o.parentNode;t.latlng={lat:n.defaultValue,lng:n.defaultValue},t.fromUI=!0,t.originalEvent={clientX:t.clientX,clientY:t.clientY,latLng:[o.osmElement.lat,o.osmElement.lon],osmElement:o.osmElement,geometry:o.osmElement.geometry},function(e,t){let o=ke(),a=tt(e,function(){let t=e.originalEvent.latLng;return[{context:To,name:A.getText("MapContextMenu - Select this point as start point"),action:-1!==le.editedRouteObjId&&n.defaultValue===le.travel.editedRoute.wayPoints.first.lat?To.setStartPoint:null,param:t},{context:To,name:A.getText("MapContextMenu - Select this point as way point"),action:-1===le.editedRouteObjId?null:To.addWayPoint,param:t},{context:To,name:A.getText("MapContextMenu - Select this point as end point"),action:-1!==le.editedRouteObjId&&n.defaultValue===le.travel.editedRoute.wayPoints.last.lat?To.setEndPoint:null,param:t},{context:Ht,name:A.getText("OsmSearchContextMenu - Create a route note with this result"),action:Ht.newSearchNote,param:{osmElement:e.originalEvent.osmElement,isTravelNote:!1}},{context:Ht,name:A.getText("OsmSearchContextMenu - Create a travel note with this result"),action:Ht.newSearchNote,param:{osmElement:e.originalEvent.osmElement,isTravelNote:!0}},{context:Ht,name:Ht.osmSearchNoteDialog?A.getText("OsmSearchContextMenu - Hide note dialog"):A.getText("OsmSearchContextMenu - Show note dialog"),action:Ht.changeOsmSearchNoteDialog},{context:o,name:A.getText("OsmSearchContextMenu - Zoom to this result"),action:o.zoomToPoi,param:{latLng:e.originalEvent.latLng,geometry:e.originalEvent.geometry}}]}(),t);return Object.seal(a)}(t,e).show()}function u(e){e.stopPropagation(),l=e.target.objId,Te.dispatch("addsearchpointmarker",{objId:e.target.objId,latLng:[e.target.osmElement.lat,e.target.osmElement.lon],geometry:e.target.osmElement.geometry})}function g(e){e.stopPropagation(),Te.dispatch("removeobject",{objId:e.target.objId})}function v(){document.querySelectorAll(".TravelNotes-OsmSearchPaneUI-SearchResult").forEach(t=>{t.removeEventListener("contextmenu",c,!1),t.removeEventListener("mouseenter",u,!1),t.removeEventListener("mouseleave",g,!1),e.removeChild(t)})}function h(e){d++;let t=b.create("div",{className:"TravelNotes-SearchPaneUI-SearchItem TravelNotes-SearchPaneUI-SearchItemMargin"+d,dictItem:e},i);if(!e.isRoot){b.create("input",{type:"checkbox",checked:e.isSelected},t).addEventListener("change",(function(e){!function e(t,o){t.isSelected=o,t.items.forEach(t=>{e(t,o)})}(e.target.parentNode.dictItem,e.target.checked),i.textContent="",h(Cn.dictionary)}),!1)}if(0===e.filterTagsArray.length){b.create("div",{className:"TravelNotes-UI-Button TravelNotes-OsmSearchPaneUI-TreeArrow",textContent:e.isExpanded?"▼":"▶"},t).addEventListener("click",(function(e){e.target.parentNode.dictItem.isExpanded=!e.target.parentNode.dictItem.isExpanded,i.textContent="",h(Cn.dictionary)}),!1)}b.create("text",{value:e.name},t),e.isExpanded&&e.items.forEach(h),d--}function m(){v(),Cn.dictionary.isExpanded=!1,i.textContent="",h(Cn.dictionary),r=b.create("div",{className:"TravelNotes-WaitAnimation"},t),b.create("div",{className:"TravelNotes-WaitAnimationBullet"},r),Cn.search()}function f(e){e.items.forEach(f),e.isSelected=!1}function y(){f(Cn.dictionary),i.textContent="",h(Cn.dictionary)}function N(e){e.items.forEach(N),e.isExpanded=!0}function w(){N(Cn.dictionary),i.textContent="",h(Cn.dictionary)}function x(e){e.items.forEach(x),e.isRoot||(e.isExpanded=!1)}function I(){x(Cn.dictionary),i.textContent="",h(Cn.dictionary)}function L(e){e.deltaY&&(e.target.scrollTop+=e.deltaY*s[e.deltaMode]),e.stopPropagation()}function E(e,t){t&&b.create("div",{textContent:t},e)}function j(t){let o=b.create("div",{className:"TravelNotes-OsmSearchPaneUI-SearchResult-Row",osmElement:t,objId:T()},e),a="";a=t.tags.rcn_ref?"<div class='TravelNotes-MapNote TravelNotes-MapNoteCategory-0073'><svg viewBox='0 0 20 20'><text class='' x=10 y=14>"+t.tags.rcn_ref+"</text></svg></div>":ft.getIconDataFromName(t.description)||"";let n=b.create("div",{className:"TravelNotes-OsmSearchPaneUI-SearchResult-IconCell"},o);p.sanitizeToHtmlElement(a,n);let r=b.create("div",{className:"TravelNotes-OsmSearchPaneUI-SearchResult-Cell"},o);E(r,t.description),E(r,t.tags.name),E(r,t.tags.rcn_ref),E(r,function(e){let t=(e.tags["addr:street"]?(e.tags["addr:housenumber"]?e.tags["addr:housenumber"]+" ":"")+e.tags["addr:street"]+" ":"")+(e.tags["addr:city"]?(e.tags["addr:postcode"]?e.tags["addr:postcode"]+" ":"")+e.tags["addr:city"]:"");return""===t?null:t}(t)),t.tags.phone&&E(r,"☎️ : "+t.tags.phone),t.tags.email&&b.create("a",{href:"mailto:"+t.tags.email,textContent:t.tags.email},b.create("div",{textContent:"📧 : "},r)),t.tags.website&&b.create("a",{href:t.tags.website,target:"_blank",textContent:t.tags.website},b.create("div",null,r)),o.title="";for(const[e,a]of Object.entries(t.tags))o.title+=e+"="+a+"\n";o.addEventListener("contextmenu",c,!1),o.addEventListener("mouseenter",u,!1),o.addEventListener("mouseleave",g,!1)}return Object.freeze(new class{remove(){Cn.hide(),v(),i&&(t.removeChild(i),i=null),a&&t.removeChild(a),r&&(t.removeChild(r),r=null),Te.dispatch("removeobject",{objId:l})}add(){Cn.show(),a=b.create("div",null,t),b.create("div",{className:"TravelNotes-UI-Button",title:A.getText("OsmSearchPaneUI - Search OpenStreetMap"),textContent:"🔎"},a).addEventListener("click",m,!1),b.create("div",{className:"TravelNotes-UI-Button",title:A.getText("OsmSearchPaneUI - Expand tree"),textContent:"▼"},a).addEventListener("click",w,!1),b.create("div",{className:"TravelNotes-UI-Button",title:A.getText("OsmSearchPaneUI - Collapse tree"),textContent:"▶"},a).addEventListener("click",I,!1),b.create("div",{id:"TravelNotes-OsmSearchPaneUI-ClearAllButton",className:"TravelNotes-UI-Button",title:A.getText("OsmSearchPaneUI - Clear tree"),textContent:"❌"},a).addEventListener("click",y,!1),i=b.create("div",{id:"TravelNotes-OsmSearchPaneUI-SearchTree"},t),i.addEventListener("wheel",L,!1),Cn.dictionary.name="",h(Cn.dictionary),le.searchData.forEach(j)}getId(){return o.searchPane}getButtonText(){return A.getText("PanesManagerUI - Search")}setPaneDivs(o,a){e=o,t=a}})}let Mn=null;const Sn=Object.freeze(new class{createUI(e){Mn||(Mn=b.create("div",{id:"TravelNotes-UI-MainDiv"},e),b.create("div",{id:"TravelNotes-UI-MainDiv-Title",textContent:"Travel & Notes"},Mn),mn.createUI(Mn),Ca.createUI(Mn),Ha.addPane(fn()),Ha.addPane(function(){let e=0,t=null,a=null;function r(t){t.stopPropagation();try{t.dataTransfer.setData("Text",t.target.dataObjId),t.dataTransfer.dropEffect="move"}catch(e){console.log(e)}e=t.target.noteObjId}function i(e){e.preventDefault()}function l(t){t.preventDefault();let o=t.target;for(;!o.noteObjId;)o=o.parentElement;let a=o.getBoundingClientRect();Ht.travelNoteDropped(e,o.noteObjId,t.clientY-a.top<a.bottom-t.clientY)}function s(e){e.stopPropagation(),e.preventDefault();let o=e.target;for(;!o.noteObjId;)o=o.parentNode;e.latlng={lat:n.defaultValue,lng:n.defaultValue},e.fromUI=!0,e.originalEvent={clientX:e.clientX,clientY:e.clientY,latLng:o.latLng},o.noteObjId&&(e.noteObjId=o.noteObjId,xo(e,t.parentNode).show())}return Object.freeze(new class{remove(){a&&(a.childNodes.forEach(e=>{e.removeEventListener("contextmenu",s,!1),e.removeEventListener("dragstart",r,!1)}),t.removeChild(a)),a=null}add(){a=jt.getTravelNotesHTML("TravelNotes-UI-"),a.addEventListener("drop",l,!1),a.addEventListener("dragover",i,!1),t.appendChild(a),a.childNodes.forEach(e=>{e.draggable=!0,e.addEventListener("contextmenu",s,!1),e.addEventListener("dragstart",r,!1),e.classList.add("TravelNotes-UI-MoveCursor")})}getId(){return o.travelNotesPane}getButtonText(){return A.getText("PanesManagerUI - Travel notes")}setPaneDivs(e){t=e}})}()),Ha.addPane(Rn()),Ha.createUI(Mn),Qa.createUI(Mn),Mn.addEventListener("travelnameupdated",()=>Ca.setTravelName(),!1),Mn.addEventListener("setrouteslist",()=>Ca.setRoutesList(),!1),Mn.addEventListener("showitinerary",()=>Ha.showPane(o.itineraryPane),!1),Mn.addEventListener("updateitinerary",()=>Ha.updatePane(o.itineraryPane),!1),Mn.addEventListener("showtravelnotes",()=>Ha.showPane(o.travelNotesPane),!1),Mn.addEventListener("updatetravelnotes",()=>Ha.updatePane(o.travelNotesPane),!1),Mn.addEventListener("showsearch",()=>Ha.showPane(o.searchPane),!1),Mn.addEventListener("updatesearch",()=>Ha.updatePane(o.searchPane),!1),Mn.addEventListener("providersadded",()=>Qa.providersAdded(),!1),Mn.addEventListener("setprovider",e=>{e.data&&e.data.provider&&(Qa.provider=e.data.provider)},!1),Mn.addEventListener("settransitmode",e=>{e.data&&e.data.provider&&(Qa.transitMode=e.data.transitMode)},!1),document.addEventListener("geolocationstatuschanged",e=>{mn.geoLocationStatusChanged(e.data.status)},!1),Mn.addEventListener("click",e=>{e.target.id&&"TravelNotes-UI-MainDiv"===e.target.id&&(e.stopPropagation(),e.preventDefault())},!1),Mn.addEventListener("dblclick",e=>{e.stopPropagation(),e.preventDefault()},!1),Mn.addEventListener("contextmenu",e=>{e.stopPropagation(),e.preventDefault()},!1),Mn.addEventListener("wheel",e=>{e.stopPropagation(),e.preventDefault()},!1))}});function On(){let e=se();e.title=A.getText("AboutDialog - About Travel & Notes");p.sanitizeToHtmlElement('<div id="TravelNotes-AboutDialog-AboutDiv"><p>This  program is free software; you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation; either version 3 of the License, or any later version.</p><p>Copyright - 2017 2021 - wwwouaiebe</p><p>Contact : <a href="https://www.ouaie.be/blog/pages/Contact" target="_blank">https://www.ouaie.be/</a></p><p>GitHub : <a href="https://github.com/wwwouaiebe/leaflet.TravelNotes" target="_blank">https://github.com/wwwouaiebe/leaflet.TravelNotes</a></p><p>Version : 2.1.0.<p>This program uses: <a href="https://leafletjs.com/" target="_blank">leaflet</a>, <a href="https://github.com/mapbox/polyline" target="_blank">mapbox/polyline</a>, <a href="https://github.com/Project-OSRM/osrm-text-instructions" target="_blank">Project-OSRM/osrm-text-instructions</a> and  <a href="https://github.com/drolbr/Overpass-API" target="_blank">the Overpass API</a></p></div>',e.content),e.show().then().catch(e=>console.log(e||"An error occurs in the dialog"))}let Un=null;const kn=Object.freeze(new class{getOpenPromise(){return new Promise((function(e,t){if(Un)return void e();let o=window.indexedDB.open("TravelNotesDb",1);o.onerror=function(){Un=null,t(new Error("Not possible to open the db"))},o.onsuccess=function(t){Un=t.target.result,e()},o.onupgradeneeded=function(e){Un=e.target.result,Un.createObjectStore("Travels",{keyPath:"UUID"})}}))}getReadPromise(e){return new Promise((function(t,o){if(!Un)return void o(new Error("Database not opened"));let a=Un.transaction(["Travels"],"readonly");a.onerror=function(){o(new Error("Transaction error"))},a.objectStore("Travels").get(e).onsuccess=function(e){t(e.target.result?e.target.result.data:null)}}))}getWritePromise(e,t){return new Promise((function(o,a){if(!Un)return void a(new Error("Database not opened"));let n=null;try{n=Un.transaction(["Travels"],"readwrite")}catch(e){return void a(e)}n.onerror=function(){a(new Error("Transaction error"))},n.objectStore("Travels").put({UUID:e,data:t}).onsuccess=function(){o()}}))}closeDb(e){if(!Un)return;if(!e)return Un.close(),void(Un=null);let t=Un.transaction(["Travels"],"readwrite");t.onerror=function(){};let o=t.objectStore("Travels").delete(e);o.onerror=function(){Un.close(),Un=null},o.onsuccess=function(){Un.close(),Un=null}}});let Bn=null,Hn=null,zn=null;function Vn(){Bn.textContent=Hn+" - Zoom : "+zn}function Fn(e){Hn=E.formatLat(e.latlng.lat)+" - "+E.formatLng(e.latlng.lng),Vn()}function Wn(){zn=le.map.getZoom(),Vn()}const Kn=Object.freeze(new class{createUI(){zn=le.map.getZoom();let e=le.map.getCenter();Hn=E.formatLat(e.lat)+" - "+E.formatLng(e.lng),Bn=b.create("span",null,b.create("div",{id:"TravelNotes-MouseUI"},document.querySelector("body"))),le.map.on("mousemove",Fn),le.map.on("zoomend",Wn)}});let Jn=!1;function Zn(){document.addEventListener("routeupdated",e=>{e.data&&_o.updateRoute(e.data.removedRouteObjId,e.data.addedRouteObjId)},!1),document.addEventListener("routepropertiesupdated",e=>{e.data&&_o.updateRouteProperties(e.data.routeObjId)},!1),document.addEventListener("noteupdated",e=>{e.data&&_o.updateNote(e.data.removedNoteObjId,e.data.addedNoteObjId)},!1),document.addEventListener("removeobject",e=>{e.data&&_o.removeObject(e.data.objId)},!1),document.addEventListener("removeallobjects",()=>_o.removeAllObjects(),!1),document.addEventListener("zoomto",e=>{e.data&&Do.zoomTo(e.data.latLng,e.data.geometry)},!1),document.addEventListener("additinerarypointmarker",e=>{e.data&&_o.addItineraryPointMarker(e.data.objId,e.data.latLng)},!1),document.addEventListener("addsearchpointmarker",e=>{e.data&&_o.addSearchPointMarker(e.data.objId,e.data.latLng,e.data.geometry)},!1),document.addEventListener("addrectangle",e=>{e.data&&_o.addRectangle(e.data.objId,e.data.bounds,e.data.properties)},!1),document.addEventListener("addwaypoint",e=>{e.data&&_o.addWayPoint(e.data.wayPoint,e.data.letter)},!1),document.addEventListener("layerchange",e=>{e.data&&_o.setLayer(e.data.layer)}),document.addEventListener("geolocationpositionchanged",e=>{e.data&&Do.onGeolocationPositionChanged(e.data.position)},!1),document.addEventListener("geolocationstatuschanged",e=>{e.data&&Do.onGeolocationStatusChanged(e.data.status)},!1),document.addEventListener("roadbookupdate",()=>{E.storageAvailable("localStorage")&&kn.getOpenPromise().then(()=>{kn.getWritePromise(le.UUID,jt.getTravelHTML("TravelNotes-Roadbook-").outerHTML)}).then(()=>localStorage.setItem(le.UUID,Date.now())).catch(e=>console.log(e||"An error occurs when writing the content"))},!1),document.addEventListener("profileclosed",e=>{e.data&&Wt.onProfileClosed(e.data.objId)},!1)}function Xn(e){le.travel.readOnly||function(e){let t=[e.latlng.lat,e.latlng.lng],o=ke(),a=tt(e,[{context:To,name:A.getText("MapContextMenu - Select this point as start point"),action:-1!==le.editedRouteObjId&&n.defaultValue===le.travel.editedRoute.wayPoints.first.lat?To.setStartPoint:null,param:t},{context:To,name:A.getText("MapContextMenu - Select this point as way point"),action:-1===le.editedRouteObjId?null:To.addWayPoint,param:t},{context:To,name:A.getText("MapContextMenu - Select this point as end point"),action:-1!==le.editedRouteObjId&&n.defaultValue===le.travel.editedRoute.wayPoints.last.lat?To.setEndPoint:null,param:t},{context:yo,name:A.getText("MapContextMenu - Add a route"),action:yo.addRoute},{context:yo,name:A.getText("MapContextMenu - Hide all routes"),action:yo.hideRoutes},{context:yo,name:A.getText("MapContextMenu - Show all routes"),action:yo.showRoutes},{context:Ht,name:A.getText("MapContextMenu - New travel note"),action:Ht.newTravelNote,param:t},{context:Ht,name:A.getText("MapContextMenu - Hide all notes"),action:Ht.hideNotes},{context:Ht,name:A.getText("MapContextMenu - Show all notes"),action:Ht.showNotes},{context:o,name:A.getText("MapContextMenu - Zoom to travel"),action:o.zoomToTravel},{context:null,name:A.getText("MapContextMenu - About Travel & Notes"),action:On}]);return Object.seal(a)}
/**
	@------------------------------------------------------------------------------------------------------------------------------

	@file IndexedDb.js
	@copyright Copyright - 2017 2021 - wwwouaiebe - Contact: https://www.ouaie.be/
	@license GNU General Public License
	@private

	@------------------------------------------------------------------------------------------------------------------------------
	*/(e).show()}const Gn=Object.seal(new class{addReadOnlyMap(e,t){Jn||(Jn=!0,Zn(),e&&(le.map=e),Kt.createUI(),uo.setLayer("OSM - Color"),y.getJsonPromise(t).then(e=>{ra().openDistantFile(e)}).catch(e=>{console.log(e||"Not possible to load the .trv file"),le.map.setView([n.defaultValue,n.defaultValue],2),document.title="Travel & Notes"}))}addControl(e,t){Jn||(Jn=!0,Zn(),window.addEventListener("unload",()=>{localStorage.removeItem(le.UUID)}),window.addEventListener("beforeunload",e=>(kn.closeDb(le.UUID),e.returnValue="x","x")),e&&(le.map=e,le.map.on("contextmenu",Xn)),le.travel=oe(),le.travel.routes.add(_()),Sn.createUI(document.getElementById(t)),Kt.createUI(),Pe.setKeysFromServerFile(),f.layersToolbarUI.haveLayersToolbarUI&&uo.createUI(),f.mouseUI.haveMouseUI&&Kn.createUI(),f.travelEditor.startupRouteEdition&&yo.editRoute(le.travel.routes.first.objId),Te.dispatch("setrouteslist"),Te.dispatch("roadbookupdate"),le.map.setView([f.map.center.lat,f.map.center.lng],f.map.zoom),ye.showHelp("<p>"+A.getText("Help - Continue with interface1")+"</p><p>"+A.getText("Help - Continue with interface2")+"</p>"),document.title="Travel & Notes")}addProvider(e){Pe.addProvider(e)}showInfo(e){ye.showInfo(e)}get baseDialog(){return se()}get map(){return le.map}get maneuver(){return H()}get itineraryPoint(){return O()}get version(){return"2.1.0"}});(function(){let e=null,t=null,o="",a=!1;function r(t){var n,r,i,l,s,d,c;("fulfilled"===t[0].status&&(a=!0),o=function(t){if("fulfilled"===t.status){if(t.value.language=e,t.value.haveCrypto=a,"wwwouaiebe.github.io"===window.location.hostname){t.value.layersToolbarUI.theDevil.addButton=!1,t.value.errorUI.showHelp=!0;const e=120;t.value.printRouteMap.maxTiles=e;const o=10;t.value.note.maxManeuversNotes=o,t.value.note.haveBackground=!0,t.value.APIKeys.dialogHaveUnsecureButtons=!0}return f.overload(t.value),""}return"Not possible to load the TravelNotesConfig.json file. "}(t[1]),o)?ye.showError(o):(le.providers.forEach(e=>{e.userLanguage=f.language}),n=t[2],r=t[5],o="fulfilled"===n.status?(A.setTranslations(n.value),""):"fulfilled"===r.status?(A.setTranslations(r.value),"Not possible to load the TravelNotes"+e.toUpperCase()+".json file. English will be used. "):"Not possible to load the translations. ",o+=(i=t[4],l=t[6],"fulfilled"===i.status?(ft.selectOptions=i.value.preDefinedIconsList,ft.buttons=i.value.editionButtons,""):"fulfilled"===l.status?(ft.selectOptions=l.value.preDefinedIconsList,ft.buttons=l.value.editionButtons,"Not possible to load the TravelNotesNoteDialog"+e.toUpperCase()+".json file. English will be used. "):"Not possible to load the translations for the note dialog. "),o+="fulfilled"===(s=t[3]).status?(uo.addLayers(s.value),""):"Not possible to load the TravelNotesLayers.json file. Only the OpenStreetMap background will be available. ",o+=(d=t[7],c=t[8],"fulfilled"===d.status?(Cn.parseDictionary(d.value),""):"fulfilled"===c.status?(Cn.parseDictionary(c.value),"Not possible to load the TravelNotesSearchDictionary"+e.toUpperCase()+".csv file. English will be used. "):"Not possible to load the search dictionary. OSM search will not be available."),""!==o&&(ye.showWarning(o),o=""))}return Object.freeze(new class{start(){window.L.travelNotes=Gn,function(){let o=new URL(window.location),a=o.searchParams.get("fil");if(a&&0!==a.length)try{if(a=atob(a),a.match(/[^\w-%:./]/))throw new Error("invalid char in the url encoded in the fil parameter");let e=new URL(a);o.protocol&&e.protocol&&o.protocol===e.protocol&&o.hostname&&e.hostname&&o.hostname===e.hostname?t=encodeURI(e.href):console.log("The distant file is not on the same site than the app")}catch(e){console.log(e.message)}let n=o.searchParams.get("lng");n&&(n.match(/^[A-Z,a-z]{2}$/)?e=n.toLowerCase():console.log("invalid lng parameter"))}(),e=e||f.language||"fr",ye.createUI(),Promise.allSettled(function(){let t=window.location.origin+window.location.pathname+"TravelNotes";return[window.crypto&&window.crypto.subtle&&window.crypto.subtle.importKey&&window.isSecureContext?window.crypto.subtle.importKey("raw",(new window.TextEncoder).encode("hoho"),{name:"PBKDF2"},!1,["deriveKey"]):Promise.reject(new Error("Invalid crypto functions or unsecure context")),y.getJsonPromise(t+"Config.json"),y.getJsonPromise(t+e.toUpperCase()+".json"),y.getJsonPromise(t+"Layers.json"),y.getJsonPromise(t+"NoteDialog"+e.toUpperCase()+".json"),y.getJsonPromise(t+"EN.json"),y.getJsonPromise(t+"NoteDialogEN.json"),y.getTextPromise(t+"SearchDictionary"+e.toUpperCase()+".csv"),y.getTextPromise(t+"SearchDictionaryEN.csv")]}()).then(e=>{r(e),function(){if(f.autoLoad&&""===o){b.create("div",{id:"Map"},document.querySelector("body")),b.create("div",{id:"TravelNotes"},document.querySelector("body"));let e=window.L.map("Map",{attributionControl:!1,zoomControl:!1}).setView([n.defaultValue,n.defaultValue],0);t?Gn.addReadOnlyMap(e,t):Gn.addControl(e,"TravelNotes")}}()})}})})().start()}();
/**
 * 
 * @source: https://github.com/wwwouaiebe/leaflet.TravelNotes
 * 
 * @licstart  The following is the entire license notice for the
 * JavaScript code in this page.
 * 
 * leaflet.travelnotes - version 1.12.0
 * Build 01848 - 2020-08-29T12:00:03+0200 
 * Copyright 2017 2020 wwwouaiebe 
 * Contact: https://www.ouaie.be/
 * License: GPL-3.0
 * 
 * The JavaScript code in this page is free software: you can
 * redistribute it and/or modify it under the terms of the GNU
 * General Public License (GNU GPL) as published by the Free Software
 * Foundation, either version 3 of the License, or (at your option)
 * any later version.  The code is distributed WITHOUT ANY WARRANTY;
 * without even the implied warranty of MERCHANTABILITY or FITNESS
 * FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.
 * 
 * As additional permission under GNU GPL version 3 section 7, you
 * may distribute non-source (e.g., minimized or compacted) forms of
 * that code without the copy of the GNU GPL normally required by
 * section 4, provided you include this license notice and a URL
 * through which recipients can access the Corresponding Source.
 * 
 * @licend  The above is the entire license notice
 * for the JavaScript code in this page.
 * 
 */


!function(){"use strict";
/**
	@------------------------------------------------------------------------------------------------------------------------------

	@file Config.js
	@copyright Copyright - 2017 2020 - wwwouaiebe - Contact: https://www.ouaie.be/
	@license GNU General Public License
	@private

	@------------------------------------------------------------------------------------------------------------------------------
	*/let e={autoLoad:!1,haveGlobals:!1,map:{center:{lat:50.50923,lng:5.49542},zoom:12},travelNotesToolbarUI:{contactMail:"https://github.com/wwwouaiebe/leaflet.TravelNotes/issues"},layersToolbarUI:{haveLayersToolbarUI:!0,toolbarTimeOut:1500,contactMail:"https://github.com/wwwouaiebe/leaflet.TravelNotes/issues",theDevil:{addButton:!1,title:"Reminder! The devil will know everything about you",text:"&#x1f47f;"}},mouseUI:{haveMouseUI:!0},errorUI:{timeOut:1e4,helpTimeOut:3e4,showError:!0,showWarning:!0,showInfo:!0,showHelp:!0},geoLocation:{color:"red",radius:11,zoomToPosition:!0,zoomFactor:17,options:{enableHighAccuracy:!1,maximumAge:0,timeout:1/0}},APIKeys:{showDialogButton:!0,saveToSessionStorage:!0,showAPIKeysInDialog:!0,dialogHaveUnsecureButtons:!0},contextMenu:{timeout:1500},routing:{auto:!0},language:"fr",itineraryPointMarker:{color:"red",weight:2,radius:7,fill:!1},searchPointMarker:{color:"green",weight:4,radius:20,fill:!1},searchPointPolyline:{color:"green",weight:4,radius:20,fill:!1},previousSearchLimit:{color:"green",fill:!1,weight:1},nextSearchLimit:{color:"red",fill:!1,weight:1},wayPoint:{reverseGeocoding:!1},route:{color:"#ff0000",width:3,dashArray:0,dashChoices:[{text:"——————",iDashArray:null},{text:"— — — — —",iDashArray:[4,2]},{text:"—‧—‧—‧—‧—",iDashArray:[4,2,0,2]},{text:"················",iDashArray:[0,2]}],elev:{smooth:!0,smoothCoefficient:.25,smoothPoints:3},showDragTooltip:3},note:{reverseGeocoding:!1,grip:{size:10,opacity:0,moveOpacity:1},polyline:{color:"gray",weight:1},style:"",svgIconWidth:200,svgAnleMaxDirection:{right:35,slightRight:80,continue:100,slightLeft:145,left:200,sharpLeft:270,sharpRight:340},svgZoom:17,svgAngleDistance:10,svgHamletDistance:200,svgVillageDistance:400,svgCityDistance:1200,svgTownDistance:1500,svgTimeOut:15e3,cityPrefix:'<span class="TravelNotes-NoteHtml-Address-City">',cityPostfix:"</span>",maxManeuversNotes:100},itineraryPointZoom:17,routeEditor:{displayEditionInHTMLPage:!0},travelEditor:{clearAfterSave:!0,startMinimized:!0,timeout:1e3,startupRouteEdition:!0},haveBeforeUnloadWarning:!0,overpassApiUrl:"https://lz4.overpass-api.de/api/interpreter",nominatim:{url:"https://nominatim.openstreetmap.org/",language:"*"},printRouteMap:{isEnabled:!0,maxTiles:240,paperWidth:287,paperHeight:200,pageBreak:!1,printNotes:!0,borderWidth:30,zoomFactor:15,entryPointMarker:{color:"green",weight:4,radius:10,fill:!0,fillOpacity:1},exitPointMarker:{color:"red",weight:4,radius:10,fill:!0,fillOpacity:1}},haveCrypto:!1,itineraryPane:{showNotes:!0,showManeuvers:!1},colorDialog:{haveSlider:!0,initialRed:0}};let t=new class{get autoLoad(){return e.autoLoad}get haveGlobals(){return e.haveGlobals}get map(){return e.map}get travelNotesToolbarUI(){return e.travelNotesToolbarUI}get layersToolbarUI(){return e.layersToolbarUI}get mouseUI(){return e.mouseUI}get errorUI(){return e.errorUI}get APIKeys(){return e.APIKeys}get contextMenu(){return e.contextMenu}get routing(){return e.routing}get language(){return e.language}get itineraryPointMarker(){return e.itineraryPointMarker}get searchPointMarker(){return e.searchPointMarker}get searchPointPolyline(){return e.searchPointPolyline}get previousSearchLimit(){return e.previousSearchLimit}get nextSearchLimit(){return e.nextSearchLimit}get wayPoint(){return e.wayPoint}get route(){return e.route}get note(){return e.note}get itineraryPointZoom(){return e.itineraryPointZoom}get routeEditor(){return e.routeEditor}get travelEditor(){return e.travelEditor}get haveBeforeUnloadWarning(){return e.haveBeforeUnloadWarning}get overpassApiUrl(){return e.overpassApiUrl}get nominatim(){return e.nominatim}get geoLocation(){return e.geoLocation}get printRouteMap(){return e.printRouteMap}get haveCrypto(){return e.haveCrypto}get itineraryPane(){return e.itineraryPane}get colorDialog(){return e.colorDialog}overload(t){!function e(t,a){if("object"==typeof t&&"object"==typeof a)try{for(let o in a)"object"==typeof a[o]?e(t[o],a[o]):a[o]=t[o]||a[o];for(let o in t)"object"==typeof t[o]?("[object Array]"===Object.prototype.toString.call(t[o])?a[o]=a[o]||[]:a[o]=a[o]||{},e(t[o],a[o])):a[o]=t[o]}catch(e){console.log(e||"Not possible to overload Config")}}(t,e),e=function e(t){for(let a in t)"object"==typeof t[a]&&(t[a]=e(t[a]));return Object.freeze(t)}(e)}};
/**
	@------------------------------------------------------------------------------------------------------------------------------

	@file HTMLElementsFactory.js
	@copyright Copyright - 2017 2020 - wwwouaiebe - Contact: https://www.ouaie.be/
	@license GNU General Public License
	@private

	@------------------------------------------------------------------------------------------------------------------------------
	*/const a=Object.freeze(new class{create(e,t,a){let o=null;return"text"===e.toLowerCase()?o=document.createTextNode(t.value||""):(o=document.createElement(e),t&&function(e,t){for(let a in t)try{e[a]=t[a]}catch(e){console.log("Invalid property : "+a)}}(o,t)),a&&a.appendChild(o),o}});const o=Object.freeze(new
/**
	@------------------------------------------------------------------------------------------------------------------------------

	@file HttpRequestBuilder.js
	@copyright Copyright - 2017 2020 - wwwouaiebe - Contact: https://www.ouaie.be/
	@license GNU General Public License
	@private

	@------------------------------------------------------------------------------------------------------------------------------
	*/
class{getJsonPromise(e,t){return new Promise((function(a,o){let n=new XMLHttpRequest;n.timeout=2e4,n.ontimeout=function(){o("XMLHttpRequest TimeOut. File : "+n.responseURL)},n.onreadystatechange=function(){if(4===n.readyState)if(200===n.status){let e=null;try{e=JSON.parse(n.responseText)}catch(e){o(e.message+" File: "+n.responseURL)}a(e)}else o("Error XMLHttpRequest - File : "+n.responseURL)},n.open("GET",e,!0),t&&t.forEach(e=>n.setRequestHeader(e.headerName,e.headerValue)),n.overrideMimeType("application/json"),n.send(null)}))}getBinaryPromise(e,t){return new Promise((function(a,o){let n=new XMLHttpRequest;n.timeout=2e4,n.ontimeout=function(){o("XMLHttpRequest TimeOut. File : "+n.responseURL)},n.onload=function(){if(200===n.status){let e=n.response;e?a(e):o("Error XMLHttpRequest - File : "+n.responseURL)}else o("Error XMLHttpRequest - File : "+n.responseURL)},n.open("GET",e,!0),t&&t.forEach(e=>n.setRequestHeader(e.headerName,e.headerValue)),n.responseType="arraybuffer",n.send(null)}))}}),n=Object.freeze({fixed:2,invalid:-1,defaultValue:0}),r=Object.freeze({refusedByUser:-1,disabled:0,inactive:1,active:2}),i=(Object.freeze({invalidPane:"43a6a53e-008a-4910-80a6-7a87d301ea15",itineraryPane:"8fbf0da7-4e6f-4bc7-8e20-1388461ccde7",travelNotesPane:"dffe782b-07df-4b81-a318-f287c0cf5ec6",searchPane:"228f00d7-43a8-4c13-897d-70400cb6dd58"}),Object.freeze({fixed:2,defaultValue:0})),s=Object.freeze({defaultValue:0,fixed:6}),l=Object.freeze({notEdited:0,editedNoChange:1,editedChanged:2}),c=Object.freeze({margin:100,height:500,width:1e3,yDeltaText:30,xDeltaText:10,vScales:[1,2,5,10,20,50,100,200,500,1e3,2e3,5e3],hScales:[1,2,5,10,20,50,100,200,500,1e3,2e3,5e3,1e4,2e4,5e4,1e5]});
/**
	@------------------------------------------------------------------------------------------------------------------------------

	@file Constants.js
	@copyright Copyright - 2017 2020 - wwwouaiebe - Contact: https://www.ouaie.be/
	@license GNU General Public License
	@private

	@------------------------------------------------------------------------------------------------------------------------------
	*/Object.freeze({width:40,height:40});let d=0;function u(){return++d,d}
/**
	@------------------------------------------------------------------------------------------------------------------------------

	@file Version.js
	@copyright Copyright - 2017 2020 - wwwouaiebe - Contact: https://www.ouaie.be/
	@license GNU General Public License
	@private

	@------------------------------------------------------------------------------------------------------------------------------
	*/function h(e){const t=e;return Object.seal(new class{get name(){return t}get version(){return"1.12.0"}get jsonObject(){return{name:t,version:"1.12.0"}}validate(e){if(!Object.getOwnPropertyNames(e).includes("name"))throw new Error("No name for "+t);if(t!==e.name)throw new Error("Invalid name for "+t);if(!Object.getOwnPropertyNames(e).includes("version"))throw new Error("No version for "+t)}})}function g(e){const t=e;let a=[];const o=function(){let e=t();if(!e.objType||!e.objType.name)throw new Error("invalid object name for collection");return e.objType.name}();function n(e){if(!e.objType||!e.objType.name||e.objType.name!==o)throw new Error("invalid object name for add function");a.push(e)}function r(){let e=-1;return Object.seal({get value(){return e<a.length?a[e]:null},get previous(){return 0>=e?null:a[e-1]},get next(){return e<a.length-1?a[e+1]:null},get done(){return++e>=a.length},get first(){return 0===e},get last(){return e>=a.length-1},get index(){return e}})}function i(e){return a.findIndex(t=>t.objId===e)}function s(e,t,o){let n=i(e);if(-1===n)throw new Error("invalid objId for next or previous function");if(1!==o&&-1!==o)throw new Error("invalid direction");let r=t;for(r||(r=()=>!0),n+=o;-1<n&&n<a.length&&!r(a[n]);)n+=o;return-1===n||a.length===n?null:a[n]}return Object.seal(new class{add(e){n(e)}forEach(e){let t=null,a=r();for(;!a.done;)t=e(a.value,t);return t}getAt(e){let t=i(e);return-1===t?null:a[t]}moveTo(e,t,o){let n=i(e),r=i(t);if(-1===n||-1===r)throw new Error("invalid objId for function  myMoveTo");o||r++,a.splice(r,0,a[n]),r<n&&n++,a.splice(n,1)}next(e,t){return s(e,t,1)}previous(e,t){return s(e,t,-1)}remove(e){if(-1===i(e))throw new Error("invalid objId for remove function");a.splice(i(e),1)}removeAll(e){e?a.splice(1,a.length-2):a.length=0}replace(e,t){let n=i(e);if(-1===n)throw new Error("invalid objId for replace function");if(!t.objType||!t.objType.name||t.objType.name!==o)throw new Error("invalid object name for replace function");a[n]=t}reverse(){a.reverse()}sort(e){a.sort(e)}swap(e,t){let o=i(e);if(-1===o||0===o&&t||a.length-1===o&&!t)throw new Error("invalid objId for swap function");let n=a[o];a[o]=a[o+(t?-1:1)],a[o+(t?-1:1)]=n}get first(){return a[0]}get iterator(){return r()}get last(){return a[a.length-1]}get length(){return a.length}get jsonObject(){let e=[],t=r();for(;!t.done;)e.push(t.value.jsonObject);return e}set jsonObject(e){a.length=0;let o=null;e.forEach(e=>{o=t(),o.jsonObject=e,n(o)})}})}
/**
	@------------------------------------------------------------------------------------------------------------------------------

	@file Translator.js
	@copyright Copyright - 2017 2020 - wwwouaiebe - Contact: https://www.ouaie.be/
	@license GNU General Public License
	@private

	@------------------------------------------------------------------------------------------------------------------------------
	*/let p=new Map;const v=Object.freeze(new class{setTranslations(e){e.forEach(e=>p.set(e.msgid,e.msgstr))}getText(e,t){let a=p.get(e);return t&&a&&Object.getOwnPropertyNames(t).forEach(e=>a=a.replace("{"+e+"}",t[e])),a||e}});const f=Object.freeze(new class{get UUID(){let e=new Uint16Array(8);const t=["","-","-","-","-","","",""];window.crypto.getRandomValues(e);let a="";for(let o=0;o<8;o++)a+=e[o].toString(16).padStart(4,"0")+t[o];return a}storageAvailable(e){try{let t=window[e],a="__storage_test__";return t.setItem(a,a),t.removeItem(a),!0}catch(e){return!1}}saveFile(e,t,a){try{let o=window.URL.createObjectURL(new File([t],e,{type:a||"text/plain"})),n=document.createElement("a");n.setAttribute("href",o),n.setAttribute("download",e),n.click(),window.URL.revokeObjectURL(o)}catch(e){console.log(e||"An error occurs when saving file")}}formatTime(e){let t=Math.floor(e);if(0===t)return"";let a=Math.floor(t/86400),o=Math.floor(t%86400/3600),n=Math.floor(t%3600/60),r=Math.floor(t%60);return 0<a?a+" "+v.getText("Utilities - Day")+" "+o+" "+v.getText("Utilities - Hour"):0<o?o+" "+v.getText("Utilities - Hour")+" "+n+" "+v.getText("Utilities - Minute"):0<n?n+" "+v.getText("Utilities - Minute"):r+" "+v.getText("Utilities - Second")}formatDistance(e){let t=Math.floor(e);return 0>=t?"0 km":Math.floor(t/1e3)+","+Math.floor(t%1e3/10).toFixed(0).padStart(2,"0").padEnd(3,"0")+" km"}formatLat(e){return e>0?e.toFixed(s.fixed)+" N":(-e).toFixed(s.fixed)+" S"}formatLng(e){return e>0?e.toFixed(s.fixed)+" E":(-e).toFixed(s.fixed)+" W"}formatLatLng(e){return 0===e[0]&&0===e[1]?"":this.formatLat(e[0])+" - "+this.formatLng(e[1])}}),m=h("WayPoint"),b=new WeakMap;class y{constructor(){this.name="",this.address="",this.lat=s.defaultValue,this.lng=s.defaultValue,b.set(this,u())}get fullName(){let e=""===this.name?this.address:this.name+", "+this.address;return""===e&&(e=f.formatLatLng([this.lat,this.lng])),e}get latLng(){return[this.lat,this.lng]}set latLng(e){this.lat=e[0],this.lng=e[1]}get objId(){return b.get(this)}get objType(){return m}get jsonObject(){return{name:this.name,address:this.address,lat:parseFloat(this.lat.toFixed(s.fixed)),lng:parseFloat(this.lng.toFixed(s.fixed)),objId:b.get(this),objType:m.jsonObject}}set jsonObject(e){let t=function(e){if(!Object.getOwnPropertyNames(e).includes("objType"))throw new Error("No objType for "+m.name);if(m.validate(e.objType),m.version!==e.objType.version)switch(e.objType.version){case"1.0.0":case"1.1.0":case"1.2.0":case"1.3.0":case"1.4.0":case"1.5.0":case"1.6.0":case"1.7.0":case"1.7.1":case"1.8.0":case"1.9.0":case"1.10.0":case"1.11.0":e.address=e.name,e.name="",e.objType.version="1.12.0";break;default:throw new Error("invalid version for "+m.name)}let t=Object.getOwnPropertyNames(e);return["address","name","lat","lng","objId"].forEach(e=>{if(!t.includes(e))throw new Error("No "+e+" for "+m.name)}),e}(e);this.address=t.address||"",this.name=t.name||"",this.lat=t.lat||s.defaultValue,this.lng=t.lng||s.defaultValue,b.set(this,u())}}function j(){return Object.seal(new y)}const w=h("ItineraryPoint"),T=new WeakMap;class N{constructor(){this.lat=s.defaultValue,this.lng=s.defaultValue,this.distance=n.defaultValue,this.elev=i.defaultValue,T.set(this,u())}get latLng(){return[this.lat,this.lng]}set latLng(e){this.lat=e[0],this.lng=e[1]}get objType(){return w}get objId(){return T.get(this)}get jsonObject(){return{lat:parseFloat(this.lat.toFixed(s.fixed)),lng:parseFloat(this.lng.toFixed(s.fixed)),distance:parseFloat(this.distance.toFixed(n.fixed)),elev:parseFloat(this.elev.toFixed(i.fixed)),objId:T.get(this),objType:w.jsonObject}}set jsonObject(e){let t=function(e){if(!Object.getOwnPropertyNames(e).includes("objType"))throw new Error("No objType for "+w.name);if(w.validate(e.objType),w.version!==e.objType.version)switch(e.objType.version){case"1.0.0":case"1.1.0":case"1.2.0":case"1.3.0":case"1.4.0":case"1.5.0":case"1.6.0":e.elev=i.defaultValue;case"1.7.0":case"1.7.1":case"1.8.0":case"1.9.0":case"1.10.0":case"1.11.0":e.objType.version="1.12.0";break;default:throw new Error("invalid version for "+w.name)}let t=Object.getOwnPropertyNames(e);return["lat","lng","distance","elev","objId"].forEach(e=>{if(!t.includes(e))throw new Error("No "+e+" for "+w.name)}),e}(e);this.lat=t.lat||s.defaultValue,this.lng=t.lng||s.defaultValue,this.distance=t.distance||n.defaultValue,this.elev=t.elev||i.defaultValue,T.set(this,u())}}function O(){return Object.seal(new N)}const M=h("Maneuver"),I=new WeakMap;class P{constructor(){this.iconName="",this.instruction="",this.itineraryPointObjId=-1,this.distance=n.defaultValue,this.duration=n.defaultValue,I.set(this,u())}get objType(){return M}get objId(){return I.get(this)}get jsonObject(){return{iconName:this.iconName,instruction:this.instruction,distance:parseFloat(this.distance.toFixed(n.fixed)),duration:this.duration,itineraryPointObjId:this.itineraryPointObjId,objId:I.get(this),objType:M.jsonObject}}set jsonObject(e){let t=function(e){if(!Object.getOwnPropertyNames(e).includes("objType"))throw new Error("No objType for "+M.name);if(M.validate(e.objType),M.version!==e.objType.version)switch(e.objType.version){case"1.0.0":case"1.1.0":case"1.2.0":case"1.3.0":case"1.4.0":case"1.5.0":case"1.6.0":case"1.7.0":case"1.7.1":case"1.8.0":case"1.9.0":case"1.10.0":case"1.11.0":e.objType.version="1.12.0","kArriveDefault"===e.iconName&&(e.distance=n.defaultValue);break;default:throw new Error("invalid version for "+M.name)}let t=Object.getOwnPropertyNames(e);return["iconName","instruction","distance","duration","itineraryPointObjId","objId"].forEach(e=>{if(!t.includes(e))throw new Error("No "+e+" for "+M.name)}),e}(e);this.iconName=t.iconName||"",this.instruction=t.instruction||"",this.distance=t.distance||n.defaultValue,this.duration=t.duration||n.defaultValue,this.itineraryPointObjId=t.itineraryPointObjId||-1,I.set(this,u())}}function x(){return Object.seal(new P)}const E=h("Itinerary"),H=new WeakMap;class C{constructor(){this.hasProfile=!1,this.ascent=0,this.descent=0,this.provider="",this.transitMode="",this.itineraryPoints=g(O),this.maneuvers=g(x),H.set(this,u())}get objType(){return E}get objId(){return H.get(this)}get jsonObject(){return{hasProfile:this.hasProfile,ascent:this.ascent,descent:this.descent,itineraryPoints:this.itineraryPoints.jsonObject,maneuvers:this.maneuvers.jsonObject,provider:this.provider,transitMode:this.transitMode,objId:H.get(this),objType:E.jsonObject}}set jsonObject(e){let t=function(e){if(!Object.getOwnPropertyNames(e).includes("objType"))throw new Error("No objType for "+E.name);if(E.validate(e.objType),E.version!==e.objType.version)switch(e.objType.version){case"1.0.0":case"1.1.0":case"1.2.0":case"1.3.0":case"1.4.0":case"1.5.0":case"1.6.0":e.hasProfile=!1,e.ascent=0,e.descent=0;case"1.7.0":case"1.7.1":case"1.8.0":case"1.9.0":case"1.10.0":case"1.11.0":e.objType.version="1.12.0";break;default:throw new Error("invalid version for "+E.name)}let t=Object.getOwnPropertyNames(e);return["hasProfile","ascent","descent","itineraryPoints","maneuvers","provider","transitMode","objId"].forEach(e=>{if(!t.includes(e))throw new Error("No "+e+" for "+E.name)}),e}(e);this.hasProfile=t.hasProfile||!1,this.ascent=t.ascent||0,this.descent=t.descent||0,this.itineraryPoints.jsonObject=t.itineraryPoints||[],this.maneuvers.jsonObject=t.maneuvers||[],this.provider=t.provider||"",this.transitMode=t.transitMode||"",H.set(this,u());let a=new Map,o=0,n=this.itineraryPoints.iterator;for(;!n.done;)a.set(t.itineraryPoints[o].objId,n.value.objId),o++;let r=this.maneuvers.iterator;for(;!r.done;)r.value.itineraryPointObjId=a.get(r.value.itineraryPointObjId)}}function A(){return Object.seal(new C)}const R=h("Note"),S=new WeakMap;class D{constructor(){this.iconHeight=0,this.iconWidth=0,this.iconContent="",this.popupContent="",this.tooltipContent="",this.phone="",this.url="",this.address="",this.iconLat=s.defaultValue,this.iconLng=s.defaultValue,this.lat=s.defaultValue,this.lng=s.defaultValue,this.distance=n.invalid,this.chainedDistance=n.defaultValue,S.set(this,u())}get isRouteNote(){return this.distance!==n.invalid}get iconLatLng(){return[this.iconLat,this.iconLng]}set iconLatLng(e){this.iconLat=e[0],this.iconLng=e[1]}get latLng(){return[this.lat,this.lng]}set latLng(e){this.lat=e[0],this.lng=e[1]}get objType(){return R}get objId(){return S.get(this)}get jsonObject(){return{iconHeight:this.iconHeight,iconWidth:this.iconWidth,iconContent:this.iconContent,popupContent:this.popupContent,tooltipContent:this.tooltipContent,phone:this.phone,url:this.url,address:this.address,iconLat:parseFloat(this.iconLat.toFixed(s.fixed)),iconLng:parseFloat(this.iconLng.toFixed(s.fixed)),lat:parseFloat(this.lat.toFixed(s.fixed)),lng:parseFloat(this.lng.toFixed(s.fixed)),distance:parseFloat(this.distance.toFixed(n.fixed)),chainedDistance:parseFloat(this.chainedDistance.toFixed(n.fixed)),objId:S.get(this),objType:R.jsonObject}}set jsonObject(e){let t=function(e){if(!Object.getOwnPropertyNames(e).includes("objType"))throw new Error("No objType for "+R.name);if(R.validate(e.objType),R.version!==e.objType.version)switch(e.objType.version){case"1.0.0":case"1.1.0":case"1.2.0":case"1.3.0":case"1.4.0":case"1.5.0":case"1.6.0":case"1.7.0":case"1.7.1":case"1.8.0":case"1.9.0":case"1.10.0":case"1.11.0":e.objType.version="1.12.0";break;default:throw new Error("invalid version for "+R.name)}let t=Object.getOwnPropertyNames(e);return["iconHeight","iconWidth","iconContent","popupContent","tooltipContent","phone","url","address","iconLat","iconLng","lat","lng","distance","chainedDistance","objId"].forEach(e=>{if(!t.includes(e))throw new Error("No "+e+" for "+R.name)}),e}(e);this.iconHeight=t.iconHeight||0,this.iconWidth=t.iconWidth||0,this.iconContent=t.iconContent||"",this.popupContent=t.popupContent||"",this.tooltipContent=t.tooltipContent||"",this.phone=t.phone||"",this.url=t.url||"",this.address=t.address||"",this.iconLat=t.iconLat||s.defaultValue,this.iconLng=t.iconLng||s.defaultValue,this.lat=t.lat||s.defaultValue,this.lng=t.lng||s.defaultValue,this.distance=t.distance||n.invalid,this.chainedDistance=t.chainedDistance,S.set(this,u())}}function F(){return Object.seal(new D)}const V=h("Route"),U=new WeakMap;class k{constructor(){this.name="",this.wayPoints=g(j),this.wayPoints.add(j()),this.wayPoints.add(j()),this.notes=g(F),this.itinerary=A(),this.width=t.route.width,this.color=t.route.color,this.dashArray=t.route.dashArray,this.chain=!1,this.chainedDistance=n.defaultValue,this.distance=n.defaultValue,this.duration=n.defaultValue,this.editionStatus=l.notEdited,this.hidden=!1,U.set(this,u())}get computedName(){let e=this.name;return""===e&&(e=(""===this.wayPoints.first.fullName?"???":this.wayPoints.first.fullName)+" ⮞ "+(""===this.wayPoints.last.fullName?"???":this.wayPoints.last.fullName)),e}get objId(){return U.get(this)}get objType(){return V}get jsonObject(){return{name:this.name,wayPoints:this.wayPoints.jsonObject,notes:this.notes.jsonObject,itinerary:this.itinerary.jsonObject,width:this.width,color:this.color,dashArray:this.dashArray,chain:this.chain,distance:parseFloat(this.distance.toFixed(n.fixed)),duration:this.duration,editionStatus:this.editionStatus,hidden:this.hidden,chainedDistance:parseFloat(this.chainedDistance.toFixed(n.fixed)),objId:U.get(this),objType:V.jsonObject}}set jsonObject(e){let a=function(e){if(!Object.getOwnPropertyNames(e).includes("objType"))throw new Error("No objType for "+V.name);if(V.validate(e.objType),V.version!==e.objType.version)switch(e.objType.version){case"1.0.0":e.dashArray=0,e.hidden=!1;case"1.1.0":case"1.2.0":case"1.3.0":case"1.4.0":e.edited=l.notEdited;case"1.5.0":case"1.6.0":case"1.7.0":case"1.7.1":case"1.8.0":case"1.9.0":case"1.10.0":case"1.11.0":e.editionStatus=e.edited,e.objType.version="1.12.0";break;default:throw new Error("invalid version for "+V.name)}let t=Object.getOwnPropertyNames(e);return["name","wayPoints","notes","itinerary","width","color","dashArray","chain","distance","duration","editionStatus","hidden","chainedDistance","objId"].forEach(e=>{if(!t.includes(e))throw new Error("No "+e+" for "+V.name)}),e}(e);this.name=a.name||"",this.wayPoints.jsonObject=a.wayPoints||[],this.notes.jsonObject=a.notes||[],this.itinerary.jsonObject=a.itinerary||A().jsonObject,this.width=a.width||t.route.width,this.color=a.color||"#000000",this.dashArray=a.dashArray||0,this.chain=a.chain||!1,this.distance=a.distance,this.duration=a.duration,this.editionStatus=a.editionStatus||l.notEdited,this.hidden=a.hidden||!1,this.chainedDistance=a.chainedDistance,U.set(this,u())}}function z(){return Object.seal(new k)}const B=h("Travel"),W=new WeakMap;class Z{constructor(){this.editedRoute=z(),this.routes=g(z),this.notes=g(F),this.layerName="OSM - Color",this.name="TravelNotes",this.readOnly=!1,this.userData={},W.set(this,u())}get objId(){return W.get(this)}get objType(){return B}get jsonObject(){return{editedRoute:this.editedRoute.jsonObject,layerName:this.layerName,name:this.name,routes:this.routes.jsonObject,notes:this.notes.jsonObject,userData:this.userData,readOnly:this.readOnly,objId:W.get(this),objType:B.jsonObject}}set jsonObject(e){let t=function(e){if(!Object.getOwnPropertyNames(e).includes("objType"))throw new Error("No objType for "+B.name);if(B.validate(e.objType),B.version!==e.objType.version)switch(e.objType.version){case"1.0.0":case"1.1.0":case"1.2.0":case"1.3.0":case"1.4.0":e.editedRoute=z();case"1.5.0":if(e.userData.layerId){let t=[{layerId:"0",layerName:"OSM - Color"},{layerId:"1",layerName:"OSM - Black and White"},{layerId:"2",layerName:"Thunderforest - Transport"},{layerId:"3",layerName:"Thunderforest - OpenCycleMap"},{layerId:"4",layerName:"Thunderforest - Outdoors"},{layerId:"5",layerName:"Esri - Aerial view"},{layerId:"6",layerName:"Kartverket - Norway"},{layerId:"7",layerName:"IGN-NGI - Belgium now"},{layerId:"12",layerName:"Thunderforest - Landscape"},{layerId:"24",layerName:"Lantmäteriet - Sweden"},{layerId:"25",layerName:"Maanmittauslaitos - Finland"}].find(t=>t.layerId===e.userData.layerId);e.layerName=t?t.layerName:"OSM - Color"}else e.layerName="OSM - Color";case"1.6.0":case"1.7.0":case"1.7.1":case"1.8.0":case"1.9.0":case"1.10.0":case"1.11.0":e.objType.version="1.12.0";break;default:throw new Error("invalid version for "+B.name)}let t=Object.getOwnPropertyNames(e);return["name","editedRoute","routes","userData","objId"].forEach(e=>{if(!t.includes(e))throw new Error("No "+e+" for "+B.name)}),e}(e);this.editedRoute.jsonObject=t.editedRoute,this.layerName=e.layerName||"OSM - Color",this.name=t.name||"",this.userData=t.userData||{},this.readOnly=t.readOnly||!1,this.routes.jsonObject=t.routes||[],this.notes.jsonObject=t.notes||[],W.set(this,u())}}function G(){return Object.seal(new Z)}let _=new Map,q=new Map,X=Object.seal({provider:"",transitMode:""}),J=f.UUID;const K=Object.seal(new class{constructor(){this.map=null,this.travel=G(),this.editedRouteObjId=-1,this.searchData=[]}get providers(){return _}get mapObjects(){return q}get routing(){return X}get UUID(){return J}});const Q=Object.seal(new class{getRoute(e){let t=null;return t=K.travel.routes.getAt(e),t||e===K.travel.editedRoute.objId&&(t=K.travel.editedRoute),t}getNoteAndRoute(e){let t=null,a=null;if(t=K.travel.notes.getAt(e),!t){let o=K.travel.routes.iterator;for(;!o.done&&!t;)t=o.value.notes.getAt(e),t&&(a=o.value);t||(t=K.travel.editedRoute.notes.getAt(e),t&&(a=K.travel.editedRoute))}return Object.freeze({note:t,route:a})}getWayPoint(e){let t=K.travel.editedRoute.wayPoints.getAt(e);if(!t){let a=K.travel.routes.iterator;for(;!a.done&&!t;)t=a.value.wayPoints.getAt(e)}return t}});function Y(e){return(e+540)%360-180}const $=Object.freeze(new class{getLatLngElevAtDist(e,t){if(e.distance<=t||0>=t)return null;let a=0,o=e.itinerary.itineraryPoints.iterator;for(;a<t&&!o.done;)a+=o.value.distance;let n=o.value;o.done;let r=(n.distance-a+t)/n.distance;return Object.freeze({latLng:[n.lat+(o.value.lat-n.lat)*r,n.lng+(o.value.lng-n.lng)*r],elev:n.elev+(o.value.elev-n.elev)*r,ascent:100*(o.value.elev-n.elev)/n.distance,routeDistance:t})}getClosestLatLngDistance(e,t){if(0===e.itinerary.itineraryPoints.length)return null;let a=e.itinerary.itineraryPoints.iterator;a.done;let o=Number.MAX_VALUE,r=L.Projection.SphericalMercator.project(L.latLng(t[0],t[1])),i=L.Projection.SphericalMercator.project(L.latLng(a.value.lat,a.value.lng)),s=null,l=n.defaultValue,c=a.value.distance;for(;!a.done;){let e=L.Projection.SphericalMercator.project(L.latLng(a.value.lat,a.value.lng)),t=L.LineUtil.pointToSegmentDistance(r,i,e);t<o&&(o=t,s=L.Projection.SphericalMercator.unproject(L.LineUtil.closestPointOnSegment(r,i,e)),l=c-s.distanceTo(L.latLng(a.value.lat,a.value.lng))),c+=a.value.distance,i=e}return Object.freeze({latLng:[s.lat,s.lng],distance:l})}getLatLngBounds(e){let t=L.latLng([90,180]),a=L.latLng([-90,-180]);return e.forEach(e=>{t.lat=Math.min(t.lat,e[0]),t.lng=Math.min(t.lng,e[1]),a.lat=Math.max(a.lat,e[0]),a.lng=Math.max(a.lng,e[1])}),L.latLngBounds(t,a)}pointsDistance(e,t){if(e[0]===t[0]&&e[1]===t[1])return 0;const a=Math.PI/180;let o=e[0]*a,n=t[0]*a,r=(Y(t[1])-Y(e[1]))*a;return 6371e3*Math.acos(Math.sin(o)*Math.sin(n)+Math.cos(o)*Math.cos(n)*Math.cos(r))}project(e,t){let a=K.map.project(L.latLng(e),t);return[a.x,a.y]}screenCoordToLatLng(e,t){let a=K.map.containerPointToLatLng(L.point(e,t));return[a.lat,a.lng]}addPoints(e,t){return[e[0]+t[0],e[1]+t[1]]}subtrackPoints(e,t){return[e[0]-t[0],e[1]-t[1]]}});function ee(){let e=null,a=1,o=1,n=Number.MAX_VALUE,r=0,i=0,s=null,l=0,d=t.route.elev.smoothCoefficient,u=t.route.elev.smoothPoints;function h(){let e=function(){let e=0,t=0,a=[],o=s.itinerary.itineraryPoints.iterator,n=0,r=o.done;for(a.push({distance:e,elev:o.value.elev}),n+=o.value.distance,r=o.done;!r;){for(e+=l;e>=n&&!r;)n+=o.value.distance,r=o.done;if(!r){let r=(o.value.elev-o.previous.elev)/o.previous.distance;t=o.value.elev-(n-e)*r,a.push({distance:e,elev:t})}}return a.push({distance:n,elev:s.itinerary.itineraryPoints.last.elev}),a}(),t=new Map,a=(e[u].elev-e[0].elev)/u,o=0;for(o=0;o<u;o++)t.set(o*l,{distance:o*l,elev:e[0].elev+a*o});for(o=u;o<e.length-u;o++){let a=0;for(let t=o-u;o+u>=t;t++)a+=e[t].elev;t.set(e[o].distance,{distance:e[o].distance,elev:a/(2*u+1)})}return o--,a=l*(e[e.length-1].elev-e[e.length-1-u].elev)/(e[e.length-1].distance-e[e.length-1-u].distance),t.set(e[o].distance+l,{distance:e[o].distance+l,elev:e[o].elev+a}),t.set(e[o].distance+2*l,{distance:e[o].distance+2*l,elev:e[o].elev+2*a}),t}function g(t){return s=t,n=Number.MAX_VALUE,r=0,s.itinerary.itineraryPoints.forEach(e=>{r=Math.max(r,e.elev),n=Math.min(n,e.elev)}),i=r-n,a=c.height/i,o=c.width/s.distance,e=document.createElementNS("http://www.w3.org/2000/svg","svg"),e.setAttributeNS(null,"viewBox","0 0 "+(c.width+2*c.margin)+" "+(c.height+2*c.margin)),e.setAttributeNS(null,"class","TravelNotes-SvgProfile"),function(){let t="",n=0,i=0,l=0;s.itinerary.itineraryPoints.forEach(e=>{i=(c.margin+o*n).toFixed(0),l=(c.margin+a*(r-e.elev)).toFixed(0),t+=i+","+l+" ",n+=e.distance});let d=document.createElementNS("http://www.w3.org/2000/svg","polyline");d.setAttributeNS(null,"points",t),d.setAttributeNS(null,"class","TravelNotes-SvgProfile-profilePolyline"),e.appendChild(d)}(),function(){const t=c.margin.toFixed(0),a=(c.margin+c.height).toFixed(0),o=(c.margin+c.width).toFixed(0),n=c.margin.toFixed(0);let r=t+","+n+" "+t+","+a+" "+o+","+a+" "+o+","+n,i=document.createElementNS("http://www.w3.org/2000/svg","polyline");i.setAttributeNS(null,"points",r),i.setAttributeNS(null,"class","TravelNotes-SvgProfile-framePolyline"),e.appendChild(i)}(),function(){let t=Number.MAX_VALUE,o=0;c.vScales.forEach(e=>{let a=Math.abs(i/4-e);a<t&&(t=a,o=e)});let s=Math.ceil(n/o)*o;const l=(c.margin+c.width+c.xDeltaText).toFixed(0),d=(c.margin-c.xDeltaText).toFixed(0);for(;s<r;){let t=c.margin+(r-s)*a,n=document.createElementNS("http://www.w3.org/2000/svg","text");n.appendChild(document.createTextNode(s.toFixed(0))),n.setAttributeNS(null,"class","TravelNotes-SvgProfile-elevLegend"),n.setAttributeNS(null,"x",l),n.setAttributeNS(null,"y",t),n.setAttributeNS(null,"text-anchor","start"),e.appendChild(n);let i=document.createElementNS("http://www.w3.org/2000/svg","text");i.appendChild(document.createTextNode(s.toFixed(0))),i.setAttributeNS(null,"class","TravelNotes-SvgProfile-elevLegend"),i.setAttributeNS(null,"x",d),i.setAttributeNS(null,"y",t),i.setAttributeNS(null,"text-anchor","end"),e.appendChild(i),s+=o}}(),function(){const t=c.margin+c.height+c.margin/2;let a=Number.MAX_VALUE,n=0;c.hScales.forEach(e=>{let t=Math.abs(s.distance/8-e);t<a&&(a=t,n=e)});let r=Math.ceil(s.chainedDistance/n)*n;for(;r<s.distance+s.chainedDistance;){let a=document.createElementNS("http://www.w3.org/2000/svg","text");a.appendChild(document.createTextNode(1e3<n||0<s.chainedDistance?r/1e3+" km":r+" m ")),a.setAttributeNS(null,"class","TravelNotes-SvgProfile-distLegend"),a.setAttributeNS(null,"x",c.margin+(r-s.chainedDistance)*o),a.setAttributeNS(null,"y",t),a.setAttributeNS(null,"text-anchor","start"),e.appendChild(a),r+=n}}(),e}return Object.seal(new class{smooth(e){!function(e){s=e;let t=s.itinerary.itineraryPoints.iterator,a=0,o=0;for(;!t.done;)a+=t.value.distance,o+=t.next?Math.abs(t.value.elev-t.next.elev):0;if(l=10*Math.floor(d/(o/a)),a<=2*u*l)return;let n=h();t=s.itinerary.itineraryPoints.iterator,t.done;let r=t.value.distance;for(;!t.done;){let e=n.get(Math.floor(r/l)*l),a=n.get(Math.ceil(r/l)*l);if(e&&a){let o=r-e.distance,n=(a.elev-e.elev)/(a.distance-e.distance);t.value.elev=e.elev+o*n}r+=t.value.distance}}(e)}createSvg(e){return g(e)}})}function te(e,t){let o=t.note,n=a.create("div");if(0!==o.tooltipContent.length&&a.create("div",{className:e+"NoteHtml-TooltipContent",innerHTML:o.tooltipContent},n),0!==o.popupContent.length&&a.create("div",{className:e+"NoteHtml-PopupContent",innerHTML:o.popupContent},n),0!==o.address.length&&a.create("div",{className:e+"NoteHtml-Address",innerHTML:v.getText("HTMLViewsFactory - Address")+o.address},n),0!==o.phone.length&&a.create("div",{className:e+"NoteHtml-Phone",innerHTML:v.getText("HTMLViewsFactory - Phone")+o.phone},n),0!==o.url.length&&a.create("a",{href:o.url,target:"_blank",innerHTML:o.url.substr(0,40)+"..."},a.create("div",{className:e+"NoteHtml-Url",innerHTML:v.getText("HTMLViewsFactory - Link")},n)),a.create("div",{className:e+"NoteHtml-LatLng",innerHTML:v.getText("HTMLViewsFactory - Latitude Longitude",{lat:f.formatLat(o.lat),lng:f.formatLng(o.lng)})},n),t.route){t.route.chain&&a.create("div",{className:e+"NoteHtml-Distance",innerHTML:v.getText("HTMLViewsFactory - Distance from start of travel",{distance:f.formatDistance(o.chainedDistance+o.distance)})},n),a.create("div",{className:e+"NoteHtml-Distance",innerHTML:v.getText("HTMLViewsFactory - Distance from start of route",{distance:f.formatDistance(o.distance)})},n);let r=t.route.notes.next(o.objId);if(r){let t=r.distance-o.distance;9<t&&a.create("div",{className:e+"NoteHtml-NextDistance",innerHTML:v.getText("HTMLViewsFactory - Next note after&nbsp;:&nbsp;{distance}",{distance:f.formatDistance(t)})},n)}}return n}function ae(e,o){let n=a.create("div"),r=a.create("div",{className:e+"Travel-Notes-IconCell",innerHTML:o.note.iconContent},n);"svg"===r.firstChild.tagName&&"TravelNotes-Roadbook-"===e&&r.firstChild.setAttributeNS(null,"viewBox","0 0 "+t.note.svgIconWidth+" "+t.note.svgIconWidth);let i=te(e,o);return i.className=e+"Travel-Notes-Cell",n.appendChild(i),n.noteObjId=o.note.objId,n}function oe(e){let t=a.create("div",{className:e+"Travel-Notes"}),o=K.travel.notes.iterator;for(;!o.done;){let a=ae(e,{note:o.value,route:null});a.className=e+"Travel-Notes-Row",t.appendChild(a)}return t}function ne(e,t){let o=a.create("div",{className:e+"Route-Header",id:"route"+t.objId});return a.create("div",{className:e+"Route-Header-Name",innerHTML:t.computedName},o),0!==t.distance&&a.create("div",{className:e+"Route-Header-Distance",innerHTML:v.getText("HTMLViewsFactory - Distance",{distance:f.formatDistance(t.distance)})},o),K.travel.readOnly||"bike"===t.itinerary.transitMode||a.create("div",{className:e+"Route-Header-Duration",innerHTML:v.getText("HTMLViewsFactory - Duration",{duration:f.formatTime(t.duration)})},o),t.itinerary.hasProfile&&(a.create("div",{className:e+"Route-Header-Ascent",innerHTML:v.getText("HTMLViewsFactory - Ascent",{ascent:t.itinerary.ascent.toFixed(0)})},o),a.create("div",{className:e+"Route-Header-Descent",innerHTML:v.getText("HTMLViewsFactory - Descent",{descent:t.itinerary.descent.toFixed(0)})},o)),o}function re(e,t){let o=a.create("div");a.create("div",{className:e+"Route-ManeuversAndNotes-IconCell TravelNotes-ManeuverNote-"+t.maneuver.iconName},o);let r=a.create("div",{className:e+"Route-ManeuversAndNotes-Cell"},o);return a.create("div",{innerHTML:t.maneuver.instruction},r),t.route.chain&&a.create("div",{innerHTML:v.getText("HTMLViewsFactory - Distance from start of travel",{distance:f.formatDistance(t.route.chainedDistance+t.maneuverDistance)})},r),a.create("div",{innerHTML:v.getText("HTMLViewsFactory - Distance from start of route",{distance:f.formatDistance(t.maneuverDistance)})},r),n.defaultValue<t.maneuver.distance&&a.create("div",{innerHTML:v.getText("HTMLViewsFactory - Next maneuver after&nbsp;:&nbsp;{distance}",{distance:f.formatDistance(t.maneuver.distance)})},r),o}function ie(e,t){let o=[],n=t.notes.iterator;for(;!n.done;){let a=ae(e,{note:n.value,route:t});a.className=e+"Route-Notes-Row",a.objId=u(),a.latLng=n.value.latLng,a.noteObjId=n.value.objId,a.distance=n.value.distance,o.push(a)}let r=t.itinerary.maneuvers.iterator,i=0;for(;!r.done;){let a=re(e,{route:t,maneuver:r.value,maneuverDistance:i});a.className=e+"Route-Maneuvers-Row",a.objId=u(),a.latLng=t.itinerary.itineraryPoints.getAt(r.value.itineraryPointObjId).latLng,a.maneuverObjId=r.value.objId,a.distance=i,o.push(a),i+=r.value.distance}o.sort((e,t)=>e.distance-t.distance);let s=a.create("div",{className:e+"Route-ManeuversAndNotes"});return o.forEach(e=>s.appendChild(e)),s}function se(e,t){let o="";return""!==t.itinerary.provider&&""!==t.itinerary.transitMode&&(o=v.getText("HTMLViewsFactory - Itinerary computed by {provider} and optimized for {transitMode}",{provider:t.itinerary.provider,transitMode:v.getText("HTMLViewsFactory - TransitMode "+t.itinerary.transitMode)})),a.create("div",{className:e+"RouteFooter",innerHTML:o})}function le(e,t){let o=a.create("div",{className:e+"RouteProfile",innerHTML:v.getText("HTMLViewsFactory - Profile")});return o.appendChild(ee().createSvg(t)),o}function ce(e){let o=a.create("div",{className:e+"Travel"});o.appendChild(function(e){let o=a.create("div",{className:e+"Travel-Header"});a.create("div",{className:e+"Travel-Header-Name",innerHTML:K.travel.name},o);let r=n.defaultValue,i=0,s=0,l=K.travel.routes.iterator;for(;!l.done;){let n=l.value.objId===K.editedRouteObjId&&t.routeEditor.displayEditionInHTMLPage?K.travel.editedRoute:l.value,c=a.create("div",{className:e+"Travel-Header-RouteName"},o);a.create("a",{href:"#route"+n.objId,innerHTML:n.computedName},c),a.create("text",{value:" : "+f.formatDistance(n.distance)+"."},c),n.chain&&(r+=n.distance,i+=n.itinerary.ascent,s+=n.itinerary.descent)}return a.create("div",{className:e+"Travel-Header-TravelDistance",innerHTML:v.getText("HTMLViewsFactory - Travel distance&nbsp;:&nbsp;{distance}",{distance:f.formatDistance(r)})},o),0!==i&&a.create("div",{className:e+"Travel-Header-TravelAscent",innerHTML:v.getText("HTMLViewsFactory - Travel ascent&nbsp;:&nbsp;{ascent}",{ascent:i.toFixed(0)})},o),0!==s&&a.create("div",{className:e+"Travel-Header-TravelDescent",innerHTML:v.getText("HTMLViewsFactory - Travel descent&nbsp;:&nbsp;{descent}",{descent:s.toFixed(0)})},o),o}(e)),o.appendChild(oe(e));let r=K.travel.routes.iterator;for(;!r.done;){let a=t.routeEditor.displayEditionInHTMLPage&&r.value.objId===K.editedRouteObjId?K.travel.editedRoute:r.value;o.appendChild(ne(e,a)),a.itinerary.hasProfile&&o.appendChild(le(e,a)),o.appendChild(ie(e,a)),o.appendChild(se(e,a))}return o.appendChild(function(e){return a.create("div",{className:e+"TravelFooter",innerHTML:v.getText("HTMLViewsFactory - Travel footer")})}(e)),o}const de=Object.freeze(new class{getTravelHTML(e){return ce(e)}getNoteTextHTML(e,t){return te(e,t)}getEditedRouteManeuversAndNotesHTML(e){return ie(e,K.travel.editedRoute)}getTravelNotesHTML(e){return oe(e)}getRouteHeaderHTML(e,t){return ne(e,t)}});let ue=null,he=null;function ge(e){let t=Q.getRoute(e.target.objId),a=$.getClosestLatLngDistance(t,[e.latlng.lat,e.latlng.lng]).distance;a+=t.chainedDistance,a=f.formatDistance(a);let o=K.mapObjects.get(e.target.objId);o.closeTooltip();let n=t.computedName;K.travel.readOnly||(n+=0===n.length?"":" - ",n+=a),o.setTooltipContent(n),o.openTooltip(e.latlng)}function pe(e,t){t.objId=e,t.addTo(K.map),K.mapObjects.set(e,t)}function ve(e){let a=Q.getNoteAndRoute(e).note,o=L.marker(a.latLng,{icon:L.divIcon({iconSize:[t.note.grip.size,t.note.grip.size],iconAnchor:[t.note.grip.size/2,t.note.grip.size/2],html:"<div></div>",className:"TravelNotes-Note-Bullet"}),opacity:t.note.grip.opacity,draggable:!K.travel.readOnly});o.objId=a.objId;let n=L.divIcon({iconSize:[a.iconWidth,a.iconHeight],iconAnchor:[a.iconWidth/2,a.iconHeight/2],popupAnchor:[0,-a.iconHeight/2],html:a.iconContent,className:"TravelNotes-AllNotes "+t.note.style});let r=L.marker(a.iconLatLng,{zIndexOffset:100,icon:n,draggable:!K.travel.readOnly});r.objId=a.objId,r.bindPopup(e=>de.getNoteTextHTML("TravelNotes-",Q.getNoteAndRoute(e.objId))),0!==a.tooltipContent.length&&(r.bindTooltip(e=>Q.getNoteAndRoute(e.objId).note.tooltipContent),r.getTooltip().options.offset[0]=a.iconWidth/2);let i=L.polyline([a.latLng,a.iconLatLng],t.note.polyline);i.objId=a.objId;let s=L.layerGroup([r,i,o]);return s.markerId=L.Util.stamp(r),s.polylineId=L.Util.stamp(i),s.bulletId=L.Util.stamp(o),pe(a.objId,s),Object.freeze({marker:r,polyline:i,bullet:o})}function fe(e){e.dashArray>=t.route.dashChoices.length&&(e.dashArray=0);let a=t.route.dashChoices[e.dashArray].iDashArray;if(a){let t="",o=0;for(o=0;o<a.length-1;o++)t+=a[o]*e.width+",";return t+=a[o]*e.width,t}return null}const me=Object.seal(new class{addRoute(e){let t=Q.getRoute(e),a=[],o=t.itinerary.itineraryPoints.iterator;for(;!o.done;)a.push(o.value.latLng);let n=L.polyline(a,{color:t.color,weight:t.width,dashArray:fe(t)});pe(t.objId,n),l.notEdited===t.editionStatus&&(n.bindTooltip(t.computedName,{sticky:!0,direction:"right"}),n.on("mouseover",ge),n.on("mousemove",ge)),n.bindPopup(e=>{let t=Q.getRoute(e.objId);return de.getRouteHeaderHTML("TravelNotes-UI-",t)}),L.DomEvent.on(n,"click",e=>e.target.openPopup(e.latlng));let r=t.notes.iterator;for(;!r.done;)ve(r.value.objId);return t}addNote(e){return ve(e)}getDashArray(e){return fe(e)}zoomTo(e,a){if(a){let e=[];a.forEach(t=>e=e.concat(t)),K.map.fitBounds($.getLatLngBounds(e))}else K.map.setView(e,t.itineraryPointZoom)}setLayer(e){let t=null;t="wmts"===e.service.toLowerCase()?L.tileLayer(e.url):L.tileLayer.wms(e.url,e.wmsOptions),ue&&K.map.removeLayer(ue),K.map.addLayer(t),ue=t,K.travel.readOnly||(K.map.getZoom()<(e.minZoom||0)&&K.map.setZoom(e.minZoom||0),K.map.setMinZoom(e.minZoom||0),K.map.getZoom()>(e.maxZoom||18)&&K.map.setZoom(e.maxZoom||18),K.map.setMaxZoom(e.maxZoom||18),e.bounds?(K.map.getBounds().intersects(e.bounds)&&!K.map.getBounds().contains(e.bounds)||(K.map.setMaxBounds(null),K.map.fitBounds(e.bounds),K.map.setZoom(e.minZoom||0)),K.map.setMaxBounds(e.bounds)):K.map.setMaxBounds(null)),K.map.fire("baselayerchange",t)}onGeolocationStatusChanged(e){r.active!==e&&he&&(K.map.removeLayer(he),he=null)}onGeolocationPositionChanged(e){let a=t.geoLocation.zoomToPosition;he&&(K.map.removeLayer(he),a=!1),he=L.circleMarker(L.latLng(e.coords.latitude,e.coords.longitude),{radius:t.geoLocation.radius,color:t.geoLocation.color}).bindTooltip(f.formatLatLng([e.coords.latitude,e.coords.longitude])).addTo(K.map),a&&K.map.setView(L.latLng(e.coords.latitude,e.coords.longitude),t.geoLocation.zoomFactor)}});const be=Object.freeze(new class{dispatch(e,t){let a=function(e){return-1<["showitinerary","updateitinerary","showtravelnotes","updatetravelnotes","showsearch","updatesearch","setrouteslist","setprovider","providersadded","travelnameupdated","settransitmode"].indexOf(e)?document.getElementById("TravelNotes-UI-MainDiv"):-1<["removeobject","removeallobjects","zoomto","additinerarypointmarker","addsearchpointmarker","addrectangle","addwaypoint","layerchange","geolocationstatuschanged","geolocationpositionchanged","routeupdated","routepropertiesupdated","noteupdated","roadbookupdate","profileclosed"].indexOf(e)?document:null}(e);if(a){let o=new Event(e);t&&(o.data=t),a.dispatchEvent(o)}}});var ye={};function je(e){return Math.floor(Math.abs(e)+.5)*(e>=0?1:-1)}function we(e,t,a){var o=(e=je(e*a))-(t=je(t*a));o<<=1,e-t<0&&(o=~o);for(var n="";o>=32;)n+=String.fromCharCode(63+(32|31&o)),o>>=5;return n+=String.fromCharCode(o+63)}function Te(e){for(var t=[],a=0;a<e.length;a++){var o=e[a].slice();t.push([o[1],o[0]])}return t}function Le(){let e=[];function t(t){e.push(t.latLng),e.push(t.iconLatLng)}function a(a){a.itinerary.itineraryPoints.forEach(t=>e.push(t.latLng)),a.notes.forEach(e=>t(e))}return Object.seal(new class{zoomToLatLng(e){be.dispatch("zoomto",{latLng:e})}zoomToManeuver(e){let t=K.travel.editedRoute.itinerary.maneuvers.getAt(e).itineraryPointObjId,a=K.travel.editedRoute.itinerary.itineraryPoints.getAt(t).latLng;be.dispatch("zoomto",{latLng:a})}zoomToNote(a){e=[],t(Q.getNoteAndRoute(a).note),be.dispatch("zoomto",{geometry:[e]})}zoomToRoute(t){e=[],a(Q.getRoute(t)),be.dispatch("zoomto",{geometry:[e]})}zoomToTravel(){e=[],K.travel.routes.forEach(e=>a(e)),-1!==K.travel.editedRouteObjId&&a(K.travel.editedRoute),K.travel.notes.forEach(e=>t(e)),be.dispatch("zoomto",{geometry:[e]})}zoomToPoi(e){be.dispatch("zoomto",e)}})}function Ne(){return Object.seal(new class{openDistantFile(e){(function(){function e(e){let t={};0!==e.itinerary.itineraryPoints.length&&(t=e.itinerary.itineraryPoints[0].objType);let a={latLngs:[],distances:[],elevs:[],objIds:[],objType:t};e.itinerary.itineraryPoints.forEach(e=>{a.latLngs.push([e.lat,e.lng]),a.distances.push(e.distance),a.elevs.push(e.elev),a.objIds.push(e.objId)}),a.latLngs=ye.encode(a.latLngs,6),e.itinerary.itineraryPoints=a}function t(e){e.itinerary.itineraryPoints.latLngs=ye.decode(e.itinerary.itineraryPoints.latLngs,6);let t=[],a=0;e.itinerary.itineraryPoints.latLngs.forEach(o=>{let n={};n.lat=o[0],n.lng=o[1],n.distance=e.itinerary.itineraryPoints.distances[a],e.itinerary.itineraryPoints.elevs?n.elev=e.itinerary.itineraryPoints.elevs[a]:n.elev=i.defaultValue,n.objId=e.itinerary.itineraryPoints.objIds[a],n.objType=e.itinerary.itineraryPoints.objType,t.push(n),a++}),e.itinerary.itineraryPoints=t}function a(e){e.routes.forEach(t),e.editedRoute&&t(e.editedRoute)}return Object.seal(new class{decompress(e){a(e),K.travel.jsonObject=e,K.editedRouteObjId=-1,K.travel.routes.forEach(e=>{l.notEdited!==e.editionStatus&&(K.editedRouteObjId=e.objId)})}decompressMerge(e){a(e);let t=G();t.jsonObject=e;let o=t.routes.iterator;for(;!o.done;)K.travel.routes.add(o.value);let n=t.notes.iterator;for(;!n.done;)K.travel.notes.add(n.value)}compress(){let t=K.travel.jsonObject;return t.routes.forEach(e),e(t.editedRoute),t}})})().decompress(e),K.travel.readOnly=!0,this.display()}display(){let e=K.travel.routes.iterator;for(;!e.done;)l.notEdited===e.value.editionStatus&&be.dispatch("routeupdated",{removedRouteObjId:-1,addedRouteObjId:e.value.objId});-1!==K.editedRouteObjId&&be.dispatch("routeupdated",{removedRouteObjId:-1,addedRouteObjId:K.travel.editedRoute.objId});let t=K.travel.notes.iterator;for(;!t.done;)be.dispatch("noteupdated",{removedNoteObjId:-1,addedNoteObjId:t.value.objId});Le().zoomToTravel()}})}ye.decode=function(e,t){for(var a,o=0,n=0,r=0,i=[],s=0,l=0,c=null,d=Math.pow(10,Number.isInteger(t)?t:5);o<e.length;){c=null,s=0,l=0;do{l|=(31&(c=e.charCodeAt(o++)-63))<<s,s+=5}while(c>=32);a=1&l?~(l>>1):l>>1,s=l=0;do{l|=(31&(c=e.charCodeAt(o++)-63))<<s,s+=5}while(c>=32);n+=a,r+=1&l?~(l>>1):l>>1,i.push([n/d,r/d])}return i},ye.encode=function(e,t){if(!e.length)return"";for(var a=Math.pow(10,Number.isInteger(t)?t:5),o=we(e[0][0],0,a)+we(e[0][1],0,a),n=1;n<e.length;n++){var r=e[n],i=e[n-1];o+=we(r[0],i[0],a),o+=we(r[1],i[1],a)}return o},ye.fromGeoJSON=function(e,t){if(e&&"Feature"===e.type&&(e=e.geometry),!e||"LineString"!==e.type)throw new Error("Input must be a GeoJSON LineString");return ye.encode(Te(e.coordinates),t)},ye.toGeoJSON=function(e,t){return{type:"LineString",coordinates:Te(ye.decode(e,t))}},"object"==typeof module&&module.exports&&(module.exports=ye);const Oe=Object.seal(new class{createUI(){a.create("div",{id:"TravelNotes-AttributionsUI"},document.querySelector("body")),this.attributions=""}set attributions(e){document.getElementById("TravelNotes-AttributionsUI").innerHTML='&copy; <a href="http://leafletjs.com/" target="_blank" title="Leaflet">Leaflet</a> | &copy; <a href="http://www.openstreetmap.org/copyright" target="_blank" title="OpenStreetMap contributors">OpenStreetMap contributors</a> '+e+'| &copy; <a href="https://github.com/wwwouaiebe" target="_blank" title="https://github.com/wwwouaiebe">Travel & Notes</a> '}});let Me="geolocation"in navigator?r.inactive:r.disabled,Ie=null;function Pe(e){be.dispatch("geolocationpositionchanged",{position:e})}function xe(){r.active===Me&&(Me=r.inactive),be.dispatch("geolocationstatuschanged",{status:Me}),navigator.geolocation.clearWatch(Ie),Ie=null}function Ee(e){1===e.code&&(Me=r.refusedByUser),xe()}const He=Object.seal(new class{get status(){return Me}switch(){switch(Me){case r.inactive:Me=r.active,be.dispatch("geolocationstatuschanged",{status:Me}),navigator.geolocation.getCurrentPosition(Pe,Ee,t.geoLocation.options),Ie=navigator.geolocation.watchPosition(Pe,Ee,t.geoLocation.options);break;case r.active:xe()}return Me}});let Ce=null,Ae=[{service:"wmts",url:"https://{s}.tile.osm.org/{z}/{x}/{y}.png",name:"OSM - Color",toolbar:{text:"OSM",color:"red",backgroundColor:"white"},providerName:"OSM",providerKeyNeeded:!1,attribution:""}];function Re(e){e.stopPropagation(),be.dispatch("layerchange",{layer:e.target.layer}),Oe.attributions=e.target.layer.attribution}function Se(e){e.stopPropagation(),He.switch()}function De(e){e.stopPropagation(),Le().zoomToTravel()}function Fe(e){a.create("div",{className:"TravelNotes-ViewerLayersToolbarUI-Button",title:e.name,layer:e,innerHTML:e.toolbar.text,style:"color:"+e.toolbar.color+";background-color:"+e.toolbar.backgroundColor},Ce).addEventListener("click",Re,!1)}const Ve=Object.seal(new class{createUI(){Ce=a.create("div",{id:"TravelNotes-ViewerLayersToolbarUI"},document.querySelector("body")),a.create("div",{className:"TravelNotes-ViewerLayersToolbarUI-Button",title:"My position",innerHTML:"&#x1f310;",style:"color:black;background-color:white"},Ce).addEventListener("click",Se,!1),a.create("div",{className:"TravelNotes-ViewerLayersToolbarUI-Button",title:"Zoom on the travel",innerHTML:"&#x1f50d;",style:"color:black;background-color:white"},Ce).addEventListener("click",De,!1),Ae.forEach(Fe)}setLayer(e){let t=Ae.find(t=>t.name===e)||Ae[0];be.dispatch("layerchange",{layer:t}),Oe.attributions=t.attribution}addLayers(e){e.forEach(e=>{e.providerKeyNeeded||Ae.push(e)})}});let Ue=!1;const ke=Object.seal(new class{addReadOnlyMap(e,t){Ue||(Ue=!0,document.addEventListener("routeupdated",e=>{e.data&&me.addRoute(e.data.addedRouteObjId)},!1),document.addEventListener("noteupdated",e=>{e.data&&me.addNote(e.data.addedNoteObjId)},!1),document.addEventListener("zoomto",e=>{e.data&&me.zoomTo(e.data.latLng,e.data.geometry)},!1),document.addEventListener("layerchange",e=>{e.data&&me.setLayer(e.data.layer)}),document.addEventListener("geolocationpositionchanged",e=>{e.data&&me.onGeolocationPositionChanged(e.data.position)},!1),document.addEventListener("geolocationstatuschanged",e=>{e.data&&me.onGeolocationStatusChanged(e.data.status)},!1),Oe.createUI(),t&&Ve.createUI(),Ve.setLayer("OSM - Color"),e&&o.getJsonPromise(e).then(e=>{Ne().openDistantFile(e)}).catch(e=>{console.log(e||"Not possible to load the .trv file"),K.map.setView([s.defaultValue,s.defaultValue],2)}))}});(function(){let e=null,n=null,r=!1,i="";function l(a){var o,n,r,s;(o=a[0],i="fulfilled"===o.status?(o.value.language=e,t.overload(o.value),""):"Not possible to load the TravelNotesConfig.json file. ",i)?console.log(i):(n=a[1],r=a[3],i="fulfilled"===n.status?(v.setTranslations(n.value),""):"fulfilled"===r.status?(v.setTranslations(r.value),"Not possible to load the TravelNotes"+e.toUpperCase()+".json file. English will be used. "):"Not possible to load the translations. ",i+="fulfilled"===(s=a[2]).status?(Ve.addLayers(s.value),""):"Not possible to load the TravelNotesLayers.json file. Only the OpenStreetMap background will be available. ",""!==i&&(console.log(i),i=""))}return Object.freeze(new class{start(){window.L.travelNotes=ke,decodeURI(window.location.search).substr(1).split("&").forEach(t=>{"fil="===t.substr(0,4).toLowerCase()?n=decodeURIComponent(escape(atob(t.substr(4)))):"lng="===t.substr(0,4).toLowerCase()?e=t.substr(4).toLowerCase():"lay"===t.substr(0,3).toLowerCase()&&(r=!0)}),e=e||t.language,Promise.allSettled(function(){let t=window.location.origin+window.location.pathname+"TravelNotes";return[o.getJsonPromise(t+"Config.json"),o.getJsonPromise(t+e.toUpperCase()+".json"),o.getJsonPromise(t+"Layers.json"),o.getJsonPromise(t+"EN.json")]}()).then(e=>{l(e),function(){if(t.autoLoad&&""===i){a.create("div",{id:"Map"},document.querySelector("body"));let e=window.L.map("Map",{attributionControl:!1,zoomControl:!1}).setView([s.defaultValue,s.defaultValue],0);K.map=e,ke.addReadOnlyMap(n,r)}}()})}})})().start()}();
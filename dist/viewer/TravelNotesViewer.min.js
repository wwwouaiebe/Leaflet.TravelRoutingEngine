/**
 * 
 * @source: https://github.com/wwwouaiebe/leaflet.TravelNotes
 * 
 * @licstart  The following is the entire license notice for the
 * JavaScript code in this page.
 * 
 * leaflet.travelnotes - version 2.2.0
 * Build 00483 - 2021-02-05T18:40:13+0100 
 * Copyright 2017 2021 wwwouaiebe 
 * Contact: https://www.ouaie.be/
 * License: GPL-3.0
 * 
 * The JavaScript code in this page is free software: you can
 * redistribute it and/or modify it under the terms of the GNU
 * General Public License (GNU GPL) as published by the Free Software
 * Foundation, either version 3 of the License, or (at your option)
 * any later version.  The code is distributed WITHOUT ANY WARRANTY;
 * without even the implied warranty of MERCHANTABILITY or FITNESS
 * FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.
 * 
 * As additional permission under GNU GPL version 3 section 7, you
 * may distribute non-source (e.g., minimized or compacted) forms of
 * that code without the copy of the GNU GPL normally required by
 * section 4, provided you include this license notice and a URL
 * through which recipients can access the Corresponding Source.
 * 
 * @licend  The above is the entire license notice
 * for the JavaScript code in this page.
 * 
 */


!function(){"use strict";
/**
	@------------------------------------------------------------------------------------------------------------------------------

	@file Constants.js
	@copyright Copyright - 2017 2021 - wwwouaiebe - Contact: https://www.ouaie.be/
	@license GNU General Public License
	@private

	@------------------------------------------------------------------------------------------------------------------------------
	*/Object.freeze({notSaved:"🔴",modified:"🟡",saved:"🟢"});const e=Object.freeze({fixed:2,invalid:-1,defaultValue:0,metersInKm:1e3}),t=Object.freeze({refusedByUser:-1,disabled:0,inactive:1,active:2}),o=(Object.freeze({invalidPane:"43a6a53e-008a-4910-80a6-7a87d301ea15",itineraryPane:"8fbf0da7-4e6f-4bc7-8e20-1388461ccde7",travelNotesPane:"dffe782b-07df-4b81-a318-f287c0cf5ec6",searchPane:"228f00d7-43a8-4c13-897d-70400cb6dd58"}),Object.freeze({fixed:2,defaultValue:0})),n=Object.freeze({defaultValue:0,fixed:6,maxLat:90,minLat:-90,maxLng:180,minLng:-180}),a=Object.freeze({notEdited:0,editedNoChange:1,editedChanged:2}),i=Object.freeze({margin:100,height:500,width:1e3,yDeltaText:30,xDeltaText:10,vScales:[1,2,5,10,20,50,100,200,500,1e3,2e3,5e3],hScales:[1,2,5,10,20,50,100,200,500,1e3,2e3,5e3,1e4,2e4,5e4,1e5]}),r=Object.freeze({width:40,height:40,svgViewboxDim:200}),s=Object.freeze({d0:0,d90:90,d180:180,d270:270,d360:360,d540:540,toRadians:Math.PI/180,fromRadians:180/Math.PI}),l="http://www.w3.org/2000/svg",c=window.location.protocol,d=new DOMParser;let u=new Map;function h(e){return e.replaceAll(/</g,"&lt;").replaceAll(/>/g,"&gt;").replaceAll(/"/g,"&quot;").replaceAll(/\u0027/g,"&apos;").replaceAll(/\u0a00/g,"&nbsp;")}function g(e,t="href"){let o=d.parseFromString("<div>"+e+"</div>","text/html");if(!o||"#document"!==o.nodeName)return{url:"",errorsString:"Parsing error"};let n=o.querySelector("body").firstChild,a="";for(let e=0;e<n.childNodes.length;e++){if("#text"!==n.childNodes[e].nodeName)return{url:"",errorsString:"Invalid characters found in the url"};a+=n.childNodes[e].nodeValue}if(a=a.replaceAll(/</g,"").replaceAll(/>/g,"").replaceAll(/"/g,"").replaceAll(/\u0027/g,"").replaceAll(/&lt;/g,"").replaceAll(/&gt;/g,"").replaceAll(/&quot;/g,"").replaceAll(/&apos;/g,"").replaceAll(/%3C/g,"").replaceAll(/%3c/g,"").replaceAll(/%3E/g,"").replaceAll(/%3e/g,"").replaceAll(/%22/g,"").replaceAll(/%27/g,""),a!==e)return{url:"",errorsString:"Invalid characters found in the url"};let i=["https:"];if("http:"!==c&&"href"!==t||i.push("http:"),"href"===t){i.push("mailto:"),i.push("sms:"),i.push("tel:");let e=a.match(/^#\w*/);if(e&&a===e[0])return{url:a,errorsString:""}}"src"===t&&i.push("data:");let r=null;try{r=new URL(a)}catch(e){return{url:"",errorsString:"Invalid url string"}}if(-1===i.indexOf(r.protocol))return{url:"",errorsString:"Invalid protocol "+r.protocol};if(-1!==["sms:","tel:"].indexOf(r.protocol)&&r.pathname.match(/^\+[0-9,*,#]*$/))return{url:a,errorsString:""};try{encodeURIComponent(r.href)}catch(e){return{url:"",errorsString:"Invalid character in url"}}return{url:a,errorsString:""}}u.set("a",["href","target"]),u.set("div",[]),u.set("del",[]),u.set("em",[]),u.set("figcaption",[]),u.set("figure",[]),u.set("h1",[]),u.set("h2",[]),u.set("h3",[]),u.set("h4",[]),u.set("h5",[]),u.set("h6",[]),u.set("hr",[]),u.set("img",["src","alt","width","height"]),u.set("ins",[]),u.set("li",[]),u.set("mark",[]),u.set("ol",[]),u.set("p",[]),u.set("s",[]),u.set("small",[]),u.set("strong",[]),u.set("span",[]),u.set("sub",[]),u.set("sup",[]),u.set("ul",[]),u.set("svg",["xmlns","viewBox","class"]),u.set("text",["x","y","text-anchor"]),u.set("polyline",["points","class","transform"]);const p=Object.freeze(new class{sanitizeToColor(e){let t=e.match(/^#[0-9,A-F,a-f]{6}$/);return t?t[0]:null}sanitizeToUrl(e,t){return g(e,t)}sanitizeToJsString(e){return function(e){let t=d.parseFromString("<div>"+e+"</div>","text/html");if(!t||"#document"!==t.nodeName)return"";let o=t.querySelector("body").firstChild,n="";for(let e=0;e<o.childNodes.length;e++){if("#text"!==o.childNodes[e].nodeName)return"";n+=o.childNodes[e].nodeValue}return n=n.replaceAll(/</g,"≺").replaceAll(/>/g,"≻").replaceAll(/"/g,"″").replaceAll(/\u0027/g,"′"),n}(e)}sanitizeToHtmlElement(e,t){!function(e,t){let o=d.parseFromString("<div>"+e+"</div>","text/html");o&&"#document"===o.nodeName?function e(t,o){let n=t.childNodes;for(let a=0;a<n.length;a++){let n=t.childNodes[a],i=n.nodeName.toLowerCase(),r=u.get(i);if(r){r=r.concat(["id","class","dir","title"]);let t="svg"===i||"text"===i||"polyline"===i,a=t?document.createElementNS(l,i):document.createElement(i);if(r.forEach(e=>{if(t)n.hasAttributeNS(null,e)&&(a.setAttributeNS(null,e,n.getAttribute(e)),n.removeAttributeNS(null,e));else if(n.hasAttribute(e))if("href"===e||"src"===e){let t=g(n.getAttribute(e),e).url;""!==t&&a.setAttribute(e,t)}else a.setAttribute(e,n.getAttribute(e))}),n.hasAttribute("style")){n.getAttribute("style").split(";").forEach(e=>{let t=e.split(":");2!==t.length||"width"!==t[0].trim()&&"height"!==t[0].trim()||(a.style[t[0].trim()]=t[1].trim())})}o.appendChild(a),e(n,a)}else"#text"===i&&o.appendChild(document.createTextNode(n.nodeValue))}}(o.querySelector("body").firstChild,t):t.textContent=""}(e,t)}sanitizeToHtmlString(e){return function(e){let t="",o="",n=d.parseFromString("<div>"+e.replace("&nbsp;","਀")+"</div>","text/html");return n&&"#document"===n.nodeName?(function e(n){let a=n.childNodes;for(let i=0;i<a.length;i++){let a=n.childNodes[i],r=a.nodeName.toLowerCase(),s=u.get(r);if(s){s=s.concat(["id","class","dir","title"]);let n="svg"===r||"text"===r||"polyline"===r;t+="<"+r,s.forEach(e=>{if(n)a.hasAttributeNS(null,e)&&(t+=" "+e+'="'+h(a.getAttribute(e))+'"',a.removeAttribute(e));else if(a.hasAttribute(e))if("href"===e||"src"===e){let n=g(a.getAttribute(e),e).url;""===n?o+="\nAn invalid url ("+a.getAttribute(e)+") was removed from a "+e+" attribute":t+=" "+e+'="'+n+'"',a.removeAttribute(e)}else t+=" "+e+'="'+h(a.getAttribute(e))+'"',a.removeAttribute(e)}),t+=">",e(a),t+="</"+r+">"}else"#text"===r?t+=h(a.nodeValue):o+="\nAn invalid tag "+r+" was removed";if(a.hasAttributes)for(let e=0;e<a.attributes.length;e++)o+="\nAn unsecure attribute "+a.attributes[e].name+'="'+a.attributes[e].value+'" was removed.'}}(n.querySelector("body").firstChild),{htmlString:t,errorsString:o}):{htmlString:"",errorsString:"Parsing error"}}(e)}});let m={autoLoad:!1,map:{center:{lat:50.50923,lng:5.49542},zoom:12},travelNotesToolbarUI:{contactMail:{url:"https://github.com/wwwouaiebe/leaflet.TravelNotes/issues"}},layersToolbarUI:{haveLayersToolbarUI:!0,toolbarTimeOut:1500,theDevil:{addButton:!1}},mouseUI:{haveMouseUI:!0},errorUI:{timeOut:1e4,helpTimeOut:3e4,showError:!0,showWarning:!0,showInfo:!0,showHelp:!0},geoLocation:{color:"#ff0000",radius:11,zoomToPosition:!0,zoomFactor:17,options:{enableHighAccuracy:!1,maximumAge:0,timeout:1/0}},APIKeys:{showDialogButton:!0,saveToSessionStorage:!0,showAPIKeysInDialog:!0,dialogHaveUnsecureButtons:!0},contextMenu:{timeout:1500},routing:{auto:!0},language:"fr",itineraryPointMarker:{color:"#ff0000",weight:2,radius:7,fill:!1},searchPointMarker:{color:"#006400",weight:4,radius:20,fill:!1},searchPointPolyline:{color:"#006400",weight:4,radius:20,fill:!1},previousSearchLimit:{color:"#006400",fill:!1,weight:1},nextSearchLimit:{color:"#ff0000",fill:!1,weight:1},wayPoint:{reverseGeocoding:!1},route:{color:"#ff0000",width:3,dashArray:0,dashChoices:[{text:"——————",iDashArray:null},{text:"— — — — —",iDashArray:[4,2]},{text:"—‧—‧—‧—‧—",iDashArray:[4,2,0,2]},{text:"················",iDashArray:[0,2]}],elev:{smooth:!0,smoothCoefficient:.25,smoothPoints:3},showDragTooltip:3},note:{osmSearchNoteDialog:!1,reverseGeocoding:!1,grip:{size:10,opacity:0,moveOpacity:1},polyline:{color:"#808080",weight:1},haveBackground:!1,svgRoadbookDimCoef:2,svgAnleMaxDirection:{right:35,slightRight:80,continue:100,slightLeft:145,left:200,sharpLeft:270,sharpRight:340},svgZoom:17,svgRcnRefDistance:20,svgAngleDistance:10,osmCityAdminLevel:{GB:"10",DEFAULT:"8"},svgHamletDistance:200,svgVillageDistance:400,svgCityDistance:1200,svgTownDistance:1500,svgTimeOut:40,maxManeuversNotes:100},noteDialog:{toggleIconDimension:!0,toggleIconTextArea:!1,toggleTooltip:!1,togglePopupContent:!1,toggleAddress:!1,toggleLink:!1,togglePhone:!0,iconAreaHeight:2,popupAreaHeigth:8},itineraryPointZoom:17,routeEditor:{displayEditionInHTMLPage:!0},travelEditor:{clearAfterSave:!0,startMinimized:!0,timeout:1e3,startupRouteEdition:!0},haveBeforeUnloadWarning:!0,overpassApi:{url:"https://lz4.overpass-api.de/api/interpreter"},nominatim:{url:"https://nominatim.openstreetmap.org/",language:"*"},printRouteMap:{isEnabled:!0,maxTiles:240,paperWidth:287,paperHeight:200,pageBreak:!1,printNotes:!0,borderWidth:30,zoomFactor:15,entryPointMarker:{color:"#00ff00",weight:4,radius:10,fill:!0,fillOpacity:1},exitPointMarker:{color:"#ff0000",weight:4,radius:10,fill:!0,fillOpacity:1}},itineraryPane:{showNotes:!0,showManeuvers:!1},colorDialog:{haveSlider:!0,initialRed:0}};let f=new class{get autoLoad(){return m.autoLoad}get map(){return m.map}get travelNotesToolbarUI(){return m.travelNotesToolbarUI}get layersToolbarUI(){return m.layersToolbarUI}get mouseUI(){return m.mouseUI}get errorUI(){return m.errorUI}get APIKeys(){return m.APIKeys}get contextMenu(){return m.contextMenu}get routing(){return m.routing}get language(){return m.language}get itineraryPointMarker(){return m.itineraryPointMarker}get searchPointMarker(){return m.searchPointMarker}get searchPointPolyline(){return m.searchPointPolyline}get previousSearchLimit(){return m.previousSearchLimit}get nextSearchLimit(){return m.nextSearchLimit}get wayPoint(){return m.wayPoint}get route(){return m.route}get note(){return m.note}get noteDialog(){return m.noteDialog}get itineraryPointZoom(){return m.itineraryPointZoom}get routeEditor(){return m.routeEditor}get travelEditor(){return m.travelEditor}get haveBeforeUnloadWarning(){return m.haveBeforeUnloadWarning}get overpassApi(){return m.overpassApi}get nominatim(){return m.nominatim}get geoLocation(){return m.geoLocation}get printRouteMap(){return m.printRouteMap}get itineraryPane(){return m.itineraryPane}get colorDialog(){return m.colorDialog}overload(e){!function e(t,o){if("object"==typeof t&&"object"==typeof o)try{for(let n in o)"object"==typeof o[n]?e(t[n],o[n]):typeof t[n]==typeof o[n]&&("string"==typeof o[n]?o[n]="color"===n?p.sanitizeToColor(t[n])||o[n]:"url"===n?p.sanitizeToUrl(t[n]).url:p.sanitizeToJsString(t[n]):o[n]=t[n]||o[n]);for(let n in t)"object"==typeof t[n]?("[object Array]"===Object.prototype.toString.call(t[n])?o[n]=o[n]||[]:o[n]=o[n]||{},e(t[n],o[n])):"string"==typeof o.property?o[n]=p.sanitizeToHtmlString(t[n],[]).htmlString:o[n]=t[n]}catch(e){e instanceof Error&&console.error(e)}}(e,m),m=function e(t){for(let o in t)"object"==typeof t[o]&&(t[o]=e(t[o]));return Object.freeze(t)}(m)}};
/**
	@------------------------------------------------------------------------------------------------------------------------------

	@file HTMLElementsFactory.js
	@copyright Copyright - 2017 2021 - wwwouaiebe - Contact: https://www.ouaie.be/
	@license GNU General Public License
	@private

	@------------------------------------------------------------------------------------------------------------------------------
	*/const v=new class{constructor(){Object.freeze(this)}create(e,t,o){let n=null;return"text"===e.toLowerCase()?n=document.createTextNode(t.value||""):(n=document.createElement(e),t&&function(e,t){for(let o in t)try{e[o]=t[o]}catch(e){e instanceof Error&&console.error(e)}}(n,t)),o&&o.appendChild(n),n}};let y=0;function b(){return++y,y}
/**
	@------------------------------------------------------------------------------------------------------------------------------

	@file Version.js
	@copyright Copyright - 2017 2021 - wwwouaiebe - Contact: https://www.ouaie.be/
	@license GNU General Public License
	@private

	@------------------------------------------------------------------------------------------------------------------------------
	*/function w(e){const t=e;return new class{constructor(){Object.freeze(this)}get name(){return t}get version(){return"2.2.0"}get jsonObject(){return{name:t,version:"2.2.0"}}validate(e){if(!Object.getOwnPropertyNames(e).includes("name"))throw new Error("No name for "+t);if(t!==e.name)throw new Error("Invalid name for "+t);if(!Object.getOwnPropertyNames(e).includes("version"))throw new Error("No version for "+t)}}}function j(e){const t=e;let o=[];const n=function(){let e=t();if(!e.objType||!e.objType.name)throw new Error("invalid object name for collection");return e.objType.name}();function a(e){if(!e.objType||!e.objType.name||e.objType.name!==n)throw new Error("invalid object name for add function");o.push(e)}function i(){let e=-1;return Object.freeze({get value(){return e<o.length?o[e]:null},get previous(){return 0>=e?null:o[e-1]},get next(){return e<o.length-1?o[e+1]:null},get done(){return++e>=o.length},get first(){return 0===e},get last(){return e>=o.length-1},get index(){return e}})}function r(e){return o.findIndex(t=>t.objId===e)}function s(e,t,n){let a=r(e);if(-1===a)throw new Error("invalid objId for next or previous function");if(1!==n&&-1!==n)throw new Error("invalid direction");let i=t;for(i||(i=()=>!0),a+=n;-1<a&&a<o.length&&!i(o[a]);)a+=n;return-1===a||o.length===a?null:o[a]}return new class{constructor(){Object.freeze(this)}add(e){a(e)}forEach(e){let t=null,o=i();for(;!o.done;)t=e(o.value,t);return t}getAt(e){let t=r(e);return-1===t?null:o[t]}moveTo(e,t,n){let a=r(e),i=r(t);if(-1===a||-1===i)throw new Error("invalid objId for function  myMoveTo");n||i++,o.splice(i,0,o[a]),i<a&&a++,o.splice(a,1)}next(e,t){return s(e,t,1)}previous(e,t){return s(e,t,-1)}remove(e){if(-1===r(e))throw new Error("invalid objId for remove function");o.splice(r(e),1)}removeAll(e){e?o.splice(1,o.length-2):o.length=0}replace(e,t){let a=r(e);if(-1===a)throw new Error("invalid objId for replace function");if(!t.objType||!t.objType.name||t.objType.name!==n)throw new Error("invalid object name for replace function");o[a]=t}reverse(){o.reverse()}sort(e){o.sort(e)}swap(e,t){let n=r(e);if(-1===n||0===n&&t||o.length-1===n&&!t)throw new Error("invalid objId for swap function");let a=o[n];o[n]=o[n+(t?-1:1)],o[n+(t?-1:1)]=a}get first(){return o[0]}get iterator(){return i()}get last(){return o[o.length-1]}get length(){return o.length}get jsonObject(){let e=[],t=i();for(;!t.done;)e.push(t.value.jsonObject);return e}set jsonObject(e){o.length=0;let n=null;e.forEach(e=>{n=t(),n.jsonObject=e,a(n)})}}}let T=new Map;const N=new class{constructor(){Object.freeze(this)}setTranslations(e){e.forEach(e=>T.set(e.msgid,p.sanitizeToJsString(e.msgstr)))}getText(e,t){let o=T.get(e);return t&&o&&Object.getOwnPropertyNames(t).forEach(e=>o=o.replace("{"+e+"}",t[e])),o||e}};const L=new class{constructor(){Object.freeze(this)}get UUID(){let e=new Uint16Array(8);const t=["","-","-","-","-","","",""];window.crypto.getRandomValues(e);let o="";for(let n=0;n<8;n++)o+=e[n].toString(16).padStart(4,"0")+t[n];return o}storageAvailable(e){try{let t=window[e],o="__storage_test__";return t.setItem(o,o),t.removeItem(o),!0}catch(e){return!1}}saveFile(e,t,o){try{let n=window.URL.createObjectURL(new File([t],e,{type:o||"text/plain"})),a=document.createElement("a");a.setAttribute("href",n),a.setAttribute("download",e),a.click(),window.URL.revokeObjectURL(n)}catch(e){e instanceof Error&&console.error(e)}}formatTime(e){let t=Math.floor(e);if(0===t)return"";let o=Math.floor(t/86400),n=Math.floor(t%86400/3600),a=Math.floor(t%3600/60),i=Math.floor(t%60);return 0<o?o+" "+N.getText("Utilities - Day")+" "+n+" "+N.getText("Utilities - Hour"):0<n?n+" "+N.getText("Utilities - Hour")+" "+a+" "+N.getText("Utilities - Minute"):0<a?a+" "+N.getText("Utilities - Minute"):i+" "+N.getText("Utilities - Second")}formatDistance(t){let o=Math.floor(t);return 0>=o?"0 km":Math.floor(o/e.metersInKm)+","+Math.floor(o%e.metersInKm/10).toFixed(0).padStart(2,"0").padEnd(3,"0")+" km"}formatLat(e){return e>0?e.toFixed(n.fixed)+" N":(-e).toFixed(n.fixed)+" S"}formatLng(e){return e>0?e.toFixed(n.fixed)+" E":(-e).toFixed(n.fixed)+" W"}formatLatLng(e){return 0===e[0]&&0===e[1]?"":this.formatLat(e[0])+" - "+this.formatLng(e[1])}},O=w("WayPoint"),x=new WeakMap;function I(e){if(!Object.getOwnPropertyNames(e).includes("objType"))throw new Error("No objType for "+O.name);O.validate(e.objType),O.version!==e.objType.version&&function(e){switch(e.objType.version){case"1.0.0":case"1.1.0":case"1.2.0":case"1.3.0":case"1.4.0":case"1.5.0":case"1.6.0":case"1.7.0":case"1.7.1":case"1.8.0":case"1.9.0":case"1.10.0":case"1.11.0":e.address=e.name,e.name="";case"1.12.0":case"1.13.0":case"2.0.0":case"2.1.0":e.objType.version="2.2.0";break;default:throw new Error("invalid version for "+O.name)}}(e);let t=Object.getOwnPropertyNames(e);return["address","name","lat","lng","objId"].forEach(e=>{if(!t.includes(e))throw new Error("No "+e+" for "+O.name)}),e}class A{constructor(){this.name="",this.address="",this.lat=n.defaultValue,this.lng=n.defaultValue,x.set(this,b()),Object.seal(this)}get fullName(){let e=""===this.name?this.address:this.name+", "+this.address;return""===e&&(e=L.formatLatLng([this.lat,this.lng])),e}get latLng(){return[this.lat,this.lng]}set latLng(e){this.lat=e[0],this.lng=e[1]}get objId(){return x.get(this)}get objType(){return O}get jsonObject(){return{name:this.name,address:this.address,lat:parseFloat(this.lat.toFixed(n.fixed)),lng:parseFloat(this.lng.toFixed(n.fixed)),objId:x.get(this),objType:O.jsonObject}}set jsonObject(e){let t=I(e);this.address=t.address||"",this.name=t.name||"",this.lat=t.lat||n.defaultValue,this.lng=t.lng||n.defaultValue,x.set(this,b()),this.validateData()}validateData(){"string"==typeof this.address?this.address=p.sanitizeToJsString(this.address):this.address="","string"==typeof this.name?this.name=p.sanitizeToJsString(this.name):this.name="","number"!=typeof this.lat&&(this.lat=n.defaultValue),"number"!=typeof this.lng&&(this.lng=n.defaultValue)}}function P(){return new A}const M=w("ItineraryPoint"),S=new WeakMap;function E(e){if(!Object.getOwnPropertyNames(e).includes("objType"))throw new Error("No objType for "+M.name);M.validate(e.objType),M.version!==e.objType.version&&function(e){switch(e.objType.version){case"1.0.0":case"1.1.0":case"1.2.0":case"1.3.0":case"1.4.0":case"1.5.0":case"1.6.0":e.elev=o.defaultValue;case"1.7.0":case"1.7.1":case"1.8.0":case"1.9.0":case"1.10.0":case"1.11.0":case"1.12.0":case"1.13.0":case"2.0.0":case"2.1.0":e.objType.version="2.2.0";break;default:throw new Error("invalid version for "+M.name)}}(e);let t=Object.getOwnPropertyNames(e);return["lat","lng","distance","elev","objId"].forEach(e=>{if(!t.includes(e))throw new Error("No "+e+" for "+M.name)}),e}class C{constructor(){this.lat=n.defaultValue,this.lng=n.defaultValue,this.distance=e.defaultValue,this.elev=o.defaultValue,S.set(this,b()),Object.seal(this)}get latLng(){return[this.lat,this.lng]}set latLng(e){this.lat=e[0],this.lng=e[1]}get objType(){return M}get objId(){return S.get(this)}get jsonObject(){return{lat:parseFloat(this.lat.toFixed(n.fixed)),lng:parseFloat(this.lng.toFixed(n.fixed)),distance:parseFloat(this.distance.toFixed(e.fixed)),elev:parseFloat(this.elev.toFixed(o.fixed)),objId:S.get(this),objType:M.jsonObject}}set jsonObject(t){let a=E(t);this.lat=a.lat||n.defaultValue,this.lng=a.lng||n.defaultValue,this.distance=a.distance||e.defaultValue,this.elev=a.elev||o.defaultValue,S.set(this,b()),this.validateData()}validateData(){"number"!=typeof this.lat&&(this.lat=n.defaultValue),"number"!=typeof this.lng&&(this.lng=n.defaultValue),"number"!=typeof this.distance&&(this.distance=e.defaultValue),"number"!=typeof this.elev&&(this.elev=o.defaultValue)}}function z(){return new C}const D=w("Maneuver"),H=new WeakMap;function V(t){if(!Object.getOwnPropertyNames(t).includes("objType"))throw new Error("No objType for "+D.name);D.validate(t.objType),D.version!==t.objType.version&&function(t){switch(t.objType.version){case"1.0.0":case"1.1.0":case"1.2.0":case"1.3.0":case"1.4.0":case"1.5.0":case"1.6.0":case"1.7.0":case"1.7.1":case"1.8.0":case"1.9.0":case"1.10.0":case"1.11.0":"kArriveDefault"===t.iconName&&(t.distance=e.defaultValue);case"1.12.0":case"1.13.0":case"2.0.0":case"2.1.0":t.objType.version="2.2.0";break;default:throw new Error("invalid version for "+D.name)}}(t);let o=Object.getOwnPropertyNames(t);return["iconName","instruction","distance","duration","itineraryPointObjId","objId"].forEach(e=>{if(!o.includes(e))throw new Error("No "+e+" for "+D.name)}),t}class R{constructor(){this.iconName="",this.instruction="",this.itineraryPointObjId=-1,this.distance=e.defaultValue,this.duration=e.defaultValue,H.set(this,b()),Object.seal(this)}get objType(){return D}get objId(){return H.get(this)}get jsonObject(){return{iconName:this.iconName,instruction:this.instruction,distance:parseFloat(this.distance.toFixed(e.fixed)),duration:this.duration,itineraryPointObjId:this.itineraryPointObjId,objId:H.get(this),objType:D.jsonObject}}set jsonObject(t){let o=V(t);this.iconName=o.iconName||"",this.instruction=o.instruction||"",this.distance=o.distance||e.defaultValue,this.duration=o.duration||e.defaultValue,this.itineraryPointObjId=o.itineraryPointObjId||-1,H.set(this,b()),this.validateData()}validateData(){"string"==typeof this.iconName?this.iconName=p.sanitizeToJsString(this.iconName):this.iconName="","string"==typeof this.instruction?this.instruction=p.sanitizeToJsString(this.instruction):this.instruction="","number"!=typeof this.distance&&(this.distance=e.defaultValue),"number"!=typeof this.duration&&(this.duration=e.defaultValue),"number"!=typeof this.itineraryPointObjId&&(this.itineraryPointObjId=-1)}}function k(){return new R}const F=w("Itinerary"),U=new WeakMap;function W(e){if(!Object.getOwnPropertyNames(e).includes("objType"))throw new Error("No objType for "+F.name);F.validate(e.objType),F.version!==e.objType.version&&function(e){switch(e.objType.version){case"1.0.0":case"1.1.0":case"1.2.0":case"1.3.0":case"1.4.0":case"1.5.0":case"1.6.0":e.hasProfile=!1,e.ascent=0,e.descent=0;case"1.7.0":case"1.7.1":case"1.8.0":case"1.9.0":case"1.10.0":case"1.11.0":case"1.12.0":case"1.13.0":case"2.0.0":case"2.1.0":e.objType.version="2.2.0";break;default:throw new Error("invalid version for "+F.name)}}(e);let t=Object.getOwnPropertyNames(e);return["hasProfile","ascent","descent","itineraryPoints","maneuvers","provider","transitMode","objId"].forEach(e=>{if(!t.includes(e))throw new Error("No "+e+" for "+F.name)}),e}class B{constructor(){this.hasProfile=!1,this.ascent=0,this.descent=0,this.provider="",this.transitMode="",this.itineraryPoints=j(z),this.maneuvers=j(k),U.set(this,b()),Object.seal(this)}get objType(){return F}get objId(){return U.get(this)}get jsonObject(){return{hasProfile:this.hasProfile,ascent:this.ascent,descent:this.descent,itineraryPoints:this.itineraryPoints.jsonObject,maneuvers:this.maneuvers.jsonObject,provider:this.provider,transitMode:this.transitMode,objId:U.get(this),objType:F.jsonObject}}set jsonObject(e){let t=W(e);this.hasProfile=t.hasProfile||!1,this.ascent=t.ascent||0,this.descent=t.descent||0,this.itineraryPoints.jsonObject=t.itineraryPoints||[],this.maneuvers.jsonObject=t.maneuvers||[],this.provider=t.provider||"",this.transitMode=t.transitMode||"",U.set(this,b());let o=new Map,n=0,a=this.itineraryPoints.iterator;for(;!a.done;)o.set(t.itineraryPoints[n].objId,a.value.objId),n++;let i=this.maneuvers.iterator;for(;!i.done;)i.value.itineraryPointObjId=o.get(i.value.itineraryPointObjId);this.validateData()}validateData(){"boolean"!=typeof this.hasProfile&&(this.hasProfile=!1),"number"!=typeof this.ascent&&(this.ascent=0),"number"!=typeof this.descent&&(this.descent=0),"string"==typeof this.provider?this.provider=p.sanitizeToJsString(this.provider):this.provider="","string"==typeof this.transitMode?this.transitMode=p.sanitizeToJsString(this.transitMode):this.transitMode=""}}function Z(){return new B}const _=w("Note"),K=new WeakMap;function J(e){return e.replaceAll(/style='color:white;background-color:red'/g,"class='TravelNotes-Note-WhiteRed'").replaceAll(/style='color:white;background-color:green'/g,"class='TravelNotes-Note-WhiteGreen'").replaceAll(/style='color:white;background-color:blue'/g,"class='TravelNotes-Note-WhiteBlue'").replaceAll(/style='color:white;background-color:brown'/g,"class='TravelNotes-Note-WhiteBrown'").replaceAll(/style='color:white;background-color:black'/g,"class='TravelNotes-Note-WhiteBlack'").replaceAll(/style='border:solid 0.1em'/g,"class='TravelNotes-Note-BlackWhite'").replaceAll(/style='background-color:white;'/g,"class='TravelNotes-Note-Knooppunt'").replaceAll(/style='fill:green;font:bold 120px sans-serif;'/g,"").replaceAll(/style='fill:none;stroke:green;stroke-width:10;'/g,"")}function q(e){if(!Object.getOwnPropertyNames(e).includes("objType"))throw new Error("No objType for "+_.name);_.validate(e.objType),_.version!==e.objType.version&&function(e){switch(e.objType.version){case"1.0.0":case"1.1.0":case"1.2.0":case"1.3.0":case"1.4.0":case"1.5.0":case"1.6.0":case"1.7.0":case"1.7.1":case"1.8.0":case"1.9.0":case"1.10.0":case"1.11.0":case"1.12.0":case"1.13.0":"string"==typeof e.iconHeight&&(e.iconHeight=Number.parseInt(e.iconHeight)),"string"==typeof e.iconWidth&&(e.iconWidth=Number.parseInt(e.iconWidth)),e.iconContent=J(e.iconContent),e.popupContent=J(e.popupContent),e.tooltipContent=J(e.tooltipContent),e.phone=J(e.phone),e.address=J(e.address);case"2.0.0":case"2.1.0":e.objType.version="2.2.0";break;default:throw new Error("invalid version for "+_.name)}}(e);let t=Object.getOwnPropertyNames(e);return["iconHeight","iconWidth","iconContent","popupContent","tooltipContent","phone","url","address","iconLat","iconLng","lat","lng","distance","chainedDistance","objId"].forEach(e=>{if(!t.includes(e))throw new Error("No "+e+" for "+_.name)}),e}class G{constructor(){this.iconHeight=0,this.iconWidth=0,this.iconContent="",this.popupContent="",this.tooltipContent="",this.phone="",this.url="",this.address="",this.iconLat=n.defaultValue,this.iconLng=n.defaultValue,this.lat=n.defaultValue,this.lng=n.defaultValue,this.distance=e.invalid,this.chainedDistance=e.defaultValue,K.set(this,b()),Object.seal(this)}get isRouteNote(){return this.distance!==e.invalid}get iconLatLng(){return[this.iconLat,this.iconLng]}set iconLatLng(e){this.iconLat=e[0],this.iconLng=e[1]}get latLng(){return[this.lat,this.lng]}set latLng(e){this.lat=e[0],this.lng=e[1]}get objType(){return _}get objId(){return K.get(this)}get jsonObject(){return{iconHeight:this.iconHeight,iconWidth:this.iconWidth,iconContent:this.iconContent,popupContent:this.popupContent,tooltipContent:this.tooltipContent,phone:this.phone,url:this.url,address:this.address,iconLat:parseFloat(this.iconLat.toFixed(n.fixed)),iconLng:parseFloat(this.iconLng.toFixed(n.fixed)),lat:parseFloat(this.lat.toFixed(n.fixed)),lng:parseFloat(this.lng.toFixed(n.fixed)),distance:parseFloat(this.distance.toFixed(e.fixed)),chainedDistance:parseFloat(this.chainedDistance.toFixed(e.fixed)),objId:K.get(this),objType:_.jsonObject}}set jsonObject(t){let o=q(t);this.iconHeight=o.iconHeight||0,this.iconWidth=o.iconWidth||0,this.iconContent=o.iconContent||"",this.popupContent=o.popupContent||"",this.tooltipContent=o.tooltipContent||"",this.phone=o.phone||"",this.url=o.url||"",this.address=o.address||"",this.iconLat=o.iconLat||n.defaultValue,this.iconLng=o.iconLng||n.defaultValue,this.lat=o.lat||n.defaultValue,this.lng=o.lng||n.defaultValue,this.distance=o.distance||e.invalid,this.chainedDistance=o.chainedDistance||e.defaultValue,K.set(this,b()),this.validateData(!0)}validateData(t){if("number"!=typeof this.iconHeight&&(this.iconHeight=0),"number"!=typeof this.iconWidth&&(this.iconWidth=0),"string"==typeof this.iconContent){let e=p.sanitizeToHtmlString(this.iconContent);t&&""!==e.errorsString&&console.log(e.errorsString+" ("+this.iconContent+")"),this.iconContent=e.htmlString}else this.iconContent="";if("string"==typeof this.popupContent){let e=p.sanitizeToHtmlString(this.popupContent);t&&""!==e.errorsString&&console.log(e.errorsString+" ("+this.popupContent+")"),this.popupContent=e.htmlString}else this.popupContent="";if("string"==typeof this.tooltipContent){let e=p.sanitizeToHtmlString(this.tooltipContent);t&&""!==e.errorsString&&console.log(e.errorsString+" ("+this.tooltipContent+")"),this.tooltipContent=e.htmlString}else this.tooltipContent="";if("string"==typeof this.phone){let e=p.sanitizeToHtmlString(this.phone);t&&""!==e.errorsString&&console.log(e.errorsString+" ("+this.phone+")"),this.phone=e.htmlString}else this.phone="";if("string"==typeof this.url&&""!==this.url){let e=p.sanitizeToUrl(this.url);t&&""!==e.errorsString&&console.log(e.errorsString+" ("+this.url+")"),this.url=encodeURI(e.url)}else this.url="";"string"==typeof this.address?this.address=p.sanitizeToHtmlString(this.address).htmlString:this.address="","number"!=typeof this.iconLat&&(this.iconLat=n.defaultValue),"number"!=typeof this.iconLng&&(this.iconLng=n.defaultValue),"number"!=typeof this.lat&&(this.lat=n.defaultValue),"number"!=typeof this.lng&&(this.lng=n.defaultValue),"number"!=typeof this.distance&&(this.distance=e.invalid),"number"!=typeof this.chainedDistance&&(this.chainedDistance=e.defaultValue)}}function X(){return new G}const $=w("Route"),Q=new WeakMap;function Y(e){if(!Object.getOwnPropertyNames(e).includes("objType"))throw new Error("No objType for "+$.name);$.validate(e.objType),$.version!==e.objType.version&&function(e){switch(e.objType.version){case"1.0.0":e.dashArray=0,e.hidden=!1;case"1.1.0":case"1.2.0":case"1.3.0":case"1.4.0":e.edited=a.notEdited;case"1.5.0":case"1.6.0":case"1.7.0":case"1.7.1":case"1.8.0":case"1.9.0":case"1.10.0":case"1.11.0":e.editionStatus=e.edited;case"1.12.0":case"1.13.0":case"2.0.0":case"2.1.0":e.objType.version="2.2.0";break;default:throw new Error("invalid version for "+$.name)}}(e);let t=Object.getOwnPropertyNames(e);return["name","wayPoints","notes","itinerary","width","color","dashArray","chain","distance","duration","editionStatus","hidden","chainedDistance","objId"].forEach(e=>{if(!t.includes(e))throw new Error("No "+e+" for "+$.name)}),e}class ee{constructor(){this.name="",this.wayPoints=j(P),this.wayPoints.add(P()),this.wayPoints.add(P()),this.notes=j(X),this.itinerary=Z(),this.width=f.route.width,this.color=f.route.color,this.dashArray=f.route.dashArray,this.chain=!0,this.chainedDistance=e.defaultValue,this.distance=e.defaultValue,this.duration=e.defaultValue,this.editionStatus=a.notEdited,this.hidden=!1,Q.set(this,b()),Object.seal(this)}get computedName(){let e=this.name;return""===e&&(e=(""===this.wayPoints.first.fullName?"???":this.wayPoints.first.fullName)+" ⮞ "+(""===this.wayPoints.last.fullName?"???":this.wayPoints.last.fullName)),e}get objId(){return Q.get(this)}get objType(){return $}get jsonObject(){return{name:this.name,wayPoints:this.wayPoints.jsonObject,notes:this.notes.jsonObject,itinerary:this.itinerary.jsonObject,width:this.width,color:this.color,dashArray:this.dashArray,chain:this.chain,distance:parseFloat(this.distance.toFixed(e.fixed)),duration:this.duration,editionStatus:this.editionStatus,hidden:this.hidden,chainedDistance:parseFloat(this.chainedDistance.toFixed(e.fixed)),objId:Q.get(this),objType:$.jsonObject}}set jsonObject(e){let t=Y(e);this.name=t.name||"",this.wayPoints.jsonObject=t.wayPoints||[],this.notes.jsonObject=t.notes||[],this.itinerary.jsonObject=t.itinerary||Z().jsonObject,this.width=t.width||f.route.width,this.color=t.color||"#000000",this.dashArray=t.dashArray||0,this.chain=t.chain||!1,this.distance=t.distance,this.duration=t.duration,this.editionStatus=t.editionStatus||a.notEdited,this.hidden=t.hidden||!1,this.chainedDistance=t.chainedDistance,Q.set(this,b()),this.validateData()}validateData(){"string"==typeof this.name?this.name=p.sanitizeToJsString(this.name):this.name="","number"!=typeof this.width&&(this.width=f.route.width),"string"==typeof this.color?this.color=p.sanitizeToColor(this.color)||f.route.color:this.color=f.route.color,"number"!=typeof this.dashArray&&(this.dashArray=0),this.dashArray>=f.route.dashChoices.length&&(this.dashArray=0),"boolean"!=typeof this.chain&&(this.chain=!1),"number"!=typeof this.distance&&(this.distance=e.defaultValue),"number"!=typeof this.duration&&(this.duration=e.defaultValue),"number"!=typeof this.editionStatus&&(this.editionStatus=a.notEdited),"boolean"!=typeof this.hidden&&(this.hidden=!1),"number"!=typeof this.chainedDistance&&(this.chainedDistance=e.defaultValue)}}function te(){return new ee}const oe=w("Travel"),ne=new WeakMap;function ae(e){if(!Object.getOwnPropertyNames(e).includes("objType"))throw new Error("No objType for "+oe.name);oe.validate(e.objType),oe.version!==e.objType.version&&function(e){switch(e.objType.version){case"1.0.0":case"1.1.0":case"1.2.0":case"1.3.0":case"1.4.0":e.editedRoute=te();case"1.5.0":if(e.userData.layerId){let t=[{layerId:"0",layerName:"OSM - Color"},{layerId:"1",layerName:"OSM - Black and White"},{layerId:"2",layerName:"Thunderforest - Transport"},{layerId:"3",layerName:"Thunderforest - OpenCycleMap"},{layerId:"4",layerName:"Thunderforest - Outdoors"},{layerId:"5",layerName:"Esri - Aerial view"},{layerId:"6",layerName:"Kartverket - Norway"},{layerId:"7",layerName:"IGN-NGI - Belgium now"},{layerId:"12",layerName:"Thunderforest - Landscape"},{layerId:"24",layerName:"Lantmäteriet - Sweden"},{layerId:"25",layerName:"Maanmittauslaitos - Finland"}].find(t=>t.layerId===e.userData.layerId);e.layerName=t?t.layerName:"OSM - Color"}else e.layerName="OSM - Color";case"1.6.0":case"1.7.0":case"1.7.1":case"1.8.0":case"1.9.0":case"1.10.0":case"1.11.0":case"1.12.0":case"1.13.0":case"2.0.0":case"2.1.0":e.objType.version="2.2.0";break;default:throw new Error("invalid version for "+oe.name)}}(e);let t=Object.getOwnPropertyNames(e);return["name","editedRoute","routes","objId"].forEach(e=>{if(!t.includes(e))throw new Error("No "+e+" for "+oe.name)}),e}class ie{constructor(){this.editedRoute=te(),this.routes=j(te),this.notes=j(X),this.layerName="OSM - Color",this.name="",this.readOnly=!1,ne.set(this,b()),Object.seal(this)}get objId(){return ne.get(this)}get objType(){return oe}get jsonObject(){return{editedRoute:this.editedRoute.jsonObject,layerName:this.layerName,name:this.name,routes:this.routes.jsonObject,notes:this.notes.jsonObject,readOnly:this.readOnly,objId:ne.get(this),objType:oe.jsonObject}}set jsonObject(e){let t=ae(e);this.editedRoute.jsonObject=t.editedRoute,this.layerName=e.layerName||"OSM - Color",this.name=t.name||"",this.readOnly=t.readOnly||!1,this.routes.jsonObject=t.routes||[],this.notes.jsonObject=t.notes||[],ne.set(this,b()),this.validateData()}validateData(){"string"==typeof this.layerName?this.layerName=p.sanitizeToJsString(this.layerName):this.layerName="OSM - Color","string"==typeof this.name?this.name=p.sanitizeToJsString(this.name):this.name="TravelNotes","boolean"!=typeof this.readOnly&&(this.readOnly=!0)}}function re(){return new ie}let se=new Map,le=new Map,ce=Object.seal({provider:"",transitMode:""}),de=L.UUID;const ue=new class{constructor(){this.map=null,this.travel=re(),this.editedRouteObjId=-1,this.searchData=[],Object.seal(this)}get providers(){return se}get mapObjects(){return le}get routing(){return ce}get UUID(){return de}};const he=new class{constructor(){Object.freeze(this)}getRoute(e){let t=null;return t=ue.travel.routes.getAt(e),t||e===ue.travel.editedRoute.objId&&(t=ue.travel.editedRoute),t}getNoteAndRoute(e){let t=null,o=null;if(t=ue.travel.notes.getAt(e),!t){let n=ue.travel.routes.iterator;for(;!n.done&&!t;)t=n.value.notes.getAt(e),t&&(o=n.value);t||(t=ue.travel.editedRoute.notes.getAt(e),t&&(o=ue.travel.editedRoute))}return Object.freeze({note:t,route:o})}getWayPoint(e){let t=ue.travel.editedRoute.wayPoints.getAt(e);if(!t){let o=ue.travel.routes.iterator;for(;!o.done&&!t;)t=o.value.wayPoints.getAt(e)}return t}};const ge=new class{constructor(){Object.freeze(this)}getLatLngElevAtDist(e,t){if(e.distance<=t||0>=t)return null;let o=0,n=e.itinerary.itineraryPoints.iterator;for(;o<t&&!n.done;)o+=n.value.distance;let a=n.value;n.done;let i=(a.distance-o+t)/a.distance;return Object.freeze({latLng:[a.lat+(n.value.lat-a.lat)*i,a.lng+(n.value.lng-a.lng)*i],elev:a.elev+(n.value.elev-a.elev)*i,ascent:100*(n.value.elev-a.elev)/a.distance,routeDistance:t})}getClosestLatLngDistance(t,o){if(0===t.itinerary.itineraryPoints.length)return null;let n=t.itinerary.itineraryPoints.iterator;n.done;let a=Number.MAX_VALUE,i=window.L.Projection.SphericalMercator.project(window.L.latLng(o[0],o[1])),r=window.L.Projection.SphericalMercator.project(window.L.latLng(n.value.lat,n.value.lng)),s=null,l=e.defaultValue,c=n.value.distance;for(;!n.done;){let e=window.L.Projection.SphericalMercator.project(window.L.latLng(n.value.lat,n.value.lng)),t=window.L.LineUtil.pointToSegmentDistance(i,r,e);t<a&&(a=t,s=window.L.Projection.SphericalMercator.unproject(window.L.LineUtil.closestPointOnSegment(i,r,e)),l=c-s.distanceTo(window.L.latLng(n.value.lat,n.value.lng))),c+=n.value.distance,r=e}return Object.freeze({latLng:[s.lat,s.lng],distance:l})}getLatLngBounds(e){let t=window.L.latLng([n.maxLat,n.maxLng]),o=window.L.latLng([n.minLat,n.minLng]);return e.forEach(e=>{t.lat=Math.min(t.lat,e[0]),t.lng=Math.min(t.lng,e[1]),o.lat=Math.max(o.lat,e[0]),o.lng=Math.max(o.lng,e[1])}),window.L.latLngBounds(t,o)}getSquareBoundingBox(e,t){let o=t/6371e3*s.fromRadians,n=e[0]*s.toRadians,a=Math.acos((Math.cos(t/6371e3)-Math.sin(n)**2)/Math.cos(n)**2)*s.fromRadians;return window.L.latLngBounds(window.L.latLng([e[0]-o,e[1]-a]),window.L.latLng([e[0]+o,e[1]+a]))}project(e,t){let o=ue.map.project(window.L.latLng(e),t);return[o.x,o.y]}screenCoordToLatLng(e,t){let o=ue.map.containerPointToLatLng(window.L.point(e,t));return[o.lat,o.lng]}addPoints(e,t){return[e[0]+t[0],e[1]+t[1]]}subtrackPoints(e,t){return[e[0]-t[0],e[1]-t[1]]}},pe=i.margin.toFixed(0),me=(i.margin+i.height).toFixed(0),fe=(i.margin+i.width).toFixed(0),ve=i.margin.toFixed(0),ye=(i.margin+i.width+i.xDeltaText).toFixed(0),be=(i.margin-i.xDeltaText).toFixed(0),we=i.margin+i.height+i.margin/2;function je(){let t=null,o=1,n=1,a=Number.MAX_VALUE,r=0,s=0,c=null,d=0,u=f.route.elev.smoothCoefficient,h=f.route.elev.smoothPoints;function g(){let e=function(){let e=0,t=0,o=[],n=c.itinerary.itineraryPoints.iterator,a=0,i=n.done;for(o.push({distance:e,elev:n.value.elev}),a+=n.value.distance,i=n.done;!i;){for(e+=d;e>=a&&!i;)a+=n.value.distance,i=n.done;if(!i){let i=(n.value.elev-n.previous.elev)/n.previous.distance;t=n.value.elev-(a-e)*i,o.push({distance:e,elev:t})}}return o.push({distance:a,elev:c.itinerary.itineraryPoints.last.elev}),o}(),t=new Map,o=(e[h].elev-e[0].elev)/h,n=0;for(n=0;n<h;n++)t.set(n*d,{distance:n*d,elev:e[0].elev+o*n});for(n=h;n<e.length-h;n++){let o=0;for(let t=n-h;n+h>=t;t++)o+=e[t].elev;t.set(e[n].distance,{distance:e[n].distance,elev:o/(2*h+1)})}return n--,o=d*(e[e.length-1].elev-e[e.length-1-h].elev)/(e[e.length-1].distance-e[e.length-1-h].distance),t.set(e[n].distance+d,{distance:e[n].distance+d,elev:e[n].elev+o}),t.set(e[n].distance+2*d,{distance:e[n].distance+2*d,elev:e[n].elev+2*o}),t}function p(d){return c=d,a=Number.MAX_VALUE,r=0,c.itinerary.itineraryPoints.forEach(e=>{r=Math.max(r,e.elev),a=Math.min(a,e.elev)}),s=r-a,o=i.height/s,n=i.width/c.distance,t=document.createElementNS(l,"svg"),t.setAttributeNS(null,"viewBox","0 0 "+(i.width+2*i.margin)+" "+(i.height+2*i.margin)),t.setAttributeNS(null,"class","TravelNotes-SvgProfile"),function(){let e="",a=0,s=0,d=0;c.itinerary.itineraryPoints.forEach(t=>{s=(i.margin+n*a).toFixed(0),d=(i.margin+o*(r-t.elev)).toFixed(0),e+=s+","+d+" ",a+=t.distance});let u=document.createElementNS(l,"polyline");u.setAttributeNS(null,"points",e),u.setAttributeNS(null,"class","TravelNotes-SvgProfile-profilePolyline"),t.appendChild(u)}(),function(){let e=pe+","+ve+" "+pe+","+me+" "+fe+","+me+" "+fe+","+ve,o=document.createElementNS(l,"polyline");o.setAttributeNS(null,"points",e),o.setAttributeNS(null,"class","TravelNotes-SvgProfile-framePolyline"),t.appendChild(o)}(),function(){let e=Number.MAX_VALUE,n=0;i.vScales.forEach(t=>{let o=Math.abs(s/4-t);o<e&&(e=o,n=t)});let c=Math.ceil(a/n)*n;for(;c<r;){let e=i.margin+(r-c)*o,a=document.createElementNS(l,"text");a.appendChild(document.createTextNode(c.toFixed(0))),a.setAttributeNS(null,"class","TravelNotes-SvgProfile-elevLegend"),a.setAttributeNS(null,"x",ye),a.setAttributeNS(null,"y",e),a.setAttributeNS(null,"text-anchor","start"),t.appendChild(a);let s=document.createElementNS(l,"text");s.appendChild(document.createTextNode(c.toFixed(0))),s.setAttributeNS(null,"class","TravelNotes-SvgProfile-elevLegend"),s.setAttributeNS(null,"x",be),s.setAttributeNS(null,"y",e),s.setAttributeNS(null,"text-anchor","end"),t.appendChild(s),c+=n}}(),function(){let o=Number.MAX_VALUE,a=0;i.hScales.forEach(e=>{let t=Math.abs(c.distance/8-e);t<o&&(o=t,a=e)});let r=Math.ceil(c.chainedDistance/a)*a;for(;r<c.distance+c.chainedDistance;){let o=document.createElementNS(l,"text");o.appendChild(document.createTextNode(e.metersInKm<a||0<c.chainedDistance?r/e.metersInKm+" km":r+" m ")),o.setAttributeNS(null,"class","TravelNotes-SvgProfile-distLegend"),o.setAttributeNS(null,"x",i.margin+(r-c.chainedDistance)*n),o.setAttributeNS(null,"y",we),o.setAttributeNS(null,"text-anchor","start"),t.appendChild(o),r+=a}}(),t}return new class{constructor(){Object.freeze(this)}smooth(e){!function(e){c=e;let t=c.itinerary.itineraryPoints.iterator,o=0,n=0;for(;!t.done;)o+=t.value.distance,n+=t.next?Math.abs(t.value.elev-t.next.elev):0;if(d=10*Math.floor(u/(n/o)),o<=2*h*d)return;let a=g();t=c.itinerary.itineraryPoints.iterator,t.done;let i=t.value.distance;for(;!t.done;){let e=a.get(Math.floor(i/d)*d),o=a.get(Math.ceil(i/d)*d);if(e&&o){let n=i-e.distance,a=(o.elev-e.elev)/(o.distance-e.distance);t.value.elev=e.elev+n*a}i+=t.value.distance}}(e)}createSvg(e){return p(e)}}}function Te(e,t){let o=t.note,n=v.create("div");if(0!==o.tooltipContent.length&&p.sanitizeToHtmlElement(o.tooltipContent,v.create("div",{className:e+"NoteHtml-TooltipContent"},n)),0!==o.popupContent.length&&p.sanitizeToHtmlElement(o.popupContent,v.create("div",{className:e+"NoteHtml-PopupContent"},n)),0!==o.address.length&&p.sanitizeToHtmlElement("<span>"+N.getText("HTMLViewsFactory - Address")+"</span> : "+o.address,v.create("div",{className:e+"NoteHtml-Address"},n)),0!==o.url.length&&p.sanitizeToHtmlElement(N.getText("HTMLViewsFactory - Link")+"<a href="+o.url+' target="_blank" >'+o.url.substr(0,40)+"...</a>",v.create("div",{className:e+"NoteHtml-Url"},n)),0!==o.phone.length){let t=o.phone;if(o.phone.match(/^\+[0-9, ,*,#]*$/)){let e=o.phone.replaceAll(/\u0020/g,""),n=o.phone.replaceAll(/\u0020/g," ");t=N.getText("HTMLViewsFactory - Phone")+" : "+N.getText("HTMLViewsFactory - call")+'<a target="_blank" href="tel:'+e+'" >'+n+"</a>"+N.getText("HTMLViewsFactory - Send a sms to")+'<a target="_blank" href="sms:'+e+'" >'+n+"</a>"}else t=N.getText("HTMLViewsFactory - Phone")+" : "+o.phone;p.sanitizeToHtmlElement(t,v.create("div",{className:e+"NoteHtml-Phone"},n))}if(p.sanitizeToHtmlElement(L.formatLatLng(o.latLng),v.create("div",{className:e+"NoteHtml-LatLng"},n)),t.route){t.route.chain&&p.sanitizeToHtmlElement("<span>"+N.getText("HTMLViewsFactory - Distance from start of travel")+"</span> : "+L.formatDistance(o.chainedDistance+o.distance),v.create("div",{className:e+"NoteHtml-Distance"},n)),p.sanitizeToHtmlElement("<span>"+N.getText("HTMLViewsFactory - Distance from start of route")+"</span> : "+L.formatDistance(o.distance),v.create("div",{className:e+"NoteHtml-Distance"},n));let a=t.route.notes.next(o.objId);if(a){let t=a.distance-o.distance;9<t&&p.sanitizeToHtmlElement("<span>"+N.getText("HTMLViewsFactory - Next note after")+"</span> : "+L.formatDistance(t),v.create("div",{className:e+"NoteHtml-NextDistance"},n))}}return n}function Ne(e,t){let o=v.create("div"),n=v.create("div",{className:e+"Travel-Notes-IconCell"},o);p.sanitizeToHtmlElement(t.note.iconContent,n),n.style.width=String(t.note.iconWidth)+"px",n.style.height=String(t.note.iconHeight)+"px","TravelNotes-Roadbook-"===e&&n.firstChild&&("svg"===n.firstChild.tagName?(n.firstChild.setAttributeNS(null,"viewBox","0 0 "+r.svgViewboxDim+" "+r.svgViewboxDim),n.style.width=String(t.note.iconWidth*f.note.svgRoadbookDimCoef)+"px",n.style.height=String(t.note.iconWidth*f.note.svgRoadbookDimCoef)+"px"):n.firstChild.classList.contains("TravelNotes-MapNoteCategory-0073")&&(n.style.width=String(t.note.iconWidth*f.note.svgRoadbookDimCoef)+"px",n.style.height=String(t.note.iconWidth*f.note.svgRoadbookDimCoef)+"px"));let a=Te(e,t);return a.className=e+"Travel-Notes-Cell",o.appendChild(a),o.noteObjId=t.note.objId,o}function Le(e){let t=v.create("div",{className:e+"Travel-Notes"}),o=ue.travel.notes.iterator;for(;!o.done;){let n=Ne(e,{note:o.value,route:null});n.className=e+"Travel-Notes-Row",t.appendChild(n)}return t}function Oe(e,t){let o=v.create("div",{className:e+"Route-Header",id:"route"+t.objId});return p.sanitizeToHtmlElement(t.computedName,v.create("div",{className:e+"Route-Header-Name"},o)),0!==t.distance&&p.sanitizeToHtmlElement(N.getText("HTMLViewsFactory - Route distance",{distance:L.formatDistance(t.distance)}),v.create("div",{className:e+"Route-Header-Distance"},o)),ue.travel.readOnly||"bike"===t.itinerary.transitMode||p.sanitizeToHtmlElement(N.getText("HTMLViewsFactory - Duration",{duration:L.formatTime(t.duration)}),v.create("div",{className:e+"Route-Header-Duration"},o)),t.itinerary.hasProfile&&(p.sanitizeToHtmlElement(N.getText("HTMLViewsFactory - Ascent",{ascent:t.itinerary.ascent.toFixed(0)}),v.create("div",{className:e+"Route-Header-Ascent"},o)),p.sanitizeToHtmlElement(N.getText("HTMLViewsFactory - Descent",{descent:t.itinerary.descent.toFixed(0)}),v.create("div",{className:e+"Route-Header-Descent"},o))),o}function xe(t,o){let n=v.create("div");v.create("div",{className:t+"Route-ManeuversAndNotes-IconCell TravelNotes-ManeuverNote-"+o.maneuver.iconName},n);let a=v.create("div",{className:t+"Route-ManeuversAndNotes-Cell"},n);return p.sanitizeToHtmlElement(o.maneuver.instruction,v.create("div",null,a)),o.route.chain&&p.sanitizeToHtmlElement("<span>"+N.getText("HTMLViewsFactory - Distance from start of travel")+"</span> : "+L.formatDistance(o.route.chainedDistance+o.maneuverDistance),v.create("div",null,a)),p.sanitizeToHtmlElement("<span>"+N.getText("HTMLViewsFactory - Distance from start of route")+"</span> : "+L.formatDistance(o.maneuverDistance),v.create("div",null,a)),e.defaultValue<o.maneuver.distance&&p.sanitizeToHtmlElement("<span>"+N.getText("HTMLViewsFactory - Next maneuver after")+"</span> : "+L.formatDistance(o.maneuver.distance),v.create("div",null,a)),n}function Ie(e,t){let o=[],n=t.notes.iterator;for(;!n.done;){let a=Ne(e,{note:n.value,route:t});a.className=e+"Route-Notes-Row",a.objId=b(),a.latLng=n.value.latLng,a.noteObjId=n.value.objId,a.distance=n.value.distance,o.push(a)}let a=t.itinerary.maneuvers.iterator,i=0;for(;!a.done;){let n=xe(e,{route:t,maneuver:a.value,maneuverDistance:i});n.className=e+"Route-Maneuvers-Row",n.objId=b(),n.latLng=t.itinerary.itineraryPoints.getAt(a.value.itineraryPointObjId).latLng,n.maneuverObjId=a.value.objId,n.distance=i,o.push(n),i+=a.value.distance}o.sort((e,t)=>e.distance-t.distance);let r=v.create("div",{className:e+"Route-ManeuversAndNotes"});return o.forEach(e=>r.appendChild(e)),r}function Ae(e,t){let o="";""!==t.itinerary.provider&&""!==t.itinerary.transitMode&&(o=N.getText("HTMLViewsFactory - Itinerary computed by {provider} and optimized for {transitMode}",{provider:t.itinerary.provider,transitMode:N.getText("HTMLViewsFactory - TransitMode "+t.itinerary.transitMode)}));let n=v.create("div",{className:e+"RouteFooter"});return p.sanitizeToHtmlElement(o,n),n}function Pe(e,t){let o=v.create("div",{className:e+"RouteProfile"});return p.sanitizeToHtmlElement(N.getText("HTMLViewsFactory - Profile"),o),o.appendChild(je().createSvg(t)),o}function Me(t){let o=v.create("div",{className:t+"Travel"});o.appendChild(function(t){let o=v.create("div",{className:t+"Travel-Header"});p.sanitizeToHtmlElement(ue.travel.name,v.create("div",{className:t+"Travel-Header-Name"},o));let n=e.defaultValue,a=0,i=0,r=ue.travel.routes.iterator;for(;!r.done;){let e=r.value.objId===ue.editedRouteObjId&&f.routeEditor.displayEditionInHTMLPage?ue.travel.editedRoute:r.value;p.sanitizeToHtmlElement('<a href="#route'+e.objId+'" >'+e.computedName+"</a> : "+L.formatDistance(e.distance)+".",v.create("div",{className:t+"Travel-Header-RouteName"},o)),e.chain&&(n+=e.distance,a+=e.itinerary.ascent,i+=e.itinerary.descent)}return p.sanitizeToHtmlElement(N.getText("HTMLViewsFactory - Travel distance",{distance:L.formatDistance(n)}),v.create("div",{className:t+"Travel-Header-TravelDistance"},o)),0!==a&&p.sanitizeToHtmlElement(N.getText("HTMLViewsFactory - Travel ascent",{ascent:a.toFixed(0)}),v.create("div",{className:t+"Travel-Header-TravelAscent"},o)),0!==i&&p.sanitizeToHtmlElement(N.getText("HTMLViewsFactory - Travel descent",{descent:i.toFixed(0)}),v.create("div",{className:t+"Travel-Header-TravelDescent"},o)),o}(t)),o.appendChild(Le(t));let n=ue.travel.routes.iterator;for(;!n.done;){let e=f.routeEditor.displayEditionInHTMLPage&&n.value.objId===ue.editedRouteObjId?ue.travel.editedRoute:n.value;o.appendChild(Oe(t,e)),e.itinerary.hasProfile&&o.appendChild(Pe(t,e)),o.appendChild(Ie(t,e)),o.appendChild(Ae(t,e))}return o.appendChild(function(e){let t=N.getText("HTMLViewsFactory - Travel footer")+'<a href="https://github.com/wwwouaiebe/leaflet.TravelNotes" target="_blank" title="https://github.com/wwwouaiebe/leaflet.TravelNotes" >Travel & Notes</a>, © <a href="https://www.ouaie.be/" target="_blank" title="https://www.ouaie.be/" >wwwouaiebe 2017 2021</a> © <a href="https://www.openstreetmap.org/copyright" target="_blank" title="https://www.openstreetmap.org/copyright">'+N.getText("HTMLViewsFactory - OpenStreetMap contributors")+"</a>",o=v.create("div",{className:e+"TravelFooter"});return p.sanitizeToHtmlElement(t,o),o}(t)),o}const Se=new class{constructor(){Object.freeze(this)}getTravelHTML(e){return Me(e)}getNoteTextAndIconHTML(e,t){return Ne(e,t)}getNoteTextHTML(e,t){return Te(e,t)}getEditedRouteManeuversAndNotesHTML(e){return Ie(e,ue.travel.editedRoute)}getTravelNotesHTML(e){return Le(e)}getRouteHeaderHTML(e,t){return Oe(e,t)}};let Ee=null,Ce=null;function ze(e){let t=he.getRoute(e.target.objId),o=ge.getClosestLatLngDistance(t,[e.latlng.lat,e.latlng.lng]).distance;o+=t.chainedDistance,o=L.formatDistance(o);let n=ue.mapObjects.get(e.target.objId);n.closeTooltip();let a=t.computedName;ue.travel.readOnly||(a+=0===a.length?"":" - ",a+=o),n.setTooltipContent(a),n.openTooltip(e.latlng)}function De(e,t){t.objId=e,t.addTo(ue.map),ue.mapObjects.set(e,t)}function He(e){let t=he.getNoteAndRoute(e).note,o=window.L.marker(t.latLng,{icon:window.L.divIcon({iconSize:[f.note.grip.size,f.note.grip.size],iconAnchor:[f.note.grip.size/2,f.note.grip.size/2],html:"<div></div>",className:"TravelNotes-Note-Bullet"}),opacity:f.note.grip.opacity,draggable:!ue.travel.readOnly});o.objId=t.objId;let n=window.L.divIcon({iconSize:[t.iconWidth,t.iconHeight],iconAnchor:[t.iconWidth/2,t.iconHeight/2],popupAnchor:[0,-t.iconHeight/2],html:t.iconContent,className:"TravelNotes-AllNotes "}),a=window.L.marker(t.iconLatLng,{zIndexOffset:100,icon:n,draggable:!ue.travel.readOnly});a.objId=t.objId,a.bindPopup(e=>Se.getNoteTextHTML("TravelNotes-",he.getNoteAndRoute(e.objId))),0!==t.tooltipContent.length&&(a.bindTooltip(e=>he.getNoteAndRoute(e.objId).note.tooltipContent),a.getTooltip().options.offset[0]=t.iconWidth/2);let i=window.L.polyline([t.latLng,t.iconLatLng],f.note.polyline);i.objId=t.objId;let r=window.L.layerGroup([a,i,o]);return r.markerId=window.L.Util.stamp(a),r.polylineId=window.L.Util.stamp(i),r.bulletId=window.L.Util.stamp(o),De(t.objId,r),f.note.haveBackground&&document.querySelectorAll(".TravelNotes-MapNote,.TravelNotes-SvgIcon").forEach(e=>e.classList.add("TravelNotes-MapNote-Background")),Object.freeze({marker:a,polyline:i,bullet:o})}function Ve(e){e.dashArray>=f.route.dashChoices.length&&(e.dashArray=0);let t=f.route.dashChoices[e.dashArray].iDashArray;if(t){let o="",n=0;for(n=0;n<t.length-1;n++)o+=t[n]*e.width+",";return o+=t[n]*e.width,o}return null}const Re=new class{constructor(){Object.freeze(this)}addRoute(e){let t=he.getRoute(e),o=[],n=t.itinerary.itineraryPoints.iterator;for(;!n.done;)o.push(n.value.latLng);let i=window.L.polyline(o,{color:t.color,weight:t.width,dashArray:Ve(t)});De(t.objId,i),a.notEdited===t.editionStatus&&(i.bindTooltip(t.computedName,{sticky:!0,direction:"right"}),i.on("mouseover",ze),i.on("mousemove",ze)),i.bindPopup(e=>{let t=he.getRoute(e.objId);return Se.getRouteHeaderHTML("TravelNotes-UI-",t)}),window.L.DomEvent.on(i,"click",e=>e.target.openPopup(e.latlng));let r=t.notes.iterator;for(;!r.done;)He(r.value.objId);return t}addNote(e){return He(e)}getDashArray(e){return Ve(e)}zoomTo(e,t){if(t){let e=[];t.forEach(t=>e=e.concat(t)),ue.map.fitBounds(ge.getLatLngBounds(e))}else ue.map.setView(e,f.itineraryPointZoom)}setLayer(e,t){let o=null;o="wmts"===e.service.toLowerCase()?window.L.tileLayer(t):window.L.tileLayer.wms(t,e.wmsOptions),Ee&&ue.map.removeLayer(Ee),ue.map.addLayer(o),Ee=o,ue.travel.readOnly||(ue.map.getZoom()<(e.minZoom||0)&&ue.map.setZoom(e.minZoom||0),ue.map.setMinZoom(e.minZoom||0),ue.map.getZoom()>(e.maxZoom||18)&&ue.map.setZoom(e.maxZoom||18),ue.map.setMaxZoom(e.maxZoom||18),e.bounds?(ue.map.getBounds().intersects(e.bounds)&&!ue.map.getBounds().contains(e.bounds)||(ue.map.setMaxBounds(null),ue.map.fitBounds(e.bounds),ue.map.setZoom(e.minZoom||0)),ue.map.setMaxBounds(e.bounds)):ue.map.setMaxBounds(null)),ue.map.fire("baselayerchange",o)}onGeolocationStatusChanged(e){t.active!==e&&Ce&&(ue.map.removeLayer(Ce),Ce=null)}onGeolocationPositionChanged(e){let t=f.geoLocation.zoomToPosition;Ce&&(ue.map.removeLayer(Ce),t=!1),Ce=window.L.circleMarker(window.L.latLng(e.coords.latitude,e.coords.longitude),{radius:f.geoLocation.radius,color:f.geoLocation.color}).bindTooltip(L.formatLatLng([e.coords.latitude,e.coords.longitude])).addTo(ue.map),t&&ue.map.setView(window.L.latLng(e.coords.latitude,e.coords.longitude),f.geoLocation.zoomFactor)}};const ke=new class{constructor(){Object.freeze(this)}dispatch(e,t){let o=function(e){return-1<["showitinerary","updateitinerary","showtravelnotes","updatetravelnotes","showsearch","updatesearch","setrouteslist","setprovider","providersadded","travelnameupdated","settransitmode"].indexOf(e)?document.getElementById("TravelNotes-UI-MainDiv"):-1<["removeobject","removeallobjects","zoomto","additinerarypointmarker","addsearchpointmarker","addrectangle","addwaypoint","layerchange","geolocationstatuschanged","geolocationpositionchanged","routeupdated","routepropertiesupdated","noteupdated","roadbookupdate","profileclosed"].indexOf(e)?document:null}(e);if(o){let n=new Event(e);t&&(n.data=t),o.dispatchEvent(n)}}};function Fe(e){return Math.floor(Math.abs(e)+.5)*(0<=e?1:-1)}const Ue=new class{constructor(){Object.freeze(this)}encode(e,t){if(!e.length)return"";let o=t.length,n=Array.from(t,e=>Math.pow(10,e));function a(e,t,o){let n=Fe(e*o),a=Fe(t*o),i=n-a;i<<=1,0>n-a&&(i=~i);let r="";for(;32<=i;)r+=String.fromCharCode(63+(32|31&i)),i>>=5;return r+=String.fromCharCode(i+63),r}let i="";for(let t=0;t<o;t++)i+=a(e[0][t],0,n[t]);for(let t=1;t<e.length;t++){let r=e[t],s=e[t-1];for(let e=0;e<o;e++)i+=a(r[e],s[e],n[e])}return i}decode(e,t){let o=t.length;if(!e||0===e.length)return[];let n=0,a=[],i=Array.from(t,e=>Math.pow(10,e)),r=new Array(o).fill(0);function s(){let t=null,o=0,a=0;do{t=e.charCodeAt(n++)-63,a|=(31&t)<<o,o+=5}while(32<=t);return 1&a?~(a>>1):a>>1}for(;n<e.length;){let e=new Array(o).fill(0);for(let t=0;t<o;t++)r[t]+=s(),e[t]=r[t]/i[t];a.push(e)}return a}};function We(){let e=[];function t(t){e.push(t.latLng),e.push(t.iconLatLng)}function o(o){o.itinerary.itineraryPoints.forEach(t=>e.push(t.latLng)),o.notes.forEach(e=>t(e))}return new class{constructor(){Object.freeze(this)}zoomToLatLng(e){ke.dispatch("zoomto",{latLng:e})}zoomToManeuver(e){let t=ue.travel.editedRoute.itinerary.maneuvers.getAt(e).itineraryPointObjId,o=ue.travel.editedRoute.itinerary.itineraryPoints.getAt(t).latLng;ke.dispatch("zoomto",{latLng:o})}zoomToNote(o){e=[],t(he.getNoteAndRoute(o).note),ke.dispatch("zoomto",{geometry:[e]})}zoomToRoute(t){e=[],o(he.getRoute(t)),ke.dispatch("zoomto",{geometry:[e]})}zoomToTravel(){e=[],ue.travel.routes.forEach(e=>o(e)),-1!==ue.travel.editedRouteObjId&&o(ue.travel.editedRoute),ue.travel.notes.forEach(e=>t(e)),ke.dispatch("zoomto",{geometry:[e]})}zoomToPoi(e){ke.dispatch("zoomto",e)}}}function Be(){return new class{constructor(){Object.freeze(this)}openDistantFile(t){(function(){function t(e){let t={};0!==e.itinerary.itineraryPoints.length&&(t=e.itinerary.itineraryPoints[0].objType);let o={values:"",objType:t},a=[];e.itinerary.itineraryPoints.forEach(e=>{a.push([e.lat,e.lng,e.distance,e.elev,e.objId])}),o.values=Ue.encode(a,[n.fixed,n.fixed,2,2,0]),e.itinerary.itineraryPoints=o}function i(t){let a=[];if(t.itinerary.itineraryPoints.values)Ue.decode(t.itinerary.itineraryPoints.values,[n.fixed,n.fixed,2,2,0]).forEach(i=>{let r={lat:n.defaultValue,lng:n.defaultValue,distance:e.defaultValue,elev:o.defaultValue,objId:-1};[r.lat,r.lng,r.distance,r.elev,r.objId]=i,r.objType=t.itinerary.itineraryPoints.objType,a.push(r)});else{t.itinerary.itineraryPoints.latLngs=Ue.decode(t.itinerary.itineraryPoints.latLngs,[n.fixed,n.fixed]);let e=0;t.itinerary.itineraryPoints.latLngs.forEach(n=>{let i={};i.lat=n[0],i.lng=n[1],i.distance=t.itinerary.itineraryPoints.distances[e],t.itinerary.itineraryPoints.elevs?i.elev=t.itinerary.itineraryPoints.elevs[e]:i.elev=o.defaultValue,i.objId=t.itinerary.itineraryPoints.objIds[e],i.objType=t.itinerary.itineraryPoints.objType,a.push(i),e++})}t.itinerary.itineraryPoints=a}function r(e){e.routes.forEach(i),e.editedRoute&&i(e.editedRoute)}return new class{constructor(){Object.freeze(this)}decompress(e){r(e),ue.travel.jsonObject=e,ue.editedRouteObjId=-1,ue.travel.routes.forEach(e=>{a.notEdited!==e.editionStatus&&(ue.editedRouteObjId=e.objId)})}decompressMerge(e){r(e);let t=re();t.jsonObject=e;let o=t.routes.iterator;for(;!o.done;)ue.travel.routes.add(o.value);let n=t.notes.iterator;for(;!n.done;)ue.travel.notes.add(n.value)}compress(){let e=ue.travel.jsonObject;return e.routes.forEach(t),t(e.editedRoute),e}}})().decompress(t),ue.travel.readOnly=!0,this.display()}display(){document.title="Travel & Notes"+(""===ue.travel.name?"":" - "+ue.travel.name);let e=ue.travel.routes.iterator;for(;!e.done;)a.notEdited===e.value.editionStatus&&ke.dispatch("routeupdated",{removedRouteObjId:-1,addedRouteObjId:e.value.objId});-1!==ue.editedRouteObjId&&ke.dispatch("routeupdated",{removedRouteObjId:-1,addedRouteObjId:ue.travel.editedRoute.objId});let t=ue.travel.notes.iterator;for(;!t.done;)ke.dispatch("noteupdated",{removedNoteObjId:-1,addedNoteObjId:t.value.objId});We().zoomToTravel()}}}const Ze=new class{constructor(){Object.freeze(this)}createUI(){v.create("div",{id:"TravelNotes-AttributionsUI"},document.querySelector("body")),this.attributions=""}set attributions(e){let t='© <a href="https://leafletjs.com/" target="_blank" title="Leaflet">Leaflet</a> | © <a href="https://www.openstreetmap.org/copyright" target="_blank" title="OpenStreetMap contributors">OpenStreetMap contributors</a> '+e+'| © <a href="https://github.com/wwwouaiebe" target="_blank" title="https://github.com/wwwouaiebe">Travel & Notes</a>',o=document.getElementById("TravelNotes-AttributionsUI");for(;o.firstChild;)o.removeChild(o.firstChild);p.sanitizeToHtmlElement(t,o)}};let _e="geolocation"in navigator?t.inactive:t.disabled,Ke=null;function Je(e){ke.dispatch("geolocationpositionchanged",{position:e})}function qe(){t.active===_e&&(_e=t.inactive),ke.dispatch("geolocationstatuschanged",{status:_e}),navigator.geolocation.clearWatch(Ke),Ke=null}function Ge(e){1===e.code&&(_e=t.refusedByUser),qe()}const Xe=new class{constructor(){Object.freeze(this)}get status(){return _e}switch(){switch(_e){case t.inactive:_e=t.active,ke.dispatch("geolocationstatuschanged",{status:_e}),navigator.geolocation.getCurrentPosition(Je,Ge,f.geoLocation.options),Ke=navigator.geolocation.watchPosition(Je,Ge,f.geoLocation.options);break;case t.active:qe()}return _e}};let $e=null,Qe=[{service:"wmts",url:"https://{s}.tile.osm.org/{z}/{x}/{y}.png",name:"OSM - Color",toolbar:{text:"OSM",color:"red",backgroundColor:"white"},providerName:"OSM",providerKeyNeeded:!1,attribution:""}];function Ye(e){e.stopPropagation(),ke.dispatch("layerchange",{layer:e.target.layer}),Ze.attributions=e.target.layer.attribution}function et(e){e.stopPropagation(),Xe.switch()}function tt(e){e.stopPropagation(),We().zoomToTravel()}function ot(e){v.create("div",{className:"TravelNotes-ViewerLayersToolbarUI-Button",title:e.name,layer:e,textContent:e.toolbar.text,style:"color:"+e.toolbar.color+";background-color:"+e.toolbar.backgroundColor},$e).addEventListener("click",Ye,!1)}const nt=new class{constructor(){Object.freeze(this)}createUI(){$e=v.create("div",{id:"TravelNotes-ViewerLayersToolbarUI"},document.querySelector("body")),v.create("div",{className:"TravelNotes-ViewerLayersToolbarUI-Button",title:"My position",textContent:"🌐",style:"color:black;background-color:white"},$e).addEventListener("click",et,!1),v.create("div",{className:"TravelNotes-ViewerLayersToolbarUI-Button",title:"Zoom on the travel",textContent:"🔍",style:"color:black;background-color:white"},$e).addEventListener("click",tt,!1),Qe.forEach(ot)}setLayer(e){let t=Qe.find(t=>t.name===e)||Qe[0];ke.dispatch("layerchange",{layer:t}),Ze.attributions=t.attribution}addLayers(e){e.forEach(e=>{e.providerKeyNeeded||Qe.push(e)})}};let at=!1;const it=new class{constructor(){Object.freeze(this)}addReadOnlyMap(e,t){at||(at=!0,document.addEventListener("routeupdated",e=>{e.data&&Re.addRoute(e.data.addedRouteObjId)},!1),document.addEventListener("noteupdated",e=>{e.data&&Re.addNote(e.data.addedNoteObjId)},!1),document.addEventListener("zoomto",e=>{e.data&&Re.zoomTo(e.data.latLng,e.data.geometry)},!1),document.addEventListener("layerchange",e=>{e.data&&Re.setLayer(e.data.layer,e.data.layer.url)}),document.addEventListener("geolocationpositionchanged",e=>{e.data&&Re.onGeolocationPositionChanged(e.data.position)},!1),document.addEventListener("geolocationstatuschanged",e=>{e.data&&Re.onGeolocationStatusChanged(e.data.status)},!1),Ze.createUI(),t&&nt.createUI(),nt.setLayer("OSM - Color"),async function(e){let t=fetch(e);if(200===t.status&&t.ok){let e=await t.json();Be().openDistantFile(e)}else ue.map.setView([n.defaultValue,n.defaultValue],2),document.title="Travel & Notes"}(e))}};!function(){let e=null,t=null,o=!1,a=window.location.href.substr(0,window.location.href.lastIndexOf("/")+1)+"TravelNotes";!async function(){!function(){let n=new URL(window.location),a=n.searchParams.get("fil");if(a&&0!==a.length)try{if(a=atob(a),a.match(/[^\w-%:./]/))throw new Error("invalid char in the url encoded in the fil parameter");let e=new URL(a);if(!(n.protocol&&e.protocol&&n.protocol===e.protocol&&n.hostname&&e.hostname&&n.hostname===e.hostname))throw new Error("The distant file is not on the same site than the app");t=encodeURI(e.href)}catch(e){e instanceof Error&&console.error(e)}let i=n.searchParams.get("lng");i&&i.match(/^[A-Z,a-z]{2}$/)&&(e=i.toLowerCase()),""===n.searchParams.get("lay")&&(o=!0)}(),await async function(){let t=await fetch(a+"Config.json");if(200===t.status&&t.ok){let o=await t.json();return o.language=e||o.language,"wwwouaiebe.github.io"===window.location.hostname&&(o.note.haveBackground=!0),f.overload(o),!0}return!1}()?(e=e||f.language,await async function(){let t=await fetch(a+e.toUpperCase()+".json");return!(200!==t.status||!t.ok)&&(N.setTranslations(await t.json()),!0)}()?await async function(){let e=await fetch(a+"Layers.json");return!(200!==e.status||!e.ok)&&(nt.addLayers(await e.json()),!0)}()?(document.body.textContent="Loaded.... ",function(){v.create("div",{id:"Map"},document.querySelector("body"));let e=window.L.map("Map",{attributionControl:!1,zoomControl:!1}).setView([n.defaultValue,n.defaultValue],2);ue.map=e,it.addReadOnlyMap(t,o)}()):document.body.textContent="Not possible to load the TravelNotesLayers.json file. ":document.body.textContent="Not possible to load the TravelNotesConfig"+e.toUpperCase()+".json file. "):document.body.textContent="Not possible to load the TravelNotesConfig.json file. "}()}()}();
/**
 * 
 * @source: https://github.com/wwwouaiebe/leaflet.TravelNotes
 * 
 * @licstart  The following is the entire license notice for the
 * JavaScript code in this page.
 * 
 * leaflet.travelnotes - version 2.1.0
 * Build 00328 - 2021-01-18T08:44:55+0100 
 * Copyright 2017 2021 wwwouaiebe 
 * Contact: https://www.ouaie.be/
 * License: GPL-3.0
 * 
 * The JavaScript code in this page is free software: you can
 * redistribute it and/or modify it under the terms of the GNU
 * General Public License (GNU GPL) as published by the Free Software
 * Foundation, either version 3 of the License, or (at your option)
 * any later version.  The code is distributed WITHOUT ANY WARRANTY;
 * without even the implied warranty of MERCHANTABILITY or FITNESS
 * FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.
 * 
 * As additional permission under GNU GPL version 3 section 7, you
 * may distribute non-source (e.g., minimized or compacted) forms of
 * that code without the copy of the GNU GPL normally required by
 * section 4, provided you include this license notice and a URL
 * through which recipients can access the Corresponding Source.
 * 
 * @licend  The above is the entire license notice
 * for the JavaScript code in this page.
 * 
 */


!function(){"use strict";
/**
	@------------------------------------------------------------------------------------------------------------------------------

	@file Constants.js
	@copyright Copyright - 2017 2021 - wwwouaiebe - Contact: https://www.ouaie.be/
	@license GNU General Public License
	@private

	@------------------------------------------------------------------------------------------------------------------------------
	*/const e=Object.freeze({fixed:2,invalid:-1,defaultValue:0}),t=Object.freeze({refusedByUser:-1,disabled:0,inactive:1,active:2}),o=(Object.freeze({invalidPane:"43a6a53e-008a-4910-80a6-7a87d301ea15",itineraryPane:"8fbf0da7-4e6f-4bc7-8e20-1388461ccde7",travelNotesPane:"dffe782b-07df-4b81-a318-f287c0cf5ec6",searchPane:"228f00d7-43a8-4c13-897d-70400cb6dd58"}),Object.freeze({fixed:2,defaultValue:0})),n=Object.freeze({defaultValue:0,fixed:6}),i=Object.freeze({notEdited:0,editedNoChange:1,editedChanged:2}),a=Object.freeze({margin:100,height:500,width:1e3,yDeltaText:30,xDeltaText:10,vScales:[1,2,5,10,20,50,100,200,500,1e3,2e3,5e3],hScales:[1,2,5,10,20,50,100,200,500,1e3,2e3,5e3,1e4,2e4,5e4,1e5]}),r=Object.freeze({width:40,height:40,svgViewboxDim:200}),s="http://www.w3.org/2000/svg";let l=new Map;l.set("a",["href","target"]),l.set("br",[]),l.set("div",[]),l.set("del",[]),l.set("em",[]),l.set("figcaption",[]),l.set("figure",[]),l.set("h1",[]),l.set("h2",[]),l.set("h3",[]),l.set("h4",[]),l.set("h5",[]),l.set("h6",[]),l.set("hr",[]),l.set("img",["src","alt","width","height"]),l.set("ins",[]),l.set("li",[]),l.set("mark",[]),l.set("ol",[]),l.set("p",[]),l.set("s",[]),l.set("small",[]),l.set("strong",[]),l.set("span",[]),l.set("sub",[]),l.set("sup",[]),l.set("ul",[]),l.set("svg",["xmlns","viewBox","class"]),l.set("text",["x","y","text-anchor"]),l.set("polyline",["points","class","transform"]);const c=window.location.protocol,d=new DOMParser;function u(e){return e.replaceAll(/</g,"&lt;").replaceAll(/>/g,"&gt;").replaceAll(/"/g,"&quot;").replaceAll(/\u0027/g,"&apos;").replaceAll(/\u0a00/g,"&nbsp;")}function h(e,t="href"){let o=d.parseFromString("<div>"+e+"</div>","text/html");if(!o||"#document"!==o.nodeName)return{url:"",errorsString:"Parsing error"};let n=o.querySelector("body").firstChild,i="";for(let e=0;e<n.childNodes.length;e++){if("#text"!==n.childNodes[e].nodeName)return{url:"",errorsString:"Invalid characters found in the url"};i+=n.childNodes[e].nodeValue}if(i=i.replaceAll(/</g,"").replaceAll(/>/g,"").replaceAll(/"/g,"").replaceAll(/\u0027/g,"").replaceAll(/&lt;/g,"").replaceAll(/&gt;/g,"").replaceAll(/&quot;/g,"").replaceAll(/&apos;/g,"").replaceAll(/%3C/g,"").replaceAll(/%3c/g,"").replaceAll(/%3E/g,"").replaceAll(/%3e/g,"").replaceAll(/%22/g,"").replaceAll(/%27/g,""),i!==e)return{url:"",errorsString:"Invalid characters found in the url"};let a=["https:"];if("http:"!==c&&"href"!==t||a.push("http:"),"href"===t){a.push("mailto:"),a.push("sms:"),a.push("tel:");let e=i.match(/^#\w*/);if(e&&i===e[0])return{url:i,errorsString:""}}"src"===t&&a.push("data:");let r=null;try{r=new URL(i)}catch(e){return{url:"",errorsString:"Invalid url string"}}if(-1===a.indexOf(r.protocol))return{url:"",errorsString:"Invalid protocol "+r.protocol};if(-1!==["sms:","tel:"].indexOf(r.protocol)&&r.pathname.match(/^\+[0-9,*,#]*$/))return{url:i,errorsString:""};try{encodeURIComponent(r.href)}catch(e){return{url:"",errorsString:"Invalid character in url"}}return{url:i,errorsString:""}}const g=Object.freeze(new class{sanitizeToColor(e){let t=e.match(/^#[0-9,A-F,a-f]{6}$/);return t?t[0]:null}sanitizeToUrl(e,t){return h(e,t)}sanitizeToJsString(e){return function(e){let t=d.parseFromString("<div>"+e+"</div>","text/html");if(!t||"#document"!==t.nodeName)return"";let o=t.querySelector("body").firstChild,n="";for(let e=0;e<o.childNodes.length;e++){if("#text"!==o.childNodes[e].nodeName)return"";n+=o.childNodes[e].nodeValue}return n=n.replaceAll(/</g,"≺").replaceAll(/>/g,"≻").replaceAll(/"/g,"″").replaceAll(/\u0027/g,"′"),n}(e)}sanitizeToHtmlElement(e,t){!function(e,t){let o=d.parseFromString("<div>"+e+"</div>","text/html");o&&"#document"===o.nodeName?function e(t,o){let n=t.childNodes;for(let i=0;i<n.length;i++){let n=t.childNodes[i],a=n.nodeName.toLowerCase(),r=l.get(a);if(r){r=r.concat(["id","class","dir","title"]);let t="svg"===a||"text"===a||"polyline"===a,i=t?document.createElementNS(s,a):document.createElement(a);if(r.forEach(e=>{if(t)n.hasAttributeNS(null,e)&&(i.setAttributeNS(null,e,n.getAttribute(e)),n.removeAttributeNS(null,e));else if(n.hasAttribute(e))if("href"===e||"src"===e){let t=h(n.getAttribute(e),e).url;""!==t&&i.setAttribute(e,t)}else i.setAttribute(e,n.getAttribute(e))}),n.hasAttribute("style")){n.getAttribute("style").split(";").forEach(e=>{let t=e.split(":");2!==t.length||"width"!==t[0].trim()&&"height"!==t[0].trim()||(i.style[t[0].trim()]=t[1].trim())})}o.appendChild(i),e(n,i)}else"#text"===a&&o.appendChild(document.createTextNode(n.nodeValue))}}(o.querySelector("body").firstChild,t):t.textContent=""}(e,t)}sanitizeToHtmlString(e){return function(e){let t="",o="",n=d.parseFromString("<div>"+e.replace("&nbsp;","਀")+"</div>","text/html");return n&&"#document"===n.nodeName?(function e(n){let i=n.childNodes;for(let a=0;a<i.length;a++){let i=n.childNodes[a],r=i.nodeName.toLowerCase(),s=l.get(r);if(s){s=s.concat(["id","class","dir","title"]);let n="svg"===r||"text"===r||"polyline"===r;t+="<"+r,s.forEach(e=>{if(n)i.hasAttributeNS(null,e)&&(t+=" "+e+'="'+u(i.getAttribute(e))+'"',i.removeAttribute(e));else if(i.hasAttribute(e))if("href"===e||"src"===e){let n=h(i.getAttribute(e),e).url;""===n?o+="\nAn invalid url ("+i.getAttribute(e)+") was removed from a "+e+" attribute":t+=" "+e+'="'+n+'"',i.removeAttribute(e)}else t+=" "+e+'="'+u(i.getAttribute(e))+'"',i.removeAttribute(e)}),t+=">",e(i),t+="</"+r+">"}else"#text"===r?t+=u(i.nodeValue):o+="\nAn invalid tag "+r+" was removed";if(i.hasAttributes)for(let e=0;e<i.attributes.length;e++)o+="\nAn unsecure attribute "+i.attributes[e].name+'="'+i.attributes[e].value+'" was removed.'}}(n.querySelector("body").firstChild),{htmlString:t,errorsString:o}):{htmlString:"",errorsString:"Parsing error"}}(e)}});let p={autoLoad:!1,map:{center:{lat:50.50923,lng:5.49542},zoom:12},travelNotesToolbarUI:{contactMail:{url:"https://github.com/wwwouaiebe/leaflet.TravelNotes/issues"}},layersToolbarUI:{haveLayersToolbarUI:!0,toolbarTimeOut:1500,theDevil:{addButton:!1}},mouseUI:{haveMouseUI:!0},errorUI:{timeOut:1e4,helpTimeOut:3e4,showError:!0,showWarning:!0,showInfo:!0,showHelp:!0},geoLocation:{color:"#ff0000",radius:11,zoomToPosition:!0,zoomFactor:17,options:{enableHighAccuracy:!1,maximumAge:0,timeout:1/0}},APIKeys:{showDialogButton:!0,saveToSessionStorage:!0,showAPIKeysInDialog:!0,dialogHaveUnsecureButtons:!0},contextMenu:{timeout:1500},routing:{auto:!0},language:"fr",itineraryPointMarker:{color:"#ff0000",weight:2,radius:7,fill:!1},searchPointMarker:{color:"#006400",weight:4,radius:20,fill:!1},searchPointPolyline:{color:"#006400",weight:4,radius:20,fill:!1},previousSearchLimit:{color:"#006400",fill:!1,weight:1},nextSearchLimit:{color:"#ff0000",fill:!1,weight:1},wayPoint:{reverseGeocoding:!1},route:{color:"#ff0000",width:3,dashArray:0,dashChoices:[{text:"——————",iDashArray:null},{text:"— — — — —",iDashArray:[4,2]},{text:"—‧—‧—‧—‧—",iDashArray:[4,2,0,2]},{text:"················",iDashArray:[0,2]}],elev:{smooth:!0,smoothCoefficient:.25,smoothPoints:3},showDragTooltip:3},note:{osmSearchNoteDialog:!1,reverseGeocoding:!1,grip:{size:10,opacity:0,moveOpacity:1},polyline:{color:"#808080",weight:1},haveBackground:!1,svgRoadbookDimCoef:2,svgAnleMaxDirection:{right:35,slightRight:80,continue:100,slightLeft:145,left:200,sharpLeft:270,sharpRight:340},svgZoom:17,svgAngleDistance:10,svgHamletDistance:200,svgVillageDistance:400,svgCityDistance:1200,svgTownDistance:1500,svgTimeOut:40,maxManeuversNotes:100},noteDialog:{toggleIconDimension:!0,toggleIconTextArea:!1,toggleTooltip:!1,togglePopupContent:!1,toggleAddress:!1,toggleLink:!1,togglePhone:!0,iconAreaHeight:2,popupAreaHeigth:8},itineraryPointZoom:17,routeEditor:{displayEditionInHTMLPage:!0},travelEditor:{clearAfterSave:!0,startMinimized:!0,timeout:1e3,startupRouteEdition:!0},haveBeforeUnloadWarning:!0,overpassApi:{url:"https://lz4.overpass-api.de/api/interpreter"},nominatim:{url:"https://nominatim.openstreetmap.org/",language:"*"},printRouteMap:{isEnabled:!0,maxTiles:240,paperWidth:287,paperHeight:200,pageBreak:!1,printNotes:!0,borderWidth:30,zoomFactor:15,entryPointMarker:{color:"#00ff00",weight:4,radius:10,fill:!0,fillOpacity:1},exitPointMarker:{color:"#ff0000",weight:4,radius:10,fill:!0,fillOpacity:1}},haveCrypto:!1,itineraryPane:{showNotes:!0,showManeuvers:!1},colorDialog:{haveSlider:!0,initialRed:0}};let m=new class{get autoLoad(){return p.autoLoad}get map(){return p.map}get travelNotesToolbarUI(){return p.travelNotesToolbarUI}get layersToolbarUI(){return p.layersToolbarUI}get mouseUI(){return p.mouseUI}get errorUI(){return p.errorUI}get APIKeys(){return p.APIKeys}get contextMenu(){return p.contextMenu}get routing(){return p.routing}get language(){return p.language}get itineraryPointMarker(){return p.itineraryPointMarker}get searchPointMarker(){return p.searchPointMarker}get searchPointPolyline(){return p.searchPointPolyline}get previousSearchLimit(){return p.previousSearchLimit}get nextSearchLimit(){return p.nextSearchLimit}get wayPoint(){return p.wayPoint}get route(){return p.route}get note(){return p.note}get noteDialog(){return p.noteDialog}get itineraryPointZoom(){return p.itineraryPointZoom}get routeEditor(){return p.routeEditor}get travelEditor(){return p.travelEditor}get haveBeforeUnloadWarning(){return p.haveBeforeUnloadWarning}get overpassApi(){return p.overpassApi}get nominatim(){return p.nominatim}get geoLocation(){return p.geoLocation}get printRouteMap(){return p.printRouteMap}get haveCrypto(){return p.haveCrypto}get itineraryPane(){return p.itineraryPane}get colorDialog(){return p.colorDialog}overload(e){!function e(t,o){if("object"==typeof t&&"object"==typeof o)try{for(let n in o)"object"==typeof o[n]?e(t[n],o[n]):typeof t[n]==typeof o[n]&&("string"==typeof o[n]?o[n]="color"===n?g.sanitizeToColor(t[n])||o[n]:"url"===n?g.sanitizeToUrl(t[n]).url:g.sanitizeToJsString(t[n]):o[n]=t[n]||o[n]);for(let n in t)"object"==typeof t[n]?("[object Array]"===Object.prototype.toString.call(t[n])?o[n]=o[n]||[]:o[n]=o[n]||{},e(t[n],o[n])):"string"==typeof o.property?o[n]=g.sanitizeToHtmlString(t[n],[]).htmlString:o[n]=t[n]}catch(e){console.log(e||"Not possible to overload Config")}}(e,p),p=function e(t){for(let o in t)"object"==typeof t[o]&&(t[o]=e(t[o]));return Object.freeze(t)}(p)}};
/**
	@------------------------------------------------------------------------------------------------------------------------------

	@file HTMLElementsFactory.js
	@copyright Copyright - 2017 2021 - wwwouaiebe - Contact: https://www.ouaie.be/
	@license GNU General Public License
	@private

	@------------------------------------------------------------------------------------------------------------------------------
	*/const f=Object.freeze(new class{create(e,t,o){let n=null;return"text"===e.toLowerCase()?n=document.createTextNode(t.value||""):(n=document.createElement(e),t&&function(e,t){for(let o in t)try{e[o]=t[o]}catch(e){console.log("Invalid property : "+o)}}(n,t)),o&&o.appendChild(n),n}});const v=Object.freeze(new
/**
	@------------------------------------------------------------------------------------------------------------------------------

	@file HttpRequestBuilder.js
	@copyright Copyright - 2017 2021 - wwwouaiebe - Contact: https://www.ouaie.be/
	@license GNU General Public License
	@private

	@------------------------------------------------------------------------------------------------------------------------------
	*/
class{getTextPromise(e,t){return new Promise((function(o,n){let i=new XMLHttpRequest;i.timeout=4e4,i.ontimeout=function(){n("XMLHttpRequest TimeOut. File : "+i.responseURL)},i.onreadystatechange=function(){4===i.readyState&&(200===i.status?o(i.responseText):n("Error XMLHttpRequest - File : "+i.responseURL))},i.open("GET",e,!0),t&&t.forEach(e=>i.setRequestHeader(e.headerName,e.headerValue)),i.overrideMimeType("text/plain"),i.send(null)}))}getJsonPromise(e,t){return new Promise((function(o,n){let i=new XMLHttpRequest;i.timeout=4e4,i.ontimeout=function(){n("XMLHttpRequest TimeOut. File : "+i.responseURL)},i.onreadystatechange=function(){if(4===i.readyState)if(200===i.status){let e=null;try{e=JSON.parse(i.responseText)}catch(e){n(e.message+" File: "+i.responseURL)}o(e)}else n("Error XMLHttpRequest - File : "+i.responseURL)},i.open("GET",e,!0),t&&t.forEach(e=>i.setRequestHeader(e.headerName,e.headerValue)),i.overrideMimeType("application/json"),i.send(null)}))}getBinaryPromise(e,t){return new Promise((function(o,n){let i=new XMLHttpRequest;i.timeout=4e4,i.ontimeout=function(){n("XMLHttpRequest TimeOut. File : "+i.responseURL)},i.onload=function(){if(200===i.status){let e=i.response;e?o(e):n("Error XMLHttpRequest - File : "+i.responseURL)}else n("Error XMLHttpRequest - File : "+i.responseURL)},i.open("GET",e,!0),t&&t.forEach(e=>i.setRequestHeader(e.headerName,e.headerValue)),i.responseType="arraybuffer",i.send(null)}))}});let b=0;function y(){return++b,b}
/**
	@------------------------------------------------------------------------------------------------------------------------------

	@file Version.js
	@copyright Copyright - 2017 2021 - wwwouaiebe - Contact: https://www.ouaie.be/
	@license GNU General Public License
	@private

	@------------------------------------------------------------------------------------------------------------------------------
	*/function w(e){const t=e;return Object.seal(new class{get name(){return t}get version(){return"2.1.0"}get jsonObject(){return{name:t,version:"2.1.0"}}validate(e){if(!Object.getOwnPropertyNames(e).includes("name"))throw new Error("No name for "+t);if(t!==e.name)throw new Error("Invalid name for "+t);if(!Object.getOwnPropertyNames(e).includes("version"))throw new Error("No version for "+t)}})}function j(e){const t=e;let o=[];const n=function(){let e=t();if(!e.objType||!e.objType.name)throw new Error("invalid object name for collection");return e.objType.name}();function i(e){if(!e.objType||!e.objType.name||e.objType.name!==n)throw new Error("invalid object name for add function");o.push(e)}function a(){let e=-1;return Object.seal({get value(){return e<o.length?o[e]:null},get previous(){return 0>=e?null:o[e-1]},get next(){return e<o.length-1?o[e+1]:null},get done(){return++e>=o.length},get first(){return 0===e},get last(){return e>=o.length-1},get index(){return e}})}function r(e){return o.findIndex(t=>t.objId===e)}function s(e,t,n){let i=r(e);if(-1===i)throw new Error("invalid objId for next or previous function");if(1!==n&&-1!==n)throw new Error("invalid direction");let a=t;for(a||(a=()=>!0),i+=n;-1<i&&i<o.length&&!a(o[i]);)i+=n;return-1===i||o.length===i?null:o[i]}return Object.seal(new class{add(e){i(e)}forEach(e){let t=null,o=a();for(;!o.done;)t=e(o.value,t);return t}getAt(e){let t=r(e);return-1===t?null:o[t]}moveTo(e,t,n){let i=r(e),a=r(t);if(-1===i||-1===a)throw new Error("invalid objId for function  myMoveTo");n||a++,o.splice(a,0,o[i]),a<i&&i++,o.splice(i,1)}next(e,t){return s(e,t,1)}previous(e,t){return s(e,t,-1)}remove(e){if(-1===r(e))throw new Error("invalid objId for remove function");o.splice(r(e),1)}removeAll(e){e?o.splice(1,o.length-2):o.length=0}replace(e,t){let i=r(e);if(-1===i)throw new Error("invalid objId for replace function");if(!t.objType||!t.objType.name||t.objType.name!==n)throw new Error("invalid object name for replace function");o[i]=t}reverse(){o.reverse()}sort(e){o.sort(e)}swap(e,t){let n=r(e);if(-1===n||0===n&&t||o.length-1===n&&!t)throw new Error("invalid objId for swap function");let i=o[n];o[n]=o[n+(t?-1:1)],o[n+(t?-1:1)]=i}get first(){return o[0]}get iterator(){return a()}get last(){return o[o.length-1]}get length(){return o.length}get jsonObject(){let e=[],t=a();for(;!t.done;)e.push(t.value.jsonObject);return e}set jsonObject(e){o.length=0;let n=null;e.forEach(e=>{n=t(),n.jsonObject=e,i(n)})}})}let T=new Map;const N=Object.freeze(new class{setTranslations(e){e.forEach(e=>T.set(e.msgid,g.sanitizeToJsString(e.msgstr)))}getText(e,t){let o=T.get(e);return t&&o&&Object.getOwnPropertyNames(t).forEach(e=>o=o.replace("{"+e+"}",t[e])),o||e}});const L=Object.freeze(new class{get UUID(){let e=new Uint16Array(8);const t=["","-","-","-","-","","",""];window.crypto.getRandomValues(e);let o="";for(let n=0;n<8;n++)o+=e[n].toString(16).padStart(4,"0")+t[n];return o}storageAvailable(e){try{let t=window[e],o="__storage_test__";return t.setItem(o,o),t.removeItem(o),!0}catch(e){return!1}}saveFile(e,t,o){try{let n=window.URL.createObjectURL(new File([t],e,{type:o||"text/plain"})),i=document.createElement("a");i.setAttribute("href",n),i.setAttribute("download",e),i.click(),window.URL.revokeObjectURL(n)}catch(e){console.log(e||"An error occurs when saving file")}}formatTime(e){let t=Math.floor(e);if(0===t)return"";let o=Math.floor(t/86400),n=Math.floor(t%86400/3600),i=Math.floor(t%3600/60),a=Math.floor(t%60);return 0<o?o+" "+N.getText("Utilities - Day")+" "+n+" "+N.getText("Utilities - Hour"):0<n?n+" "+N.getText("Utilities - Hour")+" "+i+" "+N.getText("Utilities - Minute"):0<i?i+" "+N.getText("Utilities - Minute"):a+" "+N.getText("Utilities - Second")}formatDistance(e){let t=Math.floor(e);return 0>=t?"0 km":Math.floor(t/1e3)+","+Math.floor(t%1e3/10).toFixed(0).padStart(2,"0").padEnd(3,"0")+" km"}formatLat(e){return e>0?e.toFixed(n.fixed)+" N":(-e).toFixed(n.fixed)+" S"}formatLng(e){return e>0?e.toFixed(n.fixed)+" E":(-e).toFixed(n.fixed)+" W"}formatLatLng(e){return 0===e[0]&&0===e[1]?"":this.formatLat(e[0])+" - "+this.formatLng(e[1])}}),O=w("WayPoint"),x=new WeakMap;class P{constructor(){this.name="",this.address="",this.lat=n.defaultValue,this.lng=n.defaultValue,x.set(this,y())}get fullName(){let e=""===this.name?this.address:this.name+", "+this.address;return""===e&&(e=L.formatLatLng([this.lat,this.lng])),e}get latLng(){return[this.lat,this.lng]}set latLng(e){this.lat=e[0],this.lng=e[1]}get objId(){return x.get(this)}get objType(){return O}get jsonObject(){return{name:this.name,address:this.address,lat:parseFloat(this.lat.toFixed(n.fixed)),lng:parseFloat(this.lng.toFixed(n.fixed)),objId:x.get(this),objType:O.jsonObject}}set jsonObject(e){let t=function(e){if(!Object.getOwnPropertyNames(e).includes("objType"))throw new Error("No objType for "+O.name);if(O.validate(e.objType),O.version!==e.objType.version)switch(e.objType.version){case"1.0.0":case"1.1.0":case"1.2.0":case"1.3.0":case"1.4.0":case"1.5.0":case"1.6.0":case"1.7.0":case"1.7.1":case"1.8.0":case"1.9.0":case"1.10.0":case"1.11.0":e.address=e.name,e.name="";case"1.12.0":case"1.13.0":case"2.0.0":e.objType.version="2.1.0";break;default:throw new Error("invalid version for "+O.name)}let t=Object.getOwnPropertyNames(e);return["address","name","lat","lng","objId"].forEach(e=>{if(!t.includes(e))throw new Error("No "+e+" for "+O.name)}),e}(e);this.address=t.address||"",this.name=t.name||"",this.lat=t.lat||n.defaultValue,this.lng=t.lng||n.defaultValue,x.set(this,y()),this.validateData()}validateData(){"string"==typeof this.address?this.address=g.sanitizeToJsString(this.address):this.address="","string"==typeof this.name?this.name=g.sanitizeToJsString(this.name):this.name="","number"!=typeof this.lat&&(this.lat=n.defaultValue),"number"!=typeof this.lng&&(this.lng=n.defaultValue)}}function M(){return Object.seal(new P)}const A=w("ItineraryPoint"),I=new WeakMap;class S{constructor(){this.lat=n.defaultValue,this.lng=n.defaultValue,this.distance=e.defaultValue,this.elev=o.defaultValue,I.set(this,y())}get latLng(){return[this.lat,this.lng]}set latLng(e){this.lat=e[0],this.lng=e[1]}get objType(){return A}get objId(){return I.get(this)}get jsonObject(){return{lat:parseFloat(this.lat.toFixed(n.fixed)),lng:parseFloat(this.lng.toFixed(n.fixed)),distance:parseFloat(this.distance.toFixed(e.fixed)),elev:parseFloat(this.elev.toFixed(o.fixed)),objId:I.get(this),objType:A.jsonObject}}set jsonObject(t){let i=function(e){if(!Object.getOwnPropertyNames(e).includes("objType"))throw new Error("No objType for "+A.name);if(A.validate(e.objType),A.version!==e.objType.version)switch(e.objType.version){case"1.0.0":case"1.1.0":case"1.2.0":case"1.3.0":case"1.4.0":case"1.5.0":case"1.6.0":e.elev=o.defaultValue;case"1.7.0":case"1.7.1":case"1.8.0":case"1.9.0":case"1.10.0":case"1.11.0":case"1.12.0":case"1.13.0":case"2.0.0":e.objType.version="2.1.0";break;default:throw new Error("invalid version for "+A.name)}let t=Object.getOwnPropertyNames(e);return["lat","lng","distance","elev","objId"].forEach(e=>{if(!t.includes(e))throw new Error("No "+e+" for "+A.name)}),e}(t);this.lat=i.lat||n.defaultValue,this.lng=i.lng||n.defaultValue,this.distance=i.distance||e.defaultValue,this.elev=i.elev||o.defaultValue,I.set(this,y()),this.validateData()}validateData(){"number"!=typeof this.lat&&(this.lat=n.defaultValue),"number"!=typeof this.lng&&(this.lng=n.defaultValue),"number"!=typeof this.distance&&(this.distance=e.defaultValue),"number"!=typeof this.elev&&(this.elev=o.defaultValue)}}function E(){return Object.seal(new S)}const C=w("Maneuver"),H=new WeakMap;class R{constructor(){this.iconName="",this.instruction="",this.itineraryPointObjId=-1,this.distance=e.defaultValue,this.duration=e.defaultValue,H.set(this,y())}get objType(){return C}get objId(){return H.get(this)}get jsonObject(){return{iconName:this.iconName,instruction:this.instruction,distance:parseFloat(this.distance.toFixed(e.fixed)),duration:this.duration,itineraryPointObjId:this.itineraryPointObjId,objId:H.get(this),objType:C.jsonObject}}set jsonObject(t){let o=function(t){if(!Object.getOwnPropertyNames(t).includes("objType"))throw new Error("No objType for "+C.name);if(C.validate(t.objType),C.version!==t.objType.version)switch(t.objType.version){case"1.0.0":case"1.1.0":case"1.2.0":case"1.3.0":case"1.4.0":case"1.5.0":case"1.6.0":case"1.7.0":case"1.7.1":case"1.8.0":case"1.9.0":case"1.10.0":case"1.11.0":"kArriveDefault"===t.iconName&&(t.distance=e.defaultValue);case"1.12.0":case"1.13.0":case"2.0.0":t.objType.version="2.1.0";break;default:throw new Error("invalid version for "+C.name)}let o=Object.getOwnPropertyNames(t);return["iconName","instruction","distance","duration","itineraryPointObjId","objId"].forEach(e=>{if(!o.includes(e))throw new Error("No "+e+" for "+C.name)}),t}(t);this.iconName=o.iconName||"",this.instruction=o.instruction||"",this.distance=o.distance||e.defaultValue,this.duration=o.duration||e.defaultValue,this.itineraryPointObjId=o.itineraryPointObjId||-1,H.set(this,y()),this.validateData()}validateData(){"string"==typeof this.iconName?this.iconName=g.sanitizeToJsString(this.iconName):this.iconName="","string"==typeof this.instruction?this.instruction=g.sanitizeToJsString(this.instruction):this.instruction="","number"!=typeof this.distance&&(this.distance=e.defaultValue),"number"!=typeof this.duration&&(this.duration=e.defaultValue),"number"!=typeof this.itineraryPointObjId&&(this.itineraryPointObjId=-1)}}function D(){return Object.seal(new R)}const z=w("Itinerary"),V=new WeakMap;class F{constructor(){this.hasProfile=!1,this.ascent=0,this.descent=0,this.provider="",this.transitMode="",this.itineraryPoints=j(E),this.maneuvers=j(D),V.set(this,y())}get objType(){return z}get objId(){return V.get(this)}get jsonObject(){return{hasProfile:this.hasProfile,ascent:this.ascent,descent:this.descent,itineraryPoints:this.itineraryPoints.jsonObject,maneuvers:this.maneuvers.jsonObject,provider:this.provider,transitMode:this.transitMode,objId:V.get(this),objType:z.jsonObject}}set jsonObject(e){let t=function(e){if(!Object.getOwnPropertyNames(e).includes("objType"))throw new Error("No objType for "+z.name);if(z.validate(e.objType),z.version!==e.objType.version)switch(e.objType.version){case"1.0.0":case"1.1.0":case"1.2.0":case"1.3.0":case"1.4.0":case"1.5.0":case"1.6.0":e.hasProfile=!1,e.ascent=0,e.descent=0;case"1.7.0":case"1.7.1":case"1.8.0":case"1.9.0":case"1.10.0":case"1.11.0":case"1.12.0":case"1.13.0":case"2.0.0":e.objType.version="2.1.0";break;default:throw new Error("invalid version for "+z.name)}let t=Object.getOwnPropertyNames(e);return["hasProfile","ascent","descent","itineraryPoints","maneuvers","provider","transitMode","objId"].forEach(e=>{if(!t.includes(e))throw new Error("No "+e+" for "+z.name)}),e}(e);this.hasProfile=t.hasProfile||!1,this.ascent=t.ascent||0,this.descent=t.descent||0,this.itineraryPoints.jsonObject=t.itineraryPoints||[],this.maneuvers.jsonObject=t.maneuvers||[],this.provider=t.provider||"",this.transitMode=t.transitMode||"",V.set(this,y());let o=new Map,n=0,i=this.itineraryPoints.iterator;for(;!i.done;)o.set(t.itineraryPoints[n].objId,i.value.objId),n++;let a=this.maneuvers.iterator;for(;!a.done;)a.value.itineraryPointObjId=o.get(a.value.itineraryPointObjId);this.validateData()}validateData(){"boolean"!=typeof this.hasProfile&&(this.hasProfile=!1),"number"!=typeof this.ascent&&(this.ascent=0),"number"!=typeof this.descent&&(this.descent=0),"string"==typeof this.provider?this.provider=g.sanitizeToJsString(this.provider):this.provider="","string"==typeof this.transitMode?this.transitMode=g.sanitizeToJsString(this.transitMode):this.transitMode=""}}function k(){return Object.seal(new F)}const U=w("Note"),W=new WeakMap;function B(e){return e.replaceAll(/style='color:white;background-color:red'/g,"class='TravelNotes-Note-WhiteRed'").replaceAll(/style='color:white;background-color:green'/g,"class='TravelNotes-Note-WhiteGreen'").replaceAll(/style='color:white;background-color:blue'/g,"class='TravelNotes-Note-WhiteBlue'").replaceAll(/style='color:white;background-color:brown'/g,"class='TravelNotes-Note-WhiteBrown'").replaceAll(/style='color:white;background-color:black'/g,"class='TravelNotes-Note-WhiteBlack'").replaceAll(/style='border:solid 0.1em'/g,"class='TravelNotes-Note-BlackWhite'").replaceAll(/style='background-color:white;'/g,"class='TravelNotes-Note-Knooppunt'").replaceAll(/style='fill:green;font:bold 120px sans-serif;'/g,"").replaceAll(/style='fill:none;stroke:green;stroke-width:10;'/g,"")}class q{constructor(){this.iconHeight=0,this.iconWidth=0,this.iconContent="",this.popupContent="",this.tooltipContent="",this.phone="",this.url="",this.address="",this.iconLat=n.defaultValue,this.iconLng=n.defaultValue,this.lat=n.defaultValue,this.lng=n.defaultValue,this.distance=e.invalid,this.chainedDistance=e.defaultValue,W.set(this,y())}get isRouteNote(){return this.distance!==e.invalid}get iconLatLng(){return[this.iconLat,this.iconLng]}set iconLatLng(e){this.iconLat=e[0],this.iconLng=e[1]}get latLng(){return[this.lat,this.lng]}set latLng(e){this.lat=e[0],this.lng=e[1]}get objType(){return U}get objId(){return W.get(this)}get jsonObject(){return{iconHeight:this.iconHeight,iconWidth:this.iconWidth,iconContent:this.iconContent,popupContent:this.popupContent,tooltipContent:this.tooltipContent,phone:this.phone,url:this.url,address:this.address,iconLat:parseFloat(this.iconLat.toFixed(n.fixed)),iconLng:parseFloat(this.iconLng.toFixed(n.fixed)),lat:parseFloat(this.lat.toFixed(n.fixed)),lng:parseFloat(this.lng.toFixed(n.fixed)),distance:parseFloat(this.distance.toFixed(e.fixed)),chainedDistance:parseFloat(this.chainedDistance.toFixed(e.fixed)),objId:W.get(this),objType:U.jsonObject}}set jsonObject(t){let o=function(e){if(!Object.getOwnPropertyNames(e).includes("objType"))throw new Error("No objType for "+U.name);if(U.validate(e.objType),U.version!==e.objType.version)switch(e.objType.version){case"1.0.0":case"1.1.0":case"1.2.0":case"1.3.0":case"1.4.0":case"1.5.0":case"1.6.0":case"1.7.0":case"1.7.1":case"1.8.0":case"1.9.0":case"1.10.0":case"1.11.0":case"1.12.0":case"1.13.0":"string"==typeof e.iconHeight&&(e.iconHeight=Number.parseInt(e.iconHeight)),"string"==typeof e.iconWidth&&(e.iconWidth=Number.parseInt(e.iconWidth)),e.iconContent=B(e.iconContent),e.popupContent=B(e.popupContent),e.tooltipContent=B(e.tooltipContent),e.phone=B(e.phone),e.address=B(e.address);case"2.0.0":e.objType.version="2.1.0";break;default:throw new Error("invalid version for "+U.name)}let t=Object.getOwnPropertyNames(e);return["iconHeight","iconWidth","iconContent","popupContent","tooltipContent","phone","url","address","iconLat","iconLng","lat","lng","distance","chainedDistance","objId"].forEach(e=>{if(!t.includes(e))throw new Error("No "+e+" for "+U.name)}),e}(t);this.iconHeight=o.iconHeight||0,this.iconWidth=o.iconWidth||0,this.iconContent=o.iconContent||"",this.popupContent=o.popupContent||"",this.tooltipContent=o.tooltipContent||"",this.phone=o.phone||"",this.url=o.url||"",this.address=o.address||"",this.iconLat=o.iconLat||n.defaultValue,this.iconLng=o.iconLng||n.defaultValue,this.lat=o.lat||n.defaultValue,this.lng=o.lng||n.defaultValue,this.distance=o.distance||e.invalid,this.chainedDistance=o.chainedDistance||e.defaultValue,W.set(this,y()),this.validateData(!0)}validateData(t){if("number"!=typeof this.iconHeight&&(this.iconHeight=0),"number"!=typeof this.iconWidth&&(this.iconWidth=0),"string"==typeof this.iconContent){let e=g.sanitizeToHtmlString(this.iconContent);t&&""!==e.errorsString&&console.log(e.errorsString+" ("+this.iconContent+")"),this.iconContent=e.htmlString}else this.iconContent="";if("string"==typeof this.popupContent){let e=g.sanitizeToHtmlString(this.popupContent);t&&""!==e.errorsString&&console.log(e.errorsString+" ("+this.popupContent+")"),this.popupContent=e.htmlString}else this.popupContent="";if("string"==typeof this.tooltipContent){let e=g.sanitizeToHtmlString(this.tooltipContent);t&&""!==e.errorsString&&console.log(e.errorsString+" ("+this.tooltipContent+")"),this.tooltipContent=e.htmlString}else this.tooltipContent="";if("string"==typeof this.phone){let e=g.sanitizeToHtmlString(this.phone);t&&""!==e.errorsString&&console.log(e.errorsString+" ("+this.phone+")"),this.phone=e.htmlString}else this.phone="";if("string"==typeof this.url&&""!==this.url){let e=g.sanitizeToUrl(this.url);t&&""!==e.errorsString&&console.log(e.errorsString+" ("+this.url+")"),this.url=encodeURI(e.url)}else this.url="";"string"==typeof this.address?this.address=g.sanitizeToHtmlString(this.address).htmlString:this.address="","number"!=typeof this.iconLat&&(this.iconLat=n.defaultValue),"number"!=typeof this.iconLng&&(this.iconLng=n.defaultValue),"number"!=typeof this.lat&&(this.lat=n.defaultValue),"number"!=typeof this.lng&&(this.lng=n.defaultValue),"number"!=typeof this.distance&&(this.distance=e.invalid),"number"!=typeof this.chainedDistance&&(this.chainedDistance=e.defaultValue)}}function Z(){return Object.seal(new q)}const _=w("Route"),J=new WeakMap;class X{constructor(){this.name="",this.wayPoints=j(M),this.wayPoints.add(M()),this.wayPoints.add(M()),this.notes=j(Z),this.itinerary=k(),this.width=m.route.width,this.color=m.route.color,this.dashArray=m.route.dashArray,this.chain=!1,this.chainedDistance=e.defaultValue,this.distance=e.defaultValue,this.duration=e.defaultValue,this.editionStatus=i.notEdited,this.hidden=!1,J.set(this,y())}get computedName(){let e=this.name;return""===e&&(e=(""===this.wayPoints.first.fullName?"???":this.wayPoints.first.fullName)+" ⮞ "+(""===this.wayPoints.last.fullName?"???":this.wayPoints.last.fullName)),e}get objId(){return J.get(this)}get objType(){return _}get jsonObject(){return{name:this.name,wayPoints:this.wayPoints.jsonObject,notes:this.notes.jsonObject,itinerary:this.itinerary.jsonObject,width:this.width,color:this.color,dashArray:this.dashArray,chain:this.chain,distance:parseFloat(this.distance.toFixed(e.fixed)),duration:this.duration,editionStatus:this.editionStatus,hidden:this.hidden,chainedDistance:parseFloat(this.chainedDistance.toFixed(e.fixed)),objId:J.get(this),objType:_.jsonObject}}set jsonObject(e){let t=function(e){if(!Object.getOwnPropertyNames(e).includes("objType"))throw new Error("No objType for "+_.name);if(_.validate(e.objType),_.version!==e.objType.version)switch(e.objType.version){case"1.0.0":e.dashArray=0,e.hidden=!1;case"1.1.0":case"1.2.0":case"1.3.0":case"1.4.0":e.edited=i.notEdited;case"1.5.0":case"1.6.0":case"1.7.0":case"1.7.1":case"1.8.0":case"1.9.0":case"1.10.0":case"1.11.0":e.editionStatus=e.edited;case"1.12.0":case"1.13.0":case"2.0.0":e.objType.version="2.1.0";break;default:throw new Error("invalid version for "+_.name)}let t=Object.getOwnPropertyNames(e);return["name","wayPoints","notes","itinerary","width","color","dashArray","chain","distance","duration","editionStatus","hidden","chainedDistance","objId"].forEach(e=>{if(!t.includes(e))throw new Error("No "+e+" for "+_.name)}),e}(e);this.name=t.name||"",this.wayPoints.jsonObject=t.wayPoints||[],this.notes.jsonObject=t.notes||[],this.itinerary.jsonObject=t.itinerary||k().jsonObject,this.width=t.width||m.route.width,this.color=t.color||"#000000",this.dashArray=t.dashArray||0,this.chain=t.chain||!1,this.distance=t.distance,this.duration=t.duration,this.editionStatus=t.editionStatus||i.notEdited,this.hidden=t.hidden||!1,this.chainedDistance=t.chainedDistance,J.set(this,y()),this.validateData()}validateData(){"string"==typeof this.name?this.name=g.sanitizeToJsString(this.name):this.name="","number"!=typeof this.width&&(this.width=m.route.width),"string"==typeof this.color?this.color=g.sanitizeToColor(this.color)||m.route.color:this.color=m.route.color,"number"!=typeof this.dashArray&&(this.dashArray=0),this.dashArray>=m.route.dashChoices.length&&(this.dashArray=0),"boolean"!=typeof this.chain&&(this.chain=!1),"number"!=typeof this.distance&&(this.distance=e.defaultValue),"number"!=typeof this.duration&&(this.duration=e.defaultValue),"number"!=typeof this.editionStatus&&(this.editionStatus=i.notEdited),"boolean"!=typeof this.hidden&&(this.hidden=!1),"number"!=typeof this.chainedDistance&&(this.chainedDistance=e.defaultValue)}}function G(){return Object.seal(new X)}const K=w("Travel"),$=new WeakMap;class Q{constructor(){this.editedRoute=G(),this.routes=j(G),this.notes=j(Z),this.layerName="OSM - Color",this.name="",this.readOnly=!1,$.set(this,y())}get objId(){return $.get(this)}get objType(){return K}get jsonObject(){return{editedRoute:this.editedRoute.jsonObject,layerName:this.layerName,name:this.name,routes:this.routes.jsonObject,notes:this.notes.jsonObject,readOnly:this.readOnly,objId:$.get(this),objType:K.jsonObject}}set jsonObject(e){let t=function(e){if(!Object.getOwnPropertyNames(e).includes("objType"))throw new Error("No objType for "+K.name);if(K.validate(e.objType),K.version!==e.objType.version)switch(e.objType.version){case"1.0.0":case"1.1.0":case"1.2.0":case"1.3.0":case"1.4.0":e.editedRoute=G();case"1.5.0":e.layerName="OSM - Color";case"1.6.0":case"1.7.0":case"1.7.1":case"1.8.0":case"1.9.0":case"1.10.0":case"1.11.0":case"1.12.0":case"1.13.0":case"2.0.0":e.objType.version="2.1.0";break;default:throw new Error("invalid version for "+K.name)}let t=Object.getOwnPropertyNames(e);return["name","editedRoute","routes","objId"].forEach(e=>{if(!t.includes(e))throw new Error("No "+e+" for "+K.name)}),e}(e);this.editedRoute.jsonObject=t.editedRoute,this.layerName=e.layerName||"OSM - Color",this.name=t.name||"",this.readOnly=t.readOnly||!1,this.routes.jsonObject=t.routes||[],this.notes.jsonObject=t.notes||[],$.set(this,y()),this.validateData()}validateData(){"string"==typeof this.layerName?this.layerName=g.sanitizeToJsString(this.layerName):this.layerName="OSM - Color","string"==typeof this.name?this.name=g.sanitizeToJsString(this.name):this.name="TravelNotes","boolean"!=typeof this.readOnly&&(this.readOnly=!0)}}function Y(){return Object.seal(new Q)}let ee=new Map,te=new Map,oe=Object.seal({provider:"",transitMode:""}),ne=L.UUID;const ie=Object.seal(new class{constructor(){this.map=null,this.travel=Y(),this.editedRouteObjId=-1,this.searchData=[]}get providers(){return ee}get mapObjects(){return te}get routing(){return oe}get UUID(){return ne}});const ae=Object.seal(new class{getRoute(e){let t=null;return t=ie.travel.routes.getAt(e),t||e===ie.travel.editedRoute.objId&&(t=ie.travel.editedRoute),t}getNoteAndRoute(e){let t=null,o=null;if(t=ie.travel.notes.getAt(e),!t){let n=ie.travel.routes.iterator;for(;!n.done&&!t;)t=n.value.notes.getAt(e),t&&(o=n.value);t||(t=ie.travel.editedRoute.notes.getAt(e),t&&(o=ie.travel.editedRoute))}return Object.freeze({note:t,route:o})}getWayPoint(e){let t=ie.travel.editedRoute.wayPoints.getAt(e);if(!t){let o=ie.travel.routes.iterator;for(;!o.done&&!t;)t=o.value.wayPoints.getAt(e)}return t}}),re=Math.PI/180;const se=Object.freeze(new class{getLatLngElevAtDist(e,t){if(e.distance<=t||0>=t)return null;let o=0,n=e.itinerary.itineraryPoints.iterator;for(;o<t&&!n.done;)o+=n.value.distance;let i=n.value;n.done;let a=(i.distance-o+t)/i.distance;return Object.freeze({latLng:[i.lat+(n.value.lat-i.lat)*a,i.lng+(n.value.lng-i.lng)*a],elev:i.elev+(n.value.elev-i.elev)*a,ascent:100*(n.value.elev-i.elev)/i.distance,routeDistance:t})}getClosestLatLngDistance(t,o){if(0===t.itinerary.itineraryPoints.length)return null;let n=t.itinerary.itineraryPoints.iterator;n.done;let i=Number.MAX_VALUE,a=window.L.Projection.SphericalMercator.project(window.L.latLng(o[0],o[1])),r=window.L.Projection.SphericalMercator.project(window.L.latLng(n.value.lat,n.value.lng)),s=null,l=e.defaultValue,c=n.value.distance;for(;!n.done;){let e=window.L.Projection.SphericalMercator.project(window.L.latLng(n.value.lat,n.value.lng)),t=window.L.LineUtil.pointToSegmentDistance(a,r,e);t<i&&(i=t,s=window.L.Projection.SphericalMercator.unproject(window.L.LineUtil.closestPointOnSegment(a,r,e)),l=c-s.distanceTo(window.L.latLng(n.value.lat,n.value.lng))),c+=n.value.distance,r=e}return Object.freeze({latLng:[s.lat,s.lng],distance:l})}getLatLngBounds(e){let t=window.L.latLng([90,180]),o=window.L.latLng([-90,-180]);return e.forEach(e=>{t.lat=Math.min(t.lat,e[0]),t.lng=Math.min(t.lng,e[1]),o.lat=Math.max(o.lat,e[0]),o.lng=Math.max(o.lng,e[1])}),window.L.latLngBounds(t,o)}getSquareBoundingBox(e,t){let o=t/6371e3/re,n=e[0]*re,i=Math.acos((Math.cos(t/6371e3)-Math.sin(n)**2)/Math.cos(n)**2)/re;return window.L.latLngBounds(window.L.latLng([e[0]-o,e[1]-i]),window.L.latLng([e[0]+o,e[1]+i]))}project(e,t){let o=ie.map.project(window.L.latLng(e),t);return[o.x,o.y]}screenCoordToLatLng(e,t){let o=ie.map.containerPointToLatLng(window.L.point(e,t));return[o.lat,o.lng]}addPoints(e,t){return[e[0]+t[0],e[1]+t[1]]}subtrackPoints(e,t){return[e[0]-t[0],e[1]-t[1]]}});function le(){let e=null,t=1,o=1,n=Number.MAX_VALUE,i=0,r=0,l=null,c=0,d=m.route.elev.smoothCoefficient,u=m.route.elev.smoothPoints;function h(){let e=function(){let e=0,t=0,o=[],n=l.itinerary.itineraryPoints.iterator,i=0,a=n.done;for(o.push({distance:e,elev:n.value.elev}),i+=n.value.distance,a=n.done;!a;){for(e+=c;e>=i&&!a;)i+=n.value.distance,a=n.done;if(!a){let a=(n.value.elev-n.previous.elev)/n.previous.distance;t=n.value.elev-(i-e)*a,o.push({distance:e,elev:t})}}return o.push({distance:i,elev:l.itinerary.itineraryPoints.last.elev}),o}(),t=new Map,o=(e[u].elev-e[0].elev)/u,n=0;for(n=0;n<u;n++)t.set(n*c,{distance:n*c,elev:e[0].elev+o*n});for(n=u;n<e.length-u;n++){let o=0;for(let t=n-u;n+u>=t;t++)o+=e[t].elev;t.set(e[n].distance,{distance:e[n].distance,elev:o/(2*u+1)})}return n--,o=c*(e[e.length-1].elev-e[e.length-1-u].elev)/(e[e.length-1].distance-e[e.length-1-u].distance),t.set(e[n].distance+c,{distance:e[n].distance+c,elev:e[n].elev+o}),t.set(e[n].distance+2*c,{distance:e[n].distance+2*c,elev:e[n].elev+2*o}),t}function g(c){return l=c,n=Number.MAX_VALUE,i=0,l.itinerary.itineraryPoints.forEach(e=>{i=Math.max(i,e.elev),n=Math.min(n,e.elev)}),r=i-n,t=a.height/r,o=a.width/l.distance,e=document.createElementNS(s,"svg"),e.setAttributeNS(null,"viewBox","0 0 "+(a.width+2*a.margin)+" "+(a.height+2*a.margin)),e.setAttributeNS(null,"class","TravelNotes-SvgProfile"),function(){let n="",r=0,c=0,d=0;l.itinerary.itineraryPoints.forEach(e=>{c=(a.margin+o*r).toFixed(0),d=(a.margin+t*(i-e.elev)).toFixed(0),n+=c+","+d+" ",r+=e.distance});let u=document.createElementNS(s,"polyline");u.setAttributeNS(null,"points",n),u.setAttributeNS(null,"class","TravelNotes-SvgProfile-profilePolyline"),e.appendChild(u)}(),function(){const t=a.margin.toFixed(0),o=(a.margin+a.height).toFixed(0),n=(a.margin+a.width).toFixed(0),i=a.margin.toFixed(0);let r=t+","+i+" "+t+","+o+" "+n+","+o+" "+n+","+i,l=document.createElementNS(s,"polyline");l.setAttributeNS(null,"points",r),l.setAttributeNS(null,"class","TravelNotes-SvgProfile-framePolyline"),e.appendChild(l)}(),function(){let o=Number.MAX_VALUE,l=0;a.vScales.forEach(e=>{let t=Math.abs(r/4-e);t<o&&(o=t,l=e)});let c=Math.ceil(n/l)*l;const d=(a.margin+a.width+a.xDeltaText).toFixed(0),u=(a.margin-a.xDeltaText).toFixed(0);for(;c<i;){let o=a.margin+(i-c)*t,n=document.createElementNS(s,"text");n.appendChild(document.createTextNode(c.toFixed(0))),n.setAttributeNS(null,"class","TravelNotes-SvgProfile-elevLegend"),n.setAttributeNS(null,"x",d),n.setAttributeNS(null,"y",o),n.setAttributeNS(null,"text-anchor","start"),e.appendChild(n);let r=document.createElementNS(s,"text");r.appendChild(document.createTextNode(c.toFixed(0))),r.setAttributeNS(null,"class","TravelNotes-SvgProfile-elevLegend"),r.setAttributeNS(null,"x",u),r.setAttributeNS(null,"y",o),r.setAttributeNS(null,"text-anchor","end"),e.appendChild(r),c+=l}}(),function(){const t=a.margin+a.height+a.margin/2;let n=Number.MAX_VALUE,i=0;a.hScales.forEach(e=>{let t=Math.abs(l.distance/8-e);t<n&&(n=t,i=e)});let r=Math.ceil(l.chainedDistance/i)*i;for(;r<l.distance+l.chainedDistance;){let n=document.createElementNS(s,"text");n.appendChild(document.createTextNode(1e3<i||0<l.chainedDistance?r/1e3+" km":r+" m ")),n.setAttributeNS(null,"class","TravelNotes-SvgProfile-distLegend"),n.setAttributeNS(null,"x",a.margin+(r-l.chainedDistance)*o),n.setAttributeNS(null,"y",t),n.setAttributeNS(null,"text-anchor","start"),e.appendChild(n),r+=i}}(),e}return Object.seal(new class{smooth(e){!function(e){l=e;let t=l.itinerary.itineraryPoints.iterator,o=0,n=0;for(;!t.done;)o+=t.value.distance,n+=t.next?Math.abs(t.value.elev-t.next.elev):0;if(c=10*Math.floor(d/(n/o)),o<=2*u*c)return;let i=h();t=l.itinerary.itineraryPoints.iterator,t.done;let a=t.value.distance;for(;!t.done;){let e=i.get(Math.floor(a/c)*c),o=i.get(Math.ceil(a/c)*c);if(e&&o){let n=a-e.distance,i=(o.elev-e.elev)/(o.distance-e.distance);t.value.elev=e.elev+n*i}a+=t.value.distance}}(e)}createSvg(e){return g(e)}})}function ce(e,t){let o=t.note,n=f.create("div");if(0!==o.tooltipContent.length&&g.sanitizeToHtmlElement(o.tooltipContent,f.create("div",{className:e+"NoteHtml-TooltipContent"},n)),0!==o.popupContent.length&&g.sanitizeToHtmlElement(o.popupContent,f.create("div",{className:e+"NoteHtml-PopupContent"},n)),0!==o.address.length&&g.sanitizeToHtmlElement("<span>"+N.getText("HTMLViewsFactory - Address")+"</span> : "+o.address,f.create("div",{className:e+"NoteHtml-Address"},n)),0!==o.url.length&&g.sanitizeToHtmlElement(N.getText("HTMLViewsFactory - Link")+"<a href="+o.url+' target="_blank" >'+o.url.substr(0,40)+"...</a>",f.create("div",{className:e+"NoteHtml-Url"},n)),0!==o.phone.length){let t=o.phone;if(o.phone.match(/^\+[0-9, ,*,#]*$/)){let e=o.phone.replaceAll(/\u0020/g,""),n=o.phone.replaceAll(/\u0020/g," ");t=N.getText("HTMLViewsFactory - Phone")+" : "+N.getText("HTMLViewsFactory - call")+'<a target="_blank" href="tel:'+e+'" >'+n+"</a>"+N.getText("HTMLViewsFactory - Send a sms to")+'<a target="_blank" href="sms:'+e+'" >'+n+"</a>"}else t=N.getText("HTMLViewsFactory - Phone")+" : "+o.phone;g.sanitizeToHtmlElement(t,f.create("div",{className:e+"NoteHtml-Phone"},n))}if(g.sanitizeToHtmlElement(L.formatLatLng(o.latLng),f.create("div",{className:e+"NoteHtml-LatLng"},n)),t.route){t.route.chain&&g.sanitizeToHtmlElement("<span>"+N.getText("HTMLViewsFactory - Distance from start of travel")+"</span> : "+L.formatDistance(o.chainedDistance+o.distance),f.create("div",{className:e+"NoteHtml-Distance"},n)),g.sanitizeToHtmlElement("<span>"+N.getText("HTMLViewsFactory - Distance from start of route")+"</span> : "+L.formatDistance(o.distance),f.create("div",{className:e+"NoteHtml-Distance"},n));let i=t.route.notes.next(o.objId);if(i){let t=i.distance-o.distance;9<t&&g.sanitizeToHtmlElement("<span>"+N.getText("HTMLViewsFactory - Next note after")+"</span> : "+L.formatDistance(t),f.create("div",{className:e+"NoteHtml-NextDistance"},n))}}return n}function de(e,t){let o=f.create("div"),n=f.create("div",{className:e+"Travel-Notes-IconCell"},o);g.sanitizeToHtmlElement(t.note.iconContent,n),n.style.width=String(t.note.iconWidth)+"px",n.style.height=String(t.note.iconHeight)+"px","TravelNotes-Roadbook-"===e&&n.firstChild&&("svg"===n.firstChild.tagName?(n.firstChild.setAttributeNS(null,"viewBox","0 0 "+r.svgViewboxDim+" "+r.svgViewboxDim),n.style.width=String(t.note.iconWidth*m.note.svgRoadbookDimCoef)+"px",n.style.height=String(t.note.iconWidth*m.note.svgRoadbookDimCoef)+"px"):n.firstChild.classList.contains("TravelNotes-MapNoteCategory-0073")&&(n.style.width=String(t.note.iconWidth*m.note.svgRoadbookDimCoef)+"px",n.style.height=String(t.note.iconWidth*m.note.svgRoadbookDimCoef)+"px"));let i=ce(e,t);return i.className=e+"Travel-Notes-Cell",o.appendChild(i),o.noteObjId=t.note.objId,o}function ue(e){let t=f.create("div",{className:e+"Travel-Notes"}),o=ie.travel.notes.iterator;for(;!o.done;){let n=de(e,{note:o.value,route:null});n.className=e+"Travel-Notes-Row",t.appendChild(n)}return t}function he(e,t){let o=f.create("div",{className:e+"Route-Header",id:"route"+t.objId});return g.sanitizeToHtmlElement(t.computedName,f.create("div",{className:e+"Route-Header-Name"},o)),0!==t.distance&&g.sanitizeToHtmlElement(N.getText("HTMLViewsFactory - Route distance",{distance:L.formatDistance(t.distance)}),f.create("div",{className:e+"Route-Header-Distance"},o)),ie.travel.readOnly||"bike"===t.itinerary.transitMode||g.sanitizeToHtmlElement(N.getText("HTMLViewsFactory - Duration",{duration:L.formatTime(t.duration)}),f.create("div",{className:e+"Route-Header-Duration"},o)),t.itinerary.hasProfile&&(g.sanitizeToHtmlElement(N.getText("HTMLViewsFactory - Ascent",{ascent:t.itinerary.ascent.toFixed(0)}),f.create("div",{className:e+"Route-Header-Ascent"},o)),g.sanitizeToHtmlElement(N.getText("HTMLViewsFactory - Descent",{descent:t.itinerary.descent.toFixed(0)}),f.create("div",{className:e+"Route-Header-Descent"},o))),o}function ge(t,o){let n=f.create("div");f.create("div",{className:t+"Route-ManeuversAndNotes-IconCell TravelNotes-ManeuverNote-"+o.maneuver.iconName},n);let i=f.create("div",{className:t+"Route-ManeuversAndNotes-Cell"},n);return g.sanitizeToHtmlElement(o.maneuver.instruction,f.create("div",null,i)),o.route.chain&&g.sanitizeToHtmlElement("<span>"+N.getText("HTMLViewsFactory - Distance from start of travel")+"</span> : "+L.formatDistance(o.route.chainedDistance+o.maneuverDistance),f.create("div",null,i)),g.sanitizeToHtmlElement("<span>"+N.getText("HTMLViewsFactory - Distance from start of route")+"</span> : "+L.formatDistance(o.maneuverDistance),f.create("div",null,i)),e.defaultValue<o.maneuver.distance&&g.sanitizeToHtmlElement("<span>"+N.getText("HTMLViewsFactory - Next maneuver after")+"</span> : "+L.formatDistance(o.maneuver.distance),f.create("div",null,i)),n}function pe(e,t){let o=[],n=t.notes.iterator;for(;!n.done;){let i=de(e,{note:n.value,route:t});i.className=e+"Route-Notes-Row",i.objId=y(),i.latLng=n.value.latLng,i.noteObjId=n.value.objId,i.distance=n.value.distance,o.push(i)}let i=t.itinerary.maneuvers.iterator,a=0;for(;!i.done;){let n=ge(e,{route:t,maneuver:i.value,maneuverDistance:a});n.className=e+"Route-Maneuvers-Row",n.objId=y(),n.latLng=t.itinerary.itineraryPoints.getAt(i.value.itineraryPointObjId).latLng,n.maneuverObjId=i.value.objId,n.distance=a,o.push(n),a+=i.value.distance}o.sort((e,t)=>e.distance-t.distance);let r=f.create("div",{className:e+"Route-ManeuversAndNotes"});return o.forEach(e=>r.appendChild(e)),r}function me(e,t){let o="";""!==t.itinerary.provider&&""!==t.itinerary.transitMode&&(o=N.getText("HTMLViewsFactory - Itinerary computed by {provider} and optimized for {transitMode}",{provider:t.itinerary.provider,transitMode:N.getText("HTMLViewsFactory - TransitMode "+t.itinerary.transitMode)}));let n=f.create("div",{className:e+"RouteFooter"});return g.sanitizeToHtmlElement(o,n),n}function fe(e,t){let o=f.create("div",{className:e+"RouteProfile"});return g.sanitizeToHtmlElement(N.getText("HTMLViewsFactory - Profile"),o),o.appendChild(le().createSvg(t)),o}function ve(t){let o=f.create("div",{className:t+"Travel"});o.appendChild(function(t){let o=f.create("div",{className:t+"Travel-Header"});g.sanitizeToHtmlElement(ie.travel.name,f.create("div",{className:t+"Travel-Header-Name"},o));let n=e.defaultValue,i=0,a=0,r=ie.travel.routes.iterator;for(;!r.done;){let e=r.value.objId===ie.editedRouteObjId&&m.routeEditor.displayEditionInHTMLPage?ie.travel.editedRoute:r.value;g.sanitizeToHtmlElement('<a href="#route'+e.objId+'" >'+e.computedName+"</a> : "+L.formatDistance(e.distance)+".",f.create("div",{className:t+"Travel-Header-RouteName"},o)),e.chain&&(n+=e.distance,i+=e.itinerary.ascent,a+=e.itinerary.descent)}return g.sanitizeToHtmlElement(N.getText("HTMLViewsFactory - Travel distance",{distance:L.formatDistance(n)}),f.create("div",{className:t+"Travel-Header-TravelDistance"},o)),0!==i&&g.sanitizeToHtmlElement(N.getText("HTMLViewsFactory - Travel ascent",{ascent:i.toFixed(0)}),f.create("div",{className:t+"Travel-Header-TravelAscent"},o)),0!==a&&g.sanitizeToHtmlElement(N.getText("HTMLViewsFactory - Travel descent",{descent:a.toFixed(0)}),f.create("div",{className:t+"Travel-Header-TravelDescent"},o)),o}(t)),o.appendChild(ue(t));let n=ie.travel.routes.iterator;for(;!n.done;){let e=m.routeEditor.displayEditionInHTMLPage&&n.value.objId===ie.editedRouteObjId?ie.travel.editedRoute:n.value;o.appendChild(he(t,e)),e.itinerary.hasProfile&&o.appendChild(fe(t,e)),o.appendChild(pe(t,e)),o.appendChild(me(t,e))}return o.appendChild(function(e){let t=N.getText("HTMLViewsFactory - Travel footer")+'<a href="https://github.com/wwwouaiebe/leaflet.TravelNotes" target="_blank" title="https://github.com/wwwouaiebe/leaflet.TravelNotes" >Travel & Notes</a>, © <a href="https://www.ouaie.be/" target="_blank" title="https://www.ouaie.be/" >wwwouaiebe 2017 2021</a> © <a href="https://www.openstreetmap.org/copyright" target="_blank" title="https://www.openstreetmap.org/copyright">'+N.getText("HTMLViewsFactory - OpenStreetMap contributors")+"</a>",o=f.create("div",{className:e+"TravelFooter"});return g.sanitizeToHtmlElement(t,o),o}(t)),o}const be=Object.freeze(new class{getTravelHTML(e){return ve(e)}getNoteTextAndIconHTML(e,t){return de(e,t)}getNoteTextHTML(e,t){return ce(e,t)}getEditedRouteManeuversAndNotesHTML(e){return pe(e,ie.travel.editedRoute)}getTravelNotesHTML(e){return ue(e)}getRouteHeaderHTML(e,t){return he(e,t)}});let ye=null,we=null;function je(e){let t=ae.getRoute(e.target.objId),o=se.getClosestLatLngDistance(t,[e.latlng.lat,e.latlng.lng]).distance;o+=t.chainedDistance,o=L.formatDistance(o);let n=ie.mapObjects.get(e.target.objId);n.closeTooltip();let i=t.computedName;ie.travel.readOnly||(i+=0===i.length?"":" - ",i+=o),n.setTooltipContent(i),n.openTooltip(e.latlng)}function Te(e,t){t.objId=e,t.addTo(ie.map),ie.mapObjects.set(e,t)}function Ne(e){let t=ae.getNoteAndRoute(e).note,o=window.L.marker(t.latLng,{icon:window.L.divIcon({iconSize:[m.note.grip.size,m.note.grip.size],iconAnchor:[m.note.grip.size/2,m.note.grip.size/2],html:"<div></div>",className:"TravelNotes-Note-Bullet"}),opacity:m.note.grip.opacity,draggable:!ie.travel.readOnly});o.objId=t.objId;let n=window.L.divIcon({iconSize:[t.iconWidth,t.iconHeight],iconAnchor:[t.iconWidth/2,t.iconHeight/2],popupAnchor:[0,-t.iconHeight/2],html:t.iconContent,className:"TravelNotes-AllNotes "});let i=window.L.marker(t.iconLatLng,{zIndexOffset:100,icon:n,draggable:!ie.travel.readOnly});i.objId=t.objId,i.bindPopup(e=>be.getNoteTextHTML("TravelNotes-",ae.getNoteAndRoute(e.objId))),0!==t.tooltipContent.length&&(i.bindTooltip(e=>ae.getNoteAndRoute(e.objId).note.tooltipContent),i.getTooltip().options.offset[0]=t.iconWidth/2);let a=window.L.polyline([t.latLng,t.iconLatLng],m.note.polyline);a.objId=t.objId;let r=window.L.layerGroup([i,a,o]);return r.markerId=window.L.Util.stamp(i),r.polylineId=window.L.Util.stamp(a),r.bulletId=window.L.Util.stamp(o),Te(t.objId,r),m.note.haveBackground&&document.querySelectorAll(".TravelNotes-MapNote,.TravelNotes-SvgIcon").forEach(e=>e.classList.add("TravelNotes-MapNote-Background")),Object.freeze({marker:i,polyline:a,bullet:o})}function Le(e){e.dashArray>=m.route.dashChoices.length&&(e.dashArray=0);let t=m.route.dashChoices[e.dashArray].iDashArray;if(t){let o="",n=0;for(n=0;n<t.length-1;n++)o+=t[n]*e.width+",";return o+=t[n]*e.width,o}return null}const Oe=Object.seal(new class{addRoute(e){let t=ae.getRoute(e),o=[],n=t.itinerary.itineraryPoints.iterator;for(;!n.done;)o.push(n.value.latLng);let a=window.L.polyline(o,{color:t.color,weight:t.width,dashArray:Le(t)});Te(t.objId,a),i.notEdited===t.editionStatus&&(a.bindTooltip(t.computedName,{sticky:!0,direction:"right"}),a.on("mouseover",je),a.on("mousemove",je)),a.bindPopup(e=>{let t=ae.getRoute(e.objId);return be.getRouteHeaderHTML("TravelNotes-UI-",t)}),window.L.DomEvent.on(a,"click",e=>e.target.openPopup(e.latlng));let r=t.notes.iterator;for(;!r.done;)Ne(r.value.objId);return t}addNote(e){return Ne(e)}getDashArray(e){return Le(e)}zoomTo(e,t){if(t){let e=[];t.forEach(t=>e=e.concat(t)),ie.map.fitBounds(se.getLatLngBounds(e))}else ie.map.setView(e,m.itineraryPointZoom)}setLayer(e,t){let o=null;o="wmts"===e.service.toLowerCase()?window.L.tileLayer(t):window.L.tileLayer.wms(t,e.wmsOptions),ye&&ie.map.removeLayer(ye),ie.map.addLayer(o),ye=o,ie.travel.readOnly||(ie.map.getZoom()<(e.minZoom||0)&&ie.map.setZoom(e.minZoom||0),ie.map.setMinZoom(e.minZoom||0),ie.map.getZoom()>(e.maxZoom||18)&&ie.map.setZoom(e.maxZoom||18),ie.map.setMaxZoom(e.maxZoom||18),e.bounds?(ie.map.getBounds().intersects(e.bounds)&&!ie.map.getBounds().contains(e.bounds)||(ie.map.setMaxBounds(null),ie.map.fitBounds(e.bounds),ie.map.setZoom(e.minZoom||0)),ie.map.setMaxBounds(e.bounds)):ie.map.setMaxBounds(null)),ie.map.fire("baselayerchange",o)}onGeolocationStatusChanged(e){t.active!==e&&we&&(ie.map.removeLayer(we),we=null)}onGeolocationPositionChanged(e){let t=m.geoLocation.zoomToPosition;we&&(ie.map.removeLayer(we),t=!1),we=window.L.circleMarker(window.L.latLng(e.coords.latitude,e.coords.longitude),{radius:m.geoLocation.radius,color:m.geoLocation.color}).bindTooltip(L.formatLatLng([e.coords.latitude,e.coords.longitude])).addTo(ie.map),t&&ie.map.setView(window.L.latLng(e.coords.latitude,e.coords.longitude),m.geoLocation.zoomFactor)}});const xe=Object.freeze(new class{dispatch(e,t){let o=function(e){return-1<["showitinerary","updateitinerary","showtravelnotes","updatetravelnotes","showsearch","updatesearch","setrouteslist","setprovider","providersadded","travelnameupdated","settransitmode"].indexOf(e)?document.getElementById("TravelNotes-UI-MainDiv"):-1<["removeobject","removeallobjects","zoomto","additinerarypointmarker","addsearchpointmarker","addrectangle","addwaypoint","layerchange","geolocationstatuschanged","geolocationpositionchanged","routeupdated","routepropertiesupdated","noteupdated","roadbookupdate","profileclosed"].indexOf(e)?document:null}(e);if(o){let n=new Event(e);t&&(n.data=t),o.dispatchEvent(n)}}});function Pe(e){return Math.floor(Math.abs(e)+.5)*(0<=e?1:-1)}function Me(e,t,o){let n=Pe(e*o),i=Pe(t*o),a=n-i;a<<=1,0>n-i&&(a=~a);let r="";for(;32<=a;)r+=String.fromCharCode(63+(32|31&a)),a>>=5;return r+=String.fromCharCode(a+63),r}const Ae=Object.freeze(new class{encode(e,t){if(!e.length)return"";let o=Math.pow(10,Number.isInteger(t)?t:5),n=Me(e[0][0],0,o)+Me(e[0][1],0,o);for(let t=1;t<e.length;t++){let i=e[t],a=e[t-1];n+=Me(i[0],a[0],o),n+=Me(i[1],a[1],o)}return n}decode(e,t,o=!1){let n=0,i=0,a=0,r=0,s=[],l=Math.pow(10,t);for(;n<e.length;){let t=null,c=0,d=0;do{t=e.charCodeAt(n++)-63,d|=(31&t)<<c,c+=5}while(32<=t);i+=1&d?~(d>>1):d>>1,c=0,d=0;do{t=e.charCodeAt(n++)-63,d|=(31&t)<<c,c+=5}while(32<=t);if(a+=1&d?~(d>>1):d>>1,o){c=0,d=0;do{t=e.charCodeAt(n++)-63,d|=(31&t)<<c,c+=5}while(32<=t);r+=1&d?~(d>>1):d>>1,s.push([i/l,a/l,r/100])}else s.push([i/l,a/l])}return s}});function Ie(){let e=[];function t(t){e.push(t.latLng),e.push(t.iconLatLng)}function o(o){o.itinerary.itineraryPoints.forEach(t=>e.push(t.latLng)),o.notes.forEach(e=>t(e))}return Object.seal(new class{zoomToLatLng(e){xe.dispatch("zoomto",{latLng:e})}zoomToManeuver(e){let t=ie.travel.editedRoute.itinerary.maneuvers.getAt(e).itineraryPointObjId,o=ie.travel.editedRoute.itinerary.itineraryPoints.getAt(t).latLng;xe.dispatch("zoomto",{latLng:o})}zoomToNote(o){e=[],t(ae.getNoteAndRoute(o).note),xe.dispatch("zoomto",{geometry:[e]})}zoomToRoute(t){e=[],o(ae.getRoute(t)),xe.dispatch("zoomto",{geometry:[e]})}zoomToTravel(){e=[],ie.travel.routes.forEach(e=>o(e)),-1!==ie.travel.editedRouteObjId&&o(ie.travel.editedRoute),ie.travel.notes.forEach(e=>t(e)),xe.dispatch("zoomto",{geometry:[e]})}zoomToPoi(e){xe.dispatch("zoomto",e)}})}function Se(){return Object.seal(new class{openDistantFile(e){(function(){function e(e){let t={};0!==e.itinerary.itineraryPoints.length&&(t=e.itinerary.itineraryPoints[0].objType);let o={latLngs:[],distances:[],elevs:[],objIds:[],objType:t};e.itinerary.itineraryPoints.forEach(e=>{o.latLngs.push([e.lat,e.lng]),o.distances.push(e.distance),o.elevs.push(e.elev),o.objIds.push(e.objId)}),o.latLngs=Ae.encode(o.latLngs,n.fixed),e.itinerary.itineraryPoints=o}function t(e){e.itinerary.itineraryPoints.latLngs=Ae.decode(e.itinerary.itineraryPoints.latLngs,n.fixed,!1);let t=[],i=0;e.itinerary.itineraryPoints.latLngs.forEach(n=>{let a={};a.lat=n[0],a.lng=n[1],a.distance=e.itinerary.itineraryPoints.distances[i],e.itinerary.itineraryPoints.elevs?a.elev=e.itinerary.itineraryPoints.elevs[i]:a.elev=o.defaultValue,a.objId=e.itinerary.itineraryPoints.objIds[i],a.objType=e.itinerary.itineraryPoints.objType,t.push(a),i++}),e.itinerary.itineraryPoints=t}function a(e){e.routes.forEach(t),e.editedRoute&&t(e.editedRoute)}return Object.seal(new class{decompress(e){a(e),ie.travel.jsonObject=e,ie.editedRouteObjId=-1,ie.travel.routes.forEach(e=>{i.notEdited!==e.editionStatus&&(ie.editedRouteObjId=e.objId)})}decompressMerge(e){a(e);let t=Y();t.jsonObject=e;let o=t.routes.iterator;for(;!o.done;)ie.travel.routes.add(o.value);let n=t.notes.iterator;for(;!n.done;)ie.travel.notes.add(n.value)}compress(){let t=ie.travel.jsonObject;return t.routes.forEach(e),e(t.editedRoute),t}})})().decompress(e),ie.travel.readOnly=!0,this.display()}display(){document.title="Travel & Notes"+(""===ie.travel.name?"":" - "+ie.travel.name);let e=ie.travel.routes.iterator;for(;!e.done;)i.notEdited===e.value.editionStatus&&xe.dispatch("routeupdated",{removedRouteObjId:-1,addedRouteObjId:e.value.objId});-1!==ie.editedRouteObjId&&xe.dispatch("routeupdated",{removedRouteObjId:-1,addedRouteObjId:ie.travel.editedRoute.objId});let t=ie.travel.notes.iterator;for(;!t.done;)xe.dispatch("noteupdated",{removedNoteObjId:-1,addedNoteObjId:t.value.objId});Ie().zoomToTravel()}})}const Ee=Object.seal(new class{createUI(){f.create("div",{id:"TravelNotes-AttributionsUI"},document.querySelector("body")),this.attributions=""}set attributions(e){let t='© <a href="https://leafletjs.com/" target="_blank" title="Leaflet">Leaflet</a> | © <a href="https://www.openstreetmap.org/copyright" target="_blank" title="OpenStreetMap contributors">OpenStreetMap contributors</a> '+e+'| © <a href="https://github.com/wwwouaiebe" target="_blank" title="https://github.com/wwwouaiebe">Travel & Notes</a>',o=document.getElementById("TravelNotes-AttributionsUI");for(;o.firstChild;)o.removeChild(o.firstChild);g.sanitizeToHtmlElement(t,o)}});let Ce="geolocation"in navigator?t.inactive:t.disabled,He=null;function Re(e){xe.dispatch("geolocationpositionchanged",{position:e})}function De(){t.active===Ce&&(Ce=t.inactive),xe.dispatch("geolocationstatuschanged",{status:Ce}),navigator.geolocation.clearWatch(He),He=null}function ze(e){1===e.code&&(Ce=t.refusedByUser),De()}const Ve=Object.seal(new class{get status(){return Ce}switch(){switch(Ce){case t.inactive:Ce=t.active,xe.dispatch("geolocationstatuschanged",{status:Ce}),navigator.geolocation.getCurrentPosition(Re,ze,m.geoLocation.options),He=navigator.geolocation.watchPosition(Re,ze,m.geoLocation.options);break;case t.active:De()}return Ce}});let Fe=null,ke=[{service:"wmts",url:"https://{s}.tile.osm.org/{z}/{x}/{y}.png",name:"OSM - Color",toolbar:{text:"OSM",color:"red",backgroundColor:"white"},providerName:"OSM",providerKeyNeeded:!1,attribution:""}];function Ue(e){e.stopPropagation(),xe.dispatch("layerchange",{layer:e.target.layer}),Ee.attributions=e.target.layer.attribution}function We(e){e.stopPropagation(),Ve.switch()}function Be(e){e.stopPropagation(),Ie().zoomToTravel()}function qe(e){f.create("div",{className:"TravelNotes-ViewerLayersToolbarUI-Button",title:e.name,layer:e,textContent:e.toolbar.text,style:"color:"+e.toolbar.color+";background-color:"+e.toolbar.backgroundColor},Fe).addEventListener("click",Ue,!1)}const Ze=Object.seal(new class{createUI(){Fe=f.create("div",{id:"TravelNotes-ViewerLayersToolbarUI"},document.querySelector("body")),f.create("div",{className:"TravelNotes-ViewerLayersToolbarUI-Button",title:"My position",textContent:"🌐",style:"color:black;background-color:white"},Fe).addEventListener("click",We,!1),f.create("div",{className:"TravelNotes-ViewerLayersToolbarUI-Button",title:"Zoom on the travel",textContent:"🔍",style:"color:black;background-color:white"},Fe).addEventListener("click",Be,!1),ke.forEach(qe)}setLayer(e){let t=ke.find(t=>t.name===e)||ke[0];xe.dispatch("layerchange",{layer:t}),Ee.attributions=t.attribution}addLayers(e){e.forEach(e=>{e.providerKeyNeeded||ke.push(e)})}});let _e=!1;const Je=Object.seal(new class{addReadOnlyMap(e,t){_e||(_e=!0,document.addEventListener("routeupdated",e=>{e.data&&Oe.addRoute(e.data.addedRouteObjId)},!1),document.addEventListener("noteupdated",e=>{e.data&&Oe.addNote(e.data.addedNoteObjId)},!1),document.addEventListener("zoomto",e=>{e.data&&Oe.zoomTo(e.data.latLng,e.data.geometry)},!1),document.addEventListener("layerchange",e=>{e.data&&Oe.setLayer(e.data.layer,e.data.layer.url)}),document.addEventListener("geolocationpositionchanged",e=>{e.data&&Oe.onGeolocationPositionChanged(e.data.position)},!1),document.addEventListener("geolocationstatuschanged",e=>{e.data&&Oe.onGeolocationStatusChanged(e.data.status)},!1),Ee.createUI(),t&&Ze.createUI(),Ze.setLayer("OSM - Color"),e&&v.getJsonPromise(e).then(e=>{Se().openDistantFile(e)}).catch(e=>{console.log(e||"Not possible to load the .trv file"),ie.map.setView([n.defaultValue,n.defaultValue],2)}))}});(function(){let e=null,t=null,o=!1;return Object.freeze(new class{start(){!function(){let n=new URL(window.location),i=n.searchParams.get("fil");if(i&&0!==i.length)try{if(i=atob(i),i.match(/[^\w-%:./]/))throw new Error("invalid char in the url encoded in the fil parameter");let e=new URL(i);n.protocol&&e.protocol&&n.protocol===e.protocol&&n.hostname&&e.hostname&&n.hostname===e.hostname?t=encodeURI(e.href):console.log("The distant file is not on the same site than the app")}catch(e){console.log(e.message)}let a=n.searchParams.get("lng");a&&(a.match(/^[A-Z,a-z]{2}$/)?e=a.toLowerCase():console.log("invalid lng parameter")),""===n.searchParams.get("lay")&&(o=!0)}(),e=e||m.language;let i=window.location.origin+window.location.pathname+"TravelNotes";v.getJsonPromise(i+"Config.json").then(t=>(t.language=e,"wwwouaiebe.github.io"===window.location.hostname&&(t.note.haveBackground=!0),m.overload(t),v.getJsonPromise(i+e.toUpperCase()+".json"))).then(e=>(N.setTranslations(e),v.getJsonPromise(i+"Layers.json"))).then(e=>{Ze.addLayers(e),function(){{f.create("div",{id:"Map"},document.querySelector("body"));let e=window.L.map("Map",{attributionControl:!1,zoomControl:!1}).setView([n.defaultValue,n.defaultValue],2);ie.map=e,Je.addReadOnlyMap(t,o)}}()}).catch(()=>{document.body.textContent="An error occurs when loading the configuration "})}})})().start()}();
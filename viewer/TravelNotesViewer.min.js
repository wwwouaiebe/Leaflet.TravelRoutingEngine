/**
 * 
 * @source: https://github.com/wwwouaiebe/leaflet.TravelNotes
 * 
 * @licstart  The following is the entire license notice for the
 * JavaScript code in this page.
 * 
 * leaflet.travelnotes - version 1.9.0
 * Build 00375 - 2020-05-07T19:55:20+0200 
 * Copyright 2017 2020 wwwouaiebe 
 * Contact: https://www.ouaie.be/
 * License: GPL-3.0
 * 
 * The JavaScript code in this page is free software: you can
 * redistribute it and/or modify it under the terms of the GNU
 * General Public License (GNU GPL) as published by the Free Software
 * Foundation, either version 3 of the License, or (at your option)
 * any later version.  The code is distributed WITHOUT ANY WARRANTY;
 * without even the implied warranty of MERCHANTABILITY or FITNESS
 * FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.
 * 
 * As additional permission under GNU GPL version 3 section 7, you
 * may distribute non-source (e.g., minimized or compacted) forms of
 * that code without the copy of the GNU GPL normally required by
 * section 4, provided you include this license notice and a URL
 * through which recipients can access the Corresponding Source.
 * 
 * @licend  The above is the entire license notice
 * for the JavaScript code in this page.
 * 
 */


!function(){"use strict";let e=function(){let e={autoLoad:!1,map:{center:{lat:50.50923,lng:5.49542},zoom:12},travelNotesToolbarUI:{contactMail:"https://github.com/wwwouaiebe/leaflet.TravelNotes/issues"},layersToolbarUI:{haveLayersToolbarUI:!0,toolbarTimeOut:1500,contactMail:"https://github.com/wwwouaiebe/leaflet.TravelNotes/issues",theDevil:{addButton:!1,title:"Reminder! The devil will know everything about you",text:"&#x1f47f;"}},mouseUI:{haveMouseUI:!0},errorUI:{timeOut:1e4,helpTimeOut:3e4,showError:!0,showWarning:!0,showInfo:!0,showHelp:!0},geoLocation:{color:"red",radius:11,zoomToPosition:!0,zoomFactor:17,options:{enableHighAccuracy:!1,maximumAge:0,timeout:1/0}},APIKeys:{showDialogButton:!0,saveToSessionStorage:!0,showAPIKeysInDialog:!0,dialogHaveUnsecureButtons:!0},contextMenu:{timeout:1500},routing:{auto:!0},language:"fr",itineraryPointMarker:{color:"red",weight:2,radius:7,fill:!1},searchPointMarker:{color:"green",weight:4,radius:20,fill:!1},searchPointPolyline:{color:"green",weight:4,radius:20,fill:!1},previousSearchLimit:{color:"green",fill:!1,weight:1},nextSearchLimit:{color:"red",fill:!1,weight:1},wayPoint:{reverseGeocoding:!1},route:{color:"#ff0000",width:3,dashArray:0,dashChoices:[{text:"——————",iDashArray:null},{text:"— — — — —",iDashArray:[4,2]},{text:"—‧—‧—‧—‧—",iDashArray:[4,2,0,2]},{text:"················",iDashArray:[0,2]}],elev:{smooth:!0,smoothCoefficient:.25,smoothPoints:3},showDragTooltip:3},note:{reverseGeocoding:!1,grip:{size:10,opacity:0},polyline:{color:"gray",weight:1},style:"",svgIconWidth:200,svgAnleMaxDirection:{right:35,slightRight:80,continue:100,slightLeft:145,left:200,sharpLeft:270,sharpRight:340},svgZoom:17,svgAngleDistance:10,svgHamletDistance:200,svgVillageDistance:400,svgCityDistance:1200,svgTownDistance:1500,svgTimeOut:15e3,cityPrefix:'<span class="TravelNotes-NoteHtml-Address-City">',cityPostfix:"</span>"},itineraryPointZoom:17,routeEditor:{displayEditionInHTMLPage:!0},travelEditor:{clearAfterSave:!0,startMinimized:!0,timeout:1e3,startupRouteEdition:!0},haveBeforeUnloadWarning:!0,overpassApiUrl:"https://lz4.overpass-api.de/api/interpreter",nominatim:{url:"https://nominatim.openstreetmap.org/",language:"*"},printRouteMap:{isEnabled:!0,maxTiles:240,paperWidth:287,paperHeight:200,pageBreak:!1,printNotes:!0,borderWidth:30,zoomFactor:15,entryPointMarker:{color:"green",weight:4,radius:10,fill:!0,fillOpacity:1},exitPointMarker:{color:"red",weight:4,radius:10,fill:!0,fillOpacity:1}},haveCrypto:!1};function t(t){!function e(t,o){if("object"==typeof t&&"object"==typeof o)try{for(let r in o)"object"==typeof o[r]?e(t[r],o[r]):o[r]=t[r]||o[r];for(let r in t)"object"==typeof t[r]?("[object Array]"===Object.prototype.toString.call(t[r])?o[r]=o[r]||[]:o[r]=o[r]||{},e(t[r],o[r])):o[r]=t[r]}catch(e){console.log(e||"Not possible to overload Config")}}(t,e),e=function e(t){for(let o in t)"object"==typeof t[o]&&(t[o]=e(t[o]));return Object.freeze(t)}(e)}return{get autoLoad(){return e.autoLoad},get map(){return e.map},get travelNotesToolbarUI(){return e.travelNotesToolbarUI},get layersToolbarUI(){return e.layersToolbarUI},get mouseUI(){return e.mouseUI},get errorUI(){return e.errorUI},get APIKeys(){return e.APIKeys},get contextMenu(){return e.contextMenu},get routing(){return e.routing},get language(){return e.language},get itineraryPointMarker(){return e.itineraryPointMarker},get searchPointMarker(){return e.searchPointMarker},get searchPointPolyline(){return e.searchPointPolyline},get previousSearchLimit(){return e.previousSearchLimit},get nextSearchLimit(){return e.nextSearchLimit},get wayPoint(){return e.wayPoint},get route(){return e.route},get note(){return e.note},get itineraryPointZoom(){return e.itineraryPointZoom},get routeEditor(){return e.routeEditor},get travelEditor(){return e.travelEditor},get haveBeforeUnloadWarning(){return e.haveBeforeUnloadWarning},get overpassApiUrl(){return e.overpassApiUrl},get nominatim(){return e.nominatim},get geoLocation(){return e.geoLocation},get printRouteMap(){return e.printRouteMap},get haveCrypto(){return e.haveCrypto},overload:e=>t(e)}}();function t(){return Object.seal({create:(e,t,o)=>(function(e,t,o){let r=null;if(r="text"===e.toLowerCase()?document.createTextNode(""):document.createElement(e),o&&o.appendChild(r),t)for(let e in t)try{r[e]=t[e]}catch(t){console.log("Invalid property : "+e)}return r})(e,t,o)})}function o(){const e=200,t=4,o=2e4;return{getJsonPromise:(r,n)=>(r=r,n=n,new Promise(function(a,i){let l=new XMLHttpRequest;l.timeout=o,l.ontimeout=function(){i("XMLHttpRequest TimeOut. File : "+l.responseURL)},l.onreadystatechange=function(){if(t===l.readyState)if(e===l.status){let e=null;try{e=JSON.parse(l.responseText)}catch(e){i(e.message+" File: "+l.responseURL)}a(e)}else i("Error XMLHttpRequest - File : "+l.responseURL)},l.open("GET",r,!0),n&&n.forEach(e=>l.setRequestHeader(e.headerName,e.headerValue)),l.overrideMimeType("application/json"),l.send(null)})),getBinaryPromise:(t,r)=>(function(t,r){return new Promise(function(n,a){let i=new XMLHttpRequest;i.timeout=o,i.ontimeout=function(){a("XMLHttpRequest TimeOut. File : "+i.responseURL)},i.onload=function(){if(e===i.status){let e=i.response;e?n(e):a("Error XMLHttpRequest - File : "+i.responseURL)}else a("Error XMLHttpRequest - File : "+i.responseURL)},i.open("GET",t,!0),r&&r.forEach(e=>i.setRequestHeader(e.headerName,e.headerValue)),i.responseType="arraybuffer",i.send(null)})})(t,r)};var r,n}const r=Object.freeze({fixed:2,invalid:-1,defaultValue:0}),n=Object.freeze({refusedByUser:-1,disabled:0,inactive:1,active:2}),a=Object.freeze({fixed:2,defaultValue:0}),i=Object.freeze({defaultValue:0,fixed:6}),l=Object.freeze({notEdited:0,editedNoChange:1,editedChanged:2}),s=Object.freeze({margin:100,height:500,width:1e3,yDeltaText:30,xDeltaText:10,vScales:[1,2,5,10,20,50,100,200,500,1e3,2e3,5e3],hScales:[1,2,5,10,20,50,100,200,500,1e3,2e3,5e3,1e4,2e4,5e4,1e5]}),d=-1,c=-1,u=0,g=1,v=2;let f=u;function p(){return++f}const h="1.9.0";function m(e){const t=e,o=h;return Object.seal({get name(){return t},get version(){return o},get object(){return{name:t,version:o}},validate:e=>(function(e){if(!Object.getOwnPropertyNames(e).includes("name"))throw new Error("No name for "+t);if(t!==e.name)throw new Error("Invalid name for "+t);if(!Object.getOwnPropertyNames(e).includes("version"))throw new Error("No version for "+t)})(e)})}function b(e){const t=-1,o=1,r=e().objType.name,n=e;let a=[];function i(e){if(!e.objType||!e.objType.name||e.objType.name!==r)throw new Error("invalid object name for add function");a.push(e)}function l(){let e=c;return{get value(){return e<a.length?a[e]:null},get previous(){return u>=e?null:a[e-g]},get next(){return e<a.length-g?a[e+g]:null},get done(){return++e>=a.length},get first(){return u===e},get last(){return e>=a.length-g},get index(){return e}}}function s(e){return a.findIndex(t=>t.objId===e)}function d(e,t,o){let r=s(e);if(c===r)throw new Error("invalid objId for next or previous function");let n=t;for(n||(n=(()=>!0)),r+=o;c<r&&r<a.length&&!n(a[r]);)r+=o;return c===r||a.length===r?null:a[r]}return Object.seal({add:e=>i(e),forEach:e=>(function(e){let t=null,o=l();for(;!o.done;)t=e(o.value,t);return t})(e),getAt:e=>(function(e){let t=s(e);return c===t?null:a[t]})(e),moveTo:(e,t,o)=>(function(e,t,o){let r=s(e),n=s(t);o||n++,a.splice(n,u,a[r]),n<r&&r++,a.splice(r,g)})(e,t,o),next:(e,t)=>d(e,t,1),previous:(e,t)=>d(e,t,-1),remove:e=>(function(e){let t=s(e);if(c===t)throw new Error("invalid objId for remove function");a.splice(s(e),g)})(e),removeAll:e=>(p=e,void(p?a.splice(g,a.length-v):a.length=u)),replace:(e,t)=>(function(e,t){let o=s(e);if(c===o)throw new Error("invalid objId for replace function");a[o]=t})(e,t),reverse:()=>void a.reverse(),sort:e=>(e=e,void a.sort(e)),swap:(e,r)=>(function(e,r){let n=s(e);if(c===n||u===n&&r||a.length-g===n&&!r)throw new Error("invalid objId for swap function");let i=a[n];a[n]=a[n+(r?t:o)],a[n+(r?t:o)]=i})(e,r),get first(){return a[u]},get iterator(){return l()},get last(){return a[a.length-g]},get length(){return a.length},get object(){return function(){let e=[],t=l();for(;!t.done;)e.push(t.value.object);return e}()},set object(e){!function(e){a.length=u;let t=null;e.forEach(e=>{(t=n()).object=e,i(t)})}(e)}});var f,p}const y=m("WayPoint");function w(){let e="",t=i.defaultValue,o=i.defaultValue,r=p();function n(n){let a=function(e){if(!Object.getOwnPropertyNames(e).includes("objType"))throw new Error("No objType for "+y.name);if(y.validate(e.objType),y.version!==e.objType.version)switch(e.objType.version){case"1.0.0":case"1.1.0":case"1.2.0":case"1.3.0":case"1.4.0":case"1.5.0":case"1.6.0":case"1.7.0":case"1.7.1":case"1.8.0":e.objType.version="1.9.0";break;default:throw new Error("invalid version for "+y.name)}let t=Object.getOwnPropertyNames(e);return["name","lat","lng","objId"].forEach(e=>{if(!t.includes(e))throw new Error("No "+e+" for "+y.name)}),e}(n);e=a.name||"",t=a.lat||i.defaultValue,o=a.lng||i.defaultValue,r=p()}return Object.seal({get name(){return e},set name(t){e=t},get lat(){return t},set lat(e){t=e},get lng(){return o},set lng(e){o=e},get latLng(){return[t,o]},set latLng(e){t=e[u],o=e[g]},get objId(){return r},get objType(){return y},get object(){return{name:e,lat:parseFloat(t.toFixed(i.fixed)),lng:parseFloat(o.toFixed(i.fixed)),objId:r,objType:y.object}},set object(e){n(e)}})}const j=m("ItineraryPoint");function T(){let e=i.defaultValue,t=i.defaultValue,o=r.defaultValue,n=a.defaultValue,l=p();function s(s){let d=function(e){if(!Object.getOwnPropertyNames(e).includes("objType"))throw new Error("No objType for "+j.name);if(j.validate(e.objType),j.version!==e.objType.version)switch(e.objType.version){case"1.0.0":case"1.1.0":case"1.2.0":case"1.3.0":case"1.4.0":case"1.5.0":case"1.6.0":e.elev=a.defaultValue;case"1.7.0":case"1.7.1":case"1.8.0":e.objType.version="1.9.0";break;default:throw new Error("invalid version for "+j.name)}let t=Object.getOwnPropertyNames(e);return["lat","lng","distance","elev","objId"].forEach(e=>{if(!t.includes(e))throw new Error("No "+e+" for "+j.name)}),e}(s);e=d.lat||i.defaultValue,t=d.lng||i.defaultValue,o=d.distance||r.defaultValue,n=d.elev||a.defaultValue,l=p()}return Object.seal({get lat(){return e},set lat(t){e=t},get lng(){return t},set lng(e){t=e},get latLng(){return[e,t]},set latLng(o){e=o[u],t=o[g]},get distance(){return o},set distance(e){o=e},get elev(){return n},set elev(e){n=e},get objId(){return l},get objType(){return j},get object(){return{lat:parseFloat(e.toFixed(i.fixed)),lng:parseFloat(t.toFixed(i.fixed)),distance:parseFloat(o.toFixed(r.fixed)),elev:parseFloat(n.toFixed(a.fixed)),objId:l,objType:j.object}},set object(e){s(e)}})}const N=m("Maneuver");function I(){let e=p(),t="",o="",n=-1,a=r.defaultValue,i=r.defaultValue;function l(l){let s=function(e){if(!Object.getOwnPropertyNames(e).includes("objType"))throw new Error("No objType for "+N.name);if(N.validate(e.objType),N.version!==e.objType.version)switch(e.objType.version){case"1.0.0":case"1.1.0":case"1.2.0":case"1.3.0":case"1.4.0":case"1.5.0":case"1.6.0":case"1.7.0":case"1.7.1":case"1.8.0":e.objType.version="1.9.0";break;default:throw new Error("invalid version for "+N.name)}let t=Object.getOwnPropertyNames(e);return["iconName","instruction","distance","duration","itineraryPointObjId","objId"].forEach(e=>{if(!t.includes(e))throw new Error("No "+e+" for "+N.name)}),e}(l);t=s.iconName||"",o=s.instruction||"",a=s.distance||r.defaultValue,i=s.duration||r.defaultValue,n=s.itineraryPointObjId||d,e=p()}return Object.seal({get iconName(){return t},set iconName(e){t=e},get instruction(){return o},set instruction(e){o=e},get itineraryPointObjId(){return n},set itineraryPointObjId(e){n=e},get distance(){return a},set distance(e){a=e},get duration(){return i},set duration(e){i=e},get objId(){return e},get objType(){return N},get object(){return{iconName:t,instruction:o,distance:parseFloat(a.toFixed(r.fixed)),duration:i,itineraryPointObjId:n,objId:e,objType:N.object}},set object(e){l(e)}})}const M=m("Itinerary");function x(){let e=!1,t=u,o=u,r="",n="",a=b(T),i=b(I),l=p();function s(s){let d=function(e){if(!Object.getOwnPropertyNames(e).includes("objType"))throw new Error("No objType for "+M.name);if(M.validate(e.objType),M.version!==e.objType.version)switch(e.objType.version){case"1.0.0":case"1.1.0":case"1.2.0":case"1.3.0":case"1.4.0":case"1.5.0":case"1.6.0":e.hasProfile=!1,e.ascent=u,e.descent=u;case"1.7.0":case"1.7.1":case"1.8.0":e.objType.version="1.9.0";break;default:throw new Error("invalid version for "+M.name)}let t=Object.getOwnPropertyNames(e);return["hasProfile","ascent","descent","itineraryPoints","maneuvers","provider","transitMode","objId"].forEach(e=>{if(!t.includes(e))throw new Error("No "+e+" for "+M.name)}),e}(s);e=d.hasProfile||!1,t=d.ascent||u,o=d.descent||u,a.object=d.itineraryPoints||[],i.object=d.maneuvers||[],r=d.provider||"",n=d.transitMode||"",l=p();let c=new Map,g=u,v=a.iterator;for(;!v.done;)c.set(d.itineraryPoints[g].objId,v.value.objId),g++;let f=i.iterator;for(;!f.done;)f.value.itineraryPointObjId=c.get(f.value.itineraryPointObjId)}return Object.seal({get hasProfile(){return e},set hasProfile(t){e=t},get ascent(){return t},set ascent(e){t=e},get descent(){return o},set descent(e){o=e},get itineraryPoints(){return a},get maneuvers(){return i},get provider(){return r},set provider(e){r=e},get transitMode(){return n},set transitMode(e){n=e},get objId(){return l},get objType(){return M},get object(){return{hasProfile:e,ascent:t,descent:o,itineraryPoints:a.object,maneuvers:i.object,provider:r,transitMode:n,objId:l,objType:M.object}},set object(e){s(e)}})}const O=m("Note");function P(){const e=0;let t=p(),o=e,n=e,a="",l="",s="",d="",c="",v="",f=i.defaultValue,h=i.defaultValue,m=i.defaultValue,b=i.defaultValue,y=r.invalid,w=r.defaultValue;function j(u){let g=function(e){if(!Object.getOwnPropertyNames(e).includes("objType"))throw new Error("No objType for "+O.name);if(O.validate(e.objType),O.version!==e.objType.version)switch(e.objType.version){case"1.0.0":case"1.1.0":case"1.2.0":case"1.3.0":case"1.4.0":case"1.5.0":case"1.6.0":case"1.7.0":case"1.7.1":case"1.8.0":e.objType.version="1.9.0";break;default:throw new Error("invalid version for "+O.name)}let t=Object.getOwnPropertyNames(e);return["iconHeight","iconWidth","iconContent","popupContent","tooltipContent","phone","url","address","iconLat","iconLng","lat","lng","distance","chainedDistance","objId"].forEach(e=>{if(!t.includes(e))throw new Error("No "+e+" for "+O.name)}),e}(u);o=g.iconHeight||e,n=g.iconWidth||e,a=g.iconContent||"",l=g.popupContent||"",s=g.tooltipContent||"",d=g.phone||"",c=g.url||"",v=g.address||"",f=g.iconLat||i.defaultValue,h=g.iconLng||i.defaultValue,m=g.lat||i.defaultValue,b=g.lng||i.defaultValue,y=g.distance||r.invalid,w=g.chainedDistance,t=p()}return Object.seal({get isRouteNote(){return y!==r.invalid},get iconHeight(){return o},set iconHeight(e){o=e},get iconWidth(){return n},set iconWidth(e){n=e},get iconContent(){return a},set iconContent(e){a=e},get popupContent(){return l},set popupContent(e){l=e},get tooltipContent(){return s},set tooltipContent(e){s=e},get phone(){return d},set phone(e){d=e},get url(){return c},set url(e){c=e},get address(){return v},set address(e){v=e},get iconLat(){return f},set iconLat(e){f=e},get iconLng(){return h},set iconLng(e){h=e},get iconLatLng(){return[f,h]},set iconLatLng(e){f=e[u],h=e[g]},get lat(){return m},set lat(e){m=e},get lng(){return b},set lng(e){b=e},get latLng(){return[m,b]},set latLng(e){m=e[u],b=e[g]},get distance(){return y},set distance(e){y=e},get chainedDistance(){return w},set chainedDistance(e){w=e},get objId(){return t},get objType(){return O},get object(){return{iconHeight:o,iconWidth:n,iconContent:a,popupContent:l,tooltipContent:s,phone:d,url:c,address:v,iconLat:parseFloat(f.toFixed(i.fixed)),iconLng:parseFloat(h.toFixed(i.fixed)),lat:parseFloat(m.toFixed(i.fixed)),lng:parseFloat(b.toFixed(i.fixed)),distance:parseFloat(y.toFixed(r.fixed)),chainedDistance:parseFloat(w.toFixed(r.fixed)),objId:t,objType:O.object}},set object(e){j(e)}})}const E=m("Route");function A(){let t="",o=b(w);o.add(w()),o.add(w());let n=b(P),a=x(),i=e.route.width,s=e.route.color,d=e.route.dashArray,c=!1,g=r.defaultValue,v=r.defaultValue,f=r.defaultValue,h=l.notEdited;let m=!1,y=p();function j(r){let b=function(e){if(!Object.getOwnPropertyNames(e).includes("objType"))throw new Error("No objType for "+E.name);if(E.validate(e.objType),E.version!==e.objType.version)switch(e.objType.version){case"1.0.0":e.dashArray=u,e.hidden=!1;case"1.1.0":case"1.2.0":case"1.3.0":case"1.4.0":e.edited=l.notEdited;case"1.5.0":case"1.6.0":case"1.7.0":case"1.7.1":case"1.8.0":e.objType.version="1.9.0";break;default:throw new Error("invalid version for "+E.name)}let t=Object.getOwnPropertyNames(e);return["name","wayPoints","notes","itinerary","width","color","dashArray","chain","distance","duration","edited","hidden","chainedDistance","objId"].forEach(e=>{if(!t.includes(e))throw new Error("No "+e+" for "+E.name)}),e}(r);t=b.name||"",o.object=b.wayPoints||[],n.object=b.notes||[],a.object=b.itinerary||x().object,i=b.width||e.route.width,s=b.color||"#000000",d=b.dashArray||u,c=b.chain||!1,v=b.distance,f=b.duration,h=b.edited||l.notEdited,m=b.hidden||!1,g=b.chainedDistance,y=p()}return Object.seal({get wayPoints(){return o},get itinerary(){return a},get notes(){return n},get name(){return t},set name(e){t=e},get width(){return i},set width(e){i=e},get color(){return s},set color(e){s=e},get dashArray(){return d},set dashArray(e){d=e},get chain(){return c},set chain(e){c=e},get chainedDistance(){return g},set chainedDistance(e){g=e},get distance(){return v},set distance(e){v=e},get duration(){return f},set duration(e){f=e},get edited(){return h},set edited(e){!function(e){if("number"!=typeof e||l.notEdited>e||l.editedChanged<e)throw new Error("Invalid value for Route.edited : "+e);h=e}(e)},get hidden(){return m},set hidden(e){m=e},get objId(){return y},get objType(){return E},get object(){return{name:t,wayPoints:o.object,notes:n.object,itinerary:a.object,width:i,color:s,dashArray:d,chain:c,distance:parseFloat(v.toFixed(r.fixed)),duration:f,edited:h,hidden:m,chainedDistance:parseFloat(g.toFixed(r.fixed)),objId:y,objType:E.object}},set object(e){j(e)}})}const R=m("Travel");function C(){let e=A(),t="OSM - Color",o="TravelNotes",r=b(A),n=b(P),a=p(),i=!1,l={};function s(s){let d=function(e){if(!Object.getOwnPropertyNames(e).includes("objType"))throw new Error("No objType for "+R.name);if(R.validate(e.objType),R.version!==e.objType.version)switch(e.objType.version){case"1.0.0":case"1.1.0":case"1.2.0":case"1.3.0":case"1.4.0":e.editedRoute=A();case"1.5.0":if(e.userData.layerId){let t=[{layerId:"0",layerName:"OSM - Color"},{layerId:"1",layerName:"OSM - Black and White"},{layerId:"2",layerName:"Thunderforest - Transport"},{layerId:"3",layerName:"Thunderforest - OpenCycleMap"},{layerId:"4",layerName:"Thunderforest - Outdoors"},{layerId:"5",layerName:"Esri - Aerial view"},{layerId:"6",layerName:"Kartverket - Norway"},{layerId:"7",layerName:"IGN-NGI - Belgium now"},{layerId:"12",layerName:"Thunderforest - Landscape"},{layerId:"24",layerName:"Lantmäteriet - Sweden"},{layerId:"25",layerName:"Maanmittauslaitos - Finland"}].find(t=>t.layerId===e.userData.layerId);e.layerName=t?t.layerName:"OSM - Color"}else e.layerName="OSM - Color";case"1.6.0":case"1.7.0":case"1.7.1":case"1.8.0":e.objType.version="1.9.0";break;default:throw new Error("invalid version for "+R.name)}let t=Object.getOwnPropertyNames(e);return["name","editedRoute","routes","userData","objId"].forEach(e=>{if(!t.includes(e))throw new Error("No "+e+" for "+R.name)}),e}(s);e.object=d.editedRoute,t=s.layerName||"OSM - Color",o=d.name||"",l=d.userData||{},i=d.readOnly||!1,r.object=d.routes||[],n.object=d.notes||[],a=p()}return Object.seal({get editedRoute(){return e},set editedRoute(t){e=t},get routes(){return r},get notes(){return n},get layerName(){return t},set layerName(e){t=e},get name(){return o},set name(e){o=e},get readOnly(){return i},set readOnly(e){i=e},get userData(){return l},set userData(e){l=e},get objId(){return a},get objType(){return R},get object(){return{editedRoute:e.object,layerName:t,name:o,routes:r.object,notes:n.object,userData:l,readOnly:i,objId:a,objType:R.object}},set object(e){s(e)}})}const S=function(){let e=new Map;return{setTranslations:t=>(t=t,void t.forEach(t=>e.set(t.msgid,t.msgstr))),getText:(t,o)=>(function(t,o){let r=e.get(t);return o&&r&&Object.getOwnPropertyNames(o).forEach(e=>r=r.replace("{"+e+"}",o[e])),r||t})(t,o)};var t}();function D(){function e(e){return e>u?e.toFixed(i.fixed)+" N":(-e).toFixed(i.fixed)+" S"}function t(e){return e>u?e.toFixed(i.fixed)+" E":(-e).toFixed(i.fixed)+" W"}return Object.seal({get UUID(){return function(){function e(){return Math.floor(65536*(g+Math.random())).toString(16).substring(g)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}()},storageAvailable:e=>(function(e){try{let t=window[e],o="__storage_test__";return t.setItem(o,o),t.removeItem(o),!0}catch(e){return!1}})(e),fileAPIAvailable:()=>(function(){try{return new File(["testdata"],{type:"text/plain"}),!0}catch(e){return!!window.navigator.msSaveOrOpenBlob}})(),saveFile:(e,t,o)=>(function(e,t,o){if(window.navigator.msSaveOrOpenBlob)try{window.navigator.msSaveOrOpenBlob(new Blob([t]),e)}catch(e){console.log(e||"An error occurs when saving file")}else try{let r=window.URL.createObjectURL(new File([t],{type:o||"text/plain"})),n=document.createElement("a");n.setAttribute("href",r),n.setAttribute("download",e),n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(r)}catch(e){console.log(e||"An error occurs when saving file")}})(e,t,o),formatTime:e=>(function(e){let t=Math.floor(e);if(u===t)return"";let o=Math.floor(t/86400),r=Math.floor(t%86400/3600),n=Math.floor(t%3600/60),a=Math.floor(t%60);return u<o?o+" "+S.getText("Utilities - Day")+" "+r+" "+S.getText("Utilities - Hour"):u<r?r+" "+S.getText("Utilities - Hour")+" "+n+" "+S.getText("Utilities - Minute"):u<n?n+" "+S.getText("Utilities - Minute"):a+" "+S.getText("Utilities - Second")})(e),formatDistance:e=>(function(e){let t=Math.floor(e);return u===t?"":Math.floor(t/1e3)+","+Math.floor(t%1e3/10).toFixed(u).padStart(v,"0").padEnd(3,"0")+" km"})(e),formatLat:t=>e(t),formatLng:e=>t(e),formatLatLng:o=>(o=o,u===o[u]&&u===o[g]?"":e(o[u])+" - "+t(o[g]))});var o}const H=function(){let e={map:null,providers:new Map,mapObjects:new Map,travel:C(),editedRouteObjId:d,routing:Object.seal({provider:"",transitMode:""}),searchData:[],UUID:D().UUID};return Object.seal({get map(){return e.map},set map(t){e.map=t},get providers(){return e.providers},get mapObjects(){return e.mapObjects},get travel(){return e.travel},set travel(t){e.travel=t},get editedRouteObjId(){return e.editedRouteObjId},set editedRouteObjId(t){e.editedRouteObjId=t},get routeEdition(){return e.routeEdition},get routing(){return e.routing},get searchData(){return e.searchData},set searchData(t){e.searchData=t},get UUID(){return e.UUID}})}();function U(){return Object.seal({getRoute:e=>(function(e){let t=null;return(t=H.travel.routes.getAt(e))||e===H.travel.editedRoute.objId&&(t=H.travel.editedRoute),t})(e),getNoteAndRoute:e=>(function(e){let t=null;if(t=H.travel.notes.getAt(e))return{note:t,route:null};let o=H.travel.routes.iterator;for(;!o.done;)if(t=o.value.notes.getAt(e))return{note:t,route:o.value};return(t=H.travel.editedRoute.notes.getAt(e))?{note:t,route:H.travel.editedRoute}:{note:null,route:null}})(e),getWayPoint:e=>(function(e){let t=null,o=H.travel.routes.iterator;for(;!o.done;)if(t=o.value.wayPoints.getAt(e))return t;return(t=H.travel.editedRoute.wayPoints.getAt(e))||null})(e)})}function F(){const e=180,t=360,o=540;function n(r){return(r+o)%t-e}return Object.seal({getLatLngElevAtDist:(e,t)=>(function(e,t){if(e.distance<=t||u>=t)return null;let o=0,r=e.itinerary.itineraryPoints.iterator;for(;o<t&&!r.done;)o+=r.value.distance;let n=r.value;r.done;let a=(n.distance-o+t)/n.distance;return[n.lat+(r.value.lat-n.lat)*a,n.lng+(r.value.lng-n.lng)*a,n.elev+(r.value.elev-n.elev)*a,100*(r.value.elev-n.elev)/n.distance]})(e,t),getClosestLatLngDistance:(e,t)=>(function(e,t){if(u===e.itinerary.itineraryPoints.length)return null;let o=e.itinerary.itineraryPoints.iterator;o.done;let n=Number.MAX_VALUE,a=L.Projection.SphericalMercator.project(L.latLng(t[u],t[g])),i=L.Projection.SphericalMercator.project(L.latLng(o.value.lat,o.value.lng)),l=null,s=r.defaultValue,d=o.value.distance;for(;!o.done;){let e=L.Projection.SphericalMercator.project(L.latLng(o.value.lat,o.value.lng)),t=L.LineUtil.pointToSegmentDistance(a,i,e);t<n&&(n=t,s=d-(l=L.Projection.SphericalMercator.unproject(L.LineUtil.closestPointOnSegment(a,i,e))).distanceTo(L.latLng(o.value.lat,o.value.lng))),d+=o.value.distance,i=e}return{latLng:[l.lat,l.lng],distance:s}})(e,t),getLatLngBounds:e=>(function(e){let t=L.latLng([90,180]),o=L.latLng([-90,-180]);return e.forEach(e=>{t.lat=Math.min(t.lat,e[u]),t.lng=Math.min(t.lng,e[g]),o.lat=Math.max(o.lat,e[u]),o.lng=Math.max(o.lng,e[g])}),L.latLngBounds(t,o)})(e),pointsDistance:(t,o)=>(function(t,o){if(t[u]===o[u]&&t[g]===o[g])return u;const r=Math.PI/e;let a=t[u]*r,i=o[u]*r,l=(n(o[g])-n(t[g]))*r;return 6371e3*Math.acos(Math.sin(a)*Math.sin(i)+Math.cos(a)*Math.cos(i)*Math.cos(l))})(t,o),project:(e,t)=>(function(e,t){let o=H.map.project(L.latLng(e),t);return[o.x,o.y]})(e,t),screenCoordToLatLng:(e,t)=>(function(e,t){let o=H.map.containerPointToLatLng(L.point(e,t));return[o.lat,o.lng]})(e,t),addPoints:(e,t)=>(e=e,t=t,[e[u]+t[u],e[g]+t[g]]),subtrackPoints:(e,t)=>(function(e,t){return[e[u]-t[u],e[g]-t[g]]})(e,t)});var a,i}function V(){let t=null,o=g,r=g,n=Number.MAX_VALUE,a=u,i=u,l=null,d=u,c=e.route.elev.smoothCoefficient,f=e.route.elev.smoothPoints;function p(){let e=function(){let e=0,t=0,o=[],r=l.itinerary.itineraryPoints.iterator,n=0,a=r.done;for(o.push({distance:e,elev:r.value.elev}),n+=r.value.distance,a=r.done;!a;){for(e+=d;e>=n&&!a;)n+=r.value.distance,a=r.done;if(!a){let a=(r.value.elev-r.previous.elev)/r.previous.distance;t=r.value.elev-(n-e)*a,o.push({distance:e,elev:t})}}return o.push({distance:n,elev:l.itinerary.itineraryPoints.last.elev}),o}(),t=new Map,o=(e[f].elev-e[u].elev)/f,r=u;for(r=u;r<f;r++)t.set(r*d,{distance:r*d,elev:e[u].elev+o*r});for(r=f;r<e.length-f;r++){let o=u;for(let t=r-f;r+f>=t;t++)o+=e[t].elev;t.set(e[r].distance,{distance:e[r].distance,elev:o/(f*v+g)})}return r--,o=d*(e[e.length-g].elev-e[e.length-g-f].elev)/(e[e.length-g].distance-e[e.length-g-f].distance),t.set(e[r].distance+d,{distance:e[r].distance+d,elev:e[r].elev+o}),t.set(e[r].distance+d*v,{distance:e[r].distance+d*v,elev:e[r].elev+o*v}),t}function h(e){return l=e,n=Number.MAX_VALUE,a=u,l.itinerary.itineraryPoints.forEach(e=>{a=Math.max(a,e.elev),n=Math.min(n,e.elev)}),i=a-n,o=s.height/i,r=s.width/l.distance,(t=document.createElementNS("http://www.w3.org/2000/svg","svg")).setAttributeNS(null,"viewBox","0 0 "+(s.width+v*s.margin)+" "+(s.height+v*s.margin)),t.setAttributeNS(null,"class","TravelNotes-SvgProfile"),function(){let e="",n=u,i=u,d=u;l.itinerary.itineraryPoints.forEach(t=>{i=(s.margin+r*n).toFixed(u),d=(s.margin+o*(a-t.elev)).toFixed(u),e+=i+","+d+" ",n+=t.distance});let c=document.createElementNS("http://www.w3.org/2000/svg","polyline");c.setAttributeNS(null,"points",e),c.setAttributeNS(null,"class","TravelNotes-SvgProfile-profilePolyline"),t.appendChild(c)}(),function(){const e=s.margin.toFixed(u),o=(s.margin+s.height).toFixed(u),r=(s.margin+s.width).toFixed(u),n=s.margin.toFixed(u);let a=e+","+n+" "+e+","+o+" "+r+","+o+" "+r+","+n,i=document.createElementNS("http://www.w3.org/2000/svg","polyline");i.setAttributeNS(null,"points",a),i.setAttributeNS(null,"class","TravelNotes-SvgProfile-framePolyline"),t.appendChild(i)}(),function(){let e=Number.MAX_VALUE,r=u;s.vScales.forEach(t=>{let o=Math.abs(i/4-t);o<e&&(e=o,r=t)});let l=Math.ceil(n/r)*r;const d=(s.margin+s.width+s.xDeltaText).toFixed(u),c=(s.margin-s.xDeltaText).toFixed(u);for(;l<a;){let e=s.margin+(a-l)*o,n=document.createElementNS("http://www.w3.org/2000/svg","text");n.appendChild(document.createTextNode(l.toFixed(u))),n.setAttributeNS(null,"class","TravelNotes-SvgProfile-elevLegend"),n.setAttributeNS(null,"x",d),n.setAttributeNS(null,"y",e),n.setAttributeNS(null,"text-anchor","start"),t.appendChild(n);let i=document.createElementNS("http://www.w3.org/2000/svg","text");i.appendChild(document.createTextNode(l.toFixed(u))),i.setAttributeNS(null,"class","TravelNotes-SvgProfile-elevLegend"),i.setAttributeNS(null,"x",c),i.setAttributeNS(null,"y",e),i.setAttributeNS(null,"text-anchor","end"),t.appendChild(i),l+=r}}(),function(){const e=s.margin+s.height+s.margin/v;let o=Number.MAX_VALUE,n=0;s.hScales.forEach(e=>{let t=Math.abs(l.distance/8-e);t<o&&(o=t,n=e)});let a=Math.ceil(l.chainedDistance/n)*n;for(;a<l.distance+l.chainedDistance;){let o=document.createElementNS("http://www.w3.org/2000/svg","text");o.appendChild(document.createTextNode(1e3<n||u<l.chainedDistance?a/1e3+" km":a+" m ")),o.setAttributeNS(null,"class","TravelNotes-SvgProfile-distLegend"),o.setAttributeNS(null,"x",s.margin+(a-l.chainedDistance)*r),o.setAttributeNS(null,"y",e),o.setAttributeNS(null,"text-anchor","start"),t.appendChild(o),a+=n}}(),t}return Object.seal({smooth:e=>(function(e){let t=(l=e).itinerary.itineraryPoints.iterator,o=u,r=u;for(;!t.done;)o+=t.value.distance,r+=t.next?Math.abs(t.value.elev-t.next.elev):u;if(d=10*Math.floor(c/(r/o)),o<=v*f*d)return;let n=p();(t=l.itinerary.itineraryPoints.iterator).done;let a=t.value.distance;for(;!t.done;){let e=n.get(Math.floor(a/d)*d),o=n.get(Math.ceil(a/d)*d);if(e&&o){let r=a-e.distance,n=(o.elev-e.elev)/(o.distance-e.distance);t.value.elev=e.elev+r*n}a+=t.value.distance}})(e),createSvg:e=>h(e)})}function k(o){const n=40,a=9;let i=t(),l=D(),s=V(),d=e.note.svgIconWidth,c=o||"TravelNotes-Control-";function g(e){let t="";u!==e.tooltipContent.length&&(t+='<div class="'+c+'NoteHtml-TooltipContent">'+e.tooltipContent+"</div>"),u!==e.popupContent.length&&(t+='<div class="'+c+'NoteHtml-PopupContent">'+e.popupContent+"</div>"),u!==e.address.length&&(t+='<div class="'+c+'NoteHtml-Address">'+S.getText("NoteEditor - Address")+e.address+"</div>"),u!==e.phone.length&&(t+='<div class="'+c+'NoteHtml-Phone">'+S.getText("NoteEditor - Phone")+e.phone+"</div>"),u!==e.url.length&&(t+='<div class="'+c+'NoteHtml-Url">'+S.getText("NoteEditor - Link")+'<a href="'+e.url+'" target="_blank">'+e.url.substr(u,n)+"...</a></div>");let o=D();return t+='<div class="'+c+'NoteHtml-LatLng">'+S.getText("NoteEditor - Latitude Longitude",{lat:o.formatLat(e.lat),lng:o.formatLng(e.lng)})+"</div>",r.invalid!==e.distance&&(t+='<div class="'+c+'NoteHtml-Distance">'+S.getText("NoteEditor - Distance",{distance:o.formatDistance(e.chainedDistance+e.distance)})+"</div>"),t}function v(e,t){let o=i.create("div",{className:c+"Travel-Notes-IconCell",innerHTML:e.iconContent},t);"svg"===o.firstChild.tagName&&"TravelNotes-Roadbook-"===c&&o.firstChild.setAttributeNS(null,"viewBox","0 0 "+d+" "+d),i.create("div",{className:c+"Travel-Notes-Cell",innerHTML:g(e)},t),t.noteObjId=e.objId}function f(e){let t='<div class="'+c+'Route-Header-Name">'+e.name+"</div>";return u!==e.distance&&(t+='<div class="'+c+'Route-Header-Distance">'+S.getText("HTMLViewsFactory - Distance",{distance:l.formatDistance(e.distance)})+"</div>"),H.travel.readOnly||"bike"===e.itinerary.transitMode||(t+='<div class="'+c+'Route-Header-Duration">'+S.getText("HTMLViewsFactory - Duration",{duration:l.formatTime(e.duration)})+"</div>"),e.itinerary.hasProfile&&(t+='<div class="'+c+'Route-Header-Ascent">'+S.getText("HTMLViewsFactory - Ascent",{ascent:e.itinerary.ascent.toFixed(u)})+'</div><div class="'+c+'Route-Header-Descent">'+S.getText("HTMLViewsFactory - Descent",{descent:e.itinerary.descent.toFixed(u)})+"</div>"),t}function h(){let e=i.create("div",{className:c+"Travel-Header"});i.create("div",{className:c+"Travel-Header-Name",innerHTML:H.travel.name},e);let t=r.defaultValue,o=u,n=u,a=H.travel.routes.iterator;for(;!a.done;)i.create("div",{className:c+"Travel-Header-RouteName",innerHTML:'<a href="#route'+a.value.objId+'">'+a.value.name+"</a>&nbsp;:&nbsp;"+l.formatDistance(a.value.distance)+"."},e),a.value.chain&&(t+=a.value.distance,o+=a.value.itinerary.ascent,n+=a.value.itinerary.descent);return i.create("div",{className:c+"Travel-Header-TravelDistance",innerHTML:S.getText("HTMLViewsFactory - Travel distance&nbsp;:&nbsp;{distance}",{distance:l.formatDistance(t)})},e),u!==o&&i.create("div",{className:c+"Travel-Header-TravelAscent",innerHTML:S.getText("HTMLViewsFactory - Travel ascent&nbsp;:&nbsp;{ascent}",{ascent:o.toFixed(u)})},e),u!==n&&i.create("div",{className:c+"Travel-Header-TravelDescent",innerHTML:S.getText("HTMLViewsFactory - Travel descent&nbsp;:&nbsp;{descent}",{descent:n.toFixed(u)})},e),e}function m(){let e=i.create("div",{className:c+"Travel-Notes"}),t=H.travel.notes.iterator;for(;!t.done;){let o=i.create("div",{className:c+"Travel-Notes-Row"},e);v(t.value,o)}return e}function b(e){return i.create("div",{className:c+"Route-Header",id:"route"+e.objId,innerHTML:f(e)})}function y(e){let t=i.create("div",{className:c+"Route-ManeuversAndNotes"}),o=e.notes.iterator,n=o.done,s=n?Number.MAX_VALUE:o.value.distance,d=s,g=e.itinerary.maneuvers.iterator,f=g.done,h=r.defaultValue;for(;!f||!n;){let r=i.create("div",{className:c+"Route-ManeuversAndNotes-Row"},t);if(h<=s){if(!f){r.className=c+"Route-Maneuvers-Row",i.create("div",{className:c+"Route-ManeuversAndNotes-IconCell TravelNotes-ManeuverNote-"+g.value.iconName},r);let t="<div>"+g.value.instruction+"</div>";u<g.value.distance&&(t+="<div>"+S.getText("HTMLViewsFactory - To next instruction&nbsp;:&nbsp;{distance}&nbsp;-&nbsp;{duration}",{distance:l.formatDistance(g.value.distance),duration:l.formatTime(g.value.duration)})+"</div>"),i.create("div",{className:c+"Route-ManeuversAndNotes-Cell",innerHTML:t},r),r.objId=p(),r.latLng=e.itinerary.itineraryPoints.getAt(g.value.itineraryPointObjId).latLng,r.maneuverObjId=g.value.objId,h+=g.value.distance,(f=g.done)&&(h=Number.MAX_VALUE)}}else if(!n&&(r.className=c+"Route-Notes-Row",v(o.value,r),r.objId=p(),r.latLng=o.value.latLng,r.noteObjId=o.value.objId,d=o.value.distance,s=(n=o.done)?Number.MAX_VALUE:o.value.distance,!n)){let e=o.value.distance-d;a<e&&i.create("div",{className:c+"NoteHtml-NextDistance",innerHTML:S.getText("HTMLViewsFactory - Next distance&nbsp;:&nbsp;{distance}",{distance:l.formatDistance(e)})},r.lastChild)}}return t}function w(e){let t="";return""!==e.itinerary.provider&&""!==e.itinerary.transitMode&&(t=S.getText("HTMLViewsFactory - Itinerary computed by {provider} and optimized for {transitMode}",{provider:e.itinerary.provider,transitMode:S.getText("HTMLViewsFactory - TransitMode "+e.itinerary.transitMode)})),i.create("div",{className:c+"RouteFooter",innerHTML:t})}function j(){return i.create("div",{className:c+"TravelFooter",innerHTML:S.getText("HTMLViewsFactory - Travel footer")})}function T(e){let t=i.create("div",{className:c+"RouteProfile",innerHTML:S.getText("HTMLViewsFactory - Profile")});return t.appendChild(s.createSvg(e)),t}return Object.seal({get travelHeaderHTML(){return h()},get travelNotesHTML(){return m()},get routeHeaderHTML(){return b(H.travel.editedRoute)},get routeManeuversAndNotesHTML(){return y(H.travel.editedRoute)},get routeFooterHTML(){return w(H.travel.editedRoute)},get travelFooterHTML(){return j()},get travelHTML(){return function(){let t=i.create("div",{className:c+"Travel"});t.appendChild(h()),t.appendChild(m());let o=H.travel.routes.iterator;for(;!o.done;){let r=e.routeEditor.displayEditionInHTMLPage&&o.value.objId===H.editedRouteObjId?H.travel.editedRoute:o.value;t.appendChild(b(r)),r.itinerary.hasProfile&&t.appendChild(T(r)),t.appendChild(y(r)),t.appendChild(w(r))}return t.appendChild(j()),t}()},getRouteHTML:e=>f(e),getNoteHTML:e=>g(e)})}function z(e){let t=U().getRoute(e.target.objId),o=F().getClosestLatLngDistance(t,[e.latlng.lat,e.latlng.lng]).distance;o+=t.chainedDistance,o=D().formatDistance(o);let r=H.mapObjects.get(e.target.objId);r.closeTooltip();let n=t.name;H.travel.readOnly||(n+=u===n.length?"":" - ",n+=o),r.setTooltipContent(n),r.openTooltip(e.latlng)}const B=function(){const t=18,o=0;let r=U(),a=null,i=null;function s(e,t){t.objId=e,t.addTo(H.map),H.mapObjects.set(e,t)}function d(t){let o=r.getNoteAndRoute(t).note,n=H.travel.readOnly,a=L.marker(o.latLng,{icon:L.divIcon({iconSize:[e.note.grip.size,e.note.grip.size],iconAnchor:[e.note.grip.size/v,e.note.grip.size/v],html:"<div></div>"}),opacity:e.note.grip.opacity,draggable:!n});a.objId=o.objId;let i=L.divIcon({iconSize:[o.iconWidth,o.iconHeight],iconAnchor:[o.iconWidth/v,o.iconHeight/v],popupAnchor:[u,-o.iconHeight/v],html:o.iconContent,className:"TravelNotes-AllNotes "+e.note.style}),l=L.marker(o.iconLatLng,{zIndexOffset:100,icon:i,draggable:!n});l.objId=o.objId,l.bindPopup(e=>{let t=r.getNoteAndRoute(e.objId).note;return k("TravelNotes-").getNoteHTML(t)}),u!==o.tooltipContent.length&&(l.bindTooltip(e=>r.getNoteAndRoute(e.objId).note.tooltipContent),l.getTooltip().options.offset[u]=o.iconWidth/v);let d=L.polyline([o.latLng,o.iconLatLng],e.note.polyline);d.objId=o.objId;let c=L.layerGroup([l,d,a]);c.markerId=L.Util.stamp(l),c.polylineId=L.Util.stamp(d),c.bulletId=L.Util.stamp(a),s(o.objId,c)}function c(t){t.dashArray>=e.route.dashChoices.length&&(t.dashArray=u);let o=e.route.dashChoices[t.dashArray].iDashArray;if(o){let e="",r=u;for(r=u;r<o.length-g;r++)e+=o[r]*t.width+",";return e+=o[r]*t.width}return null}return Object.seal({addRoute:e=>(function(e){let t=r.getRoute(e),o=[],n=t.itinerary.itineraryPoints.iterator;for(;!n.done;)o.push(n.value.latLng);let a=L.polyline(o,{color:t.color,weight:t.width,dashArray:c(t)});s(t.objId,a),l.notEdited===t.edited&&(a.bindTooltip(t.name,{sticky:!0,direction:"right"}),a.on("mouseover",z),a.on("mousemove",z)),a.bindPopup(e=>{let t=r.getRoute(e.objId);return k("TravelNotes-").getRouteHTML(t)}),L.DomEvent.on(a,"click",e=>e.target.openPopup(e.latlng));let i=t.notes.iterator;for(;!i.done;)d(i.value.objId);return t})(e),addNote:e=>d(e),getDashArray:e=>c(e),zoomTo:(t,o)=>(function(t,o){if(o){let e=[];o.forEach(t=>e=e.concat(t)),H.map.fitBounds(F().getLatLngBounds(e))}else H.map.setView(t,e.itineraryPointZoom)})(t,o),setLayer:e=>(function(e){let r=null;r="wmts"===e.service.toLowerCase()?L.tileLayer(e.url):L.tileLayer.wms(e.url,e.wmsOptions),a&&H.map.removeLayer(a),H.map.addLayer(r),a=r,H.travel.readOnly||(H.map.getZoom()<(e.minZoom||o)&&H.map.setZoom(e.minZoom||o),H.map.setMinZoom(e.minZoom||o),H.map.getZoom()>(e.maxZoom||t)&&H.map.setZoom(e.maxZoom||t),H.map.setMaxZoom(e.maxZoom||t),e.bounds?(H.map.getBounds().intersects(e.bounds)&&!H.map.getBounds().contains(e.bounds)||(H.map.setMaxBounds(null),H.map.fitBounds(e.bounds),H.map.setZoom(e.minZoom||o)),H.map.setMaxBounds(e.bounds)):H.map.setMaxBounds(null)),H.map.fire("baselayerchange",r)})(e),onGeolocationStatusChanged:e=>(e=e,void(n.active!==e&&i&&(H.map.removeLayer(i),i=null))),onGeolocationPositionChanged:t=>(function(t){let o=e.geoLocation.zoomToPosition;i&&(H.map.removeLayer(i),o=!1),i=L.circleMarker(L.latLng(t.coords.latitude,t.coords.longitude),{radius:e.geoLocation.radius,color:e.geoLocation.color}).bindTooltip(D().formatLatLng([t.coords.latitude,t.coords.longitude])).addTo(H.map),o&&H.map.setView(L.latLng(t.coords.latitude,t.coords.longitude),e.geoLocation.zoomFactor)})(t)});var f}();function W(){function e(e,t){let o=function(e){return c<["setitinerary","updateitinerary","settravelnotes","updatetravelnotes","setsearch","updatesearch","expandrouteui","reducerouteui","setwaypointslist","setrouteslist","setprovider","providersadded","settransitmode"].indexOf(e)?document.getElementById("TravelNotes-Control-MainDiv"):c<["removeobject","removeallobjects","zoomto","additinerarypointmarker","addsearchpointmarker","addrectangle","addwaypoint","layerchange","geolocationstatuschanged","geolocationpositionchanged","routeupdated","routepropertiesupdated","noteupdated","roadbookupdate","travelnotesfileloaded","profileclosed"].indexOf(e)?document:null}(e);if(o){let r=new Event(e);t&&(r.data=t),o.dispatchEvent(r)}}return Object.seal({dispatch:(t,o)=>e(t,o)})}var Z={};function _(e){return Math.floor(Math.abs(e)+.5)*(e>=0?1:-1)}function X(e,t,o){var r=(e=_(e*o))-(t=_(t*o));r<<=1,e-t<0&&(r=~r);for(var n="";r>=32;)n+=String.fromCharCode(63+(32|31&r)),r>>=5;return n+=String.fromCharCode(r+63)}function G(e){for(var t=[],o=0;o<e.length;o++)t.push(e[o].slice().reverse());return t}function q(){const e=6;function t(t){let o={};u!==t.itinerary.itineraryPoints.length&&(o=t.itinerary.itineraryPoints[u].objType);let r={latLngs:[],distances:[],elevs:[],objIds:[],objType:o};t.itinerary.itineraryPoints.forEach(e=>{r.latLngs.push([e.lat,e.lng]),r.distances.push(e.distance),r.elevs.push(e.elev),r.objIds.push(e.objId)}),r.latLngs=Z.encode(r.latLngs,e),t.itinerary.itineraryPoints=r}function o(t){t.itinerary.itineraryPoints.latLngs=Z.decode(t.itinerary.itineraryPoints.latLngs,e);let o=[],r=u;t.itinerary.itineraryPoints.latLngs.forEach(e=>{let n={};n.lat=e[u],n.lng=e[g],n.distance=t.itinerary.itineraryPoints.distances[r],t.itinerary.itineraryPoints.elevs?n.elev=t.itinerary.itineraryPoints.elevs[r]:n.elev=a.defaultValue,n.objId=t.itinerary.itineraryPoints.objIds[r],n.objType=t.itinerary.itineraryPoints.objType,o.push(n),r++}),t.itinerary.itineraryPoints=o}function r(e){let t=e;return t.routes.forEach(o),t.editedRoute&&o(t.editedRoute),t}return Object.seal({decompress:e=>(e=e,H.travel.object=r(e),H.editedRouteObjId=d,void H.travel.routes.forEach(e=>{l.notEdited!==e.edited&&(H.editedRouteObjId=e.objId)})),decompressMerge:e=>(function(e){let t=C();t.object=r(e);let o=t.routes.iterator;for(;!o.done;)H.travel.routes.add(o.value);let n=t.notes.iterator;for(;!n.done;)H.travel.notes.add(n.value)})(e),compress:()=>(function(){let e=H.travel.object;return e.routes.forEach(t),t(e.editedRoute),e})()});var n}function J(){let e=W(),t=U(),o=[];function r(e){o.push(e.latLng),o.push(e.iconLatLng)}function n(e){e.itinerary.itineraryPoints.forEach(e=>o.push(e.latLng)),e.notes.forEach(e=>r(e))}return Object.seal({zoomToNote:o=>(o=o,void e.dispatch("zoomto",{latLng:t.getNoteAndRoute(o).note.latLng})),zoomToRoute:r=>(r=r,o=[],n(t.getRoute(r)),void e.dispatch("zoomto",{geometry:[o]})),zoomToTravel:()=>(o=[],H.travel.routes.forEach(e=>n(e)),d!==H.travel.editedRouteObjId&&n(H.travel.editedRoute),H.travel.notes.forEach(e=>r(e)),void e.dispatch("zoomto",{geometry:[o]}))});var a,i}function K(){let e=W();function t(){let t=H.travel.routes.iterator;for(;!t.done;)l.notEdited===t.value.edited&&e.dispatch("routeupdated",{removedRouteObjId:d,addedRouteObjId:t.value.objId});d!==H.editedRouteObjId&&e.dispatch("routeupdated",{removedRouteObjId:d,addedRouteObjId:H.travel.editedRoute.objId});let o=H.travel.notes.iterator;for(;!o.done;)e.dispatch("noteupdated",{removedNoteObjId:d,addedNoteObjId:o.value.objId});J().zoomToTravel(),e.dispatch("travelnotesfileloaded",{name:H.travel.name})}return Object.seal({openDistantFile:e=>(e=e,q().decompress(e),H.travel.readOnly=!0,void t()),display:()=>t()});var o}Z.decode=function(e,t){for(var o,r=0,n=0,a=0,i=[],l=0,s=0,d=null,c=Math.pow(10,Number.isInteger(t)?t:5);r<e.length;){d=null,l=0,s=0;do{s|=(31&(d=e.charCodeAt(r++)-63))<<l,l+=5}while(d>=32);o=1&s?~(s>>1):s>>1,l=s=0;do{s|=(31&(d=e.charCodeAt(r++)-63))<<l,l+=5}while(d>=32);n+=o,a+=1&s?~(s>>1):s>>1,i.push([n/c,a/c])}return i},Z.encode=function(e,t){if(!e.length)return"";for(var o=Math.pow(10,Number.isInteger(t)?t:5),r=X(e[0][0],0,o)+X(e[0][1],0,o),n=1;n<e.length;n++){var a=e[n],i=e[n-1];r+=X(a[0],i[0],o),r+=X(a[1],i[1],o)}return r},Z.fromGeoJSON=function(e,t){if(e&&"Feature"===e.type&&(e=e.geometry),!e||"LineString"!==e.type)throw new Error("Input must be a GeoJSON LineString");return Z.encode(G(e.coordinates),t)},Z.toGeoJSON=function(e,t){return{type:"LineString",coordinates:G(Z.decode(e,t))}},"object"==typeof module&&module.exports&&(module.exports=Z);const Q=1;const Y=function(){let e=null;return Object.seal({getOpenPromise:()=>new Promise(function(t,o){if(e)return void t();let r=window.indexedDB.open("TravelNotesDb",Q);r.onerror=function(){e=null,o(new Error("Not possible to open the db"))},r.onsuccess=function(o){e=o.target.result,t()},r.onupgradeneeded=function(t){(e=t.target.result).createObjectStore("Travels",{keyPath:"UUID"})}}),getReadPromise:t=>(t=t,new Promise(function(o,r){if(!e)return void r(new Error("Database not opened"));let n=e.transaction(["Travels"],"readonly");n.onerror=function(){r(new Error("Transaction error"))},n.objectStore("Travels").get(t).onsuccess=function(e){o(e.target.result?e.target.result.data:null)}})),getWritePromise:(t,o)=>(function(t,o){return new Promise(function(r,n){if(!e)return void n(new Error("Database not opened"));let a=null;try{a=e.transaction(["Travels"],"readwrite")}catch(e){return void n(e)}a.onerror=function(){n(new Error("Transaction error"))},a.objectStore("Travels").put({UUID:t,data:o}).onsuccess=function(){r()}})})(t,o),closeDb:t=>(function(t){if(!e)return;if(!t)return e.close(),void(e=null);let o=e.transaction(["Travels"],"readwrite");o.onerror=function(){};let r=o.objectStore("Travels").delete(t);r.onerror=function(){e.close(),e=null},r.onsuccess=function(){e.close(),e=null}})(t)});var t}();const $=function(){let e=null;function o(t){e.innerHTML='&copy; <a href="http://leafletjs.com/" target="_blank" title="Leaflet">Leaflet</a> | &copy; <a href="http://www.openstreetmap.org/copyright" target="_blank" title="OpenStreetMap contributors">OpenStreetMap contributors</a> '+t+'| &copy; <a href="https://github.com/wwwouaiebe" target="_blank" title="https://github.com/wwwouaiebe">Travel & Notes</a> '}return Object.seal({set attributions(e){o(e)},createUI:()=>(e=t().create("div",{id:"TravelNotes-AttributionsUI"},document.getElementsByTagName("body")[u]),void o(""))})}();const ee=function(){let t=n.disabled,o=null,r=W();function a(e){r.dispatch("geolocationpositionchanged",{position:e})}function i(){n.active===t&&(t=n.inactive),r.dispatch("geolocationstatuschanged",{status:t}),navigator.geolocation.clearWatch(o),o=null}function l(e){g===e.code&&(t=n.refusedByUser),i()}function s(){switch(t){case n.inactive:t=n.active,r.dispatch("geolocationstatuschanged",{status:t}),navigator.geolocation.getCurrentPosition(a,l,e.geoLocation.options),o=navigator.geolocation.watchPosition(a,l,e.geoLocation.options);break;case n.active:i()}return t}return t="geolocation"in navigator?n.inactive:n.disabled,Object.seal({get status(){return t},switch:()=>s()})}();const te=function(){let e=null,o=W(),r=t(),n=[{service:"wmts",url:"https://{s}.tile.osm.org/{z}/{x}/{y}.png",name:"OSM - Color",toolbar:{text:"OSM",color:"red",backgroundColor:"white"},providerName:"OSM",providerKeyNeeded:!1,attribution:'| &copy; <a href="http://www.openstreetmap.org/copyright" target="_blank" title="OpenStreetMap contributors">OpenStreetMap contributors</a> '}];function a(e){o.dispatch("layerchange",{layer:e.target.layer}),$.attributions=e.target.layer.attribution}function i(t){r.create("div",{className:"TravelNotes-ViewerLayersToolbarUI-Button",title:t.name,layer:t,innerHTML:t.toolbar.text,style:"color:"+t.toolbar.color+";background-color:"+t.toolbar.backgroundColor},e).addEventListener("click",e=>{e.stopPropagation(),a(e)},a,!1)}return Object.seal({createUI:()=>(e=r.create("div",{id:"TravelNotes-ViewerLayersToolbarUI"},document.getElementsByTagName("body")[u]),r.create("div",{className:"TravelNotes-ViewerLayersToolbarUI-Button",title:"My position",innerHTML:"&#x1f310;",style:"color:black;background-color:white"},e).addEventListener("click",e=>{e.stopPropagation(),ee.switch()},!1),r.create("div",{className:"TravelNotes-ViewerLayersToolbarUI-Button",title:"Zoom on the travel",innerHTML:"&#x1f50d;",style:"color:black;background-color:white"},e).addEventListener("click",e=>{e.stopPropagation(),J().zoomToTravel()},!1),void n.forEach(i)),setLayer:e=>(function(e){let t=n.find(t=>t.name===e)||n[u];o.dispatch("layerchange",{layer:t}),$.attributions=t.attribution})(e),setLayers:e=>(e=e,void e.forEach(e=>{e.providerKeyNeeded||n.push(e)}))});var l}();const oe=function(){function e(){document.addEventListener("routeupdated",e=>{e.data&&B.addRoute(e.data.addedRouteObjId)},!1),document.addEventListener("noteupdated",e=>{e.data&&(B.addNote(e.data.addedNoteObjId),function(){if(D().storageAvailable("localStorage")){let e=k("TravelNotes-Roadbook-");Y.getOpenPromise().then(()=>{Y.getWritePromise(H.UUID,e.travelHTML.outerHTML)}).then(()=>localStorage.setItem(H.UUID,Date.now())).catch(e=>console.log(e||"An error occurs when writing the content"))}}())},!1),document.addEventListener("zoomto",e=>{e.data&&B.zoomTo(e.data.latLng,e.data.geometry)},!1),document.addEventListener("layerchange",e=>{e.data&&B.setLayer(e.data.layer)}),document.addEventListener("geolocationpositionchanged",e=>{e.data&&B.onGeolocationPositionChanged(e.data.position)},!1),document.addEventListener("geolocationstatuschanged",e=>{e.data&&B.onGeolocationStatusChanged(e.data.status)},!1)}return Object.seal({addReadOnlyMap:(t,r)=>(t=t,r=r,e(),$.createUI(),r&&te.createUI(),te.setLayer("OSM - Color"),void(t&&o().getJsonPromise(t).then(K().openDistantFile).catch(e=>{console.log(e||"Not possible to load the .trv file"),H.map.setView([i.defaultValue,i.defaultValue],v)})))});var t,r}();!function(){let r=null,n=null,a=!1;decodeURI(window.location.search).substr(g).split("&").forEach(e=>{"fil="===e.substr(u,4).toLowerCase()?n=decodeURIComponent(escape(atob(e.substr(4)))):"lng="===e.substr(u,4).toLowerCase()?r=e.substr(4).toLowerCase():"lay"===e.substr(u,3).toLowerCase()&&(a=!0)}),window.L.travelNotes=oe;let l=o(),s=[l.getJsonPromise(window.location.href.substr(u,window.location.href.lastIndexOf("/")+g)+"TravelNotesConfig.json"),l.getJsonPromise(window.location.href.substr(u,window.location.href.lastIndexOf("/")+g)+"TravelNotes"+(r||e.language).toUpperCase()+".json"),l.getJsonPromise(window.location.href.substr(u,window.location.href.lastIndexOf("/")+g)+"TravelNotesLayers.json")];Promise.all(s).then(o=>{if(r&&(o[u].language=r),e.overload(o[u]),S.setTranslations(o[g]),te.setLayers(o[v]),e.autoLoad){t().create("div",{id:"Map"},document.getElementsByTagName("body")[u]);let e=window.L.map("Map",{attributionControl:!1,zoomControl:!1}).setView([i.defaultValue,i.defaultValue],u);H.map=e,oe.addReadOnlyMap(n,a)}}).catch(e=>console.log(e||"An error occurs when downloading the json configuration files"))}()}();